{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_01Bx2sNiw5pZALuvDKocYdUQ", "_ts": "2026-02-20T11:31:11+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_01Bx2sNiw5pZALuvDKocYdUQ", "_ts": "2026-02-20T11:31:11+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/docs", "description": "Create docs directory"}, "tool_use_id": "toolu_013q19d1Csp9cfJW5aqkMr9h", "_ts": "2026-02-20T11:31:12+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/docs", "description": "Create docs directory"}, "tool_response": {"stdout": "", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": true}, "tool_use_id": "toolu_013q19d1Csp9cfJW5aqkMr9h", "_ts": "2026-02-20T11:31:18+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Task", "tool_input": {"description": "Analyze requirements from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a requirements document.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a team/personal TODO system that works via DM with a Slack bot, using SQLite3 for storage, with commands like /todo add|list|board|move|done|drop|edit and project management commands. Key features include private/shared projects, due date parsing, assignee management via Slack mentions, and schema migration.\n\nProduce crisp requirements covering: functional requirements, non-functional requirements, scope, assumptions, constraints, and success metrics. Write in English.", "subagent_type": "requirement-analyst", "run_in_background": true}, "tool_use_id": "toolu_01M364bqdexvkDSJtcMGSLUW", "_ts": "2026-02-20T11:31:28+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "hook_event_name": "SubagentStart", "agent_id": "a8f503f", "agent_type": "requirement-analyst", "_ts": "2026-02-20T11:31:28+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Task", "tool_input": {"description": "Analyze requirements from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a requirements document.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a team/personal TODO system that works via DM with a Slack bot, using SQLite3 for storage, with commands like /todo add|list|board|move|done|drop|edit and project management commands. Key features include private/shared projects, due date parsing, assignee management via Slack mentions, and schema migration.\n\nProduce crisp requirements covering: functional requirements, non-functional requirements, scope, assumptions, constraints, and success metrics. Write in English.", "subagent_type": "requirement-analyst", "run_in_background": true}, "tool_response": {"isAsync": true, "status": "async_launched", "agentId": "a8f503f", "description": "Analyze requirements from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a requirements document.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a team/personal TODO system that works via DM with a Slack bot, using SQLite3 for storage, with commands like /todo add|list|board|move|done|drop|edit and project management commands. Key features include private/shared projects, due date parsing, assignee management via Slack mentions, and schema migration.\n\nProduce crisp requirements covering: functional requirements, non-functional requirements, scope, assumptions, constraints, and success metrics. Write in English.", "outputFile": "/private/tmp/claude-501/-Users-pillip-project-practice-openclaw-todo-plugin/tasks/a8f503f.output"}, "tool_use_id": "toolu_01M364bqdexvkDSJtcMGSLUW", "_ts": "2026-02-20T11:31:28+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_01E7EEt8oLYqQe2fFKVAQrFW", "_ts": "2026-02-20T11:31:31+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_01E7EEt8oLYqQe2fFKVAQrFW", "_ts": "2026-02-20T11:31:31+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_01BAVkyGeE5KXxXQrEvUXDGQ", "_ts": "2026-02-20T11:31:31+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": ["/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/info/exclude", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/description", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-rebase.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/sendemail-validate.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/applypatch-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/fsmonitor-watchman.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-receive.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/prepare-commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/post-update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-merge-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-applypatch.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-push.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/push-to-checkout.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.pack", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.idx", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.rev", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/packed-refs", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/info/exclude", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/description", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-rebase.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/sendemail-validate.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/applypatch-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/fsmonitor-watchman.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-receive.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/prepare-commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/post-update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-merge-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-applypatch.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-push.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/push-to-checkout.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/prd-writer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/reviewer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/architect.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/debugger.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/documenter.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/ux-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/developer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/migrator.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/refactorer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/requirement-analyst.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/planner.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/qa-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/devops.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/kickoff/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/devops/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/migrate/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/review/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/prd/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/implement/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/ship/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/refactor/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/debug/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.pack", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.idx", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.rev", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/packed-refs", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/.git", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/config", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/.gitignore", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/architect.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/debugger.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/developer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/devops.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/documenter.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/migrator.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/planner.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/prd-writer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/qa-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/refactorer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/requirement-analyst.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/reviewer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/ux-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/PRD_agent_system_v0.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/example_prd.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/settings.snippet.json", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/scripts/ensure_gh.sh"], "durationMs": 602, "numFiles": 100, "truncated": true}, "tool_use_id": "toolu_01BAVkyGeE5KXxXQrEvUXDGQ", "_ts": "2026-02-20T11:31:32+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Task", "tool_input": {"description": "Design UX spec from PRD", "prompt": "You are a UX designer. Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a UX specification document.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a DM-based TODO system with commands like /todo add|list|board|move|done|drop|edit and project management. The interaction is text-based in Slack DM.\n\nWrite a UX spec covering:\n- User flows (primary flows for each command)\n- Input/output formats and examples\n- Error messages and edge cases\n- Response formatting (how bot replies look)\n- Interaction patterns\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md in English.", "subagent_type": "general-purpose", "run_in_background": true}, "tool_use_id": "toolu_01UntXoPGA1LnHbw2Jf8zv68", "_ts": "2026-02-20T11:31:32+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Task", "tool_input": {"description": "Design UX spec from PRD", "prompt": "You are a UX designer. Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a UX specification document.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a DM-based TODO system with commands like /todo add|list|board|move|done|drop|edit and project management. The interaction is text-based in Slack DM.\n\nWrite a UX spec covering:\n- User flows (primary flows for each command)\n- Input/output formats and examples\n- Error messages and edge cases\n- Response formatting (how bot replies look)\n- Interaction patterns\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md in English.", "subagent_type": "general-purpose", "run_in_background": true}, "tool_response": {"isAsync": true, "status": "async_launched", "agentId": "a78d2f0", "description": "Design UX spec from PRD", "prompt": "You are a UX designer. Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and produce a UX specification document.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack — a DM-based TODO system with commands like /todo add|list|board|move|done|drop|edit and project management. The interaction is text-based in Slack DM.\n\nWrite a UX spec covering:\n- User flows (primary flows for each command)\n- Input/output formats and examples\n- Error messages and edge cases\n- Response formatting (how bot replies look)\n- Interaction patterns\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md in English.", "outputFile": "/private/tmp/claude-501/-Users-pillip-project-practice-openclaw-todo-plugin/tasks/a78d2f0.output"}, "tool_use_id": "toolu_01UntXoPGA1LnHbw2Jf8zv68", "_ts": "2026-02-20T11:31:32+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "hook_event_name": "SubagentStart", "agent_id": "a78d2f0", "agent_type": "general-purpose", "_ts": "2026-02-20T11:31:32+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_014fGPJYkxxTs1SDVuevMMmz", "_ts": "2026-02-20T11:31:35+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_014fGPJYkxxTs1SDVuevMMmz", "_ts": "2026-02-20T11:31:35+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Task", "tool_input": {"description": "Design architecture from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and design the software architecture.\n\nThis is a Python-based OpenClaw plugin for Slack TODO management. Key tech decisions from PRD:\n- SQLite3 database with WAL mode\n- OpenClaw plugin system (not a standalone app)\n- Slack DM-based interaction\n- Commands: /todo add|list|board|move|done|drop|edit + project commands\n- Private/shared project system\n- Schema migration support\n\nThe project uses uv for package management and pytest for testing (per project conventions).\n\nDesign a pragmatic architecture. Since this is a plugin (not a web app), do NOT use Django. Focus on:\n- Module/package structure\n- Key classes and their responsibilities\n- Data access layer design\n- Command parsing and routing\n- Error handling strategy\n- Database schema and migration approach\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "subagent_type": "architect", "run_in_background": true}, "tool_use_id": "toolu_01CSn8shV8UXaXvNo1xTPfYr", "_ts": "2026-02-20T11:31:38+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Task", "tool_input": {"description": "Design architecture from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and design the software architecture.\n\nThis is a Python-based OpenClaw plugin for Slack TODO management. Key tech decisions from PRD:\n- SQLite3 database with WAL mode\n- OpenClaw plugin system (not a standalone app)\n- Slack DM-based interaction\n- Commands: /todo add|list|board|move|done|drop|edit + project commands\n- Private/shared project system\n- Schema migration support\n\nThe project uses uv for package management and pytest for testing (per project conventions).\n\nDesign a pragmatic architecture. Since this is a plugin (not a web app), do NOT use Django. Focus on:\n- Module/package structure\n- Key classes and their responsibilities\n- Data access layer design\n- Command parsing and routing\n- Error handling strategy\n- Database schema and migration approach\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "subagent_type": "architect", "run_in_background": true}, "tool_response": {"isAsync": true, "status": "async_launched", "agentId": "a57985d", "description": "Design architecture from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and design the software architecture.\n\nThis is a Python-based OpenClaw plugin for Slack TODO management. Key tech decisions from PRD:\n- SQLite3 database with WAL mode\n- OpenClaw plugin system (not a standalone app)\n- Slack DM-based interaction\n- Commands: /todo add|list|board|move|done|drop|edit + project commands\n- Private/shared project system\n- Schema migration support\n\nThe project uses uv for package management and pytest for testing (per project conventions).\n\nDesign a pragmatic architecture. Since this is a plugin (not a web app), do NOT use Django. Focus on:\n- Module/package structure\n- Key classes and their responsibilities\n- Data access layer design\n- Command parsing and routing\n- Error handling strategy\n- Database schema and migration approach\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "outputFile": "/private/tmp/claude-501/-Users-pillip-project-practice-openclaw-todo-plugin/tasks/a57985d.output"}, "tool_use_id": "toolu_01CSn8shV8UXaXvNo1xTPfYr", "_ts": "2026-02-20T11:31:38+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/docs", "description": "Create docs directory"}, "tool_use_id": "toolu_0171S6fYGhVRxRUbaeT42oSF", "_ts": "2026-02-20T11:31:39+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/docs", "description": "Create docs directory"}, "tool_response": {"stdout": "", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": true}, "tool_use_id": "toolu_0171S6fYGhVRxRUbaeT42oSF", "_ts": "2026-02-20T11:31:39+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_012nFoNsJeDrxgGzSaJM11eb", "_ts": "2026-02-20T11:31:41+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_012nFoNsJeDrxgGzSaJM11eb", "_ts": "2026-02-20T11:31:41+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_01Y7xdVifdnHwkCukk62j9xJ", "_ts": "2026-02-20T11:31:41+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": ["/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/info/exclude", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/description", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-rebase.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/sendemail-validate.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/applypatch-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/fsmonitor-watchman.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-receive.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/prepare-commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/post-update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-merge-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-applypatch.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/pre-push.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/hooks/push-to-checkout.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.pack", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.idx", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/objects/pack/pack-63ec6b0dc8c5da799a8300af63320c984b8a15fc.rev", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/packed-refs", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/logs/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/info/exclude", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/description", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-rebase.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/sendemail-validate.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/applypatch-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/fsmonitor-watchman.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-receive.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/prepare-commit-msg.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/post-update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-merge-commit.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-applypatch.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/pre-push.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/update.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/hooks/push-to-checkout.sample", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/prd-writer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/reviewer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/architect.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/debugger.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/documenter.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/ux-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/developer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/migrator.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/refactorer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/requirement-analyst.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/planner.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/qa-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/devops.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/kickoff/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/devops/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/migrate/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/review/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/prd/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/implement/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/ship/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/refactor/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/skills/debug/SKILL.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.pack", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.idx", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/objects/pack/pack-ba05b861ecd63a5ca4d1429f5692b5022f6b8c5e.rev", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/packed-refs", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/refs/remotes/origin/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/HEAD", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/logs/refs/heads/main", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/.git", "/Users/pillip/project/practice/openclaw_todo_plugin/.git/modules/.claude-kit/config", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/.gitignore", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/architect.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/debugger.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/developer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/devops.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/documenter.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/migrator.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/planner.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/prd-writer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/qa-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/refactorer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/requirement-analyst.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/reviewer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/agents/ux-designer.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/PRD_agent_system_v0.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/README.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/docs/example_prd.md", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/settings.snippet.json", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/scripts/ensure_gh.sh"], "durationMs": 415, "numFiles": 100, "truncated": true}, "tool_use_id": "toolu_01Y7xdVifdnHwkCukk62j9xJ", "_ts": "2026-02-20T11:31:42+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Task", "tool_input": {"description": "Create issue plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and break the requirements into small, implementable issues.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack with these milestones (from PRD section 10):\n- M0: plugin skeleton + /todo command registration\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due correction)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private validation)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/deployment\n\nBreak these into small issues with clear acceptance criteria. Each issue should be independently implementable. Use the milestone structure from the PRD.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/issues.md\n\nFormat each issue with: issue number, title, milestone, description, acceptance criteria, dependencies (if any).", "subagent_type": "planner", "run_in_background": true}, "tool_use_id": "toolu_01FiJGBPCeEm1AQXtD8NHYDC", "_ts": "2026-02-20T11:31:42+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Task", "tool_input": {"description": "Create issue plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and break the requirements into small, implementable issues.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack with these milestones (from PRD section 10):\n- M0: plugin skeleton + /todo command registration\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due correction)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private validation)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/deployment\n\nBreak these into small issues with clear acceptance criteria. Each issue should be independently implementable. Use the milestone structure from the PRD.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/issues.md\n\nFormat each issue with: issue number, title, milestone, description, acceptance criteria, dependencies (if any).", "subagent_type": "planner", "run_in_background": true}, "tool_response": {"isAsync": true, "status": "async_launched", "agentId": "a5b42a7", "description": "Create issue plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and break the requirements into small, implementable issues.\n\nThe PRD describes an OpenClaw TODO Plugin for Slack with these milestones (from PRD section 10):\n- M0: plugin skeleton + /todo command registration\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due correction)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private validation)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/deployment\n\nBreak these into small issues with clear acceptance criteria. Each issue should be independently implementable. Use the milestone structure from the PRD.\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/issues.md\n\nFormat each issue with: issue number, title, milestone, description, acceptance criteria, dependencies (if any).", "outputFile": "/private/tmp/claude-501/-Users-pillip-project-practice-openclaw-todo-plugin/tasks/a5b42a7.output"}, "tool_use_id": "toolu_01FiJGBPCeEm1AQXtD8NHYDC", "_ts": "2026-02-20T11:31:42+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_01SLvcw8E4kYrHk29G4v2DTA", "_ts": "2026-02-20T11:31:45+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_01SLvcw8E4kYrHk29G4v2DTA", "_ts": "2026-02-20T11:31:45+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/architect.md"}, "tool_use_id": "toolu_01VUbG7K4Z6PfDavPmuKPkC3", "_ts": "2026-02-20T11:31:45+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/architect.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/.claude/agents/architect.md", "content": "---\nname: architect\ndescription: Design pragmatic software architecture for the PRD. Prefer Django monolith + Postgres.\ntools: Read, Glob, Grep, Write, Edit\nmodel: opus\n---\nOutput: docs/architecture.md only.\nInclude modules, data model, APIs, jobs, observability, security, deploy/rollback, tradeoffs.\n", "numLines": 9, "startLine": 1, "totalLines": 9}}, "tool_use_id": "toolu_01VUbG7K4Z6PfDavPmuKPkC3", "_ts": "2026-02-20T11:31:45+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit"}, "tool_use_id": "toolu_01DuDusEmrihFfb9zbu3tFjk", "_ts": "2026-02-20T11:31:46+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUseFailure", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit"}, "tool_use_id": "toolu_01DuDusEmrihFfb9zbu3tFjk", "error": "EISDIR: illegal operation on a directory, read '/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit'", "is_interrupt": false, "_ts": "2026-02-20T11:31:46+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/README.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/README.md", "content": "# openclaw_todo_plugin", "numLines": 1, "startLine": 1, "totalLines": 1}}, "tool_use_id": "toolu_01DWia2zuPNUU6cqo2fEkT8F", "_ts": "2026-02-20T11:31:46+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Task", "tool_input": {"description": "Design test plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and create a test strategy and test cases document.\n\nThe project is a Python-based OpenClaw TODO Plugin for Slack with:\n- Command parsing (mentions, /p, /s, due dates)\n- SQLite3 database operations\n- Private/shared project access control\n- Multiple commands: add, list, board, move, done, drop, edit\n- Project management: list, set-private, set-shared\n- Schema migration\n\nTesting framework: pytest (per project conventions)\n\nCreate test cases (not test code) covering:\n- Unit tests for parser, commands, DB operations\n- Integration/E2E tests for full command flows\n- Edge cases from the PRD (private project restrictions, due date parsing, name conflicts)\n- Acceptance criteria validation\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "subagent_type": "qa-designer", "run_in_background": true}, "tool_use_id": "toolu_01SHYMDvWFrwqXywambUaRPh", "_ts": "2026-02-20T11:31:47+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Task", "tool_input": {"description": "Design test plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and create a test strategy and test cases document.\n\nThe project is a Python-based OpenClaw TODO Plugin for Slack with:\n- Command parsing (mentions, /p, /s, due dates)\n- SQLite3 database operations\n- Private/shared project access control\n- Multiple commands: add, list, board, move, done, drop, edit\n- Project management: list, set-private, set-shared\n- Schema migration\n\nTesting framework: pytest (per project conventions)\n\nCreate test cases (not test code) covering:\n- Unit tests for parser, commands, DB operations\n- Integration/E2E tests for full command flows\n- Edge cases from the PRD (private project restrictions, due date parsing, name conflicts)\n- Acceptance criteria validation\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "subagent_type": "qa-designer", "run_in_background": true}, "tool_response": {"isAsync": true, "status": "async_launched", "agentId": "a03d4ab", "description": "Design test plan from PRD", "prompt": "Read the PRD at /Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md and create a test strategy and test cases document.\n\nThe project is a Python-based OpenClaw TODO Plugin for Slack with:\n- Command parsing (mentions, /p, /s, due dates)\n- SQLite3 database operations\n- Private/shared project access control\n- Multiple commands: add, list, board, move, done, drop, edit\n- Project management: list, set-private, set-shared\n- Schema migration\n\nTesting framework: pytest (per project conventions)\n\nCreate test cases (not test code) covering:\n- Unit tests for parser, commands, DB operations\n- Integration/E2E tests for full command flows\n- Edge cases from the PRD (private project restrictions, due date parsing, name conflicts)\n- Acceptance criteria validation\n\nWrite the output to /Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "outputFile": "/private/tmp/claude-501/-Users-pillip-project-practice-openclaw-todo-plugin/tasks/a03d4ab.output"}, "tool_use_id": "toolu_01SHYMDvWFrwqXywambUaRPh", "_ts": "2026-02-20T11:31:47+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*.py", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_019WNn2guU9H18MJKRqpWq8Q", "_ts": "2026-02-20T11:31:49+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*.py", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": ["/Users/pillip/project/practice/openclaw_todo_plugin/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/scripts/merge_settings.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_integration.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_merge_settings.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/user/kit/bin/cc-statusline.py"], "durationMs": 421, "numFiles": 7, "truncated": false}, "tool_use_id": "toolu_019WNn2guU9H18MJKRqpWq8Q", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_01Y1qFzcwj92pZt9QvK9Eu4e", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/pyproject.toml", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_014GAEkJXy3hYJfXa7fq1UD7", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_01Y1qFzcwj92pZt9QvK9Eu4e", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*.py", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_01TWxxfs4bJfN6HHhaE2TRxx", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/pyproject.toml", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": [], "durationMs": 392, "numFiles": 0, "truncated": false}, "tool_use_id": "toolu_014GAEkJXy3hYJfXa7fq1UD7", "_ts": "2026-02-20T11:31:50+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/*.py", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": ["/Users/pillip/project/practice/openclaw_todo_plugin/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/project/.claude/hooks/agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/scripts/merge_settings.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_agent_state.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_integration.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/tests/test_merge_settings.py", "/Users/pillip/project/practice/openclaw_todo_plugin/.claude-kit/user/kit/bin/cc-statusline.py"], "durationMs": 324, "numFiles": 7, "truncated": false}, "tool_use_id": "toolu_01TWxxfs4bJfN6HHhaE2TRxx", "_ts": "2026-02-20T11:31:51+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "ac18102", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-ac18102.jsonl", "agent_type": "", "_ts": "2026-02-20T11:31:53+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/tasklist*.md", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_01Rep1yksspY6475BXnMGaZJ", "_ts": "2026-02-20T11:31:54+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/tasklist*.md", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": [], "durationMs": 413, "numFiles": 0, "truncated": false}, "tool_use_id": "toolu_01Rep1yksspY6475BXnMGaZJ", "_ts": "2026-02-20T11:31:54+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/pyproject.toml", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_use_id": "toolu_01M4pn3Le3PngsfQKzMcYLQm", "_ts": "2026-02-20T11:31:54+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Glob", "tool_input": {"pattern": "**/pyproject.toml", "path": "/Users/pillip/project/practice/openclaw_todo_plugin"}, "tool_response": {"filenames": [], "durationMs": 525, "numFiles": 0, "truncated": false}, "tool_use_id": "toolu_01M4pn3Le3PngsfQKzMcYLQm", "_ts": "2026-02-20T11:31:55+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md", "content": "# OpenClaw TODO Plugin -- Requirements Document\n\n> **Version**: 1.0\n> **Date**: 2026-02-20\n> **Source PRD**: `openclaw_todo_plugin_prd.md` v1.1\n> **Status**: Draft\n\n---\n\n## 1. Purpose\n\nDefine the functional and non-functional requirements for a Slack-based TODO management plugin (OpenClaw TODO Plugin). The plugin operates via DM with a Slack bot, stores data in SQLite3, and supports private/shared project workflows with zero LLM cost.\n\n---\n\n## 2. Scope\n\n### 2.1 In Scope (MVP / v1)\n\n| Area | Details |\n|------|---------|\n| **Command interface** | `/todo add`, `list`, `board`, `move`, `done`, `drop`, `edit` |\n| **Project management** | `/todo project list`, `set-private`, `set-shared` |\n| **Storage** | Single shared SQLite3 file with WAL mode |\n| **Input channel** | DM with the OpenClaw Slack bot (primary path) |\n| **Due date parsing** | `YYYY-MM-DD` and `MM-DD` with year inference |\n| **Assignee resolution** | Slack `<@U...>` mentions; multi-assignee support |\n| **Visibility model** | Private (owner-only) and shared projects |\n| **Schema migration** | `schema_version` table; auto-create DB and default `Inbox` project on first run |\n| **Audit log** | `events` table recording actor, action, task, and payload |\n\n### 2.2 Out of Scope\n\n- Natural language / LLM-based task creation (Phase 2).\n- Channel or thread-based usage (app mention `@openclaw /todo ...`).\n- Recurring / repeating tasks.\n- Reminders, notifications, or scheduled digests.\n- Multi-workspace federation or cross-workspace sharing.\n- Web UI or dashboard.\n- Task attachments or file uploads.\n- Real-time sync with external project management tools.\n\n---\n\n## 3. Assumptions\n\n| # | Assumption |\n|---|-----------|\n| A1 | The OpenClaw Gateway is already deployed and can route DM messages to plugins. |\n| A2 | Each Slack user has a unique, stable `user_id` (`U...` format). |\n| A3 | A single SQLite3 file is sufficient for the expected concurrency (small-to-medium teams). |\n| A4 | Server timezone is `Asia/Seoul` for date inference. |\n| A5 | The bot has DM read/write permissions via Slack OAuth scopes. |\n| A6 | Plugin packaging and distribution follows existing OpenClaw conventions (npm). |\n\n---\n\n## 4. Constraints\n\n| # | Constraint |\n|---|-----------|\n| C1 | Zero LLM calls -- all parsing is deterministic. |\n| C2 | SQLite3 only; no external database dependency. |\n| C3 | DB file location fixed at `~/.openclaw/workspace/.todo/todo.sqlite3`. |\n| C4 | Section values are a closed enum: `backlog`, `doing`, `waiting`, `done`, `drop`. |\n| C5 | Status values are a closed enum: `open`, `done`, `dropped`. |\n\n---\n\n## 5. Risks\n\n| # | Risk | Likelihood | Impact | Mitigation |\n|---|------|-----------|--------|-----------|\n| R1 | SQLite write contention under high concurrency | Medium | Medium | WAL mode + `busy_timeout=3000`; monitor lock wait times. |\n| R2 | Project name collision confusion (private vs shared same name) | Medium | Low | Private-first resolution + operational guidance to avoid same names. |\n| R3 | Schema migration failure corrupts DB | Low | High | Wrap migrations in transactions; back up DB file before migration. |\n| R4 | Slack API rate limits on bot DM responses | Low | Medium | Queue responses; respect Slack rate limit headers. |\n| R5 | Date parsing edge cases (leap years, locale) | Low | Low | Strict `datetime` validation; reject invalid dates with clear error. |\n\n---\n\n## 6. Functional Requirements\n\n### FR-1: Command Parser\n\n| ID | Requirement |\n|----|------------|\n| FR-1.1 | The plugin MUST recognize messages starting with `/todo` as commands and ignore all other messages. |\n| FR-1.2 | The parser MUST extract tokens: title text, `<@U...>` mentions, `/p <project>`, `/s <section>`, and `due:` value. |\n| FR-1.3 | `due:MM-DD` or `due:M-D` MUST be expanded to `due:YYYY-MM-DD` using the current server year. |\n| FR-1.4 | Invalid dates (e.g., `02-30`) MUST return a user-facing error. |\n| FR-1.5 | `due:-` MUST clear (set to NULL) the due date. |\n\n### FR-2: Task Commands\n\n#### FR-2.1 `/todo add`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.1.1 | Create a task with provided title, assignees, project, section, and due date. |\n| FR-2.1.2 | Defaults: project=`Inbox`, section=`backlog`, assignees=sender, due=NULL. |\n| FR-2.1.3 | If the target project does not exist and is `Inbox`, auto-create it as shared. |\n| FR-2.1.4 | If the target is a private project and any assignee is not the owner, reject with a warning message and do not create the task. |\n| FR-2.1.5 | Return a confirmation message including: task ID, project, section, due, assignees, and title. |\n\n**Acceptance Criteria (add)**:\n- AC-2.1.A: Running `/todo add Buy milk` creates task #N in Inbox/backlog with sender as assignee; response contains `Added #N`.\n- AC-2.1.B: Running `/todo add Deploy <@U2> /p Ops /s doing due:03-15` creates a task in project Ops, section doing, due set to current-year-03-15, assignee U2.\n- AC-2.1.C: Running `/todo add Secret <@U2> /p MyPrivate` where MyPrivate is a private project owned by sender returns a warning and does NOT create the task.\n- AC-2.1.D: Running `/todo add First task` when no DB file exists triggers DB creation, schema application, Inbox project creation, then creates the task.\n\n#### FR-2.2 `/todo list`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.2.1 | List tasks filtered by scope (`mine`/`all`/`<@USER>`), project, section, and status. |\n| FR-2.2.2 | Defaults: scope=`mine`, status=`open`, limit=30. |\n| FR-2.2.3 | Sort order: due (non-null first, ascending), then id descending. |\n| FR-2.2.4 | `all` scope returns shared tasks plus sender's private project tasks; never shows other users' private tasks. |\n\n**Acceptance Criteria (list)**:\n- AC-2.2.A: `/todo list` returns only open tasks where sender is an assignee, limited to 30, sorted by due then id.\n- AC-2.2.B: `/todo list all` includes tasks from shared projects and the sender's private projects, but excludes other users' private project tasks.\n- AC-2.2.C: `/todo list /p Ops /s doing` returns only tasks in project Ops, section doing.\n\n#### FR-2.3 `/todo board`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.3.1 | Display tasks grouped by section in order: BACKLOG, DOING, WAITING, DONE, DROP. |\n| FR-2.3.2 | Defaults: scope=`mine`, status=`open`, limitPerSection=10. |\n| FR-2.3.3 | Each item shows: `#id due assignees title`. |\n\n**Acceptance Criteria (board)**:\n- AC-2.3.A: `/todo board /p Ops` displays tasks grouped under section headers in the correct order.\n- AC-2.3.B: Each section contains at most 10 items by default.\n\n#### FR-2.4 `/todo move`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.4.1 | Move a task to a specified section. |\n| FR-2.4.2 | Validate section against the enum. |\n| FR-2.4.3 | Authorization: private project -- owner only; shared project -- assignee or created_by. |\n\n**Acceptance Criteria (move)**:\n- AC-2.4.A: `/todo move 42 doing` updates task #42 section to doing and returns confirmation.\n- AC-2.4.B: A user who is neither assignee nor creator of a shared task receives an authorization error.\n\n#### FR-2.5 `/todo done` and `/todo drop`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.5.1 | `/todo done <id>`: set section=`done`, status=`done`, record `closed_at`. |\n| FR-2.5.2 | `/todo drop <id>`: set section=`drop`, status=`dropped`, record `closed_at`. |\n| FR-2.5.3 | Authorization rules match FR-2.4.3. |\n\n**Acceptance Criteria (done/drop)**:\n- AC-2.5.A: `/todo done 42` sets task #42 to done status with a non-null `closed_at` timestamp.\n- AC-2.5.B: `/todo drop 42` sets task #42 to dropped status with a non-null `closed_at` timestamp.\n\n#### FR-2.6 `/todo edit`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.6.1 | Update a task's title, assignees, project, section, and/or due date. |\n| FR-2.6.2 | If mentions are provided, assignees are fully replaced (not appended). |\n| FR-2.6.3 | `due:-` clears the due date. |\n| FR-2.6.4 | If editing moves a task into or within a private project and any assignee is not the owner, reject with a warning. |\n| FR-2.6.5 | Title is inferred from text preceding option tokens; if empty, title is unchanged. |\n\n**Acceptance Criteria (edit)**:\n- AC-2.6.A: `/todo edit 42 New title due:04-01` updates both title and due date; response confirms changes.\n- AC-2.6.B: `/todo edit 42 <@U3>` replaces all assignees with U3 only.\n- AC-2.6.C: `/todo edit 42 due:-` sets due to NULL.\n\n### FR-3: Project Commands\n\n#### FR-3.1 `/todo project list`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.1.1 | Return all shared projects and the sender's private projects. |\n| FR-3.1.2 | Never expose other users' private projects. |\n\n#### FR-3.2 `/todo project set-private <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.2.1 | If the sender already owns a private project with `<name>`, return success (idempotent). |\n| FR-3.2.2 | If a shared project `<name>` exists, attempt to convert it to private (owner=sender). |\n| FR-3.2.3 | Before conversion, scan all tasks in the project. If ANY task has an assignee who is not the sender, reject with an error listing up to 10 violating task IDs and assignees. |\n| FR-3.2.4 | If neither exists, create a new private project with owner=sender. |\n\n**Acceptance Criteria (set-private)**:\n- AC-3.2.A: Converting a shared project with only owner-assigned tasks succeeds; project visibility becomes `private`.\n- AC-3.2.B: Converting a shared project where task #12 is assigned to `<@U2>` fails with an error message containing `#12` and `<@U2>`.\n- AC-3.2.C: Running `set-private NewProj` when no project exists creates a private project owned by sender.\n\n#### FR-3.3 `/todo project set-shared <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.3.1 | If a shared project `<name>` exists, no-op. |\n| FR-3.3.2 | If it does not exist, create it. |\n| FR-3.3.3 | If a shared project with `<name>` already exists (global uniqueness conflict), return an error. |\n\n### FR-4: Project Name Resolution\n\n| ID | Requirement |\n|----|------------|\n| FR-4.1 | When `/p <name>` is specified, resolve by: (1) sender's private project with that name, (2) shared project with that name, (3) error or auto-create per context. |\n| FR-4.2 | Shared project names MUST be globally unique. |\n| FR-4.3 | Private project names MUST be unique per owner. |\n\n### FR-5: Database Initialization\n\n| ID | Requirement |\n|----|------------|\n| FR-5.1 | On first command or gateway startup, create the directory `~/.openclaw/workspace/.todo/` if absent. |\n| FR-5.2 | Create `todo.sqlite3` with the full v1 schema if the file does not exist. |\n| FR-5.3 | Create `schema_version` table and set version=1. |\n| FR-5.4 | Auto-create shared project `Inbox` (idempotent). |\n| FR-5.5 | Set `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000` on every connection. |\n\n**Acceptance Criteria (DB init)**:\n- AC-5.A: Deleting the DB file and running any `/todo` command recreates the DB with all tables and the `Inbox` project.\n- AC-5.B: `schema_version` table contains exactly one row with `version=1`.\n\n### FR-6: Audit Events\n\n| ID | Requirement |\n|----|------------|\n| FR-6.1 | Every state-changing command (add, move, done, drop, edit, set-private, set-shared) MUST insert a row into the `events` table. |\n| FR-6.2 | Each event records: timestamp, actor user ID, action name, task ID (if applicable), and a JSON payload with before/after state. |\n\n---\n\n## 7. Non-Functional Requirements\n\n| ID | Requirement | Metric |\n|----|------------|--------|\n| NFR-1 | **Latency**: Command response time | p95 < 500ms for any single command (excluding Slack network round-trip). |\n| NFR-2 | **Reliability**: No data loss on concurrent writes | Zero data corruption over 1000 concurrent write operations using WAL mode. |\n| NFR-3 | **Availability**: Plugin uptime | Matches OpenClaw Gateway uptime; no independent failure modes. |\n| NFR-4 | **Correctness**: Date parsing | 100% of valid `YYYY-MM-DD` and `MM-DD` inputs produce correct stored dates; 100% of invalid dates return errors. |\n| NFR-5 | **Security**: Private project isolation | Zero information leakage: private project tasks MUST never appear in another user's list/board output. |\n| NFR-6 | **Testability**: Unit + integration test coverage | >= 80% line coverage on parser and command handler modules. |\n| NFR-7 | **Maintainability**: Schema migration | Forward-only migrations; each migration is idempotent and wrapped in a transaction. |\n| NFR-8 | **Capacity**: Task volume | Support up to 100,000 tasks per DB file without degradation beyond NFR-1. |\n\n---\n\n## 8. Success Metrics\n\n| Metric | Target | Measurement |\n|--------|--------|------------|\n| Command success rate | >= 99% of well-formed commands execute without error | `events` table: count(success) / count(total) |\n| Adoption | >= 5 active users within 2 weeks of deployment | Distinct `actor_user_id` in events table |\n| Task throughput | >= 50 tasks created per week across team | Weekly count of `add` events |\n| Mean response time | < 300ms (p50) | Instrumented timer in command handler |\n| Test pass rate | 100% on CI before merge | pytest exit code |\n\n---\n\n## 9. Data Model Summary\n\nFour core tables plus one metadata table:\n\n- **projects** (id, name, visibility, owner_user_id, created_at, updated_at)\n  - Unique index on `name` where `visibility='shared'`\n  - Unique index on `(owner_user_id, name)` where `visibility='private'`\n- **tasks** (id, title, project_id, section, due, status, created_by, created_at, updated_at, closed_at)\n- **task_assignees** (task_id, assignee_user_id) -- composite PK\n- **events** (id, ts, actor_user_id, action, task_id, payload)\n- **schema_version** (version)\n\n---\n\n## 10. Traceability Matrix\n\n| PRD Section | Requirement IDs |\n|-------------|----------------|\n| 2 (Slack usage) | FR-1.1, FR-1.2 |\n| 3 (Core policies) | FR-4.1--4.3, FR-2.1.4, FR-2.6.4, FR-3.2.3 |\n| 4 (Due parser) | FR-1.3--1.5 |\n| 5 (Command spec) | FR-2.1--2.6, FR-3.1--3.3 |\n| 6 (Data model) | Section 9 |\n| 7 (DB init/migration) | FR-5.1--5.5 |\n| 8 (Permissions) | FR-2.4.3, FR-2.5.3, NFR-5 |\n| 9 (Acceptance) | All AC-* entries |\n"}, "tool_use_id": "toolu_013tcQRoeubDPL1tUNaGBM8e", "_ts": "2026-02-20T11:33:01+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md", "content": "# OpenClaw TODO Plugin -- Requirements Document\n\n> **Version**: 1.0\n> **Date**: 2026-02-20\n> **Source PRD**: `openclaw_todo_plugin_prd.md` v1.1\n> **Status**: Draft\n\n---\n\n## 1. Purpose\n\nDefine the functional and non-functional requirements for a Slack-based TODO management plugin (OpenClaw TODO Plugin). The plugin operates via DM with a Slack bot, stores data in SQLite3, and supports private/shared project workflows with zero LLM cost.\n\n---\n\n## 2. Scope\n\n### 2.1 In Scope (MVP / v1)\n\n| Area | Details |\n|------|---------|\n| **Command interface** | `/todo add`, `list`, `board`, `move`, `done`, `drop`, `edit` |\n| **Project management** | `/todo project list`, `set-private`, `set-shared` |\n| **Storage** | Single shared SQLite3 file with WAL mode |\n| **Input channel** | DM with the OpenClaw Slack bot (primary path) |\n| **Due date parsing** | `YYYY-MM-DD` and `MM-DD` with year inference |\n| **Assignee resolution** | Slack `<@U...>` mentions; multi-assignee support |\n| **Visibility model** | Private (owner-only) and shared projects |\n| **Schema migration** | `schema_version` table; auto-create DB and default `Inbox` project on first run |\n| **Audit log** | `events` table recording actor, action, task, and payload |\n\n### 2.2 Out of Scope\n\n- Natural language / LLM-based task creation (Phase 2).\n- Channel or thread-based usage (app mention `@openclaw /todo ...`).\n- Recurring / repeating tasks.\n- Reminders, notifications, or scheduled digests.\n- Multi-workspace federation or cross-workspace sharing.\n- Web UI or dashboard.\n- Task attachments or file uploads.\n- Real-time sync with external project management tools.\n\n---\n\n## 3. Assumptions\n\n| # | Assumption |\n|---|-----------|\n| A1 | The OpenClaw Gateway is already deployed and can route DM messages to plugins. |\n| A2 | Each Slack user has a unique, stable `user_id` (`U...` format). |\n| A3 | A single SQLite3 file is sufficient for the expected concurrency (small-to-medium teams). |\n| A4 | Server timezone is `Asia/Seoul` for date inference. |\n| A5 | The bot has DM read/write permissions via Slack OAuth scopes. |\n| A6 | Plugin packaging and distribution follows existing OpenClaw conventions (npm). |\n\n---\n\n## 4. Constraints\n\n| # | Constraint |\n|---|-----------|\n| C1 | Zero LLM calls -- all parsing is deterministic. |\n| C2 | SQLite3 only; no external database dependency. |\n| C3 | DB file location fixed at `~/.openclaw/workspace/.todo/todo.sqlite3`. |\n| C4 | Section values are a closed enum: `backlog`, `doing`, `waiting`, `done`, `drop`. |\n| C5 | Status values are a closed enum: `open`, `done`, `dropped`. |\n\n---\n\n## 5. Risks\n\n| # | Risk | Likelihood | Impact | Mitigation |\n|---|------|-----------|--------|-----------|\n| R1 | SQLite write contention under high concurrency | Medium | Medium | WAL mode + `busy_timeout=3000`; monitor lock wait times. |\n| R2 | Project name collision confusion (private vs shared same name) | Medium | Low | Private-first resolution + operational guidance to avoid same names. |\n| R3 | Schema migration failure corrupts DB | Low | High | Wrap migrations in transactions; back up DB file before migration. |\n| R4 | Slack API rate limits on bot DM responses | Low | Medium | Queue responses; respect Slack rate limit headers. |\n| R5 | Date parsing edge cases (leap years, locale) | Low | Low | Strict `datetime` validation; reject invalid dates with clear error. |\n\n---\n\n## 6. Functional Requirements\n\n### FR-1: Command Parser\n\n| ID | Requirement |\n|----|------------|\n| FR-1.1 | The plugin MUST recognize messages starting with `/todo` as commands and ignore all other messages. |\n| FR-1.2 | The parser MUST extract tokens: title text, `<@U...>` mentions, `/p <project>`, `/s <section>`, and `due:` value. |\n| FR-1.3 | `due:MM-DD` or `due:M-D` MUST be expanded to `due:YYYY-MM-DD` using the current server year. |\n| FR-1.4 | Invalid dates (e.g., `02-30`) MUST return a user-facing error. |\n| FR-1.5 | `due:-` MUST clear (set to NULL) the due date. |\n\n### FR-2: Task Commands\n\n#### FR-2.1 `/todo add`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.1.1 | Create a task with provided title, assignees, project, section, and due date. |\n| FR-2.1.2 | Defaults: project=`Inbox`, section=`backlog`, assignees=sender, due=NULL. |\n| FR-2.1.3 | If the target project does not exist and is `Inbox`, auto-create it as shared. |\n| FR-2.1.4 | If the target is a private project and any assignee is not the owner, reject with a warning message and do not create the task. |\n| FR-2.1.5 | Return a confirmation message including: task ID, project, section, due, assignees, and title. |\n\n**Acceptance Criteria (add)**:\n- AC-2.1.A: Running `/todo add Buy milk` creates task #N in Inbox/backlog with sender as assignee; response contains `Added #N`.\n- AC-2.1.B: Running `/todo add Deploy <@U2> /p Ops /s doing due:03-15` creates a task in project Ops, section doing, due set to current-year-03-15, assignee U2.\n- AC-2.1.C: Running `/todo add Secret <@U2> /p MyPrivate` where MyPrivate is a private project owned by sender returns a warning and does NOT create the task.\n- AC-2.1.D: Running `/todo add First task` when no DB file exists triggers DB creation, schema application, Inbox project creation, then creates the task.\n\n#### FR-2.2 `/todo list`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.2.1 | List tasks filtered by scope (`mine`/`all`/`<@USER>`), project, section, and status. |\n| FR-2.2.2 | Defaults: scope=`mine`, status=`open`, limit=30. |\n| FR-2.2.3 | Sort order: due (non-null first, ascending), then id descending. |\n| FR-2.2.4 | `all` scope returns shared tasks plus sender's private project tasks; never shows other users' private tasks. |\n\n**Acceptance Criteria (list)**:\n- AC-2.2.A: `/todo list` returns only open tasks where sender is an assignee, limited to 30, sorted by due then id.\n- AC-2.2.B: `/todo list all` includes tasks from shared projects and the sender's private projects, but excludes other users' private project tasks.\n- AC-2.2.C: `/todo list /p Ops /s doing` returns only tasks in project Ops, section doing.\n\n#### FR-2.3 `/todo board`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.3.1 | Display tasks grouped by section in order: BACKLOG, DOING, WAITING, DONE, DROP. |\n| FR-2.3.2 | Defaults: scope=`mine`, status=`open`, limitPerSection=10. |\n| FR-2.3.3 | Each item shows: `#id due assignees title`. |\n\n**Acceptance Criteria (board)**:\n- AC-2.3.A: `/todo board /p Ops` displays tasks grouped under section headers in the correct order.\n- AC-2.3.B: Each section contains at most 10 items by default.\n\n#### FR-2.4 `/todo move`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.4.1 | Move a task to a specified section. |\n| FR-2.4.2 | Validate section against the enum. |\n| FR-2.4.3 | Authorization: private project -- owner only; shared project -- assignee or created_by. |\n\n**Acceptance Criteria (move)**:\n- AC-2.4.A: `/todo move 42 doing` updates task #42 section to doing and returns confirmation.\n- AC-2.4.B: A user who is neither assignee nor creator of a shared task receives an authorization error.\n\n#### FR-2.5 `/todo done` and `/todo drop`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.5.1 | `/todo done <id>`: set section=`done`, status=`done`, record `closed_at`. |\n| FR-2.5.2 | `/todo drop <id>`: set section=`drop`, status=`dropped`, record `closed_at`. |\n| FR-2.5.3 | Authorization rules match FR-2.4.3. |\n\n**Acceptance Criteria (done/drop)**:\n- AC-2.5.A: `/todo done 42` sets task #42 to done status with a non-null `closed_at` timestamp.\n- AC-2.5.B: `/todo drop 42` sets task #42 to dropped status with a non-null `closed_at` timestamp.\n\n#### FR-2.6 `/todo edit`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.6.1 | Update a task's title, assignees, project, section, and/or due date. |\n| FR-2.6.2 | If mentions are provided, assignees are fully replaced (not appended). |\n| FR-2.6.3 | `due:-` clears the due date. |\n| FR-2.6.4 | If editing moves a task into or within a private project and any assignee is not the owner, reject with a warning. |\n| FR-2.6.5 | Title is inferred from text preceding option tokens; if empty, title is unchanged. |\n\n**Acceptance Criteria (edit)**:\n- AC-2.6.A: `/todo edit 42 New title due:04-01` updates both title and due date; response confirms changes.\n- AC-2.6.B: `/todo edit 42 <@U3>` replaces all assignees with U3 only.\n- AC-2.6.C: `/todo edit 42 due:-` sets due to NULL.\n\n### FR-3: Project Commands\n\n#### FR-3.1 `/todo project list`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.1.1 | Return all shared projects and the sender's private projects. |\n| FR-3.1.2 | Never expose other users' private projects. |\n\n#### FR-3.2 `/todo project set-private <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.2.1 | If the sender already owns a private project with `<name>`, return success (idempotent). |\n| FR-3.2.2 | If a shared project `<name>` exists, attempt to convert it to private (owner=sender). |\n| FR-3.2.3 | Before conversion, scan all tasks in the project. If ANY task has an assignee who is not the sender, reject with an error listing up to 10 violating task IDs and assignees. |\n| FR-3.2.4 | If neither exists, create a new private project with owner=sender. |\n\n**Acceptance Criteria (set-private)**:\n- AC-3.2.A: Converting a shared project with only owner-assigned tasks succeeds; project visibility becomes `private`.\n- AC-3.2.B: Converting a shared project where task #12 is assigned to `<@U2>` fails with an error message containing `#12` and `<@U2>`.\n- AC-3.2.C: Running `set-private NewProj` when no project exists creates a private project owned by sender.\n\n#### FR-3.3 `/todo project set-shared <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.3.1 | If a shared project `<name>` exists, no-op. |\n| FR-3.3.2 | If it does not exist, create it. |\n| FR-3.3.3 | If a shared project with `<name>` already exists (global uniqueness conflict), return an error. |\n\n### FR-4: Project Name Resolution\n\n| ID | Requirement |\n|----|------------|\n| FR-4.1 | When `/p <name>` is specified, resolve by: (1) sender's private project with that name, (2) shared project with that name, (3) error or auto-create per context. |\n| FR-4.2 | Shared project names MUST be globally unique. |\n| FR-4.3 | Private project names MUST be unique per owner. |\n\n### FR-5: Database Initialization\n\n| ID | Requirement |\n|----|------------|\n| FR-5.1 | On first command or gateway startup, create the directory `~/.openclaw/workspace/.todo/` if absent. |\n| FR-5.2 | Create `todo.sqlite3` with the full v1 schema if the file does not exist. |\n| FR-5.3 | Create `schema_version` table and set version=1. |\n| FR-5.4 | Auto-create shared project `Inbox` (idempotent). |\n| FR-5.5 | Set `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000` on every connection. |\n\n**Acceptance Criteria (DB init)**:\n- AC-5.A: Deleting the DB file and running any `/todo` command recreates the DB with all tables and the `Inbox` project.\n- AC-5.B: `schema_version` table contains exactly one row with `version=1`.\n\n### FR-6: Audit Events\n\n| ID | Requirement |\n|----|------------|\n| FR-6.1 | Every state-changing command (add, move, done, drop, edit, set-private, set-shared) MUST insert a row into the `events` table. |\n| FR-6.2 | Each event records: timestamp, actor user ID, action name, task ID (if applicable), and a JSON payload with before/after state. |\n\n---\n\n## 7. Non-Functional Requirements\n\n| ID | Requirement | Metric |\n|----|------------|--------|\n| NFR-1 | **Latency**: Command response time | p95 < 500ms for any single command (excluding Slack network round-trip). |\n| NFR-2 | **Reliability**: No data loss on concurrent writes | Zero data corruption over 1000 concurrent write operations using WAL mode. |\n| NFR-3 | **Availability**: Plugin uptime | Matches OpenClaw Gateway uptime; no independent failure modes. |\n| NFR-4 | **Correctness**: Date parsing | 100% of valid `YYYY-MM-DD` and `MM-DD` inputs produce correct stored dates; 100% of invalid dates return errors. |\n| NFR-5 | **Security**: Private project isolation | Zero information leakage: private project tasks MUST never appear in another user's list/board output. |\n| NFR-6 | **Testability**: Unit + integration test coverage | >= 80% line coverage on parser and command handler modules. |\n| NFR-7 | **Maintainability**: Schema migration | Forward-only migrations; each migration is idempotent and wrapped in a transaction. |\n| NFR-8 | **Capacity**: Task volume | Support up to 100,000 tasks per DB file without degradation beyond NFR-1. |\n\n---\n\n## 8. Success Metrics\n\n| Metric | Target | Measurement |\n|--------|--------|------------|\n| Command success rate | >= 99% of well-formed commands execute without error | `events` table: count(success) / count(total) |\n| Adoption | >= 5 active users within 2 weeks of deployment | Distinct `actor_user_id` in events table |\n| Task throughput | >= 50 tasks created per week across team | Weekly count of `add` events |\n| Mean response time | < 300ms (p50) | Instrumented timer in command handler |\n| Test pass rate | 100% on CI before merge | pytest exit code |\n\n---\n\n## 9. Data Model Summary\n\nFour core tables plus one metadata table:\n\n- **projects** (id, name, visibility, owner_user_id, created_at, updated_at)\n  - Unique index on `name` where `visibility='shared'`\n  - Unique index on `(owner_user_id, name)` where `visibility='private'`\n- **tasks** (id, title, project_id, section, due, status, created_by, created_at, updated_at, closed_at)\n- **task_assignees** (task_id, assignee_user_id) -- composite PK\n- **events** (id, ts, actor_user_id, action, task_id, payload)\n- **schema_version** (version)\n\n---\n\n## 10. Traceability Matrix\n\n| PRD Section | Requirement IDs |\n|-------------|----------------|\n| 2 (Slack usage) | FR-1.1, FR-1.2 |\n| 3 (Core policies) | FR-4.1--4.3, FR-2.1.4, FR-2.6.4, FR-3.2.3 |\n| 4 (Due parser) | FR-1.3--1.5 |\n| 5 (Command spec) | FR-2.1--2.6, FR-3.1--3.3 |\n| 6 (Data model) | Section 9 |\n| 7 (DB init/migration) | FR-5.1--5.5 |\n| 8 (Permissions) | FR-2.4.3, FR-2.5.3, NFR-5 |\n| 9 (Acceptance) | All AC-* entries |\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/requirements.md", "content": "# OpenClaw TODO Plugin -- Requirements Document\n\n> **Version**: 1.0\n> **Date**: 2026-02-20\n> **Source PRD**: `openclaw_todo_plugin_prd.md` v1.1\n> **Status**: Draft\n\n---\n\n## 1. Purpose\n\nDefine the functional and non-functional requirements for a Slack-based TODO management plugin (OpenClaw TODO Plugin). The plugin operates via DM with a Slack bot, stores data in SQLite3, and supports private/shared project workflows with zero LLM cost.\n\n---\n\n## 2. Scope\n\n### 2.1 In Scope (MVP / v1)\n\n| Area | Details |\n|------|---------|\n| **Command interface** | `/todo add`, `list`, `board`, `move`, `done`, `drop`, `edit` |\n| **Project management** | `/todo project list`, `set-private`, `set-shared` |\n| **Storage** | Single shared SQLite3 file with WAL mode |\n| **Input channel** | DM with the OpenClaw Slack bot (primary path) |\n| **Due date parsing** | `YYYY-MM-DD` and `MM-DD` with year inference |\n| **Assignee resolution** | Slack `<@U...>` mentions; multi-assignee support |\n| **Visibility model** | Private (owner-only) and shared projects |\n| **Schema migration** | `schema_version` table; auto-create DB and default `Inbox` project on first run |\n| **Audit log** | `events` table recording actor, action, task, and payload |\n\n### 2.2 Out of Scope\n\n- Natural language / LLM-based task creation (Phase 2).\n- Channel or thread-based usage (app mention `@openclaw /todo ...`).\n- Recurring / repeating tasks.\n- Reminders, notifications, or scheduled digests.\n- Multi-workspace federation or cross-workspace sharing.\n- Web UI or dashboard.\n- Task attachments or file uploads.\n- Real-time sync with external project management tools.\n\n---\n\n## 3. Assumptions\n\n| # | Assumption |\n|---|-----------|\n| A1 | The OpenClaw Gateway is already deployed and can route DM messages to plugins. |\n| A2 | Each Slack user has a unique, stable `user_id` (`U...` format). |\n| A3 | A single SQLite3 file is sufficient for the expected concurrency (small-to-medium teams). |\n| A4 | Server timezone is `Asia/Seoul` for date inference. |\n| A5 | The bot has DM read/write permissions via Slack OAuth scopes. |\n| A6 | Plugin packaging and distribution follows existing OpenClaw conventions (npm). |\n\n---\n\n## 4. Constraints\n\n| # | Constraint |\n|---|-----------|\n| C1 | Zero LLM calls -- all parsing is deterministic. |\n| C2 | SQLite3 only; no external database dependency. |\n| C3 | DB file location fixed at `~/.openclaw/workspace/.todo/todo.sqlite3`. |\n| C4 | Section values are a closed enum: `backlog`, `doing`, `waiting`, `done`, `drop`. |\n| C5 | Status values are a closed enum: `open`, `done`, `dropped`. |\n\n---\n\n## 5. Risks\n\n| # | Risk | Likelihood | Impact | Mitigation |\n|---|------|-----------|--------|-----------|\n| R1 | SQLite write contention under high concurrency | Medium | Medium | WAL mode + `busy_timeout=3000`; monitor lock wait times. |\n| R2 | Project name collision confusion (private vs shared same name) | Medium | Low | Private-first resolution + operational guidance to avoid same names. |\n| R3 | Schema migration failure corrupts DB | Low | High | Wrap migrations in transactions; back up DB file before migration. |\n| R4 | Slack API rate limits on bot DM responses | Low | Medium | Queue responses; respect Slack rate limit headers. |\n| R5 | Date parsing edge cases (leap years, locale) | Low | Low | Strict `datetime` validation; reject invalid dates with clear error. |\n\n---\n\n## 6. Functional Requirements\n\n### FR-1: Command Parser\n\n| ID | Requirement |\n|----|------------|\n| FR-1.1 | The plugin MUST recognize messages starting with `/todo` as commands and ignore all other messages. |\n| FR-1.2 | The parser MUST extract tokens: title text, `<@U...>` mentions, `/p <project>`, `/s <section>`, and `due:` value. |\n| FR-1.3 | `due:MM-DD` or `due:M-D` MUST be expanded to `due:YYYY-MM-DD` using the current server year. |\n| FR-1.4 | Invalid dates (e.g., `02-30`) MUST return a user-facing error. |\n| FR-1.5 | `due:-` MUST clear (set to NULL) the due date. |\n\n### FR-2: Task Commands\n\n#### FR-2.1 `/todo add`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.1.1 | Create a task with provided title, assignees, project, section, and due date. |\n| FR-2.1.2 | Defaults: project=`Inbox`, section=`backlog`, assignees=sender, due=NULL. |\n| FR-2.1.3 | If the target project does not exist and is `Inbox`, auto-create it as shared. |\n| FR-2.1.4 | If the target is a private project and any assignee is not the owner, reject with a warning message and do not create the task. |\n| FR-2.1.5 | Return a confirmation message including: task ID, project, section, due, assignees, and title. |\n\n**Acceptance Criteria (add)**:\n- AC-2.1.A: Running `/todo add Buy milk` creates task #N in Inbox/backlog with sender as assignee; response contains `Added #N`.\n- AC-2.1.B: Running `/todo add Deploy <@U2> /p Ops /s doing due:03-15` creates a task in project Ops, section doing, due set to current-year-03-15, assignee U2.\n- AC-2.1.C: Running `/todo add Secret <@U2> /p MyPrivate` where MyPrivate is a private project owned by sender returns a warning and does NOT create the task.\n- AC-2.1.D: Running `/todo add First task` when no DB file exists triggers DB creation, schema application, Inbox project creation, then creates the task.\n\n#### FR-2.2 `/todo list`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.2.1 | List tasks filtered by scope (`mine`/`all`/`<@USER>`), project, section, and status. |\n| FR-2.2.2 | Defaults: scope=`mine`, status=`open`, limit=30. |\n| FR-2.2.3 | Sort order: due (non-null first, ascending), then id descending. |\n| FR-2.2.4 | `all` scope returns shared tasks plus sender's private project tasks; never shows other users' private tasks. |\n\n**Acceptance Criteria (list)**:\n- AC-2.2.A: `/todo list` returns only open tasks where sender is an assignee, limited to 30, sorted by due then id.\n- AC-2.2.B: `/todo list all` includes tasks from shared projects and the sender's private projects, but excludes other users' private project tasks.\n- AC-2.2.C: `/todo list /p Ops /s doing` returns only tasks in project Ops, section doing.\n\n#### FR-2.3 `/todo board`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.3.1 | Display tasks grouped by section in order: BACKLOG, DOING, WAITING, DONE, DROP. |\n| FR-2.3.2 | Defaults: scope=`mine`, status=`open`, limitPerSection=10. |\n| FR-2.3.3 | Each item shows: `#id due assignees title`. |\n\n**Acceptance Criteria (board)**:\n- AC-2.3.A: `/todo board /p Ops` displays tasks grouped under section headers in the correct order.\n- AC-2.3.B: Each section contains at most 10 items by default.\n\n#### FR-2.4 `/todo move`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.4.1 | Move a task to a specified section. |\n| FR-2.4.2 | Validate section against the enum. |\n| FR-2.4.3 | Authorization: private project -- owner only; shared project -- assignee or created_by. |\n\n**Acceptance Criteria (move)**:\n- AC-2.4.A: `/todo move 42 doing` updates task #42 section to doing and returns confirmation.\n- AC-2.4.B: A user who is neither assignee nor creator of a shared task receives an authorization error.\n\n#### FR-2.5 `/todo done` and `/todo drop`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.5.1 | `/todo done <id>`: set section=`done`, status=`done`, record `closed_at`. |\n| FR-2.5.2 | `/todo drop <id>`: set section=`drop`, status=`dropped`, record `closed_at`. |\n| FR-2.5.3 | Authorization rules match FR-2.4.3. |\n\n**Acceptance Criteria (done/drop)**:\n- AC-2.5.A: `/todo done 42` sets task #42 to done status with a non-null `closed_at` timestamp.\n- AC-2.5.B: `/todo drop 42` sets task #42 to dropped status with a non-null `closed_at` timestamp.\n\n#### FR-2.6 `/todo edit`\n\n| ID | Requirement |\n|----|------------|\n| FR-2.6.1 | Update a task's title, assignees, project, section, and/or due date. |\n| FR-2.6.2 | If mentions are provided, assignees are fully replaced (not appended). |\n| FR-2.6.3 | `due:-` clears the due date. |\n| FR-2.6.4 | If editing moves a task into or within a private project and any assignee is not the owner, reject with a warning. |\n| FR-2.6.5 | Title is inferred from text preceding option tokens; if empty, title is unchanged. |\n\n**Acceptance Criteria (edit)**:\n- AC-2.6.A: `/todo edit 42 New title due:04-01` updates both title and due date; response confirms changes.\n- AC-2.6.B: `/todo edit 42 <@U3>` replaces all assignees with U3 only.\n- AC-2.6.C: `/todo edit 42 due:-` sets due to NULL.\n\n### FR-3: Project Commands\n\n#### FR-3.1 `/todo project list`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.1.1 | Return all shared projects and the sender's private projects. |\n| FR-3.1.2 | Never expose other users' private projects. |\n\n#### FR-3.2 `/todo project set-private <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.2.1 | If the sender already owns a private project with `<name>`, return success (idempotent). |\n| FR-3.2.2 | If a shared project `<name>` exists, attempt to convert it to private (owner=sender). |\n| FR-3.2.3 | Before conversion, scan all tasks in the project. If ANY task has an assignee who is not the sender, reject with an error listing up to 10 violating task IDs and assignees. |\n| FR-3.2.4 | If neither exists, create a new private project with owner=sender. |\n\n**Acceptance Criteria (set-private)**:\n- AC-3.2.A: Converting a shared project with only owner-assigned tasks succeeds; project visibility becomes `private`.\n- AC-3.2.B: Converting a shared project where task #12 is assigned to `<@U2>` fails with an error message containing `#12` and `<@U2>`.\n- AC-3.2.C: Running `set-private NewProj` when no project exists creates a private project owned by sender.\n\n#### FR-3.3 `/todo project set-shared <name>`\n\n| ID | Requirement |\n|----|------------|\n| FR-3.3.1 | If a shared project `<name>` exists, no-op. |\n| FR-3.3.2 | If it does not exist, create it. |\n| FR-3.3.3 | If a shared project with `<name>` already exists (global uniqueness conflict), return an error. |\n\n### FR-4: Project Name Resolution\n\n| ID | Requirement |\n|----|------------|\n| FR-4.1 | When `/p <name>` is specified, resolve by: (1) sender's private project with that name, (2) shared project with that name, (3) error or auto-create per context. |\n| FR-4.2 | Shared project names MUST be globally unique. |\n| FR-4.3 | Private project names MUST be unique per owner. |\n\n### FR-5: Database Initialization\n\n| ID | Requirement |\n|----|------------|\n| FR-5.1 | On first command or gateway startup, create the directory `~/.openclaw/workspace/.todo/` if absent. |\n| FR-5.2 | Create `todo.sqlite3` with the full v1 schema if the file does not exist. |\n| FR-5.3 | Create `schema_version` table and set version=1. |\n| FR-5.4 | Auto-create shared project `Inbox` (idempotent). |\n| FR-5.5 | Set `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000` on every connection. |\n\n**Acceptance Criteria (DB init)**:\n- AC-5.A: Deleting the DB file and running any `/todo` command recreates the DB with all tables and the `Inbox` project.\n- AC-5.B: `schema_version` table contains exactly one row with `version=1`.\n\n### FR-6: Audit Events\n\n| ID | Requirement |\n|----|------------|\n| FR-6.1 | Every state-changing command (add, move, done, drop, edit, set-private, set-shared) MUST insert a row into the `events` table. |\n| FR-6.2 | Each event records: timestamp, actor user ID, action name, task ID (if applicable), and a JSON payload with before/after state. |\n\n---\n\n## 7. Non-Functional Requirements\n\n| ID | Requirement | Metric |\n|----|------------|--------|\n| NFR-1 | **Latency**: Command response time | p95 < 500ms for any single command (excluding Slack network round-trip). |\n| NFR-2 | **Reliability**: No data loss on concurrent writes | Zero data corruption over 1000 concurrent write operations using WAL mode. |\n| NFR-3 | **Availability**: Plugin uptime | Matches OpenClaw Gateway uptime; no independent failure modes. |\n| NFR-4 | **Correctness**: Date parsing | 100% of valid `YYYY-MM-DD` and `MM-DD` inputs produce correct stored dates; 100% of invalid dates return errors. |\n| NFR-5 | **Security**: Private project isolation | Zero information leakage: private project tasks MUST never appear in another user's list/board output. |\n| NFR-6 | **Testability**: Unit + integration test coverage | >= 80% line coverage on parser and command handler modules. |\n| NFR-7 | **Maintainability**: Schema migration | Forward-only migrations; each migration is idempotent and wrapped in a transaction. |\n| NFR-8 | **Capacity**: Task volume | Support up to 100,000 tasks per DB file without degradation beyond NFR-1. |\n\n---\n\n## 8. Success Metrics\n\n| Metric | Target | Measurement |\n|--------|--------|------------|\n| Command success rate | >= 99% of well-formed commands execute without error | `events` table: count(success) / count(total) |\n| Adoption | >= 5 active users within 2 weeks of deployment | Distinct `actor_user_id` in events table |\n| Task throughput | >= 50 tasks created per week across team | Weekly count of `add` events |\n| Mean response time | < 300ms (p50) | Instrumented timer in command handler |\n| Test pass rate | 100% on CI before merge | pytest exit code |\n\n---\n\n## 9. Data Model Summary\n\nFour core tables plus one metadata table:\n\n- **projects** (id, name, visibility, owner_user_id, created_at, updated_at)\n  - Unique index on `name` where `visibility='shared'`\n  - Unique index on `(owner_user_id, name)` where `visibility='private'`\n- **tasks** (id, title, project_id, section, due, status, created_by, created_at, updated_at, closed_at)\n- **task_assignees** (task_id, assignee_user_id) -- composite PK\n- **events** (id, ts, actor_user_id, action, task_id, payload)\n- **schema_version** (version)\n\n---\n\n## 10. Traceability Matrix\n\n| PRD Section | Requirement IDs |\n|-------------|----------------|\n| 2 (Slack usage) | FR-1.1, FR-1.2 |\n| 3 (Core policies) | FR-4.1--4.3, FR-2.1.4, FR-2.6.4, FR-3.2.3 |\n| 4 (Due parser) | FR-1.3--1.5 |\n| 5 (Command spec) | FR-2.1--2.6, FR-3.1--3.3 |\n| 6 (Data model) | Section 9 |\n| 7 (DB init/migration) | FR-5.1--5.5 |\n| 8 (Permissions) | FR-2.4.3, FR-2.5.3, NFR-5 |\n| 9 (Acceptance) | All AC-* entries |\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_013tcQRoeubDPL1tUNaGBM8e", "_ts": "2026-02-20T11:33:02+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a8f503f", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a8f503f.jsonl", "agent_type": "requirement-analyst", "_ts": "2026-02-20T11:33:13+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a306c9f", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a306c9f.jsonl", "agent_type": "", "_ts": "2026-02-20T11:33:18+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md", "content": "# OpenClaw TODO Plugin -- UX Specification\n\n> Version 1.0 | 2026-02-20\n> Based on PRD v1.1 (DM-based)\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Interaction Model](#2-interaction-model)\n3. [Command Reference and User Flows](#3-command-reference-and-user-flows)\n4. [Response Formatting](#4-response-formatting)\n5. [Error Messages](#5-error-messages)\n6. [Edge Cases](#6-edge-cases)\n7. [Input Parsing Rules](#7-input-parsing-rules)\n\n---\n\n## 1. Overview\n\nThe OpenClaw TODO Plugin is a text-based task management system that lives inside Slack DMs. Users interact with the bot by sending messages that start with `/todo`. The bot parses the command and replies in the same DM thread with structured, plain-text responses.\n\n### Design Principles\n\n- **Zero ambiguity**: Every command produces exactly one response. The user always knows whether the action succeeded or failed.\n- **Minimal typing**: Sensible defaults (project = `Inbox`, section = `backlog`, assignee = sender) mean most commands need only a title.\n- **Scannable output**: Responses use fixed-width IDs, consistent emoji prefixes, and aligned columns so users can scan quickly.\n- **Fail loudly**: Invalid input is rejected with a clear reason and the original request is not applied. No partial writes.\n\n---\n\n## 2. Interaction Model\n\n### 2.1 Entry Point\n\nThe user opens a DM conversation with the OpenClaw Slack bot and types messages beginning with `/todo`.\n\n### 2.2 Message Recognition\n\n| Message pattern | Bot behavior |\n|---|---|\n| Starts with `/todo` | Parsed as a command |\n| Anything else | Ignored silently (no reply) |\n\n### 2.3 Response Timing\n\nThe bot replies in the same DM channel. All responses are ephemeral-style (visible only to the sender) when technically possible; otherwise they appear as normal bot messages in the DM.\n\n### 2.4 No Confirmation Dialogs\n\nv1 has no interactive buttons, modals, or confirmation prompts. Every command is executed (or rejected) immediately upon receipt.\n\n---\n\n## 3. Command Reference and User Flows\n\n### 3.1 `/todo add` -- Create a Task\n\n**Purpose**: Create a new task with optional project, section, assignees, and due date.\n\n**Syntax**:\n```\n/todo add <title> [@user ...] [/p <project>] [/s <section>] [due:<date>]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| project | `Inbox` |\n| section | `backlog` |\n| assignees | sender |\n| due | none |\n\n**Flow**:\n1. User sends `/todo add Buy groceries`\n2. Bot creates task in Inbox/backlog, assigns to sender\n3. Bot replies with confirmation\n\n**Examples**:\n\n```\nInput:  /todo add Buy groceries\nOutput: :white_check_mark: Added #42 (Inbox/backlog) due:- assignees:@phil -- Buy groceries\n```\n\n```\nInput:  /todo add Fix login bug @alice /p Backend /s doing due:2026-03-15\nOutput: :white_check_mark: Added #43 (Backend/doing) due:2026-03-15 assignees:@alice -- Fix login bug\n```\n\n```\nInput:  /todo add Review PR @bob @carol /p Frontend\nOutput: :white_check_mark: Added #44 (Frontend/backlog) due:- assignees:@bob, @carol -- Review PR\n```\n\n**Success response format**:\n```\n:white_check_mark: Added #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, <@user>...] -- <title>\n```\n\n---\n\n### 3.2 `/todo list` -- List Tasks\n\n**Purpose**: Display a filtered, sorted list of tasks.\n\n**Syntax**:\n```\n/todo list [mine|all|@user] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limit | 30 |\n\n**Flow**:\n1. User sends `/todo list`\n2. Bot queries tasks where sender is an assignee, status is open\n3. Bot returns a numbered list sorted by due date (ascending, nulls last), then by ID (descending)\n\n**Example output**:\n```\n:clipboard: TODO List (mine / open) -- 3 tasks\n\n#50  due:2026-02-21  (Backend/doing)    @phil        Deploy hotfix\n#48  due:2026-03-01  (Inbox/backlog)    @phil        Buy groceries\n#45  due:-           (Frontend/waiting) @phil, @bob  Review PR\n\nShowing 3 of 3. Use limit:N to see more.\n```\n\n**Empty state**:\n```\n:clipboard: TODO List (mine / open) -- 0 tasks\n\nNo tasks found.\n```\n\n**Scope behavior**:\n| Scope | What it shows |\n|---|---|\n| `mine` | Tasks where sender is in the assignee list |\n| `all` | All shared tasks + sender's private tasks (never other users' private tasks) |\n| `@user` | Tasks where the mentioned user is an assignee (shared projects only, plus sender's private if sender = mentioned user) |\n\n---\n\n### 3.3 `/todo board` -- Kanban Board View\n\n**Purpose**: Display tasks grouped by section in a kanban-style text layout.\n\n**Syntax**:\n```\n/todo board [mine|all|@user] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limitPerSection | 10 |\n\n**Flow**:\n1. User sends `/todo board /p Backend`\n2. Bot queries matching tasks and groups them by section\n3. Bot returns sections in fixed order: BACKLOG, DOING, WAITING, DONE, DROP\n\n**Example output**:\n```\n:bar_chart: Board (mine / open) /p Backend\n\n-- BACKLOG (2) --\n#50  due:2026-03-10  @phil        Set up CI pipeline\n#47  due:-           @phil        Write migration script\n\n-- DOING (1) --\n#51  due:2026-02-22  @phil        Deploy hotfix\n\n-- WAITING (0) --\n(empty)\n\n-- DONE (0) --\n(empty)\n\n-- DROP (0) --\n(empty)\n```\n\n**Notes**:\n- Sections with zero items still appear with `(empty)` to maintain the full board structure.\n- Each section header shows the count of items.\n- When `limitPerSection` is reached, append `... and N more` below the last item in that section.\n\n---\n\n### 3.4 `/todo move` -- Move a Task to a Different Section\n\n**Purpose**: Change the section (kanban column) of a task.\n\n**Syntax**:\n```\n/todo move <id> <section>\n```\n\n**Valid sections**: `backlog`, `doing`, `waiting`, `done`, `drop`\n\n**Flow**:\n1. User sends `/todo move 50 doing`\n2. Bot validates permission and section name\n3. Bot updates the task and replies\n\n**Example**:\n```\nInput:  /todo move 50 doing\nOutput: :arrow_right: Moved #50 to doing (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.5 `/todo done` -- Mark a Task as Done\n\n**Purpose**: Shortcut to move a task to the `done` section and set its status to `done`.\n\n**Syntax**:\n```\n/todo done <id>\n```\n\n**Flow**:\n1. User sends `/todo done 50`\n2. Bot sets section=done, status=done, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo done 50\nOutput: :white_check_mark: Done #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.6 `/todo drop` -- Drop a Task\n\n**Purpose**: Mark a task as dropped (cancelled/abandoned).\n\n**Syntax**:\n```\n/todo drop <id>\n```\n\n**Flow**:\n1. User sends `/todo drop 50`\n2. Bot sets section=drop, status=dropped, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo drop 50\nOutput: :wastebasket: Dropped #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.7 `/todo edit` -- Edit a Task\n\n**Purpose**: Modify one or more fields of an existing task.\n\n**Syntax**:\n```\n/todo edit <id> [<new title>] [@user ...] [/p <project>] [/s <section>] [due:<date>|due:-]\n```\n\n**Rules**:\n- If `@user` mentions are present, the assignee list is **fully replaced** (not appended).\n- `due:-` clears the due date (sets it to null).\n- New title text is everything before the first option token (`/p`, `/s`, `due:`, or `@mention`). If empty, the title is unchanged.\n- Fields not specified in the command remain unchanged.\n\n**Flow**:\n1. User sends `/todo edit 50 Deploy hotfix v2 due:2026-03-01`\n2. Bot updates title and due date\n3. Bot replies with the updated state\n\n**Example**:\n```\nInput:  /todo edit 50 Deploy hotfix v2 due:2026-03-01\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@phil -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 @alice @bob\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 due:-\nOutput: :pencil2: Edited #50 (Backend/doing) due:- assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n**Success response format** (same structure as add):\n```\n:pencil2: Edited #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, ...] -- <title>\n```\n\n---\n\n### 3.8 `/todo project list` -- List Projects\n\n**Purpose**: Show all projects visible to the sender.\n\n**Syntax**:\n```\n/todo project list\n```\n\n**Flow**:\n1. User sends `/todo project list`\n2. Bot returns shared projects and the sender's private projects\n\n**Example output**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (12 tasks)\n  - Backend (5 tasks)\n  - Frontend (8 tasks)\n\nPrivate (yours):\n  - Personal (3 tasks)\n  - Side Project (1 task)\n```\n\n**Empty state**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (0 tasks)\n\nPrivate (yours):\n  (none)\n```\n\n---\n\n### 3.9 `/todo project set-private <name>` -- Make a Project Private\n\n**Purpose**: Convert a shared project to private or create a new private project.\n\n**Syntax**:\n```\n/todo project set-private <name>\n```\n\n**Flow**:\n\nCase A -- Project does not exist:\n1. Bot creates a new private project owned by the sender.\n2. Reply: `:lock: Created private project \"<name>\".`\n\nCase B -- Sender already has a private project with this name:\n1. Reply: `:lock: Project \"<name>\" is already private.`\n\nCase C -- Shared project exists, conversion attempt:\n1. Bot scans all tasks in the project for non-owner assignees.\n2. If none found: convert to private, reply `:lock: Project \"<name>\" is now private.`\n3. If found: reject with error (see [Section 5.3](#53-set-private-validation-error)).\n\n---\n\n### 3.10 `/todo project set-shared <name>` -- Make a Project Shared\n\n**Purpose**: Convert a private project to shared or create a new shared project.\n\n**Syntax**:\n```\n/todo project set-shared <name>\n```\n\n**Flow**:\n\nCase A -- Shared project with this name already exists:\n1. Reply: `:globe_with_meridians: Project \"<name>\" is already shared.`\n\nCase B -- No shared project with this name:\n1. Bot creates (or converts) the project to shared visibility.\n2. Reply: `:globe_with_meridians: Project \"<name>\" is now shared.`\n\nCase C -- Name conflict with an existing shared project:\n1. Reply: `:x: A shared project named \"<name>\" already exists.`\n\n---\n\n## 4. Response Formatting\n\n### 4.1 General Structure\n\nAll bot responses follow this pattern:\n\n```\n<emoji> <Action verb> <details>\n```\n\n| Action | Emoji | Verb |\n|---|---|---|\n| Add | :white_check_mark: | Added |\n| List | :clipboard: | TODO List |\n| Board | :bar_chart: | Board |\n| Move | :arrow_right: | Moved |\n| Done | :white_check_mark: | Done |\n| Drop | :wastebasket: | Dropped |\n| Edit | :pencil2: | Edited |\n| Project list | :file_folder: | Projects |\n| Set private | :lock: | (varies by case) |\n| Set shared | :globe_with_meridians: | (varies by case) |\n| Error | :x: | (error message) |\n| Warning/reject | :warning: | (warning message) |\n\n### 4.2 Task Line Format\n\nWhenever a single task is displayed inline (in list, board, or as a command result), it uses:\n\n```\n#<id>  due:<YYYY-MM-DD|->  (<project>/<section>)  <assignees>  <title>\n```\n\n- `id`: Left-padded for alignment in lists (e.g., `#42`, `# 7` -- optional, simple left-align is acceptable in v1).\n- `due`: Always shown. `-` when no due date.\n- `assignees`: Comma-separated Slack mentions. Displayed as `@username` in Slack's rendered view.\n- `title`: The full task title, untruncated.\n\n### 4.3 List/Board Headers\n\nLists and boards begin with a header line summarizing the query:\n\n```\n:clipboard: TODO List (<scope> / <status>) -- <count> tasks\n```\n```\n:bar_chart: Board (<scope> / <status>) [/p <project>]\n```\n\n### 4.4 Pagination Footer\n\nWhen the result set exceeds the limit:\n```\nShowing <displayed> of <total>. Use limit:N to see more.\n```\n\nFor board view:\n```\n... and <N> more\n```\n(appears below the last item in a section that hit `limitPerSection`)\n\n### 4.5 Text Encoding\n\n- All responses are plain Slack mrkdwn (Slack's markdown variant).\n- No block kit or attachments in v1.\n- User mentions are rendered as `<@UXXXXXXXX>` which Slack auto-formats.\n\n---\n\n## 5. Error Messages\n\n### 5.1 Input Validation Errors\n\n| Condition | Error message |\n|---|---|\n| Unknown command | `:x: Unknown command. Available: add, list, board, move, done, drop, edit, project` |\n| Missing title on add | `:x: Title is required. Usage: /todo add <title> [options]` |\n| Missing task ID | `:x: Task ID is required. Usage: /todo <command> <id>` |\n| Invalid task ID (not a number) | `:x: Invalid task ID \"<input>\". Must be a number.` |\n| Task not found | `:x: Task #<id> not found.` |\n| Invalid section name | `:x: Invalid section \"<input>\". Must be one of: backlog, doing, waiting, done, drop` |\n| Invalid date format | `:x: Invalid date \"<input>\". Use YYYY-MM-DD or MM-DD.` |\n| Invalid date value (e.g. 02-30) | `:x: Invalid date \"02-30\". This date does not exist.` |\n| Empty project name | `:x: Project name is required after /p.` |\n\n### 5.2 Permission Errors\n\n| Condition | Error message |\n|---|---|\n| Accessing another user's private project | `:x: Project \"<name>\" not found.` (deliberately vague to avoid leaking existence) |\n| Editing a task without permission | `:x: You don't have permission to modify task #<id>.` |\n\n### 5.3 Set-Private Validation Error\n\nWhen `/todo project set-private` fails due to non-owner assignees:\n\n```\n:x: Cannot set project \"<name>\" to private: found tasks assigned to non-owner users.\ne.g. #12 assignees:@alice, #18 assignees:@carol, #21 assignees:@bob\nPlease reassign or remove these assignees first.\n```\n\n- Show up to 10 violating tasks.\n- If more than 10, append: `... and <N> more tasks with external assignees.`\n\n### 5.4 Private Project Assignee Rejection\n\nWhen trying to assign a non-owner user to a task in a private project (on add or edit):\n\n```\n:warning: Private project \"<name>\" is owner-only. Cannot assign <@user> (not the owner).\nRequest was not applied.\n```\n\n### 5.5 Project Name Conflicts\n\n| Condition | Error message |\n|---|---|\n| Creating/renaming to an existing shared name | `:x: A shared project named \"<name>\" already exists.` |\n| Private name conflict for same owner | `:x: You already have a private project named \"<name>\".` |\n\n---\n\n## 6. Edge Cases\n\n### 6.1 Empty Inputs\n\n| Scenario | Behavior |\n|---|---|\n| `/todo` (no subcommand) | Reply with help text listing available commands |\n| `/todo add` (no title) | Error: title required |\n| `/todo edit 50` (no changes) | Reply: `:information_source: No changes specified for #50.` |\n| `/todo list /p NonExistent` | Error: project not found |\n\n### 6.2 Duplicate Operations\n\n| Scenario | Behavior |\n|---|---|\n| `/todo done 50` when already done | Reply: `:information_source: Task #50 is already done.` |\n| `/todo drop 50` when already dropped | Reply: `:information_source: Task #50 is already dropped.` |\n| `/todo move 50 doing` when already in doing | Reply: `:information_source: Task #50 is already in doing.` |\n\n### 6.3 Project Auto-Creation\n\n- When `/todo add ... /p NewProject` references a project that does not exist, the bot creates it as a **shared** project automatically and includes a note in the response:\n  ```\n  :white_check_mark: Added #55 (NewProject/backlog) due:- assignees:@phil -- Task title\n  :information_source: Project \"NewProject\" was created (shared).\n  ```\n- Exception: `Inbox` is always auto-created as shared if it does not exist.\n\n### 6.4 Case Sensitivity\n\n- **Section names**: Case-insensitive input, stored lowercase. `DOING`, `Doing`, `doing` all resolve to `doing`.\n- **Project names**: Case-sensitive. `Backend` and `backend` are different projects.\n- **Commands**: Case-insensitive. `/todo ADD`, `/TODO add`, `/todo Add` all work.\n\n### 6.5 Whitespace and Formatting\n\n- Leading/trailing whitespace in titles is trimmed.\n- Multiple spaces between words in a title are collapsed to a single space.\n- Empty title after trimming triggers the \"title required\" error.\n\n### 6.6 Special Characters in Titles\n\n- Titles may contain any UTF-8 characters except newlines.\n- Slack mrkdwn special characters (`*`, `_`, `~`, `` ` ``) in titles are escaped in the response to prevent formatting artifacts.\n\n### 6.7 Due Date Edge Cases\n\n| Input | Resolved date (assuming current year 2026) |\n|---|---|\n| `due:2026-03-15` | `2026-03-15` |\n| `due:03-15` | `2026-03-15` |\n| `due:3-5` | `2026-03-05` |\n| `due:02-29` | Error (2026 is not a leap year) |\n| `due:00-01` | Error (invalid month) |\n| `due:12-32` | Error (invalid day) |\n| `due:-` | Clears due date (null) |\n| `due:yesterday` | Error (invalid format) |\n\n---\n\n## 7. Input Parsing Rules\n\n### 7.1 Token Order\n\nThe parser processes the message left to right. Recognized option tokens are:\n\n| Token | Pattern | Notes |\n|---|---|---|\n| `/p` | `/p <word>` | Next whitespace-delimited word is the project name |\n| `/s` | `/s <word>` | Next word is the section name |\n| `due:` | `due:<value>` | No space between `due:` and the value |\n| `@mention` | `<@UXXXXXXXX>` | Slack user mention (may appear multiple times) |\n| `limit:` | `limit:<N>` | Positive integer |\n| `limitPerSection:` | `limitPerSection:<N>` | Positive integer |\n\n### 7.2 Title Extraction (for add/edit)\n\nEverything that is **not** a recognized option token or mention is treated as the title. The title words are concatenated in their original order.\n\nExample parse:\n```\n/todo add Fix the login bug @alice /p Backend due:03-15\n\nParsed:\n  command   = add\n  title     = \"Fix the login bug\"\n  assignees = [@alice]\n  project   = \"Backend\"\n  due       = \"2026-03-15\"\n  section   = (default: backlog)\n```\n\n### 7.3 Mention Handling\n\n- Slack internally sends mentions as `<@U04ABCD1234>`.\n- The bot resolves these to display names in responses when possible.\n- If a mentioned user cannot be resolved, the raw `<@U...>` format is preserved.\n\n### 7.4 Scope Keywords (for list/board)\n\nThe first non-option argument after the subcommand determines scope:\n\n| Keyword | Meaning |\n|---|---|\n| `mine` (or omitted) | Tasks assigned to sender |\n| `all` | Shared tasks + sender's private tasks |\n| `@user` | Tasks assigned to the mentioned user |\n\n### 7.5 Status Keywords (for list/board)\n\n| Keyword | Meaning |\n|---|---|\n| `open` (or omitted) | Tasks with status = open |\n| `done` | Tasks with status = done |\n| `drop` | Tasks with status = dropped |\n\n---\n\n## Appendix: Help Text\n\nWhen the user sends `/todo` with no subcommand (or `/todo help`), the bot replies:\n\n```\n:book: OpenClaw TODO -- Commands\n\n/todo add <title> [@user] [/p project] [/s section] [due:date]\n    Create a new task.\n\n/todo list [mine|all|@user] [/p project] [/s section] [open|done|drop] [limit:N]\n    List tasks.\n\n/todo board [mine|all|@user] [/p project] [open|done|drop] [limitPerSection:N]\n    Show kanban board view.\n\n/todo move <id> <section>\n    Move a task to a section (backlog, doing, waiting, done, drop).\n\n/todo done <id>\n    Mark a task as done.\n\n/todo drop <id>\n    Drop (cancel) a task.\n\n/todo edit <id> [title] [@user] [/p project] [/s section] [due:date|due:-]\n    Edit a task. Mentions replace all assignees. due:- clears the date.\n\n/todo project list\n    Show all visible projects.\n\n/todo project set-private <name>\n    Make a project private (owner-only).\n\n/todo project set-shared <name>\n    Make a project shared.\n```\n"}, "tool_use_id": "toolu_01JnW9Ux66hZDCcpcZz79c2o", "_ts": "2026-02-20T11:33:23+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md", "content": "# OpenClaw TODO Plugin -- UX Specification\n\n> Version 1.0 | 2026-02-20\n> Based on PRD v1.1 (DM-based)\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Interaction Model](#2-interaction-model)\n3. [Command Reference and User Flows](#3-command-reference-and-user-flows)\n4. [Response Formatting](#4-response-formatting)\n5. [Error Messages](#5-error-messages)\n6. [Edge Cases](#6-edge-cases)\n7. [Input Parsing Rules](#7-input-parsing-rules)\n\n---\n\n## 1. Overview\n\nThe OpenClaw TODO Plugin is a text-based task management system that lives inside Slack DMs. Users interact with the bot by sending messages that start with `/todo`. The bot parses the command and replies in the same DM thread with structured, plain-text responses.\n\n### Design Principles\n\n- **Zero ambiguity**: Every command produces exactly one response. The user always knows whether the action succeeded or failed.\n- **Minimal typing**: Sensible defaults (project = `Inbox`, section = `backlog`, assignee = sender) mean most commands need only a title.\n- **Scannable output**: Responses use fixed-width IDs, consistent emoji prefixes, and aligned columns so users can scan quickly.\n- **Fail loudly**: Invalid input is rejected with a clear reason and the original request is not applied. No partial writes.\n\n---\n\n## 2. Interaction Model\n\n### 2.1 Entry Point\n\nThe user opens a DM conversation with the OpenClaw Slack bot and types messages beginning with `/todo`.\n\n### 2.2 Message Recognition\n\n| Message pattern | Bot behavior |\n|---|---|\n| Starts with `/todo` | Parsed as a command |\n| Anything else | Ignored silently (no reply) |\n\n### 2.3 Response Timing\n\nThe bot replies in the same DM channel. All responses are ephemeral-style (visible only to the sender) when technically possible; otherwise they appear as normal bot messages in the DM.\n\n### 2.4 No Confirmation Dialogs\n\nv1 has no interactive buttons, modals, or confirmation prompts. Every command is executed (or rejected) immediately upon receipt.\n\n---\n\n## 3. Command Reference and User Flows\n\n### 3.1 `/todo add` -- Create a Task\n\n**Purpose**: Create a new task with optional project, section, assignees, and due date.\n\n**Syntax**:\n```\n/todo add <title> [@user ...] [/p <project>] [/s <section>] [due:<date>]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| project | `Inbox` |\n| section | `backlog` |\n| assignees | sender |\n| due | none |\n\n**Flow**:\n1. User sends `/todo add Buy groceries`\n2. Bot creates task in Inbox/backlog, assigns to sender\n3. Bot replies with confirmation\n\n**Examples**:\n\n```\nInput:  /todo add Buy groceries\nOutput: :white_check_mark: Added #42 (Inbox/backlog) due:- assignees:@phil -- Buy groceries\n```\n\n```\nInput:  /todo add Fix login bug @alice /p Backend /s doing due:2026-03-15\nOutput: :white_check_mark: Added #43 (Backend/doing) due:2026-03-15 assignees:@alice -- Fix login bug\n```\n\n```\nInput:  /todo add Review PR @bob @carol /p Frontend\nOutput: :white_check_mark: Added #44 (Frontend/backlog) due:- assignees:@bob, @carol -- Review PR\n```\n\n**Success response format**:\n```\n:white_check_mark: Added #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, <@user>...] -- <title>\n```\n\n---\n\n### 3.2 `/todo list` -- List Tasks\n\n**Purpose**: Display a filtered, sorted list of tasks.\n\n**Syntax**:\n```\n/todo list [mine|all|@user] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limit | 30 |\n\n**Flow**:\n1. User sends `/todo list`\n2. Bot queries tasks where sender is an assignee, status is open\n3. Bot returns a numbered list sorted by due date (ascending, nulls last), then by ID (descending)\n\n**Example output**:\n```\n:clipboard: TODO List (mine / open) -- 3 tasks\n\n#50  due:2026-02-21  (Backend/doing)    @phil        Deploy hotfix\n#48  due:2026-03-01  (Inbox/backlog)    @phil        Buy groceries\n#45  due:-           (Frontend/waiting) @phil, @bob  Review PR\n\nShowing 3 of 3. Use limit:N to see more.\n```\n\n**Empty state**:\n```\n:clipboard: TODO List (mine / open) -- 0 tasks\n\nNo tasks found.\n```\n\n**Scope behavior**:\n| Scope | What it shows |\n|---|---|\n| `mine` | Tasks where sender is in the assignee list |\n| `all` | All shared tasks + sender's private tasks (never other users' private tasks) |\n| `@user` | Tasks where the mentioned user is an assignee (shared projects only, plus sender's private if sender = mentioned user) |\n\n---\n\n### 3.3 `/todo board` -- Kanban Board View\n\n**Purpose**: Display tasks grouped by section in a kanban-style text layout.\n\n**Syntax**:\n```\n/todo board [mine|all|@user] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limitPerSection | 10 |\n\n**Flow**:\n1. User sends `/todo board /p Backend`\n2. Bot queries matching tasks and groups them by section\n3. Bot returns sections in fixed order: BACKLOG, DOING, WAITING, DONE, DROP\n\n**Example output**:\n```\n:bar_chart: Board (mine / open) /p Backend\n\n-- BACKLOG (2) --\n#50  due:2026-03-10  @phil        Set up CI pipeline\n#47  due:-           @phil        Write migration script\n\n-- DOING (1) --\n#51  due:2026-02-22  @phil        Deploy hotfix\n\n-- WAITING (0) --\n(empty)\n\n-- DONE (0) --\n(empty)\n\n-- DROP (0) --\n(empty)\n```\n\n**Notes**:\n- Sections with zero items still appear with `(empty)` to maintain the full board structure.\n- Each section header shows the count of items.\n- When `limitPerSection` is reached, append `... and N more` below the last item in that section.\n\n---\n\n### 3.4 `/todo move` -- Move a Task to a Different Section\n\n**Purpose**: Change the section (kanban column) of a task.\n\n**Syntax**:\n```\n/todo move <id> <section>\n```\n\n**Valid sections**: `backlog`, `doing`, `waiting`, `done`, `drop`\n\n**Flow**:\n1. User sends `/todo move 50 doing`\n2. Bot validates permission and section name\n3. Bot updates the task and replies\n\n**Example**:\n```\nInput:  /todo move 50 doing\nOutput: :arrow_right: Moved #50 to doing (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.5 `/todo done` -- Mark a Task as Done\n\n**Purpose**: Shortcut to move a task to the `done` section and set its status to `done`.\n\n**Syntax**:\n```\n/todo done <id>\n```\n\n**Flow**:\n1. User sends `/todo done 50`\n2. Bot sets section=done, status=done, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo done 50\nOutput: :white_check_mark: Done #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.6 `/todo drop` -- Drop a Task\n\n**Purpose**: Mark a task as dropped (cancelled/abandoned).\n\n**Syntax**:\n```\n/todo drop <id>\n```\n\n**Flow**:\n1. User sends `/todo drop 50`\n2. Bot sets section=drop, status=dropped, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo drop 50\nOutput: :wastebasket: Dropped #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.7 `/todo edit` -- Edit a Task\n\n**Purpose**: Modify one or more fields of an existing task.\n\n**Syntax**:\n```\n/todo edit <id> [<new title>] [@user ...] [/p <project>] [/s <section>] [due:<date>|due:-]\n```\n\n**Rules**:\n- If `@user` mentions are present, the assignee list is **fully replaced** (not appended).\n- `due:-` clears the due date (sets it to null).\n- New title text is everything before the first option token (`/p`, `/s`, `due:`, or `@mention`). If empty, the title is unchanged.\n- Fields not specified in the command remain unchanged.\n\n**Flow**:\n1. User sends `/todo edit 50 Deploy hotfix v2 due:2026-03-01`\n2. Bot updates title and due date\n3. Bot replies with the updated state\n\n**Example**:\n```\nInput:  /todo edit 50 Deploy hotfix v2 due:2026-03-01\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@phil -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 @alice @bob\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 due:-\nOutput: :pencil2: Edited #50 (Backend/doing) due:- assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n**Success response format** (same structure as add):\n```\n:pencil2: Edited #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, ...] -- <title>\n```\n\n---\n\n### 3.8 `/todo project list` -- List Projects\n\n**Purpose**: Show all projects visible to the sender.\n\n**Syntax**:\n```\n/todo project list\n```\n\n**Flow**:\n1. User sends `/todo project list`\n2. Bot returns shared projects and the sender's private projects\n\n**Example output**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (12 tasks)\n  - Backend (5 tasks)\n  - Frontend (8 tasks)\n\nPrivate (yours):\n  - Personal (3 tasks)\n  - Side Project (1 task)\n```\n\n**Empty state**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (0 tasks)\n\nPrivate (yours):\n  (none)\n```\n\n---\n\n### 3.9 `/todo project set-private <name>` -- Make a Project Private\n\n**Purpose**: Convert a shared project to private or create a new private project.\n\n**Syntax**:\n```\n/todo project set-private <name>\n```\n\n**Flow**:\n\nCase A -- Project does not exist:\n1. Bot creates a new private project owned by the sender.\n2. Reply: `:lock: Created private project \"<name>\".`\n\nCase B -- Sender already has a private project with this name:\n1. Reply: `:lock: Project \"<name>\" is already private.`\n\nCase C -- Shared project exists, conversion attempt:\n1. Bot scans all tasks in the project for non-owner assignees.\n2. If none found: convert to private, reply `:lock: Project \"<name>\" is now private.`\n3. If found: reject with error (see [Section 5.3](#53-set-private-validation-error)).\n\n---\n\n### 3.10 `/todo project set-shared <name>` -- Make a Project Shared\n\n**Purpose**: Convert a private project to shared or create a new shared project.\n\n**Syntax**:\n```\n/todo project set-shared <name>\n```\n\n**Flow**:\n\nCase A -- Shared project with this name already exists:\n1. Reply: `:globe_with_meridians: Project \"<name>\" is already shared.`\n\nCase B -- No shared project with this name:\n1. Bot creates (or converts) the project to shared visibility.\n2. Reply: `:globe_with_meridians: Project \"<name>\" is now shared.`\n\nCase C -- Name conflict with an existing shared project:\n1. Reply: `:x: A shared project named \"<name>\" already exists.`\n\n---\n\n## 4. Response Formatting\n\n### 4.1 General Structure\n\nAll bot responses follow this pattern:\n\n```\n<emoji> <Action verb> <details>\n```\n\n| Action | Emoji | Verb |\n|---|---|---|\n| Add | :white_check_mark: | Added |\n| List | :clipboard: | TODO List |\n| Board | :bar_chart: | Board |\n| Move | :arrow_right: | Moved |\n| Done | :white_check_mark: | Done |\n| Drop | :wastebasket: | Dropped |\n| Edit | :pencil2: | Edited |\n| Project list | :file_folder: | Projects |\n| Set private | :lock: | (varies by case) |\n| Set shared | :globe_with_meridians: | (varies by case) |\n| Error | :x: | (error message) |\n| Warning/reject | :warning: | (warning message) |\n\n### 4.2 Task Line Format\n\nWhenever a single task is displayed inline (in list, board, or as a command result), it uses:\n\n```\n#<id>  due:<YYYY-MM-DD|->  (<project>/<section>)  <assignees>  <title>\n```\n\n- `id`: Left-padded for alignment in lists (e.g., `#42`, `# 7` -- optional, simple left-align is acceptable in v1).\n- `due`: Always shown. `-` when no due date.\n- `assignees`: Comma-separated Slack mentions. Displayed as `@username` in Slack's rendered view.\n- `title`: The full task title, untruncated.\n\n### 4.3 List/Board Headers\n\nLists and boards begin with a header line summarizing the query:\n\n```\n:clipboard: TODO List (<scope> / <status>) -- <count> tasks\n```\n```\n:bar_chart: Board (<scope> / <status>) [/p <project>]\n```\n\n### 4.4 Pagination Footer\n\nWhen the result set exceeds the limit:\n```\nShowing <displayed> of <total>. Use limit:N to see more.\n```\n\nFor board view:\n```\n... and <N> more\n```\n(appears below the last item in a section that hit `limitPerSection`)\n\n### 4.5 Text Encoding\n\n- All responses are plain Slack mrkdwn (Slack's markdown variant).\n- No block kit or attachments in v1.\n- User mentions are rendered as `<@UXXXXXXXX>` which Slack auto-formats.\n\n---\n\n## 5. Error Messages\n\n### 5.1 Input Validation Errors\n\n| Condition | Error message |\n|---|---|\n| Unknown command | `:x: Unknown command. Available: add, list, board, move, done, drop, edit, project` |\n| Missing title on add | `:x: Title is required. Usage: /todo add <title> [options]` |\n| Missing task ID | `:x: Task ID is required. Usage: /todo <command> <id>` |\n| Invalid task ID (not a number) | `:x: Invalid task ID \"<input>\". Must be a number.` |\n| Task not found | `:x: Task #<id> not found.` |\n| Invalid section name | `:x: Invalid section \"<input>\". Must be one of: backlog, doing, waiting, done, drop` |\n| Invalid date format | `:x: Invalid date \"<input>\". Use YYYY-MM-DD or MM-DD.` |\n| Invalid date value (e.g. 02-30) | `:x: Invalid date \"02-30\". This date does not exist.` |\n| Empty project name | `:x: Project name is required after /p.` |\n\n### 5.2 Permission Errors\n\n| Condition | Error message |\n|---|---|\n| Accessing another user's private project | `:x: Project \"<name>\" not found.` (deliberately vague to avoid leaking existence) |\n| Editing a task without permission | `:x: You don't have permission to modify task #<id>.` |\n\n### 5.3 Set-Private Validation Error\n\nWhen `/todo project set-private` fails due to non-owner assignees:\n\n```\n:x: Cannot set project \"<name>\" to private: found tasks assigned to non-owner users.\ne.g. #12 assignees:@alice, #18 assignees:@carol, #21 assignees:@bob\nPlease reassign or remove these assignees first.\n```\n\n- Show up to 10 violating tasks.\n- If more than 10, append: `... and <N> more tasks with external assignees.`\n\n### 5.4 Private Project Assignee Rejection\n\nWhen trying to assign a non-owner user to a task in a private project (on add or edit):\n\n```\n:warning: Private project \"<name>\" is owner-only. Cannot assign <@user> (not the owner).\nRequest was not applied.\n```\n\n### 5.5 Project Name Conflicts\n\n| Condition | Error message |\n|---|---|\n| Creating/renaming to an existing shared name | `:x: A shared project named \"<name>\" already exists.` |\n| Private name conflict for same owner | `:x: You already have a private project named \"<name>\".` |\n\n---\n\n## 6. Edge Cases\n\n### 6.1 Empty Inputs\n\n| Scenario | Behavior |\n|---|---|\n| `/todo` (no subcommand) | Reply with help text listing available commands |\n| `/todo add` (no title) | Error: title required |\n| `/todo edit 50` (no changes) | Reply: `:information_source: No changes specified for #50.` |\n| `/todo list /p NonExistent` | Error: project not found |\n\n### 6.2 Duplicate Operations\n\n| Scenario | Behavior |\n|---|---|\n| `/todo done 50` when already done | Reply: `:information_source: Task #50 is already done.` |\n| `/todo drop 50` when already dropped | Reply: `:information_source: Task #50 is already dropped.` |\n| `/todo move 50 doing` when already in doing | Reply: `:information_source: Task #50 is already in doing.` |\n\n### 6.3 Project Auto-Creation\n\n- When `/todo add ... /p NewProject` references a project that does not exist, the bot creates it as a **shared** project automatically and includes a note in the response:\n  ```\n  :white_check_mark: Added #55 (NewProject/backlog) due:- assignees:@phil -- Task title\n  :information_source: Project \"NewProject\" was created (shared).\n  ```\n- Exception: `Inbox` is always auto-created as shared if it does not exist.\n\n### 6.4 Case Sensitivity\n\n- **Section names**: Case-insensitive input, stored lowercase. `DOING`, `Doing`, `doing` all resolve to `doing`.\n- **Project names**: Case-sensitive. `Backend` and `backend` are different projects.\n- **Commands**: Case-insensitive. `/todo ADD`, `/TODO add`, `/todo Add` all work.\n\n### 6.5 Whitespace and Formatting\n\n- Leading/trailing whitespace in titles is trimmed.\n- Multiple spaces between words in a title are collapsed to a single space.\n- Empty title after trimming triggers the \"title required\" error.\n\n### 6.6 Special Characters in Titles\n\n- Titles may contain any UTF-8 characters except newlines.\n- Slack mrkdwn special characters (`*`, `_`, `~`, `` ` ``) in titles are escaped in the response to prevent formatting artifacts.\n\n### 6.7 Due Date Edge Cases\n\n| Input | Resolved date (assuming current year 2026) |\n|---|---|\n| `due:2026-03-15` | `2026-03-15` |\n| `due:03-15` | `2026-03-15` |\n| `due:3-5` | `2026-03-05` |\n| `due:02-29` | Error (2026 is not a leap year) |\n| `due:00-01` | Error (invalid month) |\n| `due:12-32` | Error (invalid day) |\n| `due:-` | Clears due date (null) |\n| `due:yesterday` | Error (invalid format) |\n\n---\n\n## 7. Input Parsing Rules\n\n### 7.1 Token Order\n\nThe parser processes the message left to right. Recognized option tokens are:\n\n| Token | Pattern | Notes |\n|---|---|---|\n| `/p` | `/p <word>` | Next whitespace-delimited word is the project name |\n| `/s` | `/s <word>` | Next word is the section name |\n| `due:` | `due:<value>` | No space between `due:` and the value |\n| `@mention` | `<@UXXXXXXXX>` | Slack user mention (may appear multiple times) |\n| `limit:` | `limit:<N>` | Positive integer |\n| `limitPerSection:` | `limitPerSection:<N>` | Positive integer |\n\n### 7.2 Title Extraction (for add/edit)\n\nEverything that is **not** a recognized option token or mention is treated as the title. The title words are concatenated in their original order.\n\nExample parse:\n```\n/todo add Fix the login bug @alice /p Backend due:03-15\n\nParsed:\n  command   = add\n  title     = \"Fix the login bug\"\n  assignees = [@alice]\n  project   = \"Backend\"\n  due       = \"2026-03-15\"\n  section   = (default: backlog)\n```\n\n### 7.3 Mention Handling\n\n- Slack internally sends mentions as `<@U04ABCD1234>`.\n- The bot resolves these to display names in responses when possible.\n- If a mentioned user cannot be resolved, the raw `<@U...>` format is preserved.\n\n### 7.4 Scope Keywords (for list/board)\n\nThe first non-option argument after the subcommand determines scope:\n\n| Keyword | Meaning |\n|---|---|\n| `mine` (or omitted) | Tasks assigned to sender |\n| `all` | Shared tasks + sender's private tasks |\n| `@user` | Tasks assigned to the mentioned user |\n\n### 7.5 Status Keywords (for list/board)\n\n| Keyword | Meaning |\n|---|---|\n| `open` (or omitted) | Tasks with status = open |\n| `done` | Tasks with status = done |\n| `drop` | Tasks with status = dropped |\n\n---\n\n## Appendix: Help Text\n\nWhen the user sends `/todo` with no subcommand (or `/todo help`), the bot replies:\n\n```\n:book: OpenClaw TODO -- Commands\n\n/todo add <title> [@user] [/p project] [/s section] [due:date]\n    Create a new task.\n\n/todo list [mine|all|@user] [/p project] [/s section] [open|done|drop] [limit:N]\n    List tasks.\n\n/todo board [mine|all|@user] [/p project] [open|done|drop] [limitPerSection:N]\n    Show kanban board view.\n\n/todo move <id> <section>\n    Move a task to a section (backlog, doing, waiting, done, drop).\n\n/todo done <id>\n    Mark a task as done.\n\n/todo drop <id>\n    Drop (cancel) a task.\n\n/todo edit <id> [title] [@user] [/p project] [/s section] [due:date|due:-]\n    Edit a task. Mentions replace all assignees. due:- clears the date.\n\n/todo project list\n    Show all visible projects.\n\n/todo project set-private <name>\n    Make a project private (owner-only).\n\n/todo project set-shared <name>\n    Make a project shared.\n```\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/ux_spec.md", "content": "# OpenClaw TODO Plugin -- UX Specification\n\n> Version 1.0 | 2026-02-20\n> Based on PRD v1.1 (DM-based)\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Interaction Model](#2-interaction-model)\n3. [Command Reference and User Flows](#3-command-reference-and-user-flows)\n4. [Response Formatting](#4-response-formatting)\n5. [Error Messages](#5-error-messages)\n6. [Edge Cases](#6-edge-cases)\n7. [Input Parsing Rules](#7-input-parsing-rules)\n\n---\n\n## 1. Overview\n\nThe OpenClaw TODO Plugin is a text-based task management system that lives inside Slack DMs. Users interact with the bot by sending messages that start with `/todo`. The bot parses the command and replies in the same DM thread with structured, plain-text responses.\n\n### Design Principles\n\n- **Zero ambiguity**: Every command produces exactly one response. The user always knows whether the action succeeded or failed.\n- **Minimal typing**: Sensible defaults (project = `Inbox`, section = `backlog`, assignee = sender) mean most commands need only a title.\n- **Scannable output**: Responses use fixed-width IDs, consistent emoji prefixes, and aligned columns so users can scan quickly.\n- **Fail loudly**: Invalid input is rejected with a clear reason and the original request is not applied. No partial writes.\n\n---\n\n## 2. Interaction Model\n\n### 2.1 Entry Point\n\nThe user opens a DM conversation with the OpenClaw Slack bot and types messages beginning with `/todo`.\n\n### 2.2 Message Recognition\n\n| Message pattern | Bot behavior |\n|---|---|\n| Starts with `/todo` | Parsed as a command |\n| Anything else | Ignored silently (no reply) |\n\n### 2.3 Response Timing\n\nThe bot replies in the same DM channel. All responses are ephemeral-style (visible only to the sender) when technically possible; otherwise they appear as normal bot messages in the DM.\n\n### 2.4 No Confirmation Dialogs\n\nv1 has no interactive buttons, modals, or confirmation prompts. Every command is executed (or rejected) immediately upon receipt.\n\n---\n\n## 3. Command Reference and User Flows\n\n### 3.1 `/todo add` -- Create a Task\n\n**Purpose**: Create a new task with optional project, section, assignees, and due date.\n\n**Syntax**:\n```\n/todo add <title> [@user ...] [/p <project>] [/s <section>] [due:<date>]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| project | `Inbox` |\n| section | `backlog` |\n| assignees | sender |\n| due | none |\n\n**Flow**:\n1. User sends `/todo add Buy groceries`\n2. Bot creates task in Inbox/backlog, assigns to sender\n3. Bot replies with confirmation\n\n**Examples**:\n\n```\nInput:  /todo add Buy groceries\nOutput: :white_check_mark: Added #42 (Inbox/backlog) due:- assignees:@phil -- Buy groceries\n```\n\n```\nInput:  /todo add Fix login bug @alice /p Backend /s doing due:2026-03-15\nOutput: :white_check_mark: Added #43 (Backend/doing) due:2026-03-15 assignees:@alice -- Fix login bug\n```\n\n```\nInput:  /todo add Review PR @bob @carol /p Frontend\nOutput: :white_check_mark: Added #44 (Frontend/backlog) due:- assignees:@bob, @carol -- Review PR\n```\n\n**Success response format**:\n```\n:white_check_mark: Added #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, <@user>...] -- <title>\n```\n\n---\n\n### 3.2 `/todo list` -- List Tasks\n\n**Purpose**: Display a filtered, sorted list of tasks.\n\n**Syntax**:\n```\n/todo list [mine|all|@user] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limit | 30 |\n\n**Flow**:\n1. User sends `/todo list`\n2. Bot queries tasks where sender is an assignee, status is open\n3. Bot returns a numbered list sorted by due date (ascending, nulls last), then by ID (descending)\n\n**Example output**:\n```\n:clipboard: TODO List (mine / open) -- 3 tasks\n\n#50  due:2026-02-21  (Backend/doing)    @phil        Deploy hotfix\n#48  due:2026-03-01  (Inbox/backlog)    @phil        Buy groceries\n#45  due:-           (Frontend/waiting) @phil, @bob  Review PR\n\nShowing 3 of 3. Use limit:N to see more.\n```\n\n**Empty state**:\n```\n:clipboard: TODO List (mine / open) -- 0 tasks\n\nNo tasks found.\n```\n\n**Scope behavior**:\n| Scope | What it shows |\n|---|---|\n| `mine` | Tasks where sender is in the assignee list |\n| `all` | All shared tasks + sender's private tasks (never other users' private tasks) |\n| `@user` | Tasks where the mentioned user is an assignee (shared projects only, plus sender's private if sender = mentioned user) |\n\n---\n\n### 3.3 `/todo board` -- Kanban Board View\n\n**Purpose**: Display tasks grouped by section in a kanban-style text layout.\n\n**Syntax**:\n```\n/todo board [mine|all|@user] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n**Defaults**:\n| Parameter | Default |\n|---|---|\n| scope | `mine` |\n| status filter | `open` |\n| limitPerSection | 10 |\n\n**Flow**:\n1. User sends `/todo board /p Backend`\n2. Bot queries matching tasks and groups them by section\n3. Bot returns sections in fixed order: BACKLOG, DOING, WAITING, DONE, DROP\n\n**Example output**:\n```\n:bar_chart: Board (mine / open) /p Backend\n\n-- BACKLOG (2) --\n#50  due:2026-03-10  @phil        Set up CI pipeline\n#47  due:-           @phil        Write migration script\n\n-- DOING (1) --\n#51  due:2026-02-22  @phil        Deploy hotfix\n\n-- WAITING (0) --\n(empty)\n\n-- DONE (0) --\n(empty)\n\n-- DROP (0) --\n(empty)\n```\n\n**Notes**:\n- Sections with zero items still appear with `(empty)` to maintain the full board structure.\n- Each section header shows the count of items.\n- When `limitPerSection` is reached, append `... and N more` below the last item in that section.\n\n---\n\n### 3.4 `/todo move` -- Move a Task to a Different Section\n\n**Purpose**: Change the section (kanban column) of a task.\n\n**Syntax**:\n```\n/todo move <id> <section>\n```\n\n**Valid sections**: `backlog`, `doing`, `waiting`, `done`, `drop`\n\n**Flow**:\n1. User sends `/todo move 50 doing`\n2. Bot validates permission and section name\n3. Bot updates the task and replies\n\n**Example**:\n```\nInput:  /todo move 50 doing\nOutput: :arrow_right: Moved #50 to doing (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.5 `/todo done` -- Mark a Task as Done\n\n**Purpose**: Shortcut to move a task to the `done` section and set its status to `done`.\n\n**Syntax**:\n```\n/todo done <id>\n```\n\n**Flow**:\n1. User sends `/todo done 50`\n2. Bot sets section=done, status=done, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo done 50\nOutput: :white_check_mark: Done #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.6 `/todo drop` -- Drop a Task\n\n**Purpose**: Mark a task as dropped (cancelled/abandoned).\n\n**Syntax**:\n```\n/todo drop <id>\n```\n\n**Flow**:\n1. User sends `/todo drop 50`\n2. Bot sets section=drop, status=dropped, records closed_at\n3. Bot replies with confirmation\n\n**Example**:\n```\nInput:  /todo drop 50\nOutput: :wastebasket: Dropped #50 (Backend) -- Deploy hotfix\n```\n\n---\n\n### 3.7 `/todo edit` -- Edit a Task\n\n**Purpose**: Modify one or more fields of an existing task.\n\n**Syntax**:\n```\n/todo edit <id> [<new title>] [@user ...] [/p <project>] [/s <section>] [due:<date>|due:-]\n```\n\n**Rules**:\n- If `@user` mentions are present, the assignee list is **fully replaced** (not appended).\n- `due:-` clears the due date (sets it to null).\n- New title text is everything before the first option token (`/p`, `/s`, `due:`, or `@mention`). If empty, the title is unchanged.\n- Fields not specified in the command remain unchanged.\n\n**Flow**:\n1. User sends `/todo edit 50 Deploy hotfix v2 due:2026-03-01`\n2. Bot updates title and due date\n3. Bot replies with the updated state\n\n**Example**:\n```\nInput:  /todo edit 50 Deploy hotfix v2 due:2026-03-01\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@phil -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 @alice @bob\nOutput: :pencil2: Edited #50 (Backend/doing) due:2026-03-01 assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n```\nInput:  /todo edit 50 due:-\nOutput: :pencil2: Edited #50 (Backend/doing) due:- assignees:@alice, @bob -- Deploy hotfix v2\n```\n\n**Success response format** (same structure as add):\n```\n:pencil2: Edited #<id> (<project>/<section>) due:<date|-> assignees:<@user>[, ...] -- <title>\n```\n\n---\n\n### 3.8 `/todo project list` -- List Projects\n\n**Purpose**: Show all projects visible to the sender.\n\n**Syntax**:\n```\n/todo project list\n```\n\n**Flow**:\n1. User sends `/todo project list`\n2. Bot returns shared projects and the sender's private projects\n\n**Example output**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (12 tasks)\n  - Backend (5 tasks)\n  - Frontend (8 tasks)\n\nPrivate (yours):\n  - Personal (3 tasks)\n  - Side Project (1 task)\n```\n\n**Empty state**:\n```\n:file_folder: Projects\n\nShared:\n  - Inbox (0 tasks)\n\nPrivate (yours):\n  (none)\n```\n\n---\n\n### 3.9 `/todo project set-private <name>` -- Make a Project Private\n\n**Purpose**: Convert a shared project to private or create a new private project.\n\n**Syntax**:\n```\n/todo project set-private <name>\n```\n\n**Flow**:\n\nCase A -- Project does not exist:\n1. Bot creates a new private project owned by the sender.\n2. Reply: `:lock: Created private project \"<name>\".`\n\nCase B -- Sender already has a private project with this name:\n1. Reply: `:lock: Project \"<name>\" is already private.`\n\nCase C -- Shared project exists, conversion attempt:\n1. Bot scans all tasks in the project for non-owner assignees.\n2. If none found: convert to private, reply `:lock: Project \"<name>\" is now private.`\n3. If found: reject with error (see [Section 5.3](#53-set-private-validation-error)).\n\n---\n\n### 3.10 `/todo project set-shared <name>` -- Make a Project Shared\n\n**Purpose**: Convert a private project to shared or create a new shared project.\n\n**Syntax**:\n```\n/todo project set-shared <name>\n```\n\n**Flow**:\n\nCase A -- Shared project with this name already exists:\n1. Reply: `:globe_with_meridians: Project \"<name>\" is already shared.`\n\nCase B -- No shared project with this name:\n1. Bot creates (or converts) the project to shared visibility.\n2. Reply: `:globe_with_meridians: Project \"<name>\" is now shared.`\n\nCase C -- Name conflict with an existing shared project:\n1. Reply: `:x: A shared project named \"<name>\" already exists.`\n\n---\n\n## 4. Response Formatting\n\n### 4.1 General Structure\n\nAll bot responses follow this pattern:\n\n```\n<emoji> <Action verb> <details>\n```\n\n| Action | Emoji | Verb |\n|---|---|---|\n| Add | :white_check_mark: | Added |\n| List | :clipboard: | TODO List |\n| Board | :bar_chart: | Board |\n| Move | :arrow_right: | Moved |\n| Done | :white_check_mark: | Done |\n| Drop | :wastebasket: | Dropped |\n| Edit | :pencil2: | Edited |\n| Project list | :file_folder: | Projects |\n| Set private | :lock: | (varies by case) |\n| Set shared | :globe_with_meridians: | (varies by case) |\n| Error | :x: | (error message) |\n| Warning/reject | :warning: | (warning message) |\n\n### 4.2 Task Line Format\n\nWhenever a single task is displayed inline (in list, board, or as a command result), it uses:\n\n```\n#<id>  due:<YYYY-MM-DD|->  (<project>/<section>)  <assignees>  <title>\n```\n\n- `id`: Left-padded for alignment in lists (e.g., `#42`, `# 7` -- optional, simple left-align is acceptable in v1).\n- `due`: Always shown. `-` when no due date.\n- `assignees`: Comma-separated Slack mentions. Displayed as `@username` in Slack's rendered view.\n- `title`: The full task title, untruncated.\n\n### 4.3 List/Board Headers\n\nLists and boards begin with a header line summarizing the query:\n\n```\n:clipboard: TODO List (<scope> / <status>) -- <count> tasks\n```\n```\n:bar_chart: Board (<scope> / <status>) [/p <project>]\n```\n\n### 4.4 Pagination Footer\n\nWhen the result set exceeds the limit:\n```\nShowing <displayed> of <total>. Use limit:N to see more.\n```\n\nFor board view:\n```\n... and <N> more\n```\n(appears below the last item in a section that hit `limitPerSection`)\n\n### 4.5 Text Encoding\n\n- All responses are plain Slack mrkdwn (Slack's markdown variant).\n- No block kit or attachments in v1.\n- User mentions are rendered as `<@UXXXXXXXX>` which Slack auto-formats.\n\n---\n\n## 5. Error Messages\n\n### 5.1 Input Validation Errors\n\n| Condition | Error message |\n|---|---|\n| Unknown command | `:x: Unknown command. Available: add, list, board, move, done, drop, edit, project` |\n| Missing title on add | `:x: Title is required. Usage: /todo add <title> [options]` |\n| Missing task ID | `:x: Task ID is required. Usage: /todo <command> <id>` |\n| Invalid task ID (not a number) | `:x: Invalid task ID \"<input>\". Must be a number.` |\n| Task not found | `:x: Task #<id> not found.` |\n| Invalid section name | `:x: Invalid section \"<input>\". Must be one of: backlog, doing, waiting, done, drop` |\n| Invalid date format | `:x: Invalid date \"<input>\". Use YYYY-MM-DD or MM-DD.` |\n| Invalid date value (e.g. 02-30) | `:x: Invalid date \"02-30\". This date does not exist.` |\n| Empty project name | `:x: Project name is required after /p.` |\n\n### 5.2 Permission Errors\n\n| Condition | Error message |\n|---|---|\n| Accessing another user's private project | `:x: Project \"<name>\" not found.` (deliberately vague to avoid leaking existence) |\n| Editing a task without permission | `:x: You don't have permission to modify task #<id>.` |\n\n### 5.3 Set-Private Validation Error\n\nWhen `/todo project set-private` fails due to non-owner assignees:\n\n```\n:x: Cannot set project \"<name>\" to private: found tasks assigned to non-owner users.\ne.g. #12 assignees:@alice, #18 assignees:@carol, #21 assignees:@bob\nPlease reassign or remove these assignees first.\n```\n\n- Show up to 10 violating tasks.\n- If more than 10, append: `... and <N> more tasks with external assignees.`\n\n### 5.4 Private Project Assignee Rejection\n\nWhen trying to assign a non-owner user to a task in a private project (on add or edit):\n\n```\n:warning: Private project \"<name>\" is owner-only. Cannot assign <@user> (not the owner).\nRequest was not applied.\n```\n\n### 5.5 Project Name Conflicts\n\n| Condition | Error message |\n|---|---|\n| Creating/renaming to an existing shared name | `:x: A shared project named \"<name>\" already exists.` |\n| Private name conflict for same owner | `:x: You already have a private project named \"<name>\".` |\n\n---\n\n## 6. Edge Cases\n\n### 6.1 Empty Inputs\n\n| Scenario | Behavior |\n|---|---|\n| `/todo` (no subcommand) | Reply with help text listing available commands |\n| `/todo add` (no title) | Error: title required |\n| `/todo edit 50` (no changes) | Reply: `:information_source: No changes specified for #50.` |\n| `/todo list /p NonExistent` | Error: project not found |\n\n### 6.2 Duplicate Operations\n\n| Scenario | Behavior |\n|---|---|\n| `/todo done 50` when already done | Reply: `:information_source: Task #50 is already done.` |\n| `/todo drop 50` when already dropped | Reply: `:information_source: Task #50 is already dropped.` |\n| `/todo move 50 doing` when already in doing | Reply: `:information_source: Task #50 is already in doing.` |\n\n### 6.3 Project Auto-Creation\n\n- When `/todo add ... /p NewProject` references a project that does not exist, the bot creates it as a **shared** project automatically and includes a note in the response:\n  ```\n  :white_check_mark: Added #55 (NewProject/backlog) due:- assignees:@phil -- Task title\n  :information_source: Project \"NewProject\" was created (shared).\n  ```\n- Exception: `Inbox` is always auto-created as shared if it does not exist.\n\n### 6.4 Case Sensitivity\n\n- **Section names**: Case-insensitive input, stored lowercase. `DOING`, `Doing`, `doing` all resolve to `doing`.\n- **Project names**: Case-sensitive. `Backend` and `backend` are different projects.\n- **Commands**: Case-insensitive. `/todo ADD`, `/TODO add`, `/todo Add` all work.\n\n### 6.5 Whitespace and Formatting\n\n- Leading/trailing whitespace in titles is trimmed.\n- Multiple spaces between words in a title are collapsed to a single space.\n- Empty title after trimming triggers the \"title required\" error.\n\n### 6.6 Special Characters in Titles\n\n- Titles may contain any UTF-8 characters except newlines.\n- Slack mrkdwn special characters (`*`, `_`, `~`, `` ` ``) in titles are escaped in the response to prevent formatting artifacts.\n\n### 6.7 Due Date Edge Cases\n\n| Input | Resolved date (assuming current year 2026) |\n|---|---|\n| `due:2026-03-15` | `2026-03-15` |\n| `due:03-15` | `2026-03-15` |\n| `due:3-5` | `2026-03-05` |\n| `due:02-29` | Error (2026 is not a leap year) |\n| `due:00-01` | Error (invalid month) |\n| `due:12-32` | Error (invalid day) |\n| `due:-` | Clears due date (null) |\n| `due:yesterday` | Error (invalid format) |\n\n---\n\n## 7. Input Parsing Rules\n\n### 7.1 Token Order\n\nThe parser processes the message left to right. Recognized option tokens are:\n\n| Token | Pattern | Notes |\n|---|---|---|\n| `/p` | `/p <word>` | Next whitespace-delimited word is the project name |\n| `/s` | `/s <word>` | Next word is the section name |\n| `due:` | `due:<value>` | No space between `due:` and the value |\n| `@mention` | `<@UXXXXXXXX>` | Slack user mention (may appear multiple times) |\n| `limit:` | `limit:<N>` | Positive integer |\n| `limitPerSection:` | `limitPerSection:<N>` | Positive integer |\n\n### 7.2 Title Extraction (for add/edit)\n\nEverything that is **not** a recognized option token or mention is treated as the title. The title words are concatenated in their original order.\n\nExample parse:\n```\n/todo add Fix the login bug @alice /p Backend due:03-15\n\nParsed:\n  command   = add\n  title     = \"Fix the login bug\"\n  assignees = [@alice]\n  project   = \"Backend\"\n  due       = \"2026-03-15\"\n  section   = (default: backlog)\n```\n\n### 7.3 Mention Handling\n\n- Slack internally sends mentions as `<@U04ABCD1234>`.\n- The bot resolves these to display names in responses when possible.\n- If a mentioned user cannot be resolved, the raw `<@U...>` format is preserved.\n\n### 7.4 Scope Keywords (for list/board)\n\nThe first non-option argument after the subcommand determines scope:\n\n| Keyword | Meaning |\n|---|---|\n| `mine` (or omitted) | Tasks assigned to sender |\n| `all` | Shared tasks + sender's private tasks |\n| `@user` | Tasks assigned to the mentioned user |\n\n### 7.5 Status Keywords (for list/board)\n\n| Keyword | Meaning |\n|---|---|\n| `open` (or omitted) | Tasks with status = open |\n| `done` | Tasks with status = done |\n| `drop` | Tasks with status = dropped |\n\n---\n\n## Appendix: Help Text\n\nWhen the user sends `/todo` with no subcommand (or `/todo help`), the bot replies:\n\n```\n:book: OpenClaw TODO -- Commands\n\n/todo add <title> [@user] [/p project] [/s section] [due:date]\n    Create a new task.\n\n/todo list [mine|all|@user] [/p project] [/s section] [open|done|drop] [limit:N]\n    List tasks.\n\n/todo board [mine|all|@user] [/p project] [open|done|drop] [limitPerSection:N]\n    Show kanban board view.\n\n/todo move <id> <section>\n    Move a task to a section (backlog, doing, waiting, done, drop).\n\n/todo done <id>\n    Mark a task as done.\n\n/todo drop <id>\n    Drop (cancel) a task.\n\n/todo edit <id> [title] [@user] [/p project] [/s section] [due:date|due:-]\n    Edit a task. Mentions replace all assignees. due:- clears the date.\n\n/todo project list\n    Show all visible projects.\n\n/todo project set-private <name>\n    Make a project private (owner-only).\n\n/todo project set-shared <name>\n    Make a project shared.\n```\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01JnW9Ux66hZDCcpcZz79c2o", "_ts": "2026-02-20T11:33:23+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "content": "# Architecture -- OpenClaw TODO Plugin for Slack\n\n> Version: 1.0\n> Date: 2026-02-20\n> Status: Proposed\n> Derived from: `openclaw_todo_plugin_prd.md` v1.1\n\n---\n\n## 1. System Context\n\nThis is an **OpenClaw plugin**, not a standalone application. It runs inside the OpenClaw Gateway process and communicates with users through Slack DMs. There is no HTTP server, no REST API, and no web framework. The entire system is a single Python package that the Gateway loads at startup.\n\n```\nSlack User  --(DM)--> Slack API --> OpenClaw Gateway --> TODO Plugin --> SQLite3\n```\n\n### Constraints\n\n- No LLM calls (zero cost per invocation).\n- Single SQLite3 file shared across all users within one Gateway instance.\n- No external dependencies beyond the Python stdlib and the OpenClaw plugin SDK.\n\n---\n\n## 2. Module / Package Structure\n\n```\nopenclaw_todo_plugin/\n    __init__.py              # Plugin entry point; exports register()\n    plugin.py                # OpenClaw plugin registration and message dispatch\n    router.py                # Command routing: text -> handler\n    parser.py                # Tokenizer and argument extractor\n    commands/\n        __init__.py\n        add.py               # /todo add\n        list_cmd.py          # /todo list   (avoids shadowing builtins)\n        board.py             # /todo board\n        move.py              # /todo move\n        done.py              # /todo done\n        drop.py              # /todo drop\n        edit.py              # /todo edit\n        project.py           # /todo project list|set-private|set-shared\n    db/\n        __init__.py\n        connection.py        # Connection factory, WAL/busy_timeout pragmas\n        migrate.py           # Schema versioning and migration runner\n        migrations/\n            __init__.py\n            v001_initial.py  # Initial schema (projects, tasks, task_assignees, events, schema_version)\n    models.py                # Dataclasses: Task, Project, Assignee, Event\n    repositories/\n        __init__.py\n        project_repo.py      # CRUD + resolve logic for projects\n        task_repo.py          # CRUD + query builders for tasks\n        event_repo.py         # Append-only audit log writes\n    services/\n        __init__.py\n        project_service.py   # Business rules for project visibility transitions\n        task_service.py       # Business rules for task lifecycle\n        permission.py         # Authorization checks (private/shared, owner/assignee)\n    formatters.py             # Slack message formatting (board, list, confirmations)\n    date_utils.py             # due parser: YYYY-MM-DD / MM-DD normalization\n    errors.py                 # Domain exception hierarchy\n    config.py                 # DB path resolution, timezone, defaults\ntests/\n    conftest.py               # Shared fixtures (in-memory SQLite, fake sender context)\n    test_parser.py\n    test_date_utils.py\n    test_commands/\n        test_add.py\n        test_list.py\n        test_board.py\n        test_move.py\n        test_done_drop.py\n        test_edit.py\n        test_project.py\n    test_repositories/\n        test_project_repo.py\n        test_task_repo.py\n    test_services/\n        test_permission.py\n        test_project_service.py\n        test_task_service.py\n    test_db/\n        test_migrate.py\n```\n\n### Rationale\n\n- **Flat `commands/` package**: one module per command keeps each handler under 150 lines and independently testable.\n- **Repository pattern** over raw SQL in handlers: SQL stays in one place; business logic in `services/` never imports `sqlite3`.\n- **No ORM**: SQLite3 stdlib driver is sufficient. An ORM would add a dependency for no gain at this scale.\n\n---\n\n## 3. Data Model\n\n### 3.1 Entity-Relationship Diagram (logical)\n\n```\nprojects 1---* tasks *---* task_assignees\n                |\n                +---* events\n```\n\n### 3.2 Tables\n\nAll timestamps are stored as ISO-8601 TEXT in UTC.\n\n#### `schema_version`\n\n| Column  | Type    | Notes        |\n|---------|---------|--------------|\n| version | INTEGER | NOT NULL     |\n\nSingle-row table. Current value determines which migrations to run.\n\n#### `projects`\n\n| Column         | Type    | Constraints / Default                     |\n|----------------|---------|-------------------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT                          |\n| name           | TEXT    | NOT NULL                                  |\n| visibility     | TEXT    | NOT NULL CHECK IN ('shared','private')    |\n| owner_user_id  | TEXT    | NULL (NULL when shared)                   |\n| created_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n| updated_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n\n**Indexes:**\n\n```sql\nCREATE UNIQUE INDEX ux_projects_shared_name\n    ON projects(name) WHERE visibility='shared';\n\nCREATE UNIQUE INDEX ux_projects_private_owner_name\n    ON projects(owner_user_id, name) WHERE visibility='private';\n```\n\n#### `tasks`\n\n| Column      | Type    | Constraints / Default                                   |\n|-------------|---------|----------------------------------------------------------|\n| id          | INTEGER | PK AUTOINCREMENT                                         |\n| title       | TEXT    | NOT NULL                                                 |\n| project_id  | INTEGER | NOT NULL FK -> projects(id)                              |\n| section     | TEXT    | NOT NULL CHECK IN ('backlog','doing','waiting','done','drop') |\n| due         | TEXT    | NULL, format YYYY-MM-DD                                  |\n| status      | TEXT    | NOT NULL CHECK IN ('open','done','dropped')              |\n| created_by  | TEXT    | NOT NULL (Slack user id)                                 |\n| created_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| updated_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| closed_at   | TEXT    | NULL                                                     |\n\n**Indexes:**\n\n```sql\nCREATE INDEX ix_tasks_project_section ON tasks(project_id, section);\nCREATE INDEX ix_tasks_status ON tasks(status);\n```\n\n#### `task_assignees`\n\n| Column           | Type    | Constraints                  |\n|------------------|---------|------------------------------|\n| task_id          | INTEGER | NOT NULL FK -> tasks(id)     |\n| assignee_user_id | TEXT    | NOT NULL                     |\n\n```sql\nPRIMARY KEY (task_id, assignee_user_id)\nCREATE INDEX ix_task_assignees_user ON task_assignees(assignee_user_id, task_id);\n```\n\n#### `events` (audit log)\n\n| Column         | Type    | Notes                        |\n|----------------|---------|------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT             |\n| ts             | TEXT    | NOT NULL DEFAULT datetime('now') |\n| actor_user_id  | TEXT    | NOT NULL                     |\n| action         | TEXT    | NOT NULL (e.g. 'task.add')   |\n| task_id        | INTEGER | NULL                         |\n| payload        | TEXT    | JSON blob                    |\n\n### 3.3 Concurrency Pragmas\n\nApplied once per connection in `db/connection.py`:\n\n```python\nconn.execute(\"PRAGMA journal_mode=WAL\")\nconn.execute(\"PRAGMA busy_timeout=3000\")\nconn.execute(\"PRAGMA foreign_keys=ON\")\n```\n\n---\n\n## 4. APIs (Plugin Interface)\n\nThis plugin does not expose HTTP endpoints. Its \"API\" is the contract between OpenClaw Gateway and the plugin.\n\n### 4.1 Plugin Registration\n\n```python\n# openclaw_todo_plugin/__init__.py\n\ndef register(gateway):\n    \"\"\"Called by OpenClaw Gateway at startup.\n\n    Args:\n        gateway: OpenClaw gateway instance providing hooks for\n                 message handling and configuration access.\n    \"\"\"\n    from .plugin import TodoPlugin\n    plugin = TodoPlugin(gateway)\n    gateway.on_dm_message(plugin.handle)\n```\n\n### 4.2 Message Handler Contract\n\n```python\nclass TodoPlugin:\n    def handle(self, message: IncomingMessage) -> str | None:\n        \"\"\"Process a Slack DM. Return reply text or None to ignore.\"\"\"\n```\n\n`IncomingMessage` is an OpenClaw SDK type expected to carry at minimum:\n\n| Field        | Type | Description                     |\n|--------------|------|---------------------------------|\n| text         | str  | Raw message text                |\n| sender_id    | str  | Slack user ID of the sender     |\n| channel_id   | str  | DM channel ID                   |\n| timestamp    | str  | Slack message ts                |\n\n### 4.3 Command Routing\n\n`router.py` maps the second token of the message to a handler function:\n\n```python\nCOMMANDS = {\n    \"add\":     commands.add.handle,\n    \"list\":    commands.list_cmd.handle,\n    \"board\":   commands.board.handle,\n    \"move\":    commands.move.handle,\n    \"done\":    commands.done.handle,\n    \"drop\":    commands.drop.handle,\n    \"edit\":    commands.edit.handle,\n    \"project\": commands.project.handle,   # sub-routes internally\n}\n\ndef route(text: str, sender_id: str) -> str:\n    tokens = text.strip().split()\n    if not tokens or tokens[0] != \"/todo\":\n        return None\n    verb = tokens[1] if len(tokens) > 1 else \"help\"\n    handler = COMMANDS.get(verb)\n    if handler is None:\n        return f\"Unknown command: {verb}. Try /todo help\"\n    return handler(tokens[2:], sender_id)\n```\n\n### 4.4 Command Handler Signature\n\nEvery handler in `commands/` follows the same signature:\n\n```python\ndef handle(args: list[str], sender_id: str) -> str:\n    \"\"\"Execute the command and return a Slack-formatted reply string.\"\"\"\n```\n\n---\n\n## 5. Key Flows\n\n### 5.1 `/todo add` Flow\n\n```\nUser -> Gateway -> TodoPlugin.handle()\n  -> router.route() -> commands.add.handle()\n    -> parser.parse_add_args(tokens)        # extract title, mentions, /p, /s, due\n    -> date_utils.normalize_due(raw_due)    # MM-DD -> YYYY-MM-DD, validate\n    -> project_repo.resolve(name, sender)   # private-first resolution\n    -> permission.check_assignees(project, assignees, sender)  # private project guard\n    -> task_repo.create(task)               # INSERT task + task_assignees\n    -> event_repo.log(\"task.add\", ...)      # audit\n    -> formatters.format_add_confirm(task)  # reply string\n```\n\n### 5.2 `/todo project set-private` Flow\n\n```\ncommands.project.handle([\"set-private\", name], sender)\n  -> project_repo.resolve(name, sender)\n  -> IF already private: return \"already private\"\n  -> task_repo.find_non_owner_assignees(project_id, sender)\n  -> IF any found: return error with violating task IDs\n  -> project_repo.update_visibility(project_id, \"private\", sender)\n  -> event_repo.log(\"project.set_private\", ...)\n```\n\n---\n\n## 6. Jobs / Background Work\n\nThere are **no background jobs** in v1. All operations are synchronous request-response within the Gateway's message handler. Potential future jobs:\n\n| Job (future)           | Trigger         | Purpose                              |\n|------------------------|-----------------|--------------------------------------|\n| Due date reminders     | Cron / schedule | DM users about upcoming/overdue tasks|\n| Stale task cleanup     | Weekly          | Auto-drop tasks untouched > N days   |\n| DB vacuum              | Weekly          | Reclaim WAL space                    |\n\nThese would be registered via `gateway.schedule()` if the OpenClaw SDK supports it.\n\n---\n\n## 7. Observability\n\n### 7.1 Structured Logging\n\nAll modules use Python's `logging` module with a shared logger name `openclaw_todo`:\n\n```python\nimport logging\nlogger = logging.getLogger(\"openclaw_todo\")\n```\n\nLog levels:\n- **INFO**: command received (verb, sender_id, project), command completed.\n- **WARNING**: permission denied, invalid input, constraint violation.\n- **ERROR**: unexpected exceptions, DB errors.\n\n### 7.2 Audit Trail\n\nThe `events` table provides a queryable audit log. Every state-changing operation (add, edit, move, done, drop, project visibility change) writes an event row with the actor, action, affected task ID, and a JSON payload of the change delta.\n\n### 7.3 Metrics (future)\n\nIf the OpenClaw Gateway exposes a metrics interface, instrument:\n- `todo_commands_total` (counter, labels: verb, status)\n- `todo_command_duration_seconds` (histogram, labels: verb)\n- `todo_db_errors_total` (counter)\n\n### 7.4 Health Check\n\nThe plugin can expose a `health()` method that verifies the DB file exists and a simple `SELECT 1` succeeds.\n\n---\n\n## 8. Security\n\n### 8.1 Authentication\n\nAuthentication is delegated to Slack and the OpenClaw Gateway. The plugin trusts `sender_id` from the Gateway as the authenticated identity. No additional auth layer is needed.\n\n### 8.2 Authorization Model\n\n| Resource        | Read                                | Write                                      |\n|-----------------|-------------------------------------|--------------------------------------------|\n| Shared project  | Any user (scope-filtered)           | Assignee or created_by of the task         |\n| Private project | Owner only                          | Owner only                                 |\n\nAuthorization is enforced in `services/permission.py` and called by every command handler before any mutation.\n\n### 8.3 Input Validation\n\n- **SQL injection**: All queries use parameterized statements (`?` placeholders). No string interpolation in SQL.\n- **Slack mention validation**: Assignees must match the `<@U[A-Z0-9]+>` pattern. Arbitrary text is rejected.\n- **Due date validation**: Parsed through `datetime.date` -- invalid dates raise `ValueError` caught and returned as user-facing errors.\n- **Section/status enum**: Checked against a frozen set before reaching the DB. The DB CHECK constraint is a secondary guard.\n\n### 8.4 Data Isolation\n\nPrivate project data is filtered at the repository layer. Queries for private projects always include `WHERE owner_user_id = ?` to prevent data leakage even if a higher layer has a bug.\n\n### 8.5 Secrets\n\nNo API keys or secrets are stored by this plugin. The OpenClaw Gateway manages Slack API tokens.\n\n---\n\n## 9. Database Migration Strategy\n\n### 9.1 Version Table\n\n```sql\nCREATE TABLE IF NOT EXISTS schema_version (\n    version INTEGER NOT NULL\n);\nINSERT INTO schema_version (version) VALUES (0);\n```\n\n### 9.2 Migration Runner (`db/migrate.py`)\n\n```python\nMIGRATIONS = [\n    (1, \"v001_initial\", v001_initial.up),\n    # (2, \"v002_add_priority\", v002_add_priority.up),\n]\n\ndef run_migrations(conn: sqlite3.Connection) -> None:\n    current = _get_current_version(conn)\n    for version, name, up_fn in MIGRATIONS:\n        if version > current:\n            logger.info(\"Applying migration %s (%s)\", version, name)\n            up_fn(conn)\n            conn.execute(\"UPDATE schema_version SET version = ?\", (version,))\n            conn.commit()\n```\n\n### 9.3 Migration File Contract\n\nEach migration module in `db/migrations/` exports:\n\n```python\ndef up(conn: sqlite3.Connection) -> None:\n    \"\"\"Apply this migration forward.\"\"\"\n    conn.executescript(SQL)\n```\n\nDown migrations are not implemented in v1. Rollback is handled by restoring a DB backup (see section 10).\n\n### 9.4 Initialization Sequence\n\nOn first invocation or Gateway startup:\n\n1. Resolve DB path: `~/.openclaw/workspace/.todo/todo.sqlite3`\n2. Create directory if missing (`os.makedirs(..., exist_ok=True)`)\n3. Open connection with WAL pragmas\n4. Create `schema_version` table if not exists\n5. Run pending migrations\n6. Seed default `Inbox` shared project (idempotent `INSERT OR IGNORE`)\n\n---\n\n## 10. Deploy / Rollback\n\n### 10.1 Packaging\n\nThe plugin is distributed as a standard Python package installable via `uv add` or `pip install` (in the OpenClaw Gateway environment):\n\n```\npyproject.toml          # Package metadata, dependencies, entry points\nopenclaw_todo_plugin/   # Source\ntests/                  # Not included in distribution\n```\n\nEntry point for OpenClaw plugin discovery:\n\n```toml\n[project.entry-points.\"openclaw.plugins\"]\ntodo = \"openclaw_todo_plugin:register\"\n```\n\n### 10.2 Deployment Steps\n\n1. **Backup DB**: `cp todo.sqlite3 todo.sqlite3.bak.$(date +%s)`\n2. **Install new version**: `uv add openclaw-todo-plugin@<version>`\n3. **Restart Gateway**: migrations run automatically on startup\n4. **Verify**: send `/todo list` in DM, check logs for migration success\n\n### 10.3 Rollback Steps\n\n1. **Stop Gateway**\n2. **Restore DB** (if schema changed): `cp todo.sqlite3.bak.<ts> todo.sqlite3`\n3. **Install previous version**: `uv add openclaw-todo-plugin@<prev-version>`\n4. **Restart Gateway**\n\n### 10.4 Zero-Downtime Considerations\n\nSQLite does not support concurrent schema changes from multiple writers. Since there is a single Gateway process, migrations are safe without locking beyond SQLite's built-in WAL locking. If multi-process deployment is ever needed, migration must run as a separate step before starting workers.\n\n---\n\n## 11. Tradeoffs and Design Decisions\n\n### 11.1 SQLite vs. PostgreSQL\n\n**Chosen: SQLite.**\n\n| Factor          | SQLite                              | PostgreSQL                         |\n|-----------------|-------------------------------------|------------------------------------|\n| Ops complexity  | Zero (file on disk)                 | Requires running server            |\n| Concurrency     | Single-writer, good enough for DMs  | Full MVCC                          |\n| Scale ceiling   | ~100 concurrent users               | Thousands                          |\n| Backup          | File copy                           | pg_dump / replication              |\n| Migration       | Manual scripts                      | Alembic / django-migrations        |\n\nSQLite is the right choice for a plugin that handles single-digit QPS through Slack DMs. If the team outgrows it, the repository layer abstracts SQL enough that a PostgreSQL migration is localized to `db/` and `repositories/`.\n\n### 11.2 No ORM\n\nUsing raw `sqlite3` with parameterized queries. This avoids adding SQLAlchemy as a dependency for a plugin that has four tables. The repository layer provides the same abstraction boundary that an ORM session would.\n\n### 11.3 Synchronous Execution\n\nAll command handlers are synchronous. The OpenClaw Gateway may be async (asyncio), but SQLite operations are fast enough (sub-millisecond for typical queries) that blocking is acceptable. If the Gateway requires async handlers, a thin `asyncio.to_thread()` wrapper in `plugin.py` is sufficient.\n\n### 11.4 No Down Migrations\n\nForward-only migrations simplify the code and avoid the risk of data loss from buggy down scripts. Rollback relies on DB file backup, which is more reliable for SQLite.\n\n### 11.5 Private-First Name Resolution\n\nWhen a user references `/p MyProject`, the system checks for a private project owned by the sender before checking shared projects. This is the simplest model but can surprise users who have both a private and shared project with the same name. The PRD recommends against this pattern, and the plugin logs a warning when it detects the ambiguity.\n\n### 11.6 Repository Pattern vs. Direct SQL in Handlers\n\nAdds a small amount of indirection but pays for itself in testability. Tests can mock repositories instead of setting up SQLite fixtures for every command test. Integration tests still exercise the full stack.\n\n### 11.7 Formatter as a Separate Module\n\nSlack message formatting (mrkdwn, block kit) is isolated from business logic. If the plugin ever needs to support a second chat platform, only `formatters.py` changes.\n\n### 11.8 Event Sourcing vs. Audit Log\n\nThe `events` table is an append-only audit log, not a full event-sourcing system. State is stored directly in `tasks` and `projects`. This is simpler to query and reason about. Full event sourcing would be over-engineering for a TODO plugin.\n\n---\n\n## 12. Dependency Summary\n\n| Dependency        | Purpose                      | Required |\n|-------------------|------------------------------|----------|\n| Python 3.11+      | Runtime                      | Yes      |\n| sqlite3 (stdlib)  | Database                     | Yes      |\n| OpenClaw SDK      | Plugin registration, message hooks | Yes |\n| pytest             | Testing                      | Dev only |\n| pytest-cov         | Coverage reporting           | Dev only |\n| ruff               | Linting                      | Dev only |\n| black              | Formatting                   | Dev only |\n\nNo third-party runtime dependencies beyond the OpenClaw SDK itself.\n"}, "tool_use_id": "toolu_01QK1c7j4yi1FaPoxTHo9rPD", "_ts": "2026-02-20T11:33:34+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "content": "# Architecture -- OpenClaw TODO Plugin for Slack\n\n> Version: 1.0\n> Date: 2026-02-20\n> Status: Proposed\n> Derived from: `openclaw_todo_plugin_prd.md` v1.1\n\n---\n\n## 1. System Context\n\nThis is an **OpenClaw plugin**, not a standalone application. It runs inside the OpenClaw Gateway process and communicates with users through Slack DMs. There is no HTTP server, no REST API, and no web framework. The entire system is a single Python package that the Gateway loads at startup.\n\n```\nSlack User  --(DM)--> Slack API --> OpenClaw Gateway --> TODO Plugin --> SQLite3\n```\n\n### Constraints\n\n- No LLM calls (zero cost per invocation).\n- Single SQLite3 file shared across all users within one Gateway instance.\n- No external dependencies beyond the Python stdlib and the OpenClaw plugin SDK.\n\n---\n\n## 2. Module / Package Structure\n\n```\nopenclaw_todo_plugin/\n    __init__.py              # Plugin entry point; exports register()\n    plugin.py                # OpenClaw plugin registration and message dispatch\n    router.py                # Command routing: text -> handler\n    parser.py                # Tokenizer and argument extractor\n    commands/\n        __init__.py\n        add.py               # /todo add\n        list_cmd.py          # /todo list   (avoids shadowing builtins)\n        board.py             # /todo board\n        move.py              # /todo move\n        done.py              # /todo done\n        drop.py              # /todo drop\n        edit.py              # /todo edit\n        project.py           # /todo project list|set-private|set-shared\n    db/\n        __init__.py\n        connection.py        # Connection factory, WAL/busy_timeout pragmas\n        migrate.py           # Schema versioning and migration runner\n        migrations/\n            __init__.py\n            v001_initial.py  # Initial schema (projects, tasks, task_assignees, events, schema_version)\n    models.py                # Dataclasses: Task, Project, Assignee, Event\n    repositories/\n        __init__.py\n        project_repo.py      # CRUD + resolve logic for projects\n        task_repo.py          # CRUD + query builders for tasks\n        event_repo.py         # Append-only audit log writes\n    services/\n        __init__.py\n        project_service.py   # Business rules for project visibility transitions\n        task_service.py       # Business rules for task lifecycle\n        permission.py         # Authorization checks (private/shared, owner/assignee)\n    formatters.py             # Slack message formatting (board, list, confirmations)\n    date_utils.py             # due parser: YYYY-MM-DD / MM-DD normalization\n    errors.py                 # Domain exception hierarchy\n    config.py                 # DB path resolution, timezone, defaults\ntests/\n    conftest.py               # Shared fixtures (in-memory SQLite, fake sender context)\n    test_parser.py\n    test_date_utils.py\n    test_commands/\n        test_add.py\n        test_list.py\n        test_board.py\n        test_move.py\n        test_done_drop.py\n        test_edit.py\n        test_project.py\n    test_repositories/\n        test_project_repo.py\n        test_task_repo.py\n    test_services/\n        test_permission.py\n        test_project_service.py\n        test_task_service.py\n    test_db/\n        test_migrate.py\n```\n\n### Rationale\n\n- **Flat `commands/` package**: one module per command keeps each handler under 150 lines and independently testable.\n- **Repository pattern** over raw SQL in handlers: SQL stays in one place; business logic in `services/` never imports `sqlite3`.\n- **No ORM**: SQLite3 stdlib driver is sufficient. An ORM would add a dependency for no gain at this scale.\n\n---\n\n## 3. Data Model\n\n### 3.1 Entity-Relationship Diagram (logical)\n\n```\nprojects 1---* tasks *---* task_assignees\n                |\n                +---* events\n```\n\n### 3.2 Tables\n\nAll timestamps are stored as ISO-8601 TEXT in UTC.\n\n#### `schema_version`\n\n| Column  | Type    | Notes        |\n|---------|---------|--------------|\n| version | INTEGER | NOT NULL     |\n\nSingle-row table. Current value determines which migrations to run.\n\n#### `projects`\n\n| Column         | Type    | Constraints / Default                     |\n|----------------|---------|-------------------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT                          |\n| name           | TEXT    | NOT NULL                                  |\n| visibility     | TEXT    | NOT NULL CHECK IN ('shared','private')    |\n| owner_user_id  | TEXT    | NULL (NULL when shared)                   |\n| created_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n| updated_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n\n**Indexes:**\n\n```sql\nCREATE UNIQUE INDEX ux_projects_shared_name\n    ON projects(name) WHERE visibility='shared';\n\nCREATE UNIQUE INDEX ux_projects_private_owner_name\n    ON projects(owner_user_id, name) WHERE visibility='private';\n```\n\n#### `tasks`\n\n| Column      | Type    | Constraints / Default                                   |\n|-------------|---------|----------------------------------------------------------|\n| id          | INTEGER | PK AUTOINCREMENT                                         |\n| title       | TEXT    | NOT NULL                                                 |\n| project_id  | INTEGER | NOT NULL FK -> projects(id)                              |\n| section     | TEXT    | NOT NULL CHECK IN ('backlog','doing','waiting','done','drop') |\n| due         | TEXT    | NULL, format YYYY-MM-DD                                  |\n| status      | TEXT    | NOT NULL CHECK IN ('open','done','dropped')              |\n| created_by  | TEXT    | NOT NULL (Slack user id)                                 |\n| created_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| updated_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| closed_at   | TEXT    | NULL                                                     |\n\n**Indexes:**\n\n```sql\nCREATE INDEX ix_tasks_project_section ON tasks(project_id, section);\nCREATE INDEX ix_tasks_status ON tasks(status);\n```\n\n#### `task_assignees`\n\n| Column           | Type    | Constraints                  |\n|------------------|---------|------------------------------|\n| task_id          | INTEGER | NOT NULL FK -> tasks(id)     |\n| assignee_user_id | TEXT    | NOT NULL                     |\n\n```sql\nPRIMARY KEY (task_id, assignee_user_id)\nCREATE INDEX ix_task_assignees_user ON task_assignees(assignee_user_id, task_id);\n```\n\n#### `events` (audit log)\n\n| Column         | Type    | Notes                        |\n|----------------|---------|------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT             |\n| ts             | TEXT    | NOT NULL DEFAULT datetime('now') |\n| actor_user_id  | TEXT    | NOT NULL                     |\n| action         | TEXT    | NOT NULL (e.g. 'task.add')   |\n| task_id        | INTEGER | NULL                         |\n| payload        | TEXT    | JSON blob                    |\n\n### 3.3 Concurrency Pragmas\n\nApplied once per connection in `db/connection.py`:\n\n```python\nconn.execute(\"PRAGMA journal_mode=WAL\")\nconn.execute(\"PRAGMA busy_timeout=3000\")\nconn.execute(\"PRAGMA foreign_keys=ON\")\n```\n\n---\n\n## 4. APIs (Plugin Interface)\n\nThis plugin does not expose HTTP endpoints. Its \"API\" is the contract between OpenClaw Gateway and the plugin.\n\n### 4.1 Plugin Registration\n\n```python\n# openclaw_todo_plugin/__init__.py\n\ndef register(gateway):\n    \"\"\"Called by OpenClaw Gateway at startup.\n\n    Args:\n        gateway: OpenClaw gateway instance providing hooks for\n                 message handling and configuration access.\n    \"\"\"\n    from .plugin import TodoPlugin\n    plugin = TodoPlugin(gateway)\n    gateway.on_dm_message(plugin.handle)\n```\n\n### 4.2 Message Handler Contract\n\n```python\nclass TodoPlugin:\n    def handle(self, message: IncomingMessage) -> str | None:\n        \"\"\"Process a Slack DM. Return reply text or None to ignore.\"\"\"\n```\n\n`IncomingMessage` is an OpenClaw SDK type expected to carry at minimum:\n\n| Field        | Type | Description                     |\n|--------------|------|---------------------------------|\n| text         | str  | Raw message text                |\n| sender_id    | str  | Slack user ID of the sender     |\n| channel_id   | str  | DM channel ID                   |\n| timestamp    | str  | Slack message ts                |\n\n### 4.3 Command Routing\n\n`router.py` maps the second token of the message to a handler function:\n\n```python\nCOMMANDS = {\n    \"add\":     commands.add.handle,\n    \"list\":    commands.list_cmd.handle,\n    \"board\":   commands.board.handle,\n    \"move\":    commands.move.handle,\n    \"done\":    commands.done.handle,\n    \"drop\":    commands.drop.handle,\n    \"edit\":    commands.edit.handle,\n    \"project\": commands.project.handle,   # sub-routes internally\n}\n\ndef route(text: str, sender_id: str) -> str:\n    tokens = text.strip().split()\n    if not tokens or tokens[0] != \"/todo\":\n        return None\n    verb = tokens[1] if len(tokens) > 1 else \"help\"\n    handler = COMMANDS.get(verb)\n    if handler is None:\n        return f\"Unknown command: {verb}. Try /todo help\"\n    return handler(tokens[2:], sender_id)\n```\n\n### 4.4 Command Handler Signature\n\nEvery handler in `commands/` follows the same signature:\n\n```python\ndef handle(args: list[str], sender_id: str) -> str:\n    \"\"\"Execute the command and return a Slack-formatted reply string.\"\"\"\n```\n\n---\n\n## 5. Key Flows\n\n### 5.1 `/todo add` Flow\n\n```\nUser -> Gateway -> TodoPlugin.handle()\n  -> router.route() -> commands.add.handle()\n    -> parser.parse_add_args(tokens)        # extract title, mentions, /p, /s, due\n    -> date_utils.normalize_due(raw_due)    # MM-DD -> YYYY-MM-DD, validate\n    -> project_repo.resolve(name, sender)   # private-first resolution\n    -> permission.check_assignees(project, assignees, sender)  # private project guard\n    -> task_repo.create(task)               # INSERT task + task_assignees\n    -> event_repo.log(\"task.add\", ...)      # audit\n    -> formatters.format_add_confirm(task)  # reply string\n```\n\n### 5.2 `/todo project set-private` Flow\n\n```\ncommands.project.handle([\"set-private\", name], sender)\n  -> project_repo.resolve(name, sender)\n  -> IF already private: return \"already private\"\n  -> task_repo.find_non_owner_assignees(project_id, sender)\n  -> IF any found: return error with violating task IDs\n  -> project_repo.update_visibility(project_id, \"private\", sender)\n  -> event_repo.log(\"project.set_private\", ...)\n```\n\n---\n\n## 6. Jobs / Background Work\n\nThere are **no background jobs** in v1. All operations are synchronous request-response within the Gateway's message handler. Potential future jobs:\n\n| Job (future)           | Trigger         | Purpose                              |\n|------------------------|-----------------|--------------------------------------|\n| Due date reminders     | Cron / schedule | DM users about upcoming/overdue tasks|\n| Stale task cleanup     | Weekly          | Auto-drop tasks untouched > N days   |\n| DB vacuum              | Weekly          | Reclaim WAL space                    |\n\nThese would be registered via `gateway.schedule()` if the OpenClaw SDK supports it.\n\n---\n\n## 7. Observability\n\n### 7.1 Structured Logging\n\nAll modules use Python's `logging` module with a shared logger name `openclaw_todo`:\n\n```python\nimport logging\nlogger = logging.getLogger(\"openclaw_todo\")\n```\n\nLog levels:\n- **INFO**: command received (verb, sender_id, project), command completed.\n- **WARNING**: permission denied, invalid input, constraint violation.\n- **ERROR**: unexpected exceptions, DB errors.\n\n### 7.2 Audit Trail\n\nThe `events` table provides a queryable audit log. Every state-changing operation (add, edit, move, done, drop, project visibility change) writes an event row with the actor, action, affected task ID, and a JSON payload of the change delta.\n\n### 7.3 Metrics (future)\n\nIf the OpenClaw Gateway exposes a metrics interface, instrument:\n- `todo_commands_total` (counter, labels: verb, status)\n- `todo_command_duration_seconds` (histogram, labels: verb)\n- `todo_db_errors_total` (counter)\n\n### 7.4 Health Check\n\nThe plugin can expose a `health()` method that verifies the DB file exists and a simple `SELECT 1` succeeds.\n\n---\n\n## 8. Security\n\n### 8.1 Authentication\n\nAuthentication is delegated to Slack and the OpenClaw Gateway. The plugin trusts `sender_id` from the Gateway as the authenticated identity. No additional auth layer is needed.\n\n### 8.2 Authorization Model\n\n| Resource        | Read                                | Write                                      |\n|-----------------|-------------------------------------|--------------------------------------------|\n| Shared project  | Any user (scope-filtered)           | Assignee or created_by of the task         |\n| Private project | Owner only                          | Owner only                                 |\n\nAuthorization is enforced in `services/permission.py` and called by every command handler before any mutation.\n\n### 8.3 Input Validation\n\n- **SQL injection**: All queries use parameterized statements (`?` placeholders). No string interpolation in SQL.\n- **Slack mention validation**: Assignees must match the `<@U[A-Z0-9]+>` pattern. Arbitrary text is rejected.\n- **Due date validation**: Parsed through `datetime.date` -- invalid dates raise `ValueError` caught and returned as user-facing errors.\n- **Section/status enum**: Checked against a frozen set before reaching the DB. The DB CHECK constraint is a secondary guard.\n\n### 8.4 Data Isolation\n\nPrivate project data is filtered at the repository layer. Queries for private projects always include `WHERE owner_user_id = ?` to prevent data leakage even if a higher layer has a bug.\n\n### 8.5 Secrets\n\nNo API keys or secrets are stored by this plugin. The OpenClaw Gateway manages Slack API tokens.\n\n---\n\n## 9. Database Migration Strategy\n\n### 9.1 Version Table\n\n```sql\nCREATE TABLE IF NOT EXISTS schema_version (\n    version INTEGER NOT NULL\n);\nINSERT INTO schema_version (version) VALUES (0);\n```\n\n### 9.2 Migration Runner (`db/migrate.py`)\n\n```python\nMIGRATIONS = [\n    (1, \"v001_initial\", v001_initial.up),\n    # (2, \"v002_add_priority\", v002_add_priority.up),\n]\n\ndef run_migrations(conn: sqlite3.Connection) -> None:\n    current = _get_current_version(conn)\n    for version, name, up_fn in MIGRATIONS:\n        if version > current:\n            logger.info(\"Applying migration %s (%s)\", version, name)\n            up_fn(conn)\n            conn.execute(\"UPDATE schema_version SET version = ?\", (version,))\n            conn.commit()\n```\n\n### 9.3 Migration File Contract\n\nEach migration module in `db/migrations/` exports:\n\n```python\ndef up(conn: sqlite3.Connection) -> None:\n    \"\"\"Apply this migration forward.\"\"\"\n    conn.executescript(SQL)\n```\n\nDown migrations are not implemented in v1. Rollback is handled by restoring a DB backup (see section 10).\n\n### 9.4 Initialization Sequence\n\nOn first invocation or Gateway startup:\n\n1. Resolve DB path: `~/.openclaw/workspace/.todo/todo.sqlite3`\n2. Create directory if missing (`os.makedirs(..., exist_ok=True)`)\n3. Open connection with WAL pragmas\n4. Create `schema_version` table if not exists\n5. Run pending migrations\n6. Seed default `Inbox` shared project (idempotent `INSERT OR IGNORE`)\n\n---\n\n## 10. Deploy / Rollback\n\n### 10.1 Packaging\n\nThe plugin is distributed as a standard Python package installable via `uv add` or `pip install` (in the OpenClaw Gateway environment):\n\n```\npyproject.toml          # Package metadata, dependencies, entry points\nopenclaw_todo_plugin/   # Source\ntests/                  # Not included in distribution\n```\n\nEntry point for OpenClaw plugin discovery:\n\n```toml\n[project.entry-points.\"openclaw.plugins\"]\ntodo = \"openclaw_todo_plugin:register\"\n```\n\n### 10.2 Deployment Steps\n\n1. **Backup DB**: `cp todo.sqlite3 todo.sqlite3.bak.$(date +%s)`\n2. **Install new version**: `uv add openclaw-todo-plugin@<version>`\n3. **Restart Gateway**: migrations run automatically on startup\n4. **Verify**: send `/todo list` in DM, check logs for migration success\n\n### 10.3 Rollback Steps\n\n1. **Stop Gateway**\n2. **Restore DB** (if schema changed): `cp todo.sqlite3.bak.<ts> todo.sqlite3`\n3. **Install previous version**: `uv add openclaw-todo-plugin@<prev-version>`\n4. **Restart Gateway**\n\n### 10.4 Zero-Downtime Considerations\n\nSQLite does not support concurrent schema changes from multiple writers. Since there is a single Gateway process, migrations are safe without locking beyond SQLite's built-in WAL locking. If multi-process deployment is ever needed, migration must run as a separate step before starting workers.\n\n---\n\n## 11. Tradeoffs and Design Decisions\n\n### 11.1 SQLite vs. PostgreSQL\n\n**Chosen: SQLite.**\n\n| Factor          | SQLite                              | PostgreSQL                         |\n|-----------------|-------------------------------------|------------------------------------|\n| Ops complexity  | Zero (file on disk)                 | Requires running server            |\n| Concurrency     | Single-writer, good enough for DMs  | Full MVCC                          |\n| Scale ceiling   | ~100 concurrent users               | Thousands                          |\n| Backup          | File copy                           | pg_dump / replication              |\n| Migration       | Manual scripts                      | Alembic / django-migrations        |\n\nSQLite is the right choice for a plugin that handles single-digit QPS through Slack DMs. If the team outgrows it, the repository layer abstracts SQL enough that a PostgreSQL migration is localized to `db/` and `repositories/`.\n\n### 11.2 No ORM\n\nUsing raw `sqlite3` with parameterized queries. This avoids adding SQLAlchemy as a dependency for a plugin that has four tables. The repository layer provides the same abstraction boundary that an ORM session would.\n\n### 11.3 Synchronous Execution\n\nAll command handlers are synchronous. The OpenClaw Gateway may be async (asyncio), but SQLite operations are fast enough (sub-millisecond for typical queries) that blocking is acceptable. If the Gateway requires async handlers, a thin `asyncio.to_thread()` wrapper in `plugin.py` is sufficient.\n\n### 11.4 No Down Migrations\n\nForward-only migrations simplify the code and avoid the risk of data loss from buggy down scripts. Rollback relies on DB file backup, which is more reliable for SQLite.\n\n### 11.5 Private-First Name Resolution\n\nWhen a user references `/p MyProject`, the system checks for a private project owned by the sender before checking shared projects. This is the simplest model but can surprise users who have both a private and shared project with the same name. The PRD recommends against this pattern, and the plugin logs a warning when it detects the ambiguity.\n\n### 11.6 Repository Pattern vs. Direct SQL in Handlers\n\nAdds a small amount of indirection but pays for itself in testability. Tests can mock repositories instead of setting up SQLite fixtures for every command test. Integration tests still exercise the full stack.\n\n### 11.7 Formatter as a Separate Module\n\nSlack message formatting (mrkdwn, block kit) is isolated from business logic. If the plugin ever needs to support a second chat platform, only `formatters.py` changes.\n\n### 11.8 Event Sourcing vs. Audit Log\n\nThe `events` table is an append-only audit log, not a full event-sourcing system. State is stored directly in `tasks` and `projects`. This is simpler to query and reason about. Full event sourcing would be over-engineering for a TODO plugin.\n\n---\n\n## 12. Dependency Summary\n\n| Dependency        | Purpose                      | Required |\n|-------------------|------------------------------|----------|\n| Python 3.11+      | Runtime                      | Yes      |\n| sqlite3 (stdlib)  | Database                     | Yes      |\n| OpenClaw SDK      | Plugin registration, message hooks | Yes |\n| pytest             | Testing                      | Dev only |\n| pytest-cov         | Coverage reporting           | Dev only |\n| ruff               | Linting                      | Dev only |\n| black              | Formatting                   | Dev only |\n\nNo third-party runtime dependencies beyond the OpenClaw SDK itself.\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/architecture.md", "content": "# Architecture -- OpenClaw TODO Plugin for Slack\n\n> Version: 1.0\n> Date: 2026-02-20\n> Status: Proposed\n> Derived from: `openclaw_todo_plugin_prd.md` v1.1\n\n---\n\n## 1. System Context\n\nThis is an **OpenClaw plugin**, not a standalone application. It runs inside the OpenClaw Gateway process and communicates with users through Slack DMs. There is no HTTP server, no REST API, and no web framework. The entire system is a single Python package that the Gateway loads at startup.\n\n```\nSlack User  --(DM)--> Slack API --> OpenClaw Gateway --> TODO Plugin --> SQLite3\n```\n\n### Constraints\n\n- No LLM calls (zero cost per invocation).\n- Single SQLite3 file shared across all users within one Gateway instance.\n- No external dependencies beyond the Python stdlib and the OpenClaw plugin SDK.\n\n---\n\n## 2. Module / Package Structure\n\n```\nopenclaw_todo_plugin/\n    __init__.py              # Plugin entry point; exports register()\n    plugin.py                # OpenClaw plugin registration and message dispatch\n    router.py                # Command routing: text -> handler\n    parser.py                # Tokenizer and argument extractor\n    commands/\n        __init__.py\n        add.py               # /todo add\n        list_cmd.py          # /todo list   (avoids shadowing builtins)\n        board.py             # /todo board\n        move.py              # /todo move\n        done.py              # /todo done\n        drop.py              # /todo drop\n        edit.py              # /todo edit\n        project.py           # /todo project list|set-private|set-shared\n    db/\n        __init__.py\n        connection.py        # Connection factory, WAL/busy_timeout pragmas\n        migrate.py           # Schema versioning and migration runner\n        migrations/\n            __init__.py\n            v001_initial.py  # Initial schema (projects, tasks, task_assignees, events, schema_version)\n    models.py                # Dataclasses: Task, Project, Assignee, Event\n    repositories/\n        __init__.py\n        project_repo.py      # CRUD + resolve logic for projects\n        task_repo.py          # CRUD + query builders for tasks\n        event_repo.py         # Append-only audit log writes\n    services/\n        __init__.py\n        project_service.py   # Business rules for project visibility transitions\n        task_service.py       # Business rules for task lifecycle\n        permission.py         # Authorization checks (private/shared, owner/assignee)\n    formatters.py             # Slack message formatting (board, list, confirmations)\n    date_utils.py             # due parser: YYYY-MM-DD / MM-DD normalization\n    errors.py                 # Domain exception hierarchy\n    config.py                 # DB path resolution, timezone, defaults\ntests/\n    conftest.py               # Shared fixtures (in-memory SQLite, fake sender context)\n    test_parser.py\n    test_date_utils.py\n    test_commands/\n        test_add.py\n        test_list.py\n        test_board.py\n        test_move.py\n        test_done_drop.py\n        test_edit.py\n        test_project.py\n    test_repositories/\n        test_project_repo.py\n        test_task_repo.py\n    test_services/\n        test_permission.py\n        test_project_service.py\n        test_task_service.py\n    test_db/\n        test_migrate.py\n```\n\n### Rationale\n\n- **Flat `commands/` package**: one module per command keeps each handler under 150 lines and independently testable.\n- **Repository pattern** over raw SQL in handlers: SQL stays in one place; business logic in `services/` never imports `sqlite3`.\n- **No ORM**: SQLite3 stdlib driver is sufficient. An ORM would add a dependency for no gain at this scale.\n\n---\n\n## 3. Data Model\n\n### 3.1 Entity-Relationship Diagram (logical)\n\n```\nprojects 1---* tasks *---* task_assignees\n                |\n                +---* events\n```\n\n### 3.2 Tables\n\nAll timestamps are stored as ISO-8601 TEXT in UTC.\n\n#### `schema_version`\n\n| Column  | Type    | Notes        |\n|---------|---------|--------------|\n| version | INTEGER | NOT NULL     |\n\nSingle-row table. Current value determines which migrations to run.\n\n#### `projects`\n\n| Column         | Type    | Constraints / Default                     |\n|----------------|---------|-------------------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT                          |\n| name           | TEXT    | NOT NULL                                  |\n| visibility     | TEXT    | NOT NULL CHECK IN ('shared','private')    |\n| owner_user_id  | TEXT    | NULL (NULL when shared)                   |\n| created_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n| updated_at     | TEXT    | NOT NULL DEFAULT datetime('now')          |\n\n**Indexes:**\n\n```sql\nCREATE UNIQUE INDEX ux_projects_shared_name\n    ON projects(name) WHERE visibility='shared';\n\nCREATE UNIQUE INDEX ux_projects_private_owner_name\n    ON projects(owner_user_id, name) WHERE visibility='private';\n```\n\n#### `tasks`\n\n| Column      | Type    | Constraints / Default                                   |\n|-------------|---------|----------------------------------------------------------|\n| id          | INTEGER | PK AUTOINCREMENT                                         |\n| title       | TEXT    | NOT NULL                                                 |\n| project_id  | INTEGER | NOT NULL FK -> projects(id)                              |\n| section     | TEXT    | NOT NULL CHECK IN ('backlog','doing','waiting','done','drop') |\n| due         | TEXT    | NULL, format YYYY-MM-DD                                  |\n| status      | TEXT    | NOT NULL CHECK IN ('open','done','dropped')              |\n| created_by  | TEXT    | NOT NULL (Slack user id)                                 |\n| created_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| updated_at  | TEXT    | NOT NULL DEFAULT datetime('now')                         |\n| closed_at   | TEXT    | NULL                                                     |\n\n**Indexes:**\n\n```sql\nCREATE INDEX ix_tasks_project_section ON tasks(project_id, section);\nCREATE INDEX ix_tasks_status ON tasks(status);\n```\n\n#### `task_assignees`\n\n| Column           | Type    | Constraints                  |\n|------------------|---------|------------------------------|\n| task_id          | INTEGER | NOT NULL FK -> tasks(id)     |\n| assignee_user_id | TEXT    | NOT NULL                     |\n\n```sql\nPRIMARY KEY (task_id, assignee_user_id)\nCREATE INDEX ix_task_assignees_user ON task_assignees(assignee_user_id, task_id);\n```\n\n#### `events` (audit log)\n\n| Column         | Type    | Notes                        |\n|----------------|---------|------------------------------|\n| id             | INTEGER | PK AUTOINCREMENT             |\n| ts             | TEXT    | NOT NULL DEFAULT datetime('now') |\n| actor_user_id  | TEXT    | NOT NULL                     |\n| action         | TEXT    | NOT NULL (e.g. 'task.add')   |\n| task_id        | INTEGER | NULL                         |\n| payload        | TEXT    | JSON blob                    |\n\n### 3.3 Concurrency Pragmas\n\nApplied once per connection in `db/connection.py`:\n\n```python\nconn.execute(\"PRAGMA journal_mode=WAL\")\nconn.execute(\"PRAGMA busy_timeout=3000\")\nconn.execute(\"PRAGMA foreign_keys=ON\")\n```\n\n---\n\n## 4. APIs (Plugin Interface)\n\nThis plugin does not expose HTTP endpoints. Its \"API\" is the contract between OpenClaw Gateway and the plugin.\n\n### 4.1 Plugin Registration\n\n```python\n# openclaw_todo_plugin/__init__.py\n\ndef register(gateway):\n    \"\"\"Called by OpenClaw Gateway at startup.\n\n    Args:\n        gateway: OpenClaw gateway instance providing hooks for\n                 message handling and configuration access.\n    \"\"\"\n    from .plugin import TodoPlugin\n    plugin = TodoPlugin(gateway)\n    gateway.on_dm_message(plugin.handle)\n```\n\n### 4.2 Message Handler Contract\n\n```python\nclass TodoPlugin:\n    def handle(self, message: IncomingMessage) -> str | None:\n        \"\"\"Process a Slack DM. Return reply text or None to ignore.\"\"\"\n```\n\n`IncomingMessage` is an OpenClaw SDK type expected to carry at minimum:\n\n| Field        | Type | Description                     |\n|--------------|------|---------------------------------|\n| text         | str  | Raw message text                |\n| sender_id    | str  | Slack user ID of the sender     |\n| channel_id   | str  | DM channel ID                   |\n| timestamp    | str  | Slack message ts                |\n\n### 4.3 Command Routing\n\n`router.py` maps the second token of the message to a handler function:\n\n```python\nCOMMANDS = {\n    \"add\":     commands.add.handle,\n    \"list\":    commands.list_cmd.handle,\n    \"board\":   commands.board.handle,\n    \"move\":    commands.move.handle,\n    \"done\":    commands.done.handle,\n    \"drop\":    commands.drop.handle,\n    \"edit\":    commands.edit.handle,\n    \"project\": commands.project.handle,   # sub-routes internally\n}\n\ndef route(text: str, sender_id: str) -> str:\n    tokens = text.strip().split()\n    if not tokens or tokens[0] != \"/todo\":\n        return None\n    verb = tokens[1] if len(tokens) > 1 else \"help\"\n    handler = COMMANDS.get(verb)\n    if handler is None:\n        return f\"Unknown command: {verb}. Try /todo help\"\n    return handler(tokens[2:], sender_id)\n```\n\n### 4.4 Command Handler Signature\n\nEvery handler in `commands/` follows the same signature:\n\n```python\ndef handle(args: list[str], sender_id: str) -> str:\n    \"\"\"Execute the command and return a Slack-formatted reply string.\"\"\"\n```\n\n---\n\n## 5. Key Flows\n\n### 5.1 `/todo add` Flow\n\n```\nUser -> Gateway -> TodoPlugin.handle()\n  -> router.route() -> commands.add.handle()\n    -> parser.parse_add_args(tokens)        # extract title, mentions, /p, /s, due\n    -> date_utils.normalize_due(raw_due)    # MM-DD -> YYYY-MM-DD, validate\n    -> project_repo.resolve(name, sender)   # private-first resolution\n    -> permission.check_assignees(project, assignees, sender)  # private project guard\n    -> task_repo.create(task)               # INSERT task + task_assignees\n    -> event_repo.log(\"task.add\", ...)      # audit\n    -> formatters.format_add_confirm(task)  # reply string\n```\n\n### 5.2 `/todo project set-private` Flow\n\n```\ncommands.project.handle([\"set-private\", name], sender)\n  -> project_repo.resolve(name, sender)\n  -> IF already private: return \"already private\"\n  -> task_repo.find_non_owner_assignees(project_id, sender)\n  -> IF any found: return error with violating task IDs\n  -> project_repo.update_visibility(project_id, \"private\", sender)\n  -> event_repo.log(\"project.set_private\", ...)\n```\n\n---\n\n## 6. Jobs / Background Work\n\nThere are **no background jobs** in v1. All operations are synchronous request-response within the Gateway's message handler. Potential future jobs:\n\n| Job (future)           | Trigger         | Purpose                              |\n|------------------------|-----------------|--------------------------------------|\n| Due date reminders     | Cron / schedule | DM users about upcoming/overdue tasks|\n| Stale task cleanup     | Weekly          | Auto-drop tasks untouched > N days   |\n| DB vacuum              | Weekly          | Reclaim WAL space                    |\n\nThese would be registered via `gateway.schedule()` if the OpenClaw SDK supports it.\n\n---\n\n## 7. Observability\n\n### 7.1 Structured Logging\n\nAll modules use Python's `logging` module with a shared logger name `openclaw_todo`:\n\n```python\nimport logging\nlogger = logging.getLogger(\"openclaw_todo\")\n```\n\nLog levels:\n- **INFO**: command received (verb, sender_id, project), command completed.\n- **WARNING**: permission denied, invalid input, constraint violation.\n- **ERROR**: unexpected exceptions, DB errors.\n\n### 7.2 Audit Trail\n\nThe `events` table provides a queryable audit log. Every state-changing operation (add, edit, move, done, drop, project visibility change) writes an event row with the actor, action, affected task ID, and a JSON payload of the change delta.\n\n### 7.3 Metrics (future)\n\nIf the OpenClaw Gateway exposes a metrics interface, instrument:\n- `todo_commands_total` (counter, labels: verb, status)\n- `todo_command_duration_seconds` (histogram, labels: verb)\n- `todo_db_errors_total` (counter)\n\n### 7.4 Health Check\n\nThe plugin can expose a `health()` method that verifies the DB file exists and a simple `SELECT 1` succeeds.\n\n---\n\n## 8. Security\n\n### 8.1 Authentication\n\nAuthentication is delegated to Slack and the OpenClaw Gateway. The plugin trusts `sender_id` from the Gateway as the authenticated identity. No additional auth layer is needed.\n\n### 8.2 Authorization Model\n\n| Resource        | Read                                | Write                                      |\n|-----------------|-------------------------------------|--------------------------------------------|\n| Shared project  | Any user (scope-filtered)           | Assignee or created_by of the task         |\n| Private project | Owner only                          | Owner only                                 |\n\nAuthorization is enforced in `services/permission.py` and called by every command handler before any mutation.\n\n### 8.3 Input Validation\n\n- **SQL injection**: All queries use parameterized statements (`?` placeholders). No string interpolation in SQL.\n- **Slack mention validation**: Assignees must match the `<@U[A-Z0-9]+>` pattern. Arbitrary text is rejected.\n- **Due date validation**: Parsed through `datetime.date` -- invalid dates raise `ValueError` caught and returned as user-facing errors.\n- **Section/status enum**: Checked against a frozen set before reaching the DB. The DB CHECK constraint is a secondary guard.\n\n### 8.4 Data Isolation\n\nPrivate project data is filtered at the repository layer. Queries for private projects always include `WHERE owner_user_id = ?` to prevent data leakage even if a higher layer has a bug.\n\n### 8.5 Secrets\n\nNo API keys or secrets are stored by this plugin. The OpenClaw Gateway manages Slack API tokens.\n\n---\n\n## 9. Database Migration Strategy\n\n### 9.1 Version Table\n\n```sql\nCREATE TABLE IF NOT EXISTS schema_version (\n    version INTEGER NOT NULL\n);\nINSERT INTO schema_version (version) VALUES (0);\n```\n\n### 9.2 Migration Runner (`db/migrate.py`)\n\n```python\nMIGRATIONS = [\n    (1, \"v001_initial\", v001_initial.up),\n    # (2, \"v002_add_priority\", v002_add_priority.up),\n]\n\ndef run_migrations(conn: sqlite3.Connection) -> None:\n    current = _get_current_version(conn)\n    for version, name, up_fn in MIGRATIONS:\n        if version > current:\n            logger.info(\"Applying migration %s (%s)\", version, name)\n            up_fn(conn)\n            conn.execute(\"UPDATE schema_version SET version = ?\", (version,))\n            conn.commit()\n```\n\n### 9.3 Migration File Contract\n\nEach migration module in `db/migrations/` exports:\n\n```python\ndef up(conn: sqlite3.Connection) -> None:\n    \"\"\"Apply this migration forward.\"\"\"\n    conn.executescript(SQL)\n```\n\nDown migrations are not implemented in v1. Rollback is handled by restoring a DB backup (see section 10).\n\n### 9.4 Initialization Sequence\n\nOn first invocation or Gateway startup:\n\n1. Resolve DB path: `~/.openclaw/workspace/.todo/todo.sqlite3`\n2. Create directory if missing (`os.makedirs(..., exist_ok=True)`)\n3. Open connection with WAL pragmas\n4. Create `schema_version` table if not exists\n5. Run pending migrations\n6. Seed default `Inbox` shared project (idempotent `INSERT OR IGNORE`)\n\n---\n\n## 10. Deploy / Rollback\n\n### 10.1 Packaging\n\nThe plugin is distributed as a standard Python package installable via `uv add` or `pip install` (in the OpenClaw Gateway environment):\n\n```\npyproject.toml          # Package metadata, dependencies, entry points\nopenclaw_todo_plugin/   # Source\ntests/                  # Not included in distribution\n```\n\nEntry point for OpenClaw plugin discovery:\n\n```toml\n[project.entry-points.\"openclaw.plugins\"]\ntodo = \"openclaw_todo_plugin:register\"\n```\n\n### 10.2 Deployment Steps\n\n1. **Backup DB**: `cp todo.sqlite3 todo.sqlite3.bak.$(date +%s)`\n2. **Install new version**: `uv add openclaw-todo-plugin@<version>`\n3. **Restart Gateway**: migrations run automatically on startup\n4. **Verify**: send `/todo list` in DM, check logs for migration success\n\n### 10.3 Rollback Steps\n\n1. **Stop Gateway**\n2. **Restore DB** (if schema changed): `cp todo.sqlite3.bak.<ts> todo.sqlite3`\n3. **Install previous version**: `uv add openclaw-todo-plugin@<prev-version>`\n4. **Restart Gateway**\n\n### 10.4 Zero-Downtime Considerations\n\nSQLite does not support concurrent schema changes from multiple writers. Since there is a single Gateway process, migrations are safe without locking beyond SQLite's built-in WAL locking. If multi-process deployment is ever needed, migration must run as a separate step before starting workers.\n\n---\n\n## 11. Tradeoffs and Design Decisions\n\n### 11.1 SQLite vs. PostgreSQL\n\n**Chosen: SQLite.**\n\n| Factor          | SQLite                              | PostgreSQL                         |\n|-----------------|-------------------------------------|------------------------------------|\n| Ops complexity  | Zero (file on disk)                 | Requires running server            |\n| Concurrency     | Single-writer, good enough for DMs  | Full MVCC                          |\n| Scale ceiling   | ~100 concurrent users               | Thousands                          |\n| Backup          | File copy                           | pg_dump / replication              |\n| Migration       | Manual scripts                      | Alembic / django-migrations        |\n\nSQLite is the right choice for a plugin that handles single-digit QPS through Slack DMs. If the team outgrows it, the repository layer abstracts SQL enough that a PostgreSQL migration is localized to `db/` and `repositories/`.\n\n### 11.2 No ORM\n\nUsing raw `sqlite3` with parameterized queries. This avoids adding SQLAlchemy as a dependency for a plugin that has four tables. The repository layer provides the same abstraction boundary that an ORM session would.\n\n### 11.3 Synchronous Execution\n\nAll command handlers are synchronous. The OpenClaw Gateway may be async (asyncio), but SQLite operations are fast enough (sub-millisecond for typical queries) that blocking is acceptable. If the Gateway requires async handlers, a thin `asyncio.to_thread()` wrapper in `plugin.py` is sufficient.\n\n### 11.4 No Down Migrations\n\nForward-only migrations simplify the code and avoid the risk of data loss from buggy down scripts. Rollback relies on DB file backup, which is more reliable for SQLite.\n\n### 11.5 Private-First Name Resolution\n\nWhen a user references `/p MyProject`, the system checks for a private project owned by the sender before checking shared projects. This is the simplest model but can surprise users who have both a private and shared project with the same name. The PRD recommends against this pattern, and the plugin logs a warning when it detects the ambiguity.\n\n### 11.6 Repository Pattern vs. Direct SQL in Handlers\n\nAdds a small amount of indirection but pays for itself in testability. Tests can mock repositories instead of setting up SQLite fixtures for every command test. Integration tests still exercise the full stack.\n\n### 11.7 Formatter as a Separate Module\n\nSlack message formatting (mrkdwn, block kit) is isolated from business logic. If the plugin ever needs to support a second chat platform, only `formatters.py` changes.\n\n### 11.8 Event Sourcing vs. Audit Log\n\nThe `events` table is an append-only audit log, not a full event-sourcing system. State is stored directly in `tasks` and `projects`. This is simpler to query and reason about. Full event sourcing would be over-engineering for a TODO plugin.\n\n---\n\n## 12. Dependency Summary\n\n| Dependency        | Purpose                      | Required |\n|-------------------|------------------------------|----------|\n| Python 3.11+      | Runtime                      | Yes      |\n| sqlite3 (stdlib)  | Database                     | Yes      |\n| OpenClaw SDK      | Plugin registration, message hooks | Yes |\n| pytest             | Testing                      | Dev only |\n| pytest-cov         | Coverage reporting           | Dev only |\n| ruff               | Linting                      | Dev only |\n| black              | Formatting                   | Dev only |\n\nNo third-party runtime dependencies beyond the OpenClaw SDK itself.\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01QK1c7j4yi1FaPoxTHo9rPD", "_ts": "2026-02-20T11:33:34+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a78d2f0", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a78d2f0.jsonl", "agent_type": "general-purpose", "_ts": "2026-02-20T11:33:34+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a85660f", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a85660f.jsonl", "agent_type": "", "_ts": "2026-02-20T11:33:40+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a57985d", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a57985d.jsonl", "agent_type": "architect", "_ts": "2026-02-20T11:33:47+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "ac7594f", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-ac7594f.jsonl", "agent_type": "", "_ts": "2026-02-20T11:33:52+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "content": "# OpenClaw TODO Plugin -- Test Plan\n\n> Based on PRD v1.1 at `/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md`\n> Framework: **pytest** | DB: **SQLite3 (in-memory for tests)** | Date: 2026-02-20\n\n---\n\n## 1. Test Strategy\n\n### 1.1 Objectives\n\n- Validate all PRD acceptance criteria (Section 9).\n- Ensure parser correctness for mentions, `/p`, `/s`, `due:` tokens.\n- Verify DB schema creation, migration, and CRUD integrity.\n- Confirm access-control rules for private/shared projects.\n- Catch regressions early through an automatable smoke suite.\n\n### 1.2 Test Levels\n\n| Level | Scope | DB | Mocking |\n|---|---|---|---|\n| **Unit** | Parser functions, date normalization, individual command handlers | None or in-memory SQLite | Slack context mocked |\n| **Integration** | Full command flow: parse -> handler -> DB -> response | In-memory SQLite | Slack API mocked |\n| **E2E (lite)** | Multi-step scenarios (add then list, set-private with tasks) | Temp file SQLite | Slack API mocked |\n\n### 1.3 Principles\n\n- Every test must be **deterministic**. No real network calls; use `unittest.mock` or `pytest-mock`.\n- Date-sensitive tests must **freeze time** (e.g., `freezegun` or manual patching of `datetime.now`).\n- Tests touching SQLite use **in-memory** databases (`:memory:`) unless file-path behavior is explicitly under test.\n- Mark slow or file-I/O tests with `@pytest.mark.integration`.\n\n---\n\n## 2. Fixtures Guidance\n\n### 2.1 Core Fixtures (`conftest.py`)\n\n| Fixture | Scope | Purpose |\n|---|---|---|\n| `db_conn` | function | Returns a fresh in-memory SQLite connection with schema applied and `PRAGMA journal_mode=WAL; PRAGMA busy_timeout=3000;` set. Tears down after each test. |\n| `db_with_inbox` | function | Extends `db_conn`; also inserts the default shared `Inbox` project. |\n| `sender_ctx` | function | Returns a mock Slack sender context: `{\"user_id\": \"U_OWNER\", \"team_id\": \"T001\"}`. |\n| `other_user_ctx` | function | Returns a second mock user: `{\"user_id\": \"U_OTHER\", ...}`. |\n| `frozen_now` | function | Patches `datetime.now()` to `2026-02-20T09:00:00` (Asia/Seoul). |\n| `private_project` | function | Inserts a private project owned by `U_OWNER`. |\n| `shared_project` | function | Inserts a shared project (e.g., \"TeamWork\"). |\n| `sample_tasks` | function | Inserts a set of tasks across projects/sections for list/board tests. |\n\n### 2.2 Fixture Composition\n\nTests that need both a private project and sample tasks should compose fixtures:\n\n```\ndef test_example(db_with_inbox, private_project, sample_tasks, sender_ctx):\n    ...\n```\n\n---\n\n## 3. Test Cases -- Unit Tests\n\n### 3.1 Parser Module\n\n#### 3.1.1 Mention Extraction\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-MEN-01 | Single mention extracted | `\"buy milk <@U123>\"` | assignees=`[\"U123\"]`, title=`\"buy milk\"` |\n| P-MEN-02 | Multiple mentions | `\"task <@U1> <@U2>\"` | assignees=`[\"U1\",\"U2\"]` |\n| P-MEN-03 | No mention defaults to sender | `\"buy milk\"` | assignees=`[sender_user_id]` |\n| P-MEN-04 | Mention-like text without `<@` ignored | `\"email @someone\"` | assignees=`[sender_user_id]`, title includes `\"@someone\"` |\n\n#### 3.1.2 Project Token (`/p`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-PRJ-01 | Project parsed | `\"task /p MyProj\"` | project=`\"MyProj\"`, title=`\"task\"` |\n| P-PRJ-02 | No `/p` defaults to Inbox | `\"task\"` | project=`\"Inbox\"` |\n| P-PRJ-03 | `/p` at end of string | `\"task /p Work\"` | project=`\"Work\"` |\n| P-PRJ-04 | `/p` with no value is error | `\"task /p\"` | ParseError |\n\n#### 3.1.3 Section Token (`/s`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-SEC-01 | Valid section parsed | `\"task /s doing\"` | section=`\"doing\"` |\n| P-SEC-02 | Default section is backlog | `\"task\"` | section=`\"backlog\"` |\n| P-SEC-03 | Invalid section rejected | `\"task /s invalid\"` | ParseError with message about valid sections |\n| P-SEC-04 | All 5 enum values accepted | `\"/s backlog\"`, `\"/s doing\"`, `\"/s waiting\"`, `\"/s done\"`, `\"/s drop\"` | Each parsed correctly |\n\n#### 3.1.4 Due Date Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-DUE-01 | Full date `YYYY-MM-DD` | `\"due:2026-03-15\"` | `\"2026-03-15\"` |\n| P-DUE-02 | Short date `MM-DD` fills current year | `\"due:03-15\"` | `\"2026-03-15\"` (frozen year=2026) |\n| P-DUE-03 | Single-digit `M-D` | `\"due:3-5\"` | `\"2026-03-05\"` |\n| P-DUE-04 | Invalid date `02-30` | `\"due:02-30\"` | ParseError: invalid date |\n| P-DUE-05 | Due clear `due:-` | `\"due:-\"` | due=`None` (clear) |\n| P-DUE-06 | No due token | `\"task\"` | due=`None` |\n| P-DUE-07 | Leap year valid `02-29` | `\"due:2028-02-29\"` | `\"2028-02-29\"` |\n| P-DUE-08 | Non-leap year `02-29` | `\"due:2026-02-29\"` | ParseError |\n\n#### 3.1.5 Combined Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-CMB-01 | All tokens present | `\"buy milk <@U1> /p Home /s doing due:03-20\"` | title=`\"buy milk\"`, assignees=`[\"U1\"]`, project=`\"Home\"`, section=`\"doing\"`, due=`\"2026-03-20\"` |\n| P-CMB-02 | Tokens in any order | `\"/p Home due:03-20 buy milk /s doing <@U1>\"` | Same as above |\n| P-CMB-03 | Title is empty when only tokens | `\"/p Home /s doing\"` | title=`\"\"` or ParseError (depends on command context) |\n\n---\n\n### 3.2 Due Date Normalization (standalone unit)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| D-NORM-01 | Year auto-fill uses server year | `\"06-15\"` with frozen year 2026 | `\"2026-06-15\"` |\n| D-NORM-02 | Full date passes through | `\"2025-12-01\"` | `\"2025-12-01\"` |\n| D-NORM-03 | Garbage input rejected | `\"abc\"` | ValueError |\n| D-NORM-04 | Empty string rejected | `\"\"` | ValueError |\n\n---\n\n### 3.3 DB Operations (schema and CRUD)\n\n#### 3.3.1 Schema Initialization\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-INIT-01 | Fresh DB creates all tables | Initialize on `:memory:` | Tables `projects`, `tasks`, `task_assignees`, `events`, `schema_version` exist |\n| DB-INIT-02 | `schema_version` set to 1 | After init | `SELECT version FROM schema_version` returns `1` |\n| DB-INIT-03 | Default `Inbox` project created | After init | Shared project named `Inbox` exists |\n| DB-INIT-04 | WAL journal mode set | After init | `PRAGMA journal_mode` returns `wal` |\n| DB-INIT-05 | Idempotent init (run twice) | Init -> Init again | No error, schema unchanged |\n\n#### 3.3.2 Project CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-PRJ-01 | Create shared project | Insert `(name=\"Work\", visibility=\"shared\")` | Row inserted, id returned |\n| DB-PRJ-02 | Duplicate shared name rejected | Insert `Inbox` again | UNIQUE constraint error |\n| DB-PRJ-03 | Create private project | Insert `(name=\"Personal\", visibility=\"private\", owner=\"U1\")` | Success |\n| DB-PRJ-04 | Same-name private for different owners | owner=U1 \"X\", owner=U2 \"X\" | Both succeed |\n| DB-PRJ-05 | Same-name private for same owner rejected | owner=U1 \"X\" twice | UNIQUE constraint error |\n| DB-PRJ-06 | Shared and private can share name | shared \"Work\" + private(U1) \"Work\" | Both exist |\n\n#### 3.3.3 Task CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-TSK-01 | Insert task with all fields | Full insert | Row with auto-increment id |\n| DB-TSK-02 | Section enum enforced | Insert section=\"invalid\" | CHECK constraint error |\n| DB-TSK-03 | Status enum enforced | Insert status=\"pending\" | CHECK constraint error |\n| DB-TSK-04 | Assignees linked correctly | Insert task -> insert 2 assignees | `task_assignees` has 2 rows |\n| DB-TSK-05 | Update section | Change backlog -> doing | section updated, updated_at changed |\n| DB-TSK-06 | Mark done sets closed_at | `done` command | status=`done`, section=`done`, closed_at not null |\n\n---\n\n## 4. Test Cases -- Command Handlers\n\n### 4.1 `/todo add`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-ADD-01 | Basic add to Inbox | `add buy milk` | Inbox exists | Task in Inbox/backlog, assignee=sender |\n| CMD-ADD-02 | Add with project and section | `add task /p Work /s doing` | \"Work\" shared exists | Task in Work/doing |\n| CMD-ADD-03 | Add with assignees | `add task <@U2> <@U3>` | -- | assignees=[U2, U3] |\n| CMD-ADD-04 | Add with due date | `add task due:03-15` | -- | due=\"2026-03-15\" |\n| CMD-ADD-05 | Add to nonexistent project (Inbox auto-create) | `add task` | No Inbox | Inbox auto-created, task added |\n| CMD-ADD-06 | **REJECT**: Add to private project with non-owner assignee | `add task <@U_OTHER> /p MyPrivate` | MyPrivate is private, owner=sender | Warning message, task NOT created |\n| CMD-ADD-07 | Add to private project with owner assignee | `add task /p MyPrivate` | owner=sender | Task created successfully |\n| CMD-ADD-08 | Response format matches spec | `add buy milk` | -- | Response contains `#id`, project/section, due, assignees, title |\n\n### 4.2 `/todo list`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-LST-01 | Default list (mine, open) | `list` | Tasks exist | Only sender's open tasks |\n| CMD-LST-02 | List all | `list all` | Shared + private tasks | Shared all + sender's private only |\n| CMD-LST-03 | List by user | `list <@U2>` | U2 has tasks | Only U2's tasks |\n| CMD-LST-04 | Filter by project | `list /p Work` | -- | Only Work project tasks |\n| CMD-LST-05 | Filter by section | `list /s doing` | -- | Only doing section |\n| CMD-LST-06 | Limit applied | `list limit:5` | 10+ tasks | Exactly 5 returned |\n| CMD-LST-07 | Default limit is 30 | `list` | 50 tasks | 30 returned |\n| CMD-LST-08 | Sort order: due first, due asc, id desc | `list` | Mixed due/no-due tasks | Correct ordering |\n| CMD-LST-09 | **HIDDEN**: Other user's private project tasks not visible | `list all` | U_OTHER has private project with tasks | Those tasks excluded |\n| CMD-LST-10 | Status filters: done, drop | `list done` | -- | Only done/dropped tasks respectively |\n\n### 4.3 `/todo board`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-BRD-01 | Board shows all 5 sections in order | `board` | Tasks in various sections | BACKLOG -> DOING -> WAITING -> DONE -> DROP |\n| CMD-BRD-02 | Default scope is mine | `board` | -- | Only sender's tasks |\n| CMD-BRD-03 | limitPerSection applied | `board limitPerSection:2` | 5 tasks per section | 2 per section max |\n| CMD-BRD-04 | Private project tasks only for owner | `board all` | Private project tasks exist | Sender sees own private, not others' |\n\n### 4.4 `/todo move`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-MOV-01 | Move to valid section | `move 1 doing` | Task #1 in backlog | section=doing |\n| CMD-MOV-02 | Invalid section rejected | `move 1 invalid` | -- | Error: invalid section |\n| CMD-MOV-03 | **REJECT**: Non-owner moves private task | `move 1 doing` (sender=U_OTHER) | Task #1 in private project, owner=U_OWNER | Permission denied |\n| CMD-MOV-04 | Shared task: assignee can move | `move 1 doing` (sender=assignee) | -- | Success |\n| CMD-MOV-05 | Shared task: creator can move | `move 1 doing` (sender=created_by) | -- | Success |\n| CMD-MOV-06 | Nonexistent task id | `move 999 doing` | -- | Error: task not found |\n\n### 4.5 `/todo done`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DON-01 | Mark task done | `done 1` | Task #1 open | section=done, status=done, closed_at set |\n| CMD-DON-02 | Already done task | `done 1` | Task #1 already done | Idempotent or informational message |\n| CMD-DON-03 | Permission check on private task | `done 1` (non-owner) | Private project | Denied |\n\n### 4.6 `/todo drop`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DRP-01 | Drop task | `drop 1` | Task #1 open | section=drop, status=dropped, closed_at set |\n| CMD-DRP-02 | Permission check | `drop 1` (non-owner) | Private project | Denied |\n\n### 4.7 `/todo edit`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-EDT-01 | Edit title only | `edit 1 new title` | Task #1 exists | title updated |\n| CMD-EDT-02 | Edit assignees (replace) | `edit 1 <@U2> <@U3>` | -- | assignees fully replaced |\n| CMD-EDT-03 | Clear due | `edit 1 due:-` | Task has due | due=NULL |\n| CMD-EDT-04 | Change project | `edit 1 /p NewProj` | -- | project_id updated |\n| CMD-EDT-05 | Change section | `edit 1 /s waiting` | -- | section updated |\n| CMD-EDT-06 | **REJECT**: Edit in private project with non-owner assignee | `edit 1 <@U_OTHER>` | Task in private project, owner=sender | Warning, no change applied |\n| CMD-EDT-07 | **REJECT**: Move task to private project with non-owner assignee | `edit 1 /p PrivateProj` | Task has assignee U_OTHER | Warning, no change applied |\n| CMD-EDT-08 | No title change when only option tokens given | `edit 1 /s doing` | title=\"original\" | title remains \"original\" |\n| CMD-EDT-09 | Nonexistent task | `edit 999 new title` | -- | Error: task not found |\n\n---\n\n## 5. Test Cases -- Project Commands\n\n### 5.1 `/todo project list`\n\n| ID | Description | Sender | Expected |\n|---|---|---|---|\n| PRJ-LST-01 | Returns shared projects | U1 | All shared projects |\n| PRJ-LST-02 | Returns sender's private projects | U1 | Only U1's private projects |\n| PRJ-LST-03 | Does not return other user's private | U1 | U2's private excluded |\n\n### 5.2 `/todo project set-private`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SPR-01 | Already private -- noop | Private \"X\" owned by sender | Success/noop message |\n| PRJ-SPR-02 | Shared to private -- no tasks | Shared \"X\" with 0 tasks | Converted: visibility=private, owner=sender |\n| PRJ-SPR-03 | Shared to private -- all tasks owner-assigned | Shared \"X\", all assignees=sender | Converted successfully |\n| PRJ-SPR-04 | **REJECT**: Shared to private -- non-owner assignees exist | Shared \"X\", task #12 has assignee U_OTHER | Error with task ids and assignee list |\n| PRJ-SPR-05 | Error message includes violating task ids | Same as PRJ-SPR-04 | Message contains `#12` and `<@U_OTHER>` |\n| PRJ-SPR-06 | Error caps listed violations at 10 | 15+ violating tasks | Max 10 task ids shown |\n| PRJ-SPR-07 | Neither exists -- create new private | No project \"X\" | New private project created, owner=sender |\n\n### 5.3 `/todo project set-shared`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SSH-01 | Create new shared project | Name does not exist | Created |\n| PRJ-SSH-02 | Already shared -- noop | Shared \"X\" exists | No error, noop |\n| PRJ-SSH-03 | Name conflict with existing shared | Shared \"X\" exists, try set-shared \"X\" | Noop or \"already exists\" |\n\n---\n\n## 6. Test Cases -- Edge Cases and PRD-Specific Scenarios\n\n### 6.1 Project Name Collision Resolution (Option A: Private First)\n\n| ID | Description | Setup | Command | Expected |\n|---|---|---|---|---|\n| EDGE-COL-01 | Private and shared same name -- `/p` resolves to private | Private(U1) \"Work\" + Shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **private** \"Work\" |\n| EDGE-COL-02 | No private -- falls to shared | Only shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **shared** \"Work\" |\n| EDGE-COL-03 | Neither exists -- auto-create behavior | No \"NewProj\" | `add task /p NewProj` | Shared auto-create or error (per v1 policy) |\n\n### 6.2 Access Control Boundaries\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-ACL-01 | Non-owner cannot list private project tasks | Empty result or error |\n| EDGE-ACL-02 | Non-owner cannot add to private project | Permission denied |\n| EDGE-ACL-03 | Non-owner cannot move/done/drop private task | Permission denied |\n| EDGE-ACL-04 | Non-owner cannot edit private task | Permission denied |\n\n### 6.3 Concurrency and DB Integrity\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-DB-01 | Unique index prevents duplicate shared project names | UNIQUE constraint violation |\n| EDGE-DB-02 | Unique index allows same private name for different owners | Both inserted |\n| EDGE-DB-03 | WAL mode enabled on connection | `PRAGMA journal_mode` returns `wal` |\n\n### 6.4 Schema Migration\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-MIG-01 | Fresh DB gets version 1 | schema_version=1 |\n| EDGE-MIG-02 | Re-init on existing DB is safe | No duplicate tables, version unchanged |\n| EDGE-MIG-03 | DB directory auto-created | `~/.openclaw/workspace/.todo/` created if missing |\n\n---\n\n## 7. Acceptance Criteria Traceability\n\nMapping each PRD acceptance criterion (Section 9) to test cases.\n\n| PRD Criterion | Test Case IDs |\n|---|---|\n| Shared project name collision rejected | DB-PRJ-02, PRJ-SSH-03, EDGE-COL-03 |\n| Private project owner-unique (cross-owner OK) | DB-PRJ-04, DB-PRJ-05, EDGE-DB-02 |\n| `set-private` rejects when non-owner assignees exist | PRJ-SPR-04, PRJ-SPR-05, PRJ-SPR-06 |\n| Private project + non-owner assignee = warning + reject | CMD-ADD-06, CMD-EDT-06, CMD-EDT-07 |\n| `due:MM-DD` fills current year | P-DUE-02, P-DUE-03, D-NORM-01 |\n| DB first-run: file + schema + Inbox | DB-INIT-01 through DB-INIT-05, EDGE-MIG-01, EDGE-MIG-03 |\n\n---\n\n## 8. Automation Candidates\n\n### 8.1 High Priority (automate first)\n\n| Area | Rationale |\n|---|---|\n| **Parser unit tests** (Section 3.1) | Pure functions, fast, high regression value. Run on every commit. |\n| **Due date normalization** (Section 3.2) | Date logic is error-prone; requires time-freezing. |\n| **DB schema init** (Section 3.3.1) | Catches migration regressions early. |\n| **Private project access control** (Sections 4, 5, 6.2) | Security-critical; must never regress. |\n\n### 8.2 Medium Priority\n\n| Area | Rationale |\n|---|---|\n| **Command handler integration** (Section 4) | Parse-to-DB flow; requires fixture setup but high coverage value. |\n| **Project name collision resolution** (Section 6.1) | Logic is subtle (Option A). |\n\n### 8.3 Lower Priority / Manual\n\n| Area | Rationale |\n|---|---|\n| **Response message formatting** | Cosmetic; snapshot testing if desired. |\n| **Concurrency under load** | Harder to automate reliably in CI; manual or stress-test script. |\n\n### 8.4 Suggested pytest Marks\n\n```python\n# conftest.py or pyproject.toml\nmarkers = [\n    \"unit: Pure unit tests (no DB, no I/O)\",\n    \"integration: Tests requiring DB or multi-component interaction\",\n    \"slow: Tests with file I/O or significant setup\",\n]\n```\n\n---\n\n## 9. Smoke Checklist\n\nA minimal set of tests to run before any release or deployment. If any fail, the build is not shippable.\n\n- [ ] **SMOKE-01**: DB initializes without error on empty state (DB-INIT-01)\n- [ ] **SMOKE-02**: Default `Inbox` project exists after init (DB-INIT-03)\n- [ ] **SMOKE-03**: `/todo add buy milk` creates a task in Inbox/backlog (CMD-ADD-01)\n- [ ] **SMOKE-04**: `/todo list` returns the just-added task (CMD-LST-01)\n- [ ] **SMOKE-05**: `/todo done <id>` marks task done with closed_at (CMD-DON-01)\n- [ ] **SMOKE-06**: `/todo add task <@U_OTHER> /p PrivateProj` is rejected (CMD-ADD-06)\n- [ ] **SMOKE-07**: `/todo project set-private` with non-owner assignees fails (PRJ-SPR-04)\n- [ ] **SMOKE-08**: `due:03-15` parses to `2026-03-15` (P-DUE-02)\n- [ ] **SMOKE-09**: Invalid due `due:02-30` returns error (P-DUE-04)\n- [ ] **SMOKE-10**: `/todo board` renders sections in correct order (CMD-BRD-01)\n\nRun with:\n```bash\nuv run pytest -m smoke -q --tb=short\n```\n\n---\n\n## 10. Test Directory Structure (Recommended)\n\n```\ntests/\n  conftest.py              # Shared fixtures (db_conn, sender_ctx, etc.)\n  test_parser.py           # 3.1 Parser tests (P-MEN, P-PRJ, P-SEC, P-DUE, P-CMB)\n  test_due_normalization.py # 3.2 Date normalization\n  test_db_schema.py        # 3.3.1 Schema init and migration\n  test_db_projects.py      # 3.3.2 Project CRUD\n  test_db_tasks.py         # 3.3.3 Task CRUD\n  test_cmd_add.py          # 4.1 /todo add\n  test_cmd_list.py         # 4.2 /todo list\n  test_cmd_board.py        # 4.3 /todo board\n  test_cmd_move.py         # 4.4 /todo move\n  test_cmd_done_drop.py    # 4.5-4.6 /todo done, drop\n  test_cmd_edit.py         # 4.7 /todo edit\n  test_project_cmds.py     # 5.1-5.3 project list/set-private/set-shared\n  test_edge_cases.py       # 6.x Edge cases and collision resolution\n```\n"}, "tool_use_id": "toolu_01ND4HFHoF4wNNjctmU6rd4T", "_ts": "2026-02-20T11:33:55+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "content": "# OpenClaw TODO Plugin -- Test Plan\n\n> Based on PRD v1.1 at `/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md`\n> Framework: **pytest** | DB: **SQLite3 (in-memory for tests)** | Date: 2026-02-20\n\n---\n\n## 1. Test Strategy\n\n### 1.1 Objectives\n\n- Validate all PRD acceptance criteria (Section 9).\n- Ensure parser correctness for mentions, `/p`, `/s`, `due:` tokens.\n- Verify DB schema creation, migration, and CRUD integrity.\n- Confirm access-control rules for private/shared projects.\n- Catch regressions early through an automatable smoke suite.\n\n### 1.2 Test Levels\n\n| Level | Scope | DB | Mocking |\n|---|---|---|---|\n| **Unit** | Parser functions, date normalization, individual command handlers | None or in-memory SQLite | Slack context mocked |\n| **Integration** | Full command flow: parse -> handler -> DB -> response | In-memory SQLite | Slack API mocked |\n| **E2E (lite)** | Multi-step scenarios (add then list, set-private with tasks) | Temp file SQLite | Slack API mocked |\n\n### 1.3 Principles\n\n- Every test must be **deterministic**. No real network calls; use `unittest.mock` or `pytest-mock`.\n- Date-sensitive tests must **freeze time** (e.g., `freezegun` or manual patching of `datetime.now`).\n- Tests touching SQLite use **in-memory** databases (`:memory:`) unless file-path behavior is explicitly under test.\n- Mark slow or file-I/O tests with `@pytest.mark.integration`.\n\n---\n\n## 2. Fixtures Guidance\n\n### 2.1 Core Fixtures (`conftest.py`)\n\n| Fixture | Scope | Purpose |\n|---|---|---|\n| `db_conn` | function | Returns a fresh in-memory SQLite connection with schema applied and `PRAGMA journal_mode=WAL; PRAGMA busy_timeout=3000;` set. Tears down after each test. |\n| `db_with_inbox` | function | Extends `db_conn`; also inserts the default shared `Inbox` project. |\n| `sender_ctx` | function | Returns a mock Slack sender context: `{\"user_id\": \"U_OWNER\", \"team_id\": \"T001\"}`. |\n| `other_user_ctx` | function | Returns a second mock user: `{\"user_id\": \"U_OTHER\", ...}`. |\n| `frozen_now` | function | Patches `datetime.now()` to `2026-02-20T09:00:00` (Asia/Seoul). |\n| `private_project` | function | Inserts a private project owned by `U_OWNER`. |\n| `shared_project` | function | Inserts a shared project (e.g., \"TeamWork\"). |\n| `sample_tasks` | function | Inserts a set of tasks across projects/sections for list/board tests. |\n\n### 2.2 Fixture Composition\n\nTests that need both a private project and sample tasks should compose fixtures:\n\n```\ndef test_example(db_with_inbox, private_project, sample_tasks, sender_ctx):\n    ...\n```\n\n---\n\n## 3. Test Cases -- Unit Tests\n\n### 3.1 Parser Module\n\n#### 3.1.1 Mention Extraction\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-MEN-01 | Single mention extracted | `\"buy milk <@U123>\"` | assignees=`[\"U123\"]`, title=`\"buy milk\"` |\n| P-MEN-02 | Multiple mentions | `\"task <@U1> <@U2>\"` | assignees=`[\"U1\",\"U2\"]` |\n| P-MEN-03 | No mention defaults to sender | `\"buy milk\"` | assignees=`[sender_user_id]` |\n| P-MEN-04 | Mention-like text without `<@` ignored | `\"email @someone\"` | assignees=`[sender_user_id]`, title includes `\"@someone\"` |\n\n#### 3.1.2 Project Token (`/p`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-PRJ-01 | Project parsed | `\"task /p MyProj\"` | project=`\"MyProj\"`, title=`\"task\"` |\n| P-PRJ-02 | No `/p` defaults to Inbox | `\"task\"` | project=`\"Inbox\"` |\n| P-PRJ-03 | `/p` at end of string | `\"task /p Work\"` | project=`\"Work\"` |\n| P-PRJ-04 | `/p` with no value is error | `\"task /p\"` | ParseError |\n\n#### 3.1.3 Section Token (`/s`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-SEC-01 | Valid section parsed | `\"task /s doing\"` | section=`\"doing\"` |\n| P-SEC-02 | Default section is backlog | `\"task\"` | section=`\"backlog\"` |\n| P-SEC-03 | Invalid section rejected | `\"task /s invalid\"` | ParseError with message about valid sections |\n| P-SEC-04 | All 5 enum values accepted | `\"/s backlog\"`, `\"/s doing\"`, `\"/s waiting\"`, `\"/s done\"`, `\"/s drop\"` | Each parsed correctly |\n\n#### 3.1.4 Due Date Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-DUE-01 | Full date `YYYY-MM-DD` | `\"due:2026-03-15\"` | `\"2026-03-15\"` |\n| P-DUE-02 | Short date `MM-DD` fills current year | `\"due:03-15\"` | `\"2026-03-15\"` (frozen year=2026) |\n| P-DUE-03 | Single-digit `M-D` | `\"due:3-5\"` | `\"2026-03-05\"` |\n| P-DUE-04 | Invalid date `02-30` | `\"due:02-30\"` | ParseError: invalid date |\n| P-DUE-05 | Due clear `due:-` | `\"due:-\"` | due=`None` (clear) |\n| P-DUE-06 | No due token | `\"task\"` | due=`None` |\n| P-DUE-07 | Leap year valid `02-29` | `\"due:2028-02-29\"` | `\"2028-02-29\"` |\n| P-DUE-08 | Non-leap year `02-29` | `\"due:2026-02-29\"` | ParseError |\n\n#### 3.1.5 Combined Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-CMB-01 | All tokens present | `\"buy milk <@U1> /p Home /s doing due:03-20\"` | title=`\"buy milk\"`, assignees=`[\"U1\"]`, project=`\"Home\"`, section=`\"doing\"`, due=`\"2026-03-20\"` |\n| P-CMB-02 | Tokens in any order | `\"/p Home due:03-20 buy milk /s doing <@U1>\"` | Same as above |\n| P-CMB-03 | Title is empty when only tokens | `\"/p Home /s doing\"` | title=`\"\"` or ParseError (depends on command context) |\n\n---\n\n### 3.2 Due Date Normalization (standalone unit)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| D-NORM-01 | Year auto-fill uses server year | `\"06-15\"` with frozen year 2026 | `\"2026-06-15\"` |\n| D-NORM-02 | Full date passes through | `\"2025-12-01\"` | `\"2025-12-01\"` |\n| D-NORM-03 | Garbage input rejected | `\"abc\"` | ValueError |\n| D-NORM-04 | Empty string rejected | `\"\"` | ValueError |\n\n---\n\n### 3.3 DB Operations (schema and CRUD)\n\n#### 3.3.1 Schema Initialization\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-INIT-01 | Fresh DB creates all tables | Initialize on `:memory:` | Tables `projects`, `tasks`, `task_assignees`, `events`, `schema_version` exist |\n| DB-INIT-02 | `schema_version` set to 1 | After init | `SELECT version FROM schema_version` returns `1` |\n| DB-INIT-03 | Default `Inbox` project created | After init | Shared project named `Inbox` exists |\n| DB-INIT-04 | WAL journal mode set | After init | `PRAGMA journal_mode` returns `wal` |\n| DB-INIT-05 | Idempotent init (run twice) | Init -> Init again | No error, schema unchanged |\n\n#### 3.3.2 Project CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-PRJ-01 | Create shared project | Insert `(name=\"Work\", visibility=\"shared\")` | Row inserted, id returned |\n| DB-PRJ-02 | Duplicate shared name rejected | Insert `Inbox` again | UNIQUE constraint error |\n| DB-PRJ-03 | Create private project | Insert `(name=\"Personal\", visibility=\"private\", owner=\"U1\")` | Success |\n| DB-PRJ-04 | Same-name private for different owners | owner=U1 \"X\", owner=U2 \"X\" | Both succeed |\n| DB-PRJ-05 | Same-name private for same owner rejected | owner=U1 \"X\" twice | UNIQUE constraint error |\n| DB-PRJ-06 | Shared and private can share name | shared \"Work\" + private(U1) \"Work\" | Both exist |\n\n#### 3.3.3 Task CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-TSK-01 | Insert task with all fields | Full insert | Row with auto-increment id |\n| DB-TSK-02 | Section enum enforced | Insert section=\"invalid\" | CHECK constraint error |\n| DB-TSK-03 | Status enum enforced | Insert status=\"pending\" | CHECK constraint error |\n| DB-TSK-04 | Assignees linked correctly | Insert task -> insert 2 assignees | `task_assignees` has 2 rows |\n| DB-TSK-05 | Update section | Change backlog -> doing | section updated, updated_at changed |\n| DB-TSK-06 | Mark done sets closed_at | `done` command | status=`done`, section=`done`, closed_at not null |\n\n---\n\n## 4. Test Cases -- Command Handlers\n\n### 4.1 `/todo add`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-ADD-01 | Basic add to Inbox | `add buy milk` | Inbox exists | Task in Inbox/backlog, assignee=sender |\n| CMD-ADD-02 | Add with project and section | `add task /p Work /s doing` | \"Work\" shared exists | Task in Work/doing |\n| CMD-ADD-03 | Add with assignees | `add task <@U2> <@U3>` | -- | assignees=[U2, U3] |\n| CMD-ADD-04 | Add with due date | `add task due:03-15` | -- | due=\"2026-03-15\" |\n| CMD-ADD-05 | Add to nonexistent project (Inbox auto-create) | `add task` | No Inbox | Inbox auto-created, task added |\n| CMD-ADD-06 | **REJECT**: Add to private project with non-owner assignee | `add task <@U_OTHER> /p MyPrivate` | MyPrivate is private, owner=sender | Warning message, task NOT created |\n| CMD-ADD-07 | Add to private project with owner assignee | `add task /p MyPrivate` | owner=sender | Task created successfully |\n| CMD-ADD-08 | Response format matches spec | `add buy milk` | -- | Response contains `#id`, project/section, due, assignees, title |\n\n### 4.2 `/todo list`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-LST-01 | Default list (mine, open) | `list` | Tasks exist | Only sender's open tasks |\n| CMD-LST-02 | List all | `list all` | Shared + private tasks | Shared all + sender's private only |\n| CMD-LST-03 | List by user | `list <@U2>` | U2 has tasks | Only U2's tasks |\n| CMD-LST-04 | Filter by project | `list /p Work` | -- | Only Work project tasks |\n| CMD-LST-05 | Filter by section | `list /s doing` | -- | Only doing section |\n| CMD-LST-06 | Limit applied | `list limit:5` | 10+ tasks | Exactly 5 returned |\n| CMD-LST-07 | Default limit is 30 | `list` | 50 tasks | 30 returned |\n| CMD-LST-08 | Sort order: due first, due asc, id desc | `list` | Mixed due/no-due tasks | Correct ordering |\n| CMD-LST-09 | **HIDDEN**: Other user's private project tasks not visible | `list all` | U_OTHER has private project with tasks | Those tasks excluded |\n| CMD-LST-10 | Status filters: done, drop | `list done` | -- | Only done/dropped tasks respectively |\n\n### 4.3 `/todo board`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-BRD-01 | Board shows all 5 sections in order | `board` | Tasks in various sections | BACKLOG -> DOING -> WAITING -> DONE -> DROP |\n| CMD-BRD-02 | Default scope is mine | `board` | -- | Only sender's tasks |\n| CMD-BRD-03 | limitPerSection applied | `board limitPerSection:2` | 5 tasks per section | 2 per section max |\n| CMD-BRD-04 | Private project tasks only for owner | `board all` | Private project tasks exist | Sender sees own private, not others' |\n\n### 4.4 `/todo move`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-MOV-01 | Move to valid section | `move 1 doing` | Task #1 in backlog | section=doing |\n| CMD-MOV-02 | Invalid section rejected | `move 1 invalid` | -- | Error: invalid section |\n| CMD-MOV-03 | **REJECT**: Non-owner moves private task | `move 1 doing` (sender=U_OTHER) | Task #1 in private project, owner=U_OWNER | Permission denied |\n| CMD-MOV-04 | Shared task: assignee can move | `move 1 doing` (sender=assignee) | -- | Success |\n| CMD-MOV-05 | Shared task: creator can move | `move 1 doing` (sender=created_by) | -- | Success |\n| CMD-MOV-06 | Nonexistent task id | `move 999 doing` | -- | Error: task not found |\n\n### 4.5 `/todo done`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DON-01 | Mark task done | `done 1` | Task #1 open | section=done, status=done, closed_at set |\n| CMD-DON-02 | Already done task | `done 1` | Task #1 already done | Idempotent or informational message |\n| CMD-DON-03 | Permission check on private task | `done 1` (non-owner) | Private project | Denied |\n\n### 4.6 `/todo drop`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DRP-01 | Drop task | `drop 1` | Task #1 open | section=drop, status=dropped, closed_at set |\n| CMD-DRP-02 | Permission check | `drop 1` (non-owner) | Private project | Denied |\n\n### 4.7 `/todo edit`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-EDT-01 | Edit title only | `edit 1 new title` | Task #1 exists | title updated |\n| CMD-EDT-02 | Edit assignees (replace) | `edit 1 <@U2> <@U3>` | -- | assignees fully replaced |\n| CMD-EDT-03 | Clear due | `edit 1 due:-` | Task has due | due=NULL |\n| CMD-EDT-04 | Change project | `edit 1 /p NewProj` | -- | project_id updated |\n| CMD-EDT-05 | Change section | `edit 1 /s waiting` | -- | section updated |\n| CMD-EDT-06 | **REJECT**: Edit in private project with non-owner assignee | `edit 1 <@U_OTHER>` | Task in private project, owner=sender | Warning, no change applied |\n| CMD-EDT-07 | **REJECT**: Move task to private project with non-owner assignee | `edit 1 /p PrivateProj` | Task has assignee U_OTHER | Warning, no change applied |\n| CMD-EDT-08 | No title change when only option tokens given | `edit 1 /s doing` | title=\"original\" | title remains \"original\" |\n| CMD-EDT-09 | Nonexistent task | `edit 999 new title` | -- | Error: task not found |\n\n---\n\n## 5. Test Cases -- Project Commands\n\n### 5.1 `/todo project list`\n\n| ID | Description | Sender | Expected |\n|---|---|---|---|\n| PRJ-LST-01 | Returns shared projects | U1 | All shared projects |\n| PRJ-LST-02 | Returns sender's private projects | U1 | Only U1's private projects |\n| PRJ-LST-03 | Does not return other user's private | U1 | U2's private excluded |\n\n### 5.2 `/todo project set-private`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SPR-01 | Already private -- noop | Private \"X\" owned by sender | Success/noop message |\n| PRJ-SPR-02 | Shared to private -- no tasks | Shared \"X\" with 0 tasks | Converted: visibility=private, owner=sender |\n| PRJ-SPR-03 | Shared to private -- all tasks owner-assigned | Shared \"X\", all assignees=sender | Converted successfully |\n| PRJ-SPR-04 | **REJECT**: Shared to private -- non-owner assignees exist | Shared \"X\", task #12 has assignee U_OTHER | Error with task ids and assignee list |\n| PRJ-SPR-05 | Error message includes violating task ids | Same as PRJ-SPR-04 | Message contains `#12` and `<@U_OTHER>` |\n| PRJ-SPR-06 | Error caps listed violations at 10 | 15+ violating tasks | Max 10 task ids shown |\n| PRJ-SPR-07 | Neither exists -- create new private | No project \"X\" | New private project created, owner=sender |\n\n### 5.3 `/todo project set-shared`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SSH-01 | Create new shared project | Name does not exist | Created |\n| PRJ-SSH-02 | Already shared -- noop | Shared \"X\" exists | No error, noop |\n| PRJ-SSH-03 | Name conflict with existing shared | Shared \"X\" exists, try set-shared \"X\" | Noop or \"already exists\" |\n\n---\n\n## 6. Test Cases -- Edge Cases and PRD-Specific Scenarios\n\n### 6.1 Project Name Collision Resolution (Option A: Private First)\n\n| ID | Description | Setup | Command | Expected |\n|---|---|---|---|---|\n| EDGE-COL-01 | Private and shared same name -- `/p` resolves to private | Private(U1) \"Work\" + Shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **private** \"Work\" |\n| EDGE-COL-02 | No private -- falls to shared | Only shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **shared** \"Work\" |\n| EDGE-COL-03 | Neither exists -- auto-create behavior | No \"NewProj\" | `add task /p NewProj` | Shared auto-create or error (per v1 policy) |\n\n### 6.2 Access Control Boundaries\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-ACL-01 | Non-owner cannot list private project tasks | Empty result or error |\n| EDGE-ACL-02 | Non-owner cannot add to private project | Permission denied |\n| EDGE-ACL-03 | Non-owner cannot move/done/drop private task | Permission denied |\n| EDGE-ACL-04 | Non-owner cannot edit private task | Permission denied |\n\n### 6.3 Concurrency and DB Integrity\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-DB-01 | Unique index prevents duplicate shared project names | UNIQUE constraint violation |\n| EDGE-DB-02 | Unique index allows same private name for different owners | Both inserted |\n| EDGE-DB-03 | WAL mode enabled on connection | `PRAGMA journal_mode` returns `wal` |\n\n### 6.4 Schema Migration\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-MIG-01 | Fresh DB gets version 1 | schema_version=1 |\n| EDGE-MIG-02 | Re-init on existing DB is safe | No duplicate tables, version unchanged |\n| EDGE-MIG-03 | DB directory auto-created | `~/.openclaw/workspace/.todo/` created if missing |\n\n---\n\n## 7. Acceptance Criteria Traceability\n\nMapping each PRD acceptance criterion (Section 9) to test cases.\n\n| PRD Criterion | Test Case IDs |\n|---|---|\n| Shared project name collision rejected | DB-PRJ-02, PRJ-SSH-03, EDGE-COL-03 |\n| Private project owner-unique (cross-owner OK) | DB-PRJ-04, DB-PRJ-05, EDGE-DB-02 |\n| `set-private` rejects when non-owner assignees exist | PRJ-SPR-04, PRJ-SPR-05, PRJ-SPR-06 |\n| Private project + non-owner assignee = warning + reject | CMD-ADD-06, CMD-EDT-06, CMD-EDT-07 |\n| `due:MM-DD` fills current year | P-DUE-02, P-DUE-03, D-NORM-01 |\n| DB first-run: file + schema + Inbox | DB-INIT-01 through DB-INIT-05, EDGE-MIG-01, EDGE-MIG-03 |\n\n---\n\n## 8. Automation Candidates\n\n### 8.1 High Priority (automate first)\n\n| Area | Rationale |\n|---|---|\n| **Parser unit tests** (Section 3.1) | Pure functions, fast, high regression value. Run on every commit. |\n| **Due date normalization** (Section 3.2) | Date logic is error-prone; requires time-freezing. |\n| **DB schema init** (Section 3.3.1) | Catches migration regressions early. |\n| **Private project access control** (Sections 4, 5, 6.2) | Security-critical; must never regress. |\n\n### 8.2 Medium Priority\n\n| Area | Rationale |\n|---|---|\n| **Command handler integration** (Section 4) | Parse-to-DB flow; requires fixture setup but high coverage value. |\n| **Project name collision resolution** (Section 6.1) | Logic is subtle (Option A). |\n\n### 8.3 Lower Priority / Manual\n\n| Area | Rationale |\n|---|---|\n| **Response message formatting** | Cosmetic; snapshot testing if desired. |\n| **Concurrency under load** | Harder to automate reliably in CI; manual or stress-test script. |\n\n### 8.4 Suggested pytest Marks\n\n```python\n# conftest.py or pyproject.toml\nmarkers = [\n    \"unit: Pure unit tests (no DB, no I/O)\",\n    \"integration: Tests requiring DB or multi-component interaction\",\n    \"slow: Tests with file I/O or significant setup\",\n]\n```\n\n---\n\n## 9. Smoke Checklist\n\nA minimal set of tests to run before any release or deployment. If any fail, the build is not shippable.\n\n- [ ] **SMOKE-01**: DB initializes without error on empty state (DB-INIT-01)\n- [ ] **SMOKE-02**: Default `Inbox` project exists after init (DB-INIT-03)\n- [ ] **SMOKE-03**: `/todo add buy milk` creates a task in Inbox/backlog (CMD-ADD-01)\n- [ ] **SMOKE-04**: `/todo list` returns the just-added task (CMD-LST-01)\n- [ ] **SMOKE-05**: `/todo done <id>` marks task done with closed_at (CMD-DON-01)\n- [ ] **SMOKE-06**: `/todo add task <@U_OTHER> /p PrivateProj` is rejected (CMD-ADD-06)\n- [ ] **SMOKE-07**: `/todo project set-private` with non-owner assignees fails (PRJ-SPR-04)\n- [ ] **SMOKE-08**: `due:03-15` parses to `2026-03-15` (P-DUE-02)\n- [ ] **SMOKE-09**: Invalid due `due:02-30` returns error (P-DUE-04)\n- [ ] **SMOKE-10**: `/todo board` renders sections in correct order (CMD-BRD-01)\n\nRun with:\n```bash\nuv run pytest -m smoke -q --tb=short\n```\n\n---\n\n## 10. Test Directory Structure (Recommended)\n\n```\ntests/\n  conftest.py              # Shared fixtures (db_conn, sender_ctx, etc.)\n  test_parser.py           # 3.1 Parser tests (P-MEN, P-PRJ, P-SEC, P-DUE, P-CMB)\n  test_due_normalization.py # 3.2 Date normalization\n  test_db_schema.py        # 3.3.1 Schema init and migration\n  test_db_projects.py      # 3.3.2 Project CRUD\n  test_db_tasks.py         # 3.3.3 Task CRUD\n  test_cmd_add.py          # 4.1 /todo add\n  test_cmd_list.py         # 4.2 /todo list\n  test_cmd_board.py        # 4.3 /todo board\n  test_cmd_move.py         # 4.4 /todo move\n  test_cmd_done_drop.py    # 4.5-4.6 /todo done, drop\n  test_cmd_edit.py         # 4.7 /todo edit\n  test_project_cmds.py     # 5.1-5.3 project list/set-private/set-shared\n  test_edge_cases.py       # 6.x Edge cases and collision resolution\n```\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/test_plan.md", "content": "# OpenClaw TODO Plugin -- Test Plan\n\n> Based on PRD v1.1 at `/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md`\n> Framework: **pytest** | DB: **SQLite3 (in-memory for tests)** | Date: 2026-02-20\n\n---\n\n## 1. Test Strategy\n\n### 1.1 Objectives\n\n- Validate all PRD acceptance criteria (Section 9).\n- Ensure parser correctness for mentions, `/p`, `/s`, `due:` tokens.\n- Verify DB schema creation, migration, and CRUD integrity.\n- Confirm access-control rules for private/shared projects.\n- Catch regressions early through an automatable smoke suite.\n\n### 1.2 Test Levels\n\n| Level | Scope | DB | Mocking |\n|---|---|---|---|\n| **Unit** | Parser functions, date normalization, individual command handlers | None or in-memory SQLite | Slack context mocked |\n| **Integration** | Full command flow: parse -> handler -> DB -> response | In-memory SQLite | Slack API mocked |\n| **E2E (lite)** | Multi-step scenarios (add then list, set-private with tasks) | Temp file SQLite | Slack API mocked |\n\n### 1.3 Principles\n\n- Every test must be **deterministic**. No real network calls; use `unittest.mock` or `pytest-mock`.\n- Date-sensitive tests must **freeze time** (e.g., `freezegun` or manual patching of `datetime.now`).\n- Tests touching SQLite use **in-memory** databases (`:memory:`) unless file-path behavior is explicitly under test.\n- Mark slow or file-I/O tests with `@pytest.mark.integration`.\n\n---\n\n## 2. Fixtures Guidance\n\n### 2.1 Core Fixtures (`conftest.py`)\n\n| Fixture | Scope | Purpose |\n|---|---|---|\n| `db_conn` | function | Returns a fresh in-memory SQLite connection with schema applied and `PRAGMA journal_mode=WAL; PRAGMA busy_timeout=3000;` set. Tears down after each test. |\n| `db_with_inbox` | function | Extends `db_conn`; also inserts the default shared `Inbox` project. |\n| `sender_ctx` | function | Returns a mock Slack sender context: `{\"user_id\": \"U_OWNER\", \"team_id\": \"T001\"}`. |\n| `other_user_ctx` | function | Returns a second mock user: `{\"user_id\": \"U_OTHER\", ...}`. |\n| `frozen_now` | function | Patches `datetime.now()` to `2026-02-20T09:00:00` (Asia/Seoul). |\n| `private_project` | function | Inserts a private project owned by `U_OWNER`. |\n| `shared_project` | function | Inserts a shared project (e.g., \"TeamWork\"). |\n| `sample_tasks` | function | Inserts a set of tasks across projects/sections for list/board tests. |\n\n### 2.2 Fixture Composition\n\nTests that need both a private project and sample tasks should compose fixtures:\n\n```\ndef test_example(db_with_inbox, private_project, sample_tasks, sender_ctx):\n    ...\n```\n\n---\n\n## 3. Test Cases -- Unit Tests\n\n### 3.1 Parser Module\n\n#### 3.1.1 Mention Extraction\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-MEN-01 | Single mention extracted | `\"buy milk <@U123>\"` | assignees=`[\"U123\"]`, title=`\"buy milk\"` |\n| P-MEN-02 | Multiple mentions | `\"task <@U1> <@U2>\"` | assignees=`[\"U1\",\"U2\"]` |\n| P-MEN-03 | No mention defaults to sender | `\"buy milk\"` | assignees=`[sender_user_id]` |\n| P-MEN-04 | Mention-like text without `<@` ignored | `\"email @someone\"` | assignees=`[sender_user_id]`, title includes `\"@someone\"` |\n\n#### 3.1.2 Project Token (`/p`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-PRJ-01 | Project parsed | `\"task /p MyProj\"` | project=`\"MyProj\"`, title=`\"task\"` |\n| P-PRJ-02 | No `/p` defaults to Inbox | `\"task\"` | project=`\"Inbox\"` |\n| P-PRJ-03 | `/p` at end of string | `\"task /p Work\"` | project=`\"Work\"` |\n| P-PRJ-04 | `/p` with no value is error | `\"task /p\"` | ParseError |\n\n#### 3.1.3 Section Token (`/s`)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-SEC-01 | Valid section parsed | `\"task /s doing\"` | section=`\"doing\"` |\n| P-SEC-02 | Default section is backlog | `\"task\"` | section=`\"backlog\"` |\n| P-SEC-03 | Invalid section rejected | `\"task /s invalid\"` | ParseError with message about valid sections |\n| P-SEC-04 | All 5 enum values accepted | `\"/s backlog\"`, `\"/s doing\"`, `\"/s waiting\"`, `\"/s done\"`, `\"/s drop\"` | Each parsed correctly |\n\n#### 3.1.4 Due Date Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-DUE-01 | Full date `YYYY-MM-DD` | `\"due:2026-03-15\"` | `\"2026-03-15\"` |\n| P-DUE-02 | Short date `MM-DD` fills current year | `\"due:03-15\"` | `\"2026-03-15\"` (frozen year=2026) |\n| P-DUE-03 | Single-digit `M-D` | `\"due:3-5\"` | `\"2026-03-05\"` |\n| P-DUE-04 | Invalid date `02-30` | `\"due:02-30\"` | ParseError: invalid date |\n| P-DUE-05 | Due clear `due:-` | `\"due:-\"` | due=`None` (clear) |\n| P-DUE-06 | No due token | `\"task\"` | due=`None` |\n| P-DUE-07 | Leap year valid `02-29` | `\"due:2028-02-29\"` | `\"2028-02-29\"` |\n| P-DUE-08 | Non-leap year `02-29` | `\"due:2026-02-29\"` | ParseError |\n\n#### 3.1.5 Combined Parsing\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| P-CMB-01 | All tokens present | `\"buy milk <@U1> /p Home /s doing due:03-20\"` | title=`\"buy milk\"`, assignees=`[\"U1\"]`, project=`\"Home\"`, section=`\"doing\"`, due=`\"2026-03-20\"` |\n| P-CMB-02 | Tokens in any order | `\"/p Home due:03-20 buy milk /s doing <@U1>\"` | Same as above |\n| P-CMB-03 | Title is empty when only tokens | `\"/p Home /s doing\"` | title=`\"\"` or ParseError (depends on command context) |\n\n---\n\n### 3.2 Due Date Normalization (standalone unit)\n\n| ID | Description | Input | Expected |\n|---|---|---|---|\n| D-NORM-01 | Year auto-fill uses server year | `\"06-15\"` with frozen year 2026 | `\"2026-06-15\"` |\n| D-NORM-02 | Full date passes through | `\"2025-12-01\"` | `\"2025-12-01\"` |\n| D-NORM-03 | Garbage input rejected | `\"abc\"` | ValueError |\n| D-NORM-04 | Empty string rejected | `\"\"` | ValueError |\n\n---\n\n### 3.3 DB Operations (schema and CRUD)\n\n#### 3.3.1 Schema Initialization\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-INIT-01 | Fresh DB creates all tables | Initialize on `:memory:` | Tables `projects`, `tasks`, `task_assignees`, `events`, `schema_version` exist |\n| DB-INIT-02 | `schema_version` set to 1 | After init | `SELECT version FROM schema_version` returns `1` |\n| DB-INIT-03 | Default `Inbox` project created | After init | Shared project named `Inbox` exists |\n| DB-INIT-04 | WAL journal mode set | After init | `PRAGMA journal_mode` returns `wal` |\n| DB-INIT-05 | Idempotent init (run twice) | Init -> Init again | No error, schema unchanged |\n\n#### 3.3.2 Project CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-PRJ-01 | Create shared project | Insert `(name=\"Work\", visibility=\"shared\")` | Row inserted, id returned |\n| DB-PRJ-02 | Duplicate shared name rejected | Insert `Inbox` again | UNIQUE constraint error |\n| DB-PRJ-03 | Create private project | Insert `(name=\"Personal\", visibility=\"private\", owner=\"U1\")` | Success |\n| DB-PRJ-04 | Same-name private for different owners | owner=U1 \"X\", owner=U2 \"X\" | Both succeed |\n| DB-PRJ-05 | Same-name private for same owner rejected | owner=U1 \"X\" twice | UNIQUE constraint error |\n| DB-PRJ-06 | Shared and private can share name | shared \"Work\" + private(U1) \"Work\" | Both exist |\n\n#### 3.3.3 Task CRUD\n\n| ID | Description | Steps | Expected |\n|---|---|---|---|\n| DB-TSK-01 | Insert task with all fields | Full insert | Row with auto-increment id |\n| DB-TSK-02 | Section enum enforced | Insert section=\"invalid\" | CHECK constraint error |\n| DB-TSK-03 | Status enum enforced | Insert status=\"pending\" | CHECK constraint error |\n| DB-TSK-04 | Assignees linked correctly | Insert task -> insert 2 assignees | `task_assignees` has 2 rows |\n| DB-TSK-05 | Update section | Change backlog -> doing | section updated, updated_at changed |\n| DB-TSK-06 | Mark done sets closed_at | `done` command | status=`done`, section=`done`, closed_at not null |\n\n---\n\n## 4. Test Cases -- Command Handlers\n\n### 4.1 `/todo add`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-ADD-01 | Basic add to Inbox | `add buy milk` | Inbox exists | Task in Inbox/backlog, assignee=sender |\n| CMD-ADD-02 | Add with project and section | `add task /p Work /s doing` | \"Work\" shared exists | Task in Work/doing |\n| CMD-ADD-03 | Add with assignees | `add task <@U2> <@U3>` | -- | assignees=[U2, U3] |\n| CMD-ADD-04 | Add with due date | `add task due:03-15` | -- | due=\"2026-03-15\" |\n| CMD-ADD-05 | Add to nonexistent project (Inbox auto-create) | `add task` | No Inbox | Inbox auto-created, task added |\n| CMD-ADD-06 | **REJECT**: Add to private project with non-owner assignee | `add task <@U_OTHER> /p MyPrivate` | MyPrivate is private, owner=sender | Warning message, task NOT created |\n| CMD-ADD-07 | Add to private project with owner assignee | `add task /p MyPrivate` | owner=sender | Task created successfully |\n| CMD-ADD-08 | Response format matches spec | `add buy milk` | -- | Response contains `#id`, project/section, due, assignees, title |\n\n### 4.2 `/todo list`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-LST-01 | Default list (mine, open) | `list` | Tasks exist | Only sender's open tasks |\n| CMD-LST-02 | List all | `list all` | Shared + private tasks | Shared all + sender's private only |\n| CMD-LST-03 | List by user | `list <@U2>` | U2 has tasks | Only U2's tasks |\n| CMD-LST-04 | Filter by project | `list /p Work` | -- | Only Work project tasks |\n| CMD-LST-05 | Filter by section | `list /s doing` | -- | Only doing section |\n| CMD-LST-06 | Limit applied | `list limit:5` | 10+ tasks | Exactly 5 returned |\n| CMD-LST-07 | Default limit is 30 | `list` | 50 tasks | 30 returned |\n| CMD-LST-08 | Sort order: due first, due asc, id desc | `list` | Mixed due/no-due tasks | Correct ordering |\n| CMD-LST-09 | **HIDDEN**: Other user's private project tasks not visible | `list all` | U_OTHER has private project with tasks | Those tasks excluded |\n| CMD-LST-10 | Status filters: done, drop | `list done` | -- | Only done/dropped tasks respectively |\n\n### 4.3 `/todo board`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-BRD-01 | Board shows all 5 sections in order | `board` | Tasks in various sections | BACKLOG -> DOING -> WAITING -> DONE -> DROP |\n| CMD-BRD-02 | Default scope is mine | `board` | -- | Only sender's tasks |\n| CMD-BRD-03 | limitPerSection applied | `board limitPerSection:2` | 5 tasks per section | 2 per section max |\n| CMD-BRD-04 | Private project tasks only for owner | `board all` | Private project tasks exist | Sender sees own private, not others' |\n\n### 4.4 `/todo move`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-MOV-01 | Move to valid section | `move 1 doing` | Task #1 in backlog | section=doing |\n| CMD-MOV-02 | Invalid section rejected | `move 1 invalid` | -- | Error: invalid section |\n| CMD-MOV-03 | **REJECT**: Non-owner moves private task | `move 1 doing` (sender=U_OTHER) | Task #1 in private project, owner=U_OWNER | Permission denied |\n| CMD-MOV-04 | Shared task: assignee can move | `move 1 doing` (sender=assignee) | -- | Success |\n| CMD-MOV-05 | Shared task: creator can move | `move 1 doing` (sender=created_by) | -- | Success |\n| CMD-MOV-06 | Nonexistent task id | `move 999 doing` | -- | Error: task not found |\n\n### 4.5 `/todo done`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DON-01 | Mark task done | `done 1` | Task #1 open | section=done, status=done, closed_at set |\n| CMD-DON-02 | Already done task | `done 1` | Task #1 already done | Idempotent or informational message |\n| CMD-DON-03 | Permission check on private task | `done 1` (non-owner) | Private project | Denied |\n\n### 4.6 `/todo drop`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-DRP-01 | Drop task | `drop 1` | Task #1 open | section=drop, status=dropped, closed_at set |\n| CMD-DRP-02 | Permission check | `drop 1` (non-owner) | Private project | Denied |\n\n### 4.7 `/todo edit`\n\n| ID | Description | Input | Preconditions | Expected |\n|---|---|---|---|---|\n| CMD-EDT-01 | Edit title only | `edit 1 new title` | Task #1 exists | title updated |\n| CMD-EDT-02 | Edit assignees (replace) | `edit 1 <@U2> <@U3>` | -- | assignees fully replaced |\n| CMD-EDT-03 | Clear due | `edit 1 due:-` | Task has due | due=NULL |\n| CMD-EDT-04 | Change project | `edit 1 /p NewProj` | -- | project_id updated |\n| CMD-EDT-05 | Change section | `edit 1 /s waiting` | -- | section updated |\n| CMD-EDT-06 | **REJECT**: Edit in private project with non-owner assignee | `edit 1 <@U_OTHER>` | Task in private project, owner=sender | Warning, no change applied |\n| CMD-EDT-07 | **REJECT**: Move task to private project with non-owner assignee | `edit 1 /p PrivateProj` | Task has assignee U_OTHER | Warning, no change applied |\n| CMD-EDT-08 | No title change when only option tokens given | `edit 1 /s doing` | title=\"original\" | title remains \"original\" |\n| CMD-EDT-09 | Nonexistent task | `edit 999 new title` | -- | Error: task not found |\n\n---\n\n## 5. Test Cases -- Project Commands\n\n### 5.1 `/todo project list`\n\n| ID | Description | Sender | Expected |\n|---|---|---|---|\n| PRJ-LST-01 | Returns shared projects | U1 | All shared projects |\n| PRJ-LST-02 | Returns sender's private projects | U1 | Only U1's private projects |\n| PRJ-LST-03 | Does not return other user's private | U1 | U2's private excluded |\n\n### 5.2 `/todo project set-private`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SPR-01 | Already private -- noop | Private \"X\" owned by sender | Success/noop message |\n| PRJ-SPR-02 | Shared to private -- no tasks | Shared \"X\" with 0 tasks | Converted: visibility=private, owner=sender |\n| PRJ-SPR-03 | Shared to private -- all tasks owner-assigned | Shared \"X\", all assignees=sender | Converted successfully |\n| PRJ-SPR-04 | **REJECT**: Shared to private -- non-owner assignees exist | Shared \"X\", task #12 has assignee U_OTHER | Error with task ids and assignee list |\n| PRJ-SPR-05 | Error message includes violating task ids | Same as PRJ-SPR-04 | Message contains `#12` and `<@U_OTHER>` |\n| PRJ-SPR-06 | Error caps listed violations at 10 | 15+ violating tasks | Max 10 task ids shown |\n| PRJ-SPR-07 | Neither exists -- create new private | No project \"X\" | New private project created, owner=sender |\n\n### 5.3 `/todo project set-shared`\n\n| ID | Description | Preconditions | Expected |\n|---|---|---|---|\n| PRJ-SSH-01 | Create new shared project | Name does not exist | Created |\n| PRJ-SSH-02 | Already shared -- noop | Shared \"X\" exists | No error, noop |\n| PRJ-SSH-03 | Name conflict with existing shared | Shared \"X\" exists, try set-shared \"X\" | Noop or \"already exists\" |\n\n---\n\n## 6. Test Cases -- Edge Cases and PRD-Specific Scenarios\n\n### 6.1 Project Name Collision Resolution (Option A: Private First)\n\n| ID | Description | Setup | Command | Expected |\n|---|---|---|---|---|\n| EDGE-COL-01 | Private and shared same name -- `/p` resolves to private | Private(U1) \"Work\" + Shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **private** \"Work\" |\n| EDGE-COL-02 | No private -- falls to shared | Only shared \"Work\" | `add task /p Work` (sender=U1) | Task added to **shared** \"Work\" |\n| EDGE-COL-03 | Neither exists -- auto-create behavior | No \"NewProj\" | `add task /p NewProj` | Shared auto-create or error (per v1 policy) |\n\n### 6.2 Access Control Boundaries\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-ACL-01 | Non-owner cannot list private project tasks | Empty result or error |\n| EDGE-ACL-02 | Non-owner cannot add to private project | Permission denied |\n| EDGE-ACL-03 | Non-owner cannot move/done/drop private task | Permission denied |\n| EDGE-ACL-04 | Non-owner cannot edit private task | Permission denied |\n\n### 6.3 Concurrency and DB Integrity\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-DB-01 | Unique index prevents duplicate shared project names | UNIQUE constraint violation |\n| EDGE-DB-02 | Unique index allows same private name for different owners | Both inserted |\n| EDGE-DB-03 | WAL mode enabled on connection | `PRAGMA journal_mode` returns `wal` |\n\n### 6.4 Schema Migration\n\n| ID | Description | Expected |\n|---|---|---|\n| EDGE-MIG-01 | Fresh DB gets version 1 | schema_version=1 |\n| EDGE-MIG-02 | Re-init on existing DB is safe | No duplicate tables, version unchanged |\n| EDGE-MIG-03 | DB directory auto-created | `~/.openclaw/workspace/.todo/` created if missing |\n\n---\n\n## 7. Acceptance Criteria Traceability\n\nMapping each PRD acceptance criterion (Section 9) to test cases.\n\n| PRD Criterion | Test Case IDs |\n|---|---|\n| Shared project name collision rejected | DB-PRJ-02, PRJ-SSH-03, EDGE-COL-03 |\n| Private project owner-unique (cross-owner OK) | DB-PRJ-04, DB-PRJ-05, EDGE-DB-02 |\n| `set-private` rejects when non-owner assignees exist | PRJ-SPR-04, PRJ-SPR-05, PRJ-SPR-06 |\n| Private project + non-owner assignee = warning + reject | CMD-ADD-06, CMD-EDT-06, CMD-EDT-07 |\n| `due:MM-DD` fills current year | P-DUE-02, P-DUE-03, D-NORM-01 |\n| DB first-run: file + schema + Inbox | DB-INIT-01 through DB-INIT-05, EDGE-MIG-01, EDGE-MIG-03 |\n\n---\n\n## 8. Automation Candidates\n\n### 8.1 High Priority (automate first)\n\n| Area | Rationale |\n|---|---|\n| **Parser unit tests** (Section 3.1) | Pure functions, fast, high regression value. Run on every commit. |\n| **Due date normalization** (Section 3.2) | Date logic is error-prone; requires time-freezing. |\n| **DB schema init** (Section 3.3.1) | Catches migration regressions early. |\n| **Private project access control** (Sections 4, 5, 6.2) | Security-critical; must never regress. |\n\n### 8.2 Medium Priority\n\n| Area | Rationale |\n|---|---|\n| **Command handler integration** (Section 4) | Parse-to-DB flow; requires fixture setup but high coverage value. |\n| **Project name collision resolution** (Section 6.1) | Logic is subtle (Option A). |\n\n### 8.3 Lower Priority / Manual\n\n| Area | Rationale |\n|---|---|\n| **Response message formatting** | Cosmetic; snapshot testing if desired. |\n| **Concurrency under load** | Harder to automate reliably in CI; manual or stress-test script. |\n\n### 8.4 Suggested pytest Marks\n\n```python\n# conftest.py or pyproject.toml\nmarkers = [\n    \"unit: Pure unit tests (no DB, no I/O)\",\n    \"integration: Tests requiring DB or multi-component interaction\",\n    \"slow: Tests with file I/O or significant setup\",\n]\n```\n\n---\n\n## 9. Smoke Checklist\n\nA minimal set of tests to run before any release or deployment. If any fail, the build is not shippable.\n\n- [ ] **SMOKE-01**: DB initializes without error on empty state (DB-INIT-01)\n- [ ] **SMOKE-02**: Default `Inbox` project exists after init (DB-INIT-03)\n- [ ] **SMOKE-03**: `/todo add buy milk` creates a task in Inbox/backlog (CMD-ADD-01)\n- [ ] **SMOKE-04**: `/todo list` returns the just-added task (CMD-LST-01)\n- [ ] **SMOKE-05**: `/todo done <id>` marks task done with closed_at (CMD-DON-01)\n- [ ] **SMOKE-06**: `/todo add task <@U_OTHER> /p PrivateProj` is rejected (CMD-ADD-06)\n- [ ] **SMOKE-07**: `/todo project set-private` with non-owner assignees fails (PRJ-SPR-04)\n- [ ] **SMOKE-08**: `due:03-15` parses to `2026-03-15` (P-DUE-02)\n- [ ] **SMOKE-09**: Invalid due `due:02-30` returns error (P-DUE-04)\n- [ ] **SMOKE-10**: `/todo board` renders sections in correct order (CMD-BRD-01)\n\nRun with:\n```bash\nuv run pytest -m smoke -q --tb=short\n```\n\n---\n\n## 10. Test Directory Structure (Recommended)\n\n```\ntests/\n  conftest.py              # Shared fixtures (db_conn, sender_ctx, etc.)\n  test_parser.py           # 3.1 Parser tests (P-MEN, P-PRJ, P-SEC, P-DUE, P-CMB)\n  test_due_normalization.py # 3.2 Date normalization\n  test_db_schema.py        # 3.3.1 Schema init and migration\n  test_db_projects.py      # 3.3.2 Project CRUD\n  test_db_tasks.py         # 3.3.3 Task CRUD\n  test_cmd_add.py          # 4.1 /todo add\n  test_cmd_list.py         # 4.2 /todo list\n  test_cmd_board.py        # 4.3 /todo board\n  test_cmd_move.py         # 4.4 /todo move\n  test_cmd_done_drop.py    # 4.5-4.6 /todo done, drop\n  test_cmd_edit.py         # 4.7 /todo edit\n  test_project_cmds.py     # 5.1-5.3 project list/set-private/set-shared\n  test_edge_cases.py       # 6.x Edge cases and collision resolution\n```\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01ND4HFHoF4wNNjctmU6rd4T", "_ts": "2026-02-20T11:33:56+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a03d4ab", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a03d4ab.jsonl", "agent_type": "qa-designer", "_ts": "2026-02-20T11:34:09+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a90351a", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a90351a.jsonl", "agent_type": "", "_ts": "2026-02-20T11:34:13+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "content": "# OpenClaw TODO Plugin -- Issues\n\n> Auto-generated from `openclaw_todo_plugin_prd.md` (PRD v1.1)\n> Date: 2026-02-20\n\n---\n\n## Issue #1: Plugin skeleton and entry point\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M0                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/001-plugin-skeleton`          |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load. The plugin must expose a callable that receives raw Slack DM text and a sender context dict.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n**Tests**\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n**Rollback**\nDelete branch; no runtime dependency.\n\n**Observability**\n`logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched.\n\n**Dependencies**\nNone.\n\n---\n\n## Issue #2: DB module -- connection helper and pragma setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/002-db-connection`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/db.py` with a `get_connection(db_path)` helper that creates the `~/.openclaw/workspace/.todo/` directory tree if missing, opens (or creates) `todo.sqlite3`, and applies `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000`.\n\n**Acceptance Criteria**\n- [ ] Directory is created recursively when absent\n- [ ] SQLite connection returned with WAL mode enabled\n- [ ] `busy_timeout` is 3000\n- [ ] Calling `get_connection` twice returns usable connections (no lock conflict)\n\n**Tests**\n- `tests/test_db.py::test_creates_directory_and_file` (tmp_path)\n- `tests/test_db.py::test_wal_mode_enabled`\n- `tests/test_db.py::test_busy_timeout`\n\n**Rollback**\nRevert module; no schema changes yet.\n\n**Observability**\n`logger.info` on first DB creation; `logger.debug` on each connection open.\n\n**Dependencies**\n#1\n\n---\n\n## Issue #3: Schema migration framework and schema_version table\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/003-schema-migration`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement a simple sequential migration runner. On startup, read `schema_version` (create if missing), compare to available migrations list, and apply outstanding migrations in order inside a transaction.\n\n**Acceptance Criteria**\n- [ ] `schema_version` table created with single row `version=0` if absent\n- [ ] Migrations are Python callables registered in an ordered list\n- [ ] Each migration runs inside a transaction; version incremented on success\n- [ ] Re-running on an up-to-date DB is a no-op\n- [ ] Failing migration rolls back and raises with clear message\n\n**Tests**\n- `tests/test_migrations.py::test_fresh_db_gets_version_table`\n- `tests/test_migrations.py::test_applies_migrations_sequentially`\n- `tests/test_migrations.py::test_idempotent_on_rerun`\n- `tests/test_migrations.py::test_rollback_on_failure`\n\n**Rollback**\nDrop `schema_version` table; revert module.\n\n**Observability**\n`logger.info(\"Migrating from version %d to %d\", current, target)` per step.\n\n**Dependencies**\n#2\n\n---\n\n## Issue #4: V1 schema migration -- projects, tasks, task_assignees, events\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/004-v1-schema`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nRegister migration v1 that creates the four tables (`projects`, `tasks`, `task_assignees`, `events`) with all columns, CHECK constraints, and partial unique indexes as specified in PRD section 6.3. Also seed shared project `Inbox`.\n\n**Acceptance Criteria**\n- [ ] `projects` table with `ux_projects_shared_name` and `ux_projects_private_owner_name` partial unique indexes\n- [ ] `tasks` table with section and status CHECK constraints\n- [ ] `task_assignees` table with composite PK and secondary index\n- [ ] `events` audit table created\n- [ ] Shared `Inbox` project auto-created (INSERT OR IGNORE)\n- [ ] `schema_version` = 1 after migration\n\n**Tests**\n- `tests/test_migrations.py::test_v1_tables_exist`\n- `tests/test_migrations.py::test_v1_inbox_created`\n- `tests/test_migrations.py::test_v1_shared_unique_index_enforced`\n- `tests/test_migrations.py::test_v1_private_unique_index_enforced`\n\n**Rollback**\nDrop all four tables + reset schema_version to 0.\n\n**Observability**\nLog table creation counts.\n\n**Dependencies**\n#3\n\n---\n\n## Issue #5: Command parser -- tokenizer and option extraction\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M2                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/005-parser-tokenizer`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/parser.py` that takes raw message text (after `/todo` prefix) and returns a `ParsedCommand` dataclass containing: `command` (str), `args` (list), `project` (str|None), `section` (str|None), `due` (str|None, normalised to YYYY-MM-DD), `mentions` (list of Slack user IDs), and remaining `title_tokens`.\n\nParsing rules:\n- `/p <name>` extracts project\n- `/s <section>` extracts section (validate against enum)\n- `due:YYYY-MM-DD` or `due:MM-DD` extracts and normalises due date\n- `due:-` clears due (sentinel)\n- `<@U...>` patterns extracted as mentions\n- Everything else before first option token is title\n\n**Acceptance Criteria**\n- [ ] `/p MyProject` correctly extracted; token consumed\n- [ ] `/s doing` validated; invalid section raises `ParseError`\n- [ ] `due:03-15` normalised to `2026-03-15`\n- [ ] `due:2026-02-30` raises `ParseError` (invalid date)\n- [ ] `<@U12345>` extracted into mentions list\n- [ ] Multiple mentions supported\n- [ ] Title tokens are non-option, non-mention tokens before first option\n\n**Tests**\n- `tests/test_parser.py::test_extract_project`\n- `tests/test_parser.py::test_extract_section_valid`\n- `tests/test_parser.py::test_extract_section_invalid`\n- `tests/test_parser.py::test_due_mm_dd_normalisation`\n- `tests/test_parser.py::test_due_full_date`\n- `tests/test_parser.py::test_due_invalid_date`\n- `tests/test_parser.py::test_due_clear`\n- `tests/test_parser.py::test_mentions_extraction`\n- `tests/test_parser.py::test_title_extraction`\n\n**Rollback**\nRevert module; no side effects.\n\n**Observability**\n`logger.debug(\"Parsed: %s\", parsed_command)`\n\n**Dependencies**\n#1\n\n---\n\n## Issue #6: /todo add command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/006-cmd-add`                  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `add` subcommand handler. Resolves project (default `Inbox`), applies defaults (section=`backlog`, assignees=sender if none mentioned), validates private-project assignee constraint (PRD 3.3), inserts task + task_assignees rows, logs event, and returns formatted confirmation.\n\n**Acceptance Criteria**\n- [ ] Task inserted with correct project_id, section, due, status='open', created_by\n- [ ] Assignees default to sender when no mentions\n- [ ] Multiple mentions create multiple task_assignee rows\n- [ ] Private project + non-owner assignee returns warning and does NOT insert\n- [ ] Non-existent project: `Inbox` auto-created as shared; others return error\n- [ ] Response format: `Added #<id> (<project>/<section>) due:<due|-> assignees:<mentions> -- <title>`\n- [ ] Event row written to `events` table\n\n**Tests**\n- `tests/test_cmd_add.py::test_add_default_inbox`\n- `tests/test_cmd_add.py::test_add_with_project_section_due`\n- `tests/test_cmd_add.py::test_add_private_rejects_other_assignee`\n- `tests/test_cmd_add.py::test_add_assignee_defaults_to_sender`\n- `tests/test_cmd_add.py::test_add_multiple_assignees`\n\n**Rollback**\nRevert handler; tasks table unchanged structurally.\n\n**Observability**\n`logger.info(\"Task #%d created in %s/%s by %s\", id, project, section, sender)`\n\n**Dependencies**\n#4, #5\n\n---\n\n## Issue #7: Project resolver helper\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/007-project-resolver`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `resolve_project(conn, name, sender_id) -> Project` following PRD 3.2 (Option A): sender's private project with that name takes priority, then shared, then error/auto-create for Inbox.\n\n**Acceptance Criteria**\n- [ ] Private project of sender matched first\n- [ ] Falls back to shared if no private match\n- [ ] Returns error when neither exists (except Inbox which is auto-created)\n- [ ] Returns project row with id, name, visibility, owner_user_id\n\n**Tests**\n- `tests/test_project_resolver.py::test_private_takes_priority`\n- `tests/test_project_resolver.py::test_falls_back_to_shared`\n- `tests/test_project_resolver.py::test_inbox_auto_created`\n- `tests/test_project_resolver.py::test_unknown_project_error`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Resolved project '%s' -> id=%d vis=%s\", name, id, visibility)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #8: /todo list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/008-cmd-list`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `list` subcommand. Supports scope (mine/all/<@USER>), project filter, section filter, status filter (open/done/drop), and limit. Sorting: due ASC (NULLs last), then id DESC. Excludes other users' private projects.\n\n**Acceptance Criteria**\n- [ ] Default scope=mine, status=open, limit=30\n- [ ] `mine` filters to tasks where sender is an assignee\n- [ ] `all` includes shared + sender's private (excludes others' private)\n- [ ] `/p` and `/s` filters applied correctly\n- [ ] Sorting: due NOT NULL first, due ASC, id DESC\n- [ ] limit:N respected\n- [ ] Output lists tasks in formatted lines\n\n**Tests**\n- `tests/test_cmd_list.py::test_list_mine_default`\n- `tests/test_cmd_list.py::test_list_all_excludes_others_private`\n- `tests/test_cmd_list.py::test_list_with_project_filter`\n- `tests/test_cmd_list.py::test_list_sorting_order`\n- `tests/test_cmd_list.py::test_list_limit`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"list: scope=%s project=%s returned %d rows\", scope, project, count)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #9: /todo board command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/009-cmd-board`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `board` subcommand. Groups tasks by section in fixed order (BACKLOG, DOING, WAITING, DONE, DROP), applies scope/project/status filters, and limits per section. Format: section headers with task lines underneath.\n\n**Acceptance Criteria**\n- [ ] Sections displayed in order: BACKLOG -> DOING -> WAITING -> DONE -> DROP\n- [ ] Empty sections shown with \"(empty)\" or omitted (decide and document)\n- [ ] `limitPerSection:N` caps items per section (default 10)\n- [ ] Scope/project filters identical to `list`\n- [ ] Each task line: `#id due:<date|-> assignees:<@U..> title`\n\n**Tests**\n- `tests/test_cmd_board.py::test_board_section_order`\n- `tests/test_cmd_board.py::test_board_limit_per_section`\n- `tests/test_cmd_board.py::test_board_scope_filter`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"board: scope=%s project=%s sections=%s\", ...)`\n\n**Dependencies**\n#8\n\n---\n\n## Issue #10: /todo move command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/010-cmd-move`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `move` subcommand. Validates section enum, checks permissions (private: owner only; shared: assignee or created_by), updates task section and updated_at, logs event.\n\n**Acceptance Criteria**\n- [ ] Section validated against enum; invalid returns error\n- [ ] Private project: only owner can move\n- [ ] Shared project: only assignee or created_by can move\n- [ ] `updated_at` set on change\n- [ ] Event logged\n- [ ] Response confirms new section\n\n**Tests**\n- `tests/test_cmd_move.py::test_move_valid_section`\n- `tests/test_cmd_move.py::test_move_invalid_section`\n- `tests/test_cmd_move.py::test_move_private_owner_only`\n- `tests/test_cmd_move.py::test_move_shared_permission`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d moved to %s by %s\", id, section, sender)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #11: /todo done and /todo drop commands\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/011-cmd-done-drop`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `done` and `drop` subcommands. Both set section and status accordingly, record `closed_at`, validate permissions same as `move`, and log event.\n\n**Acceptance Criteria**\n- [ ] `done`: section='done', status='done', closed_at=now\n- [ ] `drop`: section='drop', status='dropped', closed_at=now\n- [ ] Permissions enforced (same as move)\n- [ ] Already-closed task returns informational message (idempotent or error -- decide)\n- [ ] Event logged for each\n\n**Tests**\n- `tests/test_cmd_done_drop.py::test_done_sets_fields`\n- `tests/test_cmd_done_drop.py::test_drop_sets_fields`\n- `tests/test_cmd_done_drop.py::test_permission_check`\n- `tests/test_cmd_done_drop.py::test_already_done`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d %s by %s\", id, action, sender)`\n\n**Dependencies**\n#10\n\n---\n\n## Issue #12: /todo edit command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/012-cmd-edit`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `edit` subcommand (v1 replace semantics). Supports changing title, assignees (full replace), project, section, and due. Validates private-project assignee constraint on both source and target project. Logs event with old/new diff in payload.\n\n**Acceptance Criteria**\n- [ ] Title updated only if non-option tokens present\n- [ ] Mentions present -> assignees fully replaced (DELETE + INSERT)\n- [ ] `due:-` clears due to NULL\n- [ ] `/p <newProject>` moves task to new project (project_id updated)\n- [ ] Private project assignee validation applied to target project\n- [ ] If moving to private project with non-owner assignees -> warning, no change\n- [ ] Event payload contains changed fields\n- [ ] Permissions: private owner only; shared assignee/created_by\n\n**Tests**\n- `tests/test_cmd_edit.py::test_edit_title`\n- `tests/test_cmd_edit.py::test_edit_assignees_replace`\n- `tests/test_cmd_edit.py::test_edit_due_clear`\n- `tests/test_cmd_edit.py::test_edit_move_project`\n- `tests/test_cmd_edit.py::test_edit_private_assignee_rejected`\n- `tests/test_cmd_edit.py::test_edit_no_change_fields`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d edited by %s: fields=%s\", id, sender, changed_fields)`\n\n**Dependencies**\n#6, #7, #10\n\n---\n\n## Issue #13: /todo project list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/013-cmd-project-list`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project list`. Returns all shared projects and the sender's private projects. Format: grouped by visibility with name and task count.\n\n**Acceptance Criteria**\n- [ ] Shared projects listed regardless of sender\n- [ ] Sender's private projects listed\n- [ ] Other users' private projects NOT shown\n- [ ] Each project shows name, visibility, task count\n\n**Tests**\n- `tests/test_cmd_project.py::test_project_list_shows_shared`\n- `tests/test_cmd_project.py::test_project_list_shows_own_private`\n- `tests/test_cmd_project.py::test_project_list_hides_others_private`\n\n**Rollback**\nRevert handler; read-only.\n\n**Observability**\n`logger.info(\"project list: %d shared, %d private for %s\", ...)`\n\n**Dependencies**\n#7\n\n---\n\n## Issue #14: /todo project set-private command with assignee validation\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/014-cmd-project-set-private`  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-private <name>` with the assignee validation described in PRD 3.4. Resolution flow: if sender already has private with that name -> noop; if shared exists -> attempt conversion; if neither -> create new private. Conversion scans all tasks in the project and rejects if any task has a non-owner assignee.\n\n**Acceptance Criteria**\n- [ ] Already-private for sender: returns \"already private\" message\n- [ ] Shared -> private: scans tasks; all assignees are owner -> success (visibility='private', owner_user_id=sender)\n- [ ] Shared -> private: at least one non-owner assignee -> error with task IDs and violating assignee list (max 10)\n- [ ] Neither exists: creates new private project with owner=sender\n- [ ] Error message format matches PRD example\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_private_already_private`\n- `tests/test_cmd_project.py::test_set_private_shared_success`\n- `tests/test_cmd_project.py::test_set_private_shared_rejected_non_owner_assignee`\n- `tests/test_cmd_project.py::test_set_private_creates_new`\n- `tests/test_cmd_project.py::test_set_private_error_message_format`\n\n**Rollback**\nRevert handler; no schema change.\n\n**Observability**\n`logger.info(\"project set-private: %s result=%s by %s\", name, result, sender)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #15: /todo project set-shared command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/015-cmd-project-set-shared`   |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-shared <name>`. Creates a shared project if none exists. If a shared project with that name already exists, noop. Global uniqueness enforced by DB index.\n\n**Acceptance Criteria**\n- [ ] New shared project created when name is free\n- [ ] Existing shared project: returns \"already shared\" / noop\n- [ ] Name conflict with existing shared: returns exists message (index enforces)\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_shared_creates_new`\n- `tests/test_cmd_project.py::test_set_shared_already_exists_noop`\n- `tests/test_cmd_project.py::test_set_shared_name_conflict`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"project set-shared: %s result=%s\", name, result)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #16: Command dispatcher and routing\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/016-dispatcher`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the dispatcher in `plugin.py` that maps the parsed command name to handler functions: `add`, `list`, `board`, `move`, `done`, `drop`, `edit`, `project`. The `project` command further dispatches to `list`, `set-private`, `set-shared`. Unknown commands return a help/error message.\n\n**Acceptance Criteria**\n- [ ] All valid command names routed to correct handler\n- [ ] `project` subcommands routed correctly\n- [ ] Unknown command returns usage hint\n- [ ] DB connection initialised (migration check) before first command execution\n\n**Tests**\n- `tests/test_dispatcher.py::test_routes_known_commands`\n- `tests/test_dispatcher.py::test_project_sub_routing`\n- `tests/test_dispatcher.py::test_unknown_command_help`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.info(\"Dispatching command=%s sub=%s\", command, sub)`\n\n**Dependencies**\n#5\n\n---\n\n## Issue #17: Permission helper module\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/017-permissions`              |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExtract shared permission-checking logic into `src/openclaw_todo/permissions.py`. Provides `can_write_task(conn, task_id, sender_id) -> bool` and `validate_private_assignees(project, assignees, owner_id) -> Optional[str]` (returns warning message or None).\n\n**Acceptance Criteria**\n- [ ] Private project: only owner can write\n- [ ] Shared project: only assignee or created_by can write\n- [ ] `validate_private_assignees` returns warning string when non-owner assignees present for private project\n- [ ] Returns None for shared projects or when all assignees are owner\n\n**Tests**\n- `tests/test_permissions.py::test_private_owner_can_write`\n- `tests/test_permissions.py::test_private_non_owner_rejected`\n- `tests/test_permissions.py::test_shared_assignee_can_write`\n- `tests/test_permissions.py::test_shared_creator_can_write`\n- `tests/test_permissions.py::test_validate_private_assignees_warning`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Permission check: task=%d sender=%s result=%s\", ...)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #18: Parser unit tests (comprehensive)\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/018-parser-tests`             |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExpand parser test coverage to include edge cases: multiple options in varied order, due at year boundary, empty title, mentions mixed with options, unicode in titles, extra whitespace handling.\n\n**Acceptance Criteria**\n- [ ] >=95% line coverage on `parser.py`\n- [ ] Edge cases documented in test docstrings\n- [ ] All tests pass with `uv run pytest tests/test_parser.py -v`\n\n**Tests**\n- `tests/test_parser.py::test_options_in_any_order`\n- `tests/test_parser.py::test_due_year_boundary`\n- `tests/test_parser.py::test_empty_title_no_crash`\n- `tests/test_parser.py::test_unicode_title`\n- `tests/test_parser.py::test_extra_whitespace`\n- `tests/test_parser.py::test_mixed_mentions_and_options`\n\n**Rollback**\nRevert test file; no production code change.\n\n**Observability**\nCI coverage report.\n\n**Dependencies**\n#5\n\n---\n\n## Issue #19: SQLite end-to-end integration tests\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/019-e2e-tests`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nWrite integration tests that exercise the full flow through `handle_message` with a real (tmp_path) SQLite database. Cover the main user stories: add a task, list it, move it, mark done, edit it, manage projects, and validate private project constraints.\n\n**Acceptance Criteria**\n- [ ] Each test uses a fresh DB via `tmp_path` fixture\n- [ ] Scenarios: add->list, add->move->board, add->done, add->edit, project set-private rejection\n- [ ] Private project visibility enforced end-to-end\n- [ ] Due normalisation verified in DB\n- [ ] All tests pass with `uv run pytest tests/test_e2e.py -v`\n\n**Tests**\n- `tests/test_e2e.py::test_add_and_list_roundtrip`\n- `tests/test_e2e.py::test_add_move_board`\n- `tests/test_e2e.py::test_done_and_drop`\n- `tests/test_e2e.py::test_edit_title_and_assignees`\n- `tests/test_e2e.py::test_private_project_isolation`\n- `tests/test_e2e.py::test_set_private_rejects_foreign_assignees`\n- `tests/test_e2e.py::test_due_normalisation_stored_correctly`\n\n**Rollback**\nRevert test file.\n\n**Observability**\nCI test results and coverage delta.\n\n**Dependencies**\n#6, #8, #9, #10, #11, #12, #14, #15\n\n---\n\n## Issue #20: Packaging and distribution setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | DevOps                                 |\n| Milestone   | M6                                     |\n| Status      | TODO                                   |\n| Priority    | P2                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/020-packaging`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nFinalise `pyproject.toml` metadata (name, version, description, license, entry-points), add a `Makefile` with targets for lint/test/build, and document installation instructions in README. Ensure the plugin can be installed as a package and discovered by the OpenClaw gateway.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` has complete metadata and entry-point for OpenClaw plugin discovery\n- [ ] `make lint` runs ruff + black --check\n- [ ] `make test` runs pytest with coverage\n- [ ] `make build` produces a wheel via `uv build`\n- [ ] `pip install <wheel>` in a clean venv makes the plugin importable\n- [ ] README documents installation and configuration (DB path env var)\n\n**Tests**\n- Manual: install wheel in fresh venv, import module, call `handle_message`\n- `make test` passes in CI\n\n**Rollback**\nRevert packaging changes.\n\n**Observability**\nBuild artifact size logged; CI publishes wheel as artifact.\n\n**Dependencies**\n#19\n\n---\n\n## Dependency Graph (summary)\n\n```\n#1  Plugin skeleton\n |\n +--#2  DB connection\n |   |\n |   +--#3  Migration framework\n |       |\n |       +--#4  V1 schema\n |           |\n |           +--#7  Project resolver\n |           |   |\n |           |   +--#13 project list\n |           |   +--#14 project set-private\n |           |   +--#15 project set-shared\n |           |\n |           +--#17 Permissions helper\n |\n +--#5  Parser\n |   |\n |   +--#18 Parser tests (M5)\n |\n +--#16 Dispatcher\n     |\n     +--#6  cmd add       (#4,#5,#7,#17)\n     +--#8  cmd list      (#6,#7)\n     +--#9  cmd board     (#8)\n     +--#10 cmd move      (#6,#7,#17)\n     +--#11 cmd done/drop (#10)\n     +--#12 cmd edit      (#6,#7,#10,#17)\n\n#19 E2E tests    (all commands)\n#20 Packaging    (#19)\n```\n"}, "tool_use_id": "toolu_01GX5wGMA8Kjz7rK3knMWd4V", "_ts": "2026-02-20T11:34:16+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "content": "# OpenClaw TODO Plugin -- Issues\n\n> Auto-generated from `openclaw_todo_plugin_prd.md` (PRD v1.1)\n> Date: 2026-02-20\n\n---\n\n## Issue #1: Plugin skeleton and entry point\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M0                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/001-plugin-skeleton`          |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load. The plugin must expose a callable that receives raw Slack DM text and a sender context dict.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n**Tests**\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n**Rollback**\nDelete branch; no runtime dependency.\n\n**Observability**\n`logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched.\n\n**Dependencies**\nNone.\n\n---\n\n## Issue #2: DB module -- connection helper and pragma setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/002-db-connection`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/db.py` with a `get_connection(db_path)` helper that creates the `~/.openclaw/workspace/.todo/` directory tree if missing, opens (or creates) `todo.sqlite3`, and applies `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000`.\n\n**Acceptance Criteria**\n- [ ] Directory is created recursively when absent\n- [ ] SQLite connection returned with WAL mode enabled\n- [ ] `busy_timeout` is 3000\n- [ ] Calling `get_connection` twice returns usable connections (no lock conflict)\n\n**Tests**\n- `tests/test_db.py::test_creates_directory_and_file` (tmp_path)\n- `tests/test_db.py::test_wal_mode_enabled`\n- `tests/test_db.py::test_busy_timeout`\n\n**Rollback**\nRevert module; no schema changes yet.\n\n**Observability**\n`logger.info` on first DB creation; `logger.debug` on each connection open.\n\n**Dependencies**\n#1\n\n---\n\n## Issue #3: Schema migration framework and schema_version table\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/003-schema-migration`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement a simple sequential migration runner. On startup, read `schema_version` (create if missing), compare to available migrations list, and apply outstanding migrations in order inside a transaction.\n\n**Acceptance Criteria**\n- [ ] `schema_version` table created with single row `version=0` if absent\n- [ ] Migrations are Python callables registered in an ordered list\n- [ ] Each migration runs inside a transaction; version incremented on success\n- [ ] Re-running on an up-to-date DB is a no-op\n- [ ] Failing migration rolls back and raises with clear message\n\n**Tests**\n- `tests/test_migrations.py::test_fresh_db_gets_version_table`\n- `tests/test_migrations.py::test_applies_migrations_sequentially`\n- `tests/test_migrations.py::test_idempotent_on_rerun`\n- `tests/test_migrations.py::test_rollback_on_failure`\n\n**Rollback**\nDrop `schema_version` table; revert module.\n\n**Observability**\n`logger.info(\"Migrating from version %d to %d\", current, target)` per step.\n\n**Dependencies**\n#2\n\n---\n\n## Issue #4: V1 schema migration -- projects, tasks, task_assignees, events\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/004-v1-schema`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nRegister migration v1 that creates the four tables (`projects`, `tasks`, `task_assignees`, `events`) with all columns, CHECK constraints, and partial unique indexes as specified in PRD section 6.3. Also seed shared project `Inbox`.\n\n**Acceptance Criteria**\n- [ ] `projects` table with `ux_projects_shared_name` and `ux_projects_private_owner_name` partial unique indexes\n- [ ] `tasks` table with section and status CHECK constraints\n- [ ] `task_assignees` table with composite PK and secondary index\n- [ ] `events` audit table created\n- [ ] Shared `Inbox` project auto-created (INSERT OR IGNORE)\n- [ ] `schema_version` = 1 after migration\n\n**Tests**\n- `tests/test_migrations.py::test_v1_tables_exist`\n- `tests/test_migrations.py::test_v1_inbox_created`\n- `tests/test_migrations.py::test_v1_shared_unique_index_enforced`\n- `tests/test_migrations.py::test_v1_private_unique_index_enforced`\n\n**Rollback**\nDrop all four tables + reset schema_version to 0.\n\n**Observability**\nLog table creation counts.\n\n**Dependencies**\n#3\n\n---\n\n## Issue #5: Command parser -- tokenizer and option extraction\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M2                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/005-parser-tokenizer`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/parser.py` that takes raw message text (after `/todo` prefix) and returns a `ParsedCommand` dataclass containing: `command` (str), `args` (list), `project` (str|None), `section` (str|None), `due` (str|None, normalised to YYYY-MM-DD), `mentions` (list of Slack user IDs), and remaining `title_tokens`.\n\nParsing rules:\n- `/p <name>` extracts project\n- `/s <section>` extracts section (validate against enum)\n- `due:YYYY-MM-DD` or `due:MM-DD` extracts and normalises due date\n- `due:-` clears due (sentinel)\n- `<@U...>` patterns extracted as mentions\n- Everything else before first option token is title\n\n**Acceptance Criteria**\n- [ ] `/p MyProject` correctly extracted; token consumed\n- [ ] `/s doing` validated; invalid section raises `ParseError`\n- [ ] `due:03-15` normalised to `2026-03-15`\n- [ ] `due:2026-02-30` raises `ParseError` (invalid date)\n- [ ] `<@U12345>` extracted into mentions list\n- [ ] Multiple mentions supported\n- [ ] Title tokens are non-option, non-mention tokens before first option\n\n**Tests**\n- `tests/test_parser.py::test_extract_project`\n- `tests/test_parser.py::test_extract_section_valid`\n- `tests/test_parser.py::test_extract_section_invalid`\n- `tests/test_parser.py::test_due_mm_dd_normalisation`\n- `tests/test_parser.py::test_due_full_date`\n- `tests/test_parser.py::test_due_invalid_date`\n- `tests/test_parser.py::test_due_clear`\n- `tests/test_parser.py::test_mentions_extraction`\n- `tests/test_parser.py::test_title_extraction`\n\n**Rollback**\nRevert module; no side effects.\n\n**Observability**\n`logger.debug(\"Parsed: %s\", parsed_command)`\n\n**Dependencies**\n#1\n\n---\n\n## Issue #6: /todo add command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/006-cmd-add`                  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `add` subcommand handler. Resolves project (default `Inbox`), applies defaults (section=`backlog`, assignees=sender if none mentioned), validates private-project assignee constraint (PRD 3.3), inserts task + task_assignees rows, logs event, and returns formatted confirmation.\n\n**Acceptance Criteria**\n- [ ] Task inserted with correct project_id, section, due, status='open', created_by\n- [ ] Assignees default to sender when no mentions\n- [ ] Multiple mentions create multiple task_assignee rows\n- [ ] Private project + non-owner assignee returns warning and does NOT insert\n- [ ] Non-existent project: `Inbox` auto-created as shared; others return error\n- [ ] Response format: `Added #<id> (<project>/<section>) due:<due|-> assignees:<mentions> -- <title>`\n- [ ] Event row written to `events` table\n\n**Tests**\n- `tests/test_cmd_add.py::test_add_default_inbox`\n- `tests/test_cmd_add.py::test_add_with_project_section_due`\n- `tests/test_cmd_add.py::test_add_private_rejects_other_assignee`\n- `tests/test_cmd_add.py::test_add_assignee_defaults_to_sender`\n- `tests/test_cmd_add.py::test_add_multiple_assignees`\n\n**Rollback**\nRevert handler; tasks table unchanged structurally.\n\n**Observability**\n`logger.info(\"Task #%d created in %s/%s by %s\", id, project, section, sender)`\n\n**Dependencies**\n#4, #5\n\n---\n\n## Issue #7: Project resolver helper\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/007-project-resolver`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `resolve_project(conn, name, sender_id) -> Project` following PRD 3.2 (Option A): sender's private project with that name takes priority, then shared, then error/auto-create for Inbox.\n\n**Acceptance Criteria**\n- [ ] Private project of sender matched first\n- [ ] Falls back to shared if no private match\n- [ ] Returns error when neither exists (except Inbox which is auto-created)\n- [ ] Returns project row with id, name, visibility, owner_user_id\n\n**Tests**\n- `tests/test_project_resolver.py::test_private_takes_priority`\n- `tests/test_project_resolver.py::test_falls_back_to_shared`\n- `tests/test_project_resolver.py::test_inbox_auto_created`\n- `tests/test_project_resolver.py::test_unknown_project_error`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Resolved project '%s' -> id=%d vis=%s\", name, id, visibility)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #8: /todo list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/008-cmd-list`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `list` subcommand. Supports scope (mine/all/<@USER>), project filter, section filter, status filter (open/done/drop), and limit. Sorting: due ASC (NULLs last), then id DESC. Excludes other users' private projects.\n\n**Acceptance Criteria**\n- [ ] Default scope=mine, status=open, limit=30\n- [ ] `mine` filters to tasks where sender is an assignee\n- [ ] `all` includes shared + sender's private (excludes others' private)\n- [ ] `/p` and `/s` filters applied correctly\n- [ ] Sorting: due NOT NULL first, due ASC, id DESC\n- [ ] limit:N respected\n- [ ] Output lists tasks in formatted lines\n\n**Tests**\n- `tests/test_cmd_list.py::test_list_mine_default`\n- `tests/test_cmd_list.py::test_list_all_excludes_others_private`\n- `tests/test_cmd_list.py::test_list_with_project_filter`\n- `tests/test_cmd_list.py::test_list_sorting_order`\n- `tests/test_cmd_list.py::test_list_limit`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"list: scope=%s project=%s returned %d rows\", scope, project, count)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #9: /todo board command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/009-cmd-board`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `board` subcommand. Groups tasks by section in fixed order (BACKLOG, DOING, WAITING, DONE, DROP), applies scope/project/status filters, and limits per section. Format: section headers with task lines underneath.\n\n**Acceptance Criteria**\n- [ ] Sections displayed in order: BACKLOG -> DOING -> WAITING -> DONE -> DROP\n- [ ] Empty sections shown with \"(empty)\" or omitted (decide and document)\n- [ ] `limitPerSection:N` caps items per section (default 10)\n- [ ] Scope/project filters identical to `list`\n- [ ] Each task line: `#id due:<date|-> assignees:<@U..> title`\n\n**Tests**\n- `tests/test_cmd_board.py::test_board_section_order`\n- `tests/test_cmd_board.py::test_board_limit_per_section`\n- `tests/test_cmd_board.py::test_board_scope_filter`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"board: scope=%s project=%s sections=%s\", ...)`\n\n**Dependencies**\n#8\n\n---\n\n## Issue #10: /todo move command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/010-cmd-move`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `move` subcommand. Validates section enum, checks permissions (private: owner only; shared: assignee or created_by), updates task section and updated_at, logs event.\n\n**Acceptance Criteria**\n- [ ] Section validated against enum; invalid returns error\n- [ ] Private project: only owner can move\n- [ ] Shared project: only assignee or created_by can move\n- [ ] `updated_at` set on change\n- [ ] Event logged\n- [ ] Response confirms new section\n\n**Tests**\n- `tests/test_cmd_move.py::test_move_valid_section`\n- `tests/test_cmd_move.py::test_move_invalid_section`\n- `tests/test_cmd_move.py::test_move_private_owner_only`\n- `tests/test_cmd_move.py::test_move_shared_permission`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d moved to %s by %s\", id, section, sender)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #11: /todo done and /todo drop commands\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/011-cmd-done-drop`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `done` and `drop` subcommands. Both set section and status accordingly, record `closed_at`, validate permissions same as `move`, and log event.\n\n**Acceptance Criteria**\n- [ ] `done`: section='done', status='done', closed_at=now\n- [ ] `drop`: section='drop', status='dropped', closed_at=now\n- [ ] Permissions enforced (same as move)\n- [ ] Already-closed task returns informational message (idempotent or error -- decide)\n- [ ] Event logged for each\n\n**Tests**\n- `tests/test_cmd_done_drop.py::test_done_sets_fields`\n- `tests/test_cmd_done_drop.py::test_drop_sets_fields`\n- `tests/test_cmd_done_drop.py::test_permission_check`\n- `tests/test_cmd_done_drop.py::test_already_done`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d %s by %s\", id, action, sender)`\n\n**Dependencies**\n#10\n\n---\n\n## Issue #12: /todo edit command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/012-cmd-edit`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `edit` subcommand (v1 replace semantics). Supports changing title, assignees (full replace), project, section, and due. Validates private-project assignee constraint on both source and target project. Logs event with old/new diff in payload.\n\n**Acceptance Criteria**\n- [ ] Title updated only if non-option tokens present\n- [ ] Mentions present -> assignees fully replaced (DELETE + INSERT)\n- [ ] `due:-` clears due to NULL\n- [ ] `/p <newProject>` moves task to new project (project_id updated)\n- [ ] Private project assignee validation applied to target project\n- [ ] If moving to private project with non-owner assignees -> warning, no change\n- [ ] Event payload contains changed fields\n- [ ] Permissions: private owner only; shared assignee/created_by\n\n**Tests**\n- `tests/test_cmd_edit.py::test_edit_title`\n- `tests/test_cmd_edit.py::test_edit_assignees_replace`\n- `tests/test_cmd_edit.py::test_edit_due_clear`\n- `tests/test_cmd_edit.py::test_edit_move_project`\n- `tests/test_cmd_edit.py::test_edit_private_assignee_rejected`\n- `tests/test_cmd_edit.py::test_edit_no_change_fields`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d edited by %s: fields=%s\", id, sender, changed_fields)`\n\n**Dependencies**\n#6, #7, #10\n\n---\n\n## Issue #13: /todo project list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/013-cmd-project-list`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project list`. Returns all shared projects and the sender's private projects. Format: grouped by visibility with name and task count.\n\n**Acceptance Criteria**\n- [ ] Shared projects listed regardless of sender\n- [ ] Sender's private projects listed\n- [ ] Other users' private projects NOT shown\n- [ ] Each project shows name, visibility, task count\n\n**Tests**\n- `tests/test_cmd_project.py::test_project_list_shows_shared`\n- `tests/test_cmd_project.py::test_project_list_shows_own_private`\n- `tests/test_cmd_project.py::test_project_list_hides_others_private`\n\n**Rollback**\nRevert handler; read-only.\n\n**Observability**\n`logger.info(\"project list: %d shared, %d private for %s\", ...)`\n\n**Dependencies**\n#7\n\n---\n\n## Issue #14: /todo project set-private command with assignee validation\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/014-cmd-project-set-private`  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-private <name>` with the assignee validation described in PRD 3.4. Resolution flow: if sender already has private with that name -> noop; if shared exists -> attempt conversion; if neither -> create new private. Conversion scans all tasks in the project and rejects if any task has a non-owner assignee.\n\n**Acceptance Criteria**\n- [ ] Already-private for sender: returns \"already private\" message\n- [ ] Shared -> private: scans tasks; all assignees are owner -> success (visibility='private', owner_user_id=sender)\n- [ ] Shared -> private: at least one non-owner assignee -> error with task IDs and violating assignee list (max 10)\n- [ ] Neither exists: creates new private project with owner=sender\n- [ ] Error message format matches PRD example\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_private_already_private`\n- `tests/test_cmd_project.py::test_set_private_shared_success`\n- `tests/test_cmd_project.py::test_set_private_shared_rejected_non_owner_assignee`\n- `tests/test_cmd_project.py::test_set_private_creates_new`\n- `tests/test_cmd_project.py::test_set_private_error_message_format`\n\n**Rollback**\nRevert handler; no schema change.\n\n**Observability**\n`logger.info(\"project set-private: %s result=%s by %s\", name, result, sender)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #15: /todo project set-shared command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/015-cmd-project-set-shared`   |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-shared <name>`. Creates a shared project if none exists. If a shared project with that name already exists, noop. Global uniqueness enforced by DB index.\n\n**Acceptance Criteria**\n- [ ] New shared project created when name is free\n- [ ] Existing shared project: returns \"already shared\" / noop\n- [ ] Name conflict with existing shared: returns exists message (index enforces)\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_shared_creates_new`\n- `tests/test_cmd_project.py::test_set_shared_already_exists_noop`\n- `tests/test_cmd_project.py::test_set_shared_name_conflict`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"project set-shared: %s result=%s\", name, result)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #16: Command dispatcher and routing\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/016-dispatcher`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the dispatcher in `plugin.py` that maps the parsed command name to handler functions: `add`, `list`, `board`, `move`, `done`, `drop`, `edit`, `project`. The `project` command further dispatches to `list`, `set-private`, `set-shared`. Unknown commands return a help/error message.\n\n**Acceptance Criteria**\n- [ ] All valid command names routed to correct handler\n- [ ] `project` subcommands routed correctly\n- [ ] Unknown command returns usage hint\n- [ ] DB connection initialised (migration check) before first command execution\n\n**Tests**\n- `tests/test_dispatcher.py::test_routes_known_commands`\n- `tests/test_dispatcher.py::test_project_sub_routing`\n- `tests/test_dispatcher.py::test_unknown_command_help`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.info(\"Dispatching command=%s sub=%s\", command, sub)`\n\n**Dependencies**\n#5\n\n---\n\n## Issue #17: Permission helper module\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/017-permissions`              |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExtract shared permission-checking logic into `src/openclaw_todo/permissions.py`. Provides `can_write_task(conn, task_id, sender_id) -> bool` and `validate_private_assignees(project, assignees, owner_id) -> Optional[str]` (returns warning message or None).\n\n**Acceptance Criteria**\n- [ ] Private project: only owner can write\n- [ ] Shared project: only assignee or created_by can write\n- [ ] `validate_private_assignees` returns warning string when non-owner assignees present for private project\n- [ ] Returns None for shared projects or when all assignees are owner\n\n**Tests**\n- `tests/test_permissions.py::test_private_owner_can_write`\n- `tests/test_permissions.py::test_private_non_owner_rejected`\n- `tests/test_permissions.py::test_shared_assignee_can_write`\n- `tests/test_permissions.py::test_shared_creator_can_write`\n- `tests/test_permissions.py::test_validate_private_assignees_warning`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Permission check: task=%d sender=%s result=%s\", ...)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #18: Parser unit tests (comprehensive)\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/018-parser-tests`             |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExpand parser test coverage to include edge cases: multiple options in varied order, due at year boundary, empty title, mentions mixed with options, unicode in titles, extra whitespace handling.\n\n**Acceptance Criteria**\n- [ ] >=95% line coverage on `parser.py`\n- [ ] Edge cases documented in test docstrings\n- [ ] All tests pass with `uv run pytest tests/test_parser.py -v`\n\n**Tests**\n- `tests/test_parser.py::test_options_in_any_order`\n- `tests/test_parser.py::test_due_year_boundary`\n- `tests/test_parser.py::test_empty_title_no_crash`\n- `tests/test_parser.py::test_unicode_title`\n- `tests/test_parser.py::test_extra_whitespace`\n- `tests/test_parser.py::test_mixed_mentions_and_options`\n\n**Rollback**\nRevert test file; no production code change.\n\n**Observability**\nCI coverage report.\n\n**Dependencies**\n#5\n\n---\n\n## Issue #19: SQLite end-to-end integration tests\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/019-e2e-tests`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nWrite integration tests that exercise the full flow through `handle_message` with a real (tmp_path) SQLite database. Cover the main user stories: add a task, list it, move it, mark done, edit it, manage projects, and validate private project constraints.\n\n**Acceptance Criteria**\n- [ ] Each test uses a fresh DB via `tmp_path` fixture\n- [ ] Scenarios: add->list, add->move->board, add->done, add->edit, project set-private rejection\n- [ ] Private project visibility enforced end-to-end\n- [ ] Due normalisation verified in DB\n- [ ] All tests pass with `uv run pytest tests/test_e2e.py -v`\n\n**Tests**\n- `tests/test_e2e.py::test_add_and_list_roundtrip`\n- `tests/test_e2e.py::test_add_move_board`\n- `tests/test_e2e.py::test_done_and_drop`\n- `tests/test_e2e.py::test_edit_title_and_assignees`\n- `tests/test_e2e.py::test_private_project_isolation`\n- `tests/test_e2e.py::test_set_private_rejects_foreign_assignees`\n- `tests/test_e2e.py::test_due_normalisation_stored_correctly`\n\n**Rollback**\nRevert test file.\n\n**Observability**\nCI test results and coverage delta.\n\n**Dependencies**\n#6, #8, #9, #10, #11, #12, #14, #15\n\n---\n\n## Issue #20: Packaging and distribution setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | DevOps                                 |\n| Milestone   | M6                                     |\n| Status      | TODO                                   |\n| Priority    | P2                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/020-packaging`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nFinalise `pyproject.toml` metadata (name, version, description, license, entry-points), add a `Makefile` with targets for lint/test/build, and document installation instructions in README. Ensure the plugin can be installed as a package and discovered by the OpenClaw gateway.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` has complete metadata and entry-point for OpenClaw plugin discovery\n- [ ] `make lint` runs ruff + black --check\n- [ ] `make test` runs pytest with coverage\n- [ ] `make build` produces a wheel via `uv build`\n- [ ] `pip install <wheel>` in a clean venv makes the plugin importable\n- [ ] README documents installation and configuration (DB path env var)\n\n**Tests**\n- Manual: install wheel in fresh venv, import module, call `handle_message`\n- `make test` passes in CI\n\n**Rollback**\nRevert packaging changes.\n\n**Observability**\nBuild artifact size logged; CI publishes wheel as artifact.\n\n**Dependencies**\n#19\n\n---\n\n## Dependency Graph (summary)\n\n```\n#1  Plugin skeleton\n |\n +--#2  DB connection\n |   |\n |   +--#3  Migration framework\n |       |\n |       +--#4  V1 schema\n |           |\n |           +--#7  Project resolver\n |           |   |\n |           |   +--#13 project list\n |           |   +--#14 project set-private\n |           |   +--#15 project set-shared\n |           |\n |           +--#17 Permissions helper\n |\n +--#5  Parser\n |   |\n |   +--#18 Parser tests (M5)\n |\n +--#16 Dispatcher\n     |\n     +--#6  cmd add       (#4,#5,#7,#17)\n     +--#8  cmd list      (#6,#7)\n     +--#9  cmd board     (#8)\n     +--#10 cmd move      (#6,#7,#17)\n     +--#11 cmd done/drop (#10)\n     +--#12 cmd edit      (#6,#7,#10,#17)\n\n#19 E2E tests    (all commands)\n#20 Packaging    (#19)\n```\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "content": "# OpenClaw TODO Plugin -- Issues\n\n> Auto-generated from `openclaw_todo_plugin_prd.md` (PRD v1.1)\n> Date: 2026-02-20\n\n---\n\n## Issue #1: Plugin skeleton and entry point\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M0                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/001-plugin-skeleton`          |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load. The plugin must expose a callable that receives raw Slack DM text and a sender context dict.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n**Tests**\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n**Rollback**\nDelete branch; no runtime dependency.\n\n**Observability**\n`logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched.\n\n**Dependencies**\nNone.\n\n---\n\n## Issue #2: DB module -- connection helper and pragma setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/002-db-connection`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/db.py` with a `get_connection(db_path)` helper that creates the `~/.openclaw/workspace/.todo/` directory tree if missing, opens (or creates) `todo.sqlite3`, and applies `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000`.\n\n**Acceptance Criteria**\n- [ ] Directory is created recursively when absent\n- [ ] SQLite connection returned with WAL mode enabled\n- [ ] `busy_timeout` is 3000\n- [ ] Calling `get_connection` twice returns usable connections (no lock conflict)\n\n**Tests**\n- `tests/test_db.py::test_creates_directory_and_file` (tmp_path)\n- `tests/test_db.py::test_wal_mode_enabled`\n- `tests/test_db.py::test_busy_timeout`\n\n**Rollback**\nRevert module; no schema changes yet.\n\n**Observability**\n`logger.info` on first DB creation; `logger.debug` on each connection open.\n\n**Dependencies**\n#1\n\n---\n\n## Issue #3: Schema migration framework and schema_version table\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/003-schema-migration`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement a simple sequential migration runner. On startup, read `schema_version` (create if missing), compare to available migrations list, and apply outstanding migrations in order inside a transaction.\n\n**Acceptance Criteria**\n- [ ] `schema_version` table created with single row `version=0` if absent\n- [ ] Migrations are Python callables registered in an ordered list\n- [ ] Each migration runs inside a transaction; version incremented on success\n- [ ] Re-running on an up-to-date DB is a no-op\n- [ ] Failing migration rolls back and raises with clear message\n\n**Tests**\n- `tests/test_migrations.py::test_fresh_db_gets_version_table`\n- `tests/test_migrations.py::test_applies_migrations_sequentially`\n- `tests/test_migrations.py::test_idempotent_on_rerun`\n- `tests/test_migrations.py::test_rollback_on_failure`\n\n**Rollback**\nDrop `schema_version` table; revert module.\n\n**Observability**\n`logger.info(\"Migrating from version %d to %d\", current, target)` per step.\n\n**Dependencies**\n#2\n\n---\n\n## Issue #4: V1 schema migration -- projects, tasks, task_assignees, events\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/004-v1-schema`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nRegister migration v1 that creates the four tables (`projects`, `tasks`, `task_assignees`, `events`) with all columns, CHECK constraints, and partial unique indexes as specified in PRD section 6.3. Also seed shared project `Inbox`.\n\n**Acceptance Criteria**\n- [ ] `projects` table with `ux_projects_shared_name` and `ux_projects_private_owner_name` partial unique indexes\n- [ ] `tasks` table with section and status CHECK constraints\n- [ ] `task_assignees` table with composite PK and secondary index\n- [ ] `events` audit table created\n- [ ] Shared `Inbox` project auto-created (INSERT OR IGNORE)\n- [ ] `schema_version` = 1 after migration\n\n**Tests**\n- `tests/test_migrations.py::test_v1_tables_exist`\n- `tests/test_migrations.py::test_v1_inbox_created`\n- `tests/test_migrations.py::test_v1_shared_unique_index_enforced`\n- `tests/test_migrations.py::test_v1_private_unique_index_enforced`\n\n**Rollback**\nDrop all four tables + reset schema_version to 0.\n\n**Observability**\nLog table creation counts.\n\n**Dependencies**\n#3\n\n---\n\n## Issue #5: Command parser -- tokenizer and option extraction\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M2                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/005-parser-tokenizer`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/parser.py` that takes raw message text (after `/todo` prefix) and returns a `ParsedCommand` dataclass containing: `command` (str), `args` (list), `project` (str|None), `section` (str|None), `due` (str|None, normalised to YYYY-MM-DD), `mentions` (list of Slack user IDs), and remaining `title_tokens`.\n\nParsing rules:\n- `/p <name>` extracts project\n- `/s <section>` extracts section (validate against enum)\n- `due:YYYY-MM-DD` or `due:MM-DD` extracts and normalises due date\n- `due:-` clears due (sentinel)\n- `<@U...>` patterns extracted as mentions\n- Everything else before first option token is title\n\n**Acceptance Criteria**\n- [ ] `/p MyProject` correctly extracted; token consumed\n- [ ] `/s doing` validated; invalid section raises `ParseError`\n- [ ] `due:03-15` normalised to `2026-03-15`\n- [ ] `due:2026-02-30` raises `ParseError` (invalid date)\n- [ ] `<@U12345>` extracted into mentions list\n- [ ] Multiple mentions supported\n- [ ] Title tokens are non-option, non-mention tokens before first option\n\n**Tests**\n- `tests/test_parser.py::test_extract_project`\n- `tests/test_parser.py::test_extract_section_valid`\n- `tests/test_parser.py::test_extract_section_invalid`\n- `tests/test_parser.py::test_due_mm_dd_normalisation`\n- `tests/test_parser.py::test_due_full_date`\n- `tests/test_parser.py::test_due_invalid_date`\n- `tests/test_parser.py::test_due_clear`\n- `tests/test_parser.py::test_mentions_extraction`\n- `tests/test_parser.py::test_title_extraction`\n\n**Rollback**\nRevert module; no side effects.\n\n**Observability**\n`logger.debug(\"Parsed: %s\", parsed_command)`\n\n**Dependencies**\n#1\n\n---\n\n## Issue #6: /todo add command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/006-cmd-add`                  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `add` subcommand handler. Resolves project (default `Inbox`), applies defaults (section=`backlog`, assignees=sender if none mentioned), validates private-project assignee constraint (PRD 3.3), inserts task + task_assignees rows, logs event, and returns formatted confirmation.\n\n**Acceptance Criteria**\n- [ ] Task inserted with correct project_id, section, due, status='open', created_by\n- [ ] Assignees default to sender when no mentions\n- [ ] Multiple mentions create multiple task_assignee rows\n- [ ] Private project + non-owner assignee returns warning and does NOT insert\n- [ ] Non-existent project: `Inbox` auto-created as shared; others return error\n- [ ] Response format: `Added #<id> (<project>/<section>) due:<due|-> assignees:<mentions> -- <title>`\n- [ ] Event row written to `events` table\n\n**Tests**\n- `tests/test_cmd_add.py::test_add_default_inbox`\n- `tests/test_cmd_add.py::test_add_with_project_section_due`\n- `tests/test_cmd_add.py::test_add_private_rejects_other_assignee`\n- `tests/test_cmd_add.py::test_add_assignee_defaults_to_sender`\n- `tests/test_cmd_add.py::test_add_multiple_assignees`\n\n**Rollback**\nRevert handler; tasks table unchanged structurally.\n\n**Observability**\n`logger.info(\"Task #%d created in %s/%s by %s\", id, project, section, sender)`\n\n**Dependencies**\n#4, #5\n\n---\n\n## Issue #7: Project resolver helper\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/007-project-resolver`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `resolve_project(conn, name, sender_id) -> Project` following PRD 3.2 (Option A): sender's private project with that name takes priority, then shared, then error/auto-create for Inbox.\n\n**Acceptance Criteria**\n- [ ] Private project of sender matched first\n- [ ] Falls back to shared if no private match\n- [ ] Returns error when neither exists (except Inbox which is auto-created)\n- [ ] Returns project row with id, name, visibility, owner_user_id\n\n**Tests**\n- `tests/test_project_resolver.py::test_private_takes_priority`\n- `tests/test_project_resolver.py::test_falls_back_to_shared`\n- `tests/test_project_resolver.py::test_inbox_auto_created`\n- `tests/test_project_resolver.py::test_unknown_project_error`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Resolved project '%s' -> id=%d vis=%s\", name, id, visibility)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #8: /todo list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/008-cmd-list`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `list` subcommand. Supports scope (mine/all/<@USER>), project filter, section filter, status filter (open/done/drop), and limit. Sorting: due ASC (NULLs last), then id DESC. Excludes other users' private projects.\n\n**Acceptance Criteria**\n- [ ] Default scope=mine, status=open, limit=30\n- [ ] `mine` filters to tasks where sender is an assignee\n- [ ] `all` includes shared + sender's private (excludes others' private)\n- [ ] `/p` and `/s` filters applied correctly\n- [ ] Sorting: due NOT NULL first, due ASC, id DESC\n- [ ] limit:N respected\n- [ ] Output lists tasks in formatted lines\n\n**Tests**\n- `tests/test_cmd_list.py::test_list_mine_default`\n- `tests/test_cmd_list.py::test_list_all_excludes_others_private`\n- `tests/test_cmd_list.py::test_list_with_project_filter`\n- `tests/test_cmd_list.py::test_list_sorting_order`\n- `tests/test_cmd_list.py::test_list_limit`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"list: scope=%s project=%s returned %d rows\", scope, project, count)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #9: /todo board command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/009-cmd-board`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `board` subcommand. Groups tasks by section in fixed order (BACKLOG, DOING, WAITING, DONE, DROP), applies scope/project/status filters, and limits per section. Format: section headers with task lines underneath.\n\n**Acceptance Criteria**\n- [ ] Sections displayed in order: BACKLOG -> DOING -> WAITING -> DONE -> DROP\n- [ ] Empty sections shown with \"(empty)\" or omitted (decide and document)\n- [ ] `limitPerSection:N` caps items per section (default 10)\n- [ ] Scope/project filters identical to `list`\n- [ ] Each task line: `#id due:<date|-> assignees:<@U..> title`\n\n**Tests**\n- `tests/test_cmd_board.py::test_board_section_order`\n- `tests/test_cmd_board.py::test_board_limit_per_section`\n- `tests/test_cmd_board.py::test_board_scope_filter`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"board: scope=%s project=%s sections=%s\", ...)`\n\n**Dependencies**\n#8\n\n---\n\n## Issue #10: /todo move command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/010-cmd-move`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `move` subcommand. Validates section enum, checks permissions (private: owner only; shared: assignee or created_by), updates task section and updated_at, logs event.\n\n**Acceptance Criteria**\n- [ ] Section validated against enum; invalid returns error\n- [ ] Private project: only owner can move\n- [ ] Shared project: only assignee or created_by can move\n- [ ] `updated_at` set on change\n- [ ] Event logged\n- [ ] Response confirms new section\n\n**Tests**\n- `tests/test_cmd_move.py::test_move_valid_section`\n- `tests/test_cmd_move.py::test_move_invalid_section`\n- `tests/test_cmd_move.py::test_move_private_owner_only`\n- `tests/test_cmd_move.py::test_move_shared_permission`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d moved to %s by %s\", id, section, sender)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #11: /todo done and /todo drop commands\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/011-cmd-done-drop`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `done` and `drop` subcommands. Both set section and status accordingly, record `closed_at`, validate permissions same as `move`, and log event.\n\n**Acceptance Criteria**\n- [ ] `done`: section='done', status='done', closed_at=now\n- [ ] `drop`: section='drop', status='dropped', closed_at=now\n- [ ] Permissions enforced (same as move)\n- [ ] Already-closed task returns informational message (idempotent or error -- decide)\n- [ ] Event logged for each\n\n**Tests**\n- `tests/test_cmd_done_drop.py::test_done_sets_fields`\n- `tests/test_cmd_done_drop.py::test_drop_sets_fields`\n- `tests/test_cmd_done_drop.py::test_permission_check`\n- `tests/test_cmd_done_drop.py::test_already_done`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d %s by %s\", id, action, sender)`\n\n**Dependencies**\n#10\n\n---\n\n## Issue #12: /todo edit command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/012-cmd-edit`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `edit` subcommand (v1 replace semantics). Supports changing title, assignees (full replace), project, section, and due. Validates private-project assignee constraint on both source and target project. Logs event with old/new diff in payload.\n\n**Acceptance Criteria**\n- [ ] Title updated only if non-option tokens present\n- [ ] Mentions present -> assignees fully replaced (DELETE + INSERT)\n- [ ] `due:-` clears due to NULL\n- [ ] `/p <newProject>` moves task to new project (project_id updated)\n- [ ] Private project assignee validation applied to target project\n- [ ] If moving to private project with non-owner assignees -> warning, no change\n- [ ] Event payload contains changed fields\n- [ ] Permissions: private owner only; shared assignee/created_by\n\n**Tests**\n- `tests/test_cmd_edit.py::test_edit_title`\n- `tests/test_cmd_edit.py::test_edit_assignees_replace`\n- `tests/test_cmd_edit.py::test_edit_due_clear`\n- `tests/test_cmd_edit.py::test_edit_move_project`\n- `tests/test_cmd_edit.py::test_edit_private_assignee_rejected`\n- `tests/test_cmd_edit.py::test_edit_no_change_fields`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d edited by %s: fields=%s\", id, sender, changed_fields)`\n\n**Dependencies**\n#6, #7, #10\n\n---\n\n## Issue #13: /todo project list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/013-cmd-project-list`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project list`. Returns all shared projects and the sender's private projects. Format: grouped by visibility with name and task count.\n\n**Acceptance Criteria**\n- [ ] Shared projects listed regardless of sender\n- [ ] Sender's private projects listed\n- [ ] Other users' private projects NOT shown\n- [ ] Each project shows name, visibility, task count\n\n**Tests**\n- `tests/test_cmd_project.py::test_project_list_shows_shared`\n- `tests/test_cmd_project.py::test_project_list_shows_own_private`\n- `tests/test_cmd_project.py::test_project_list_hides_others_private`\n\n**Rollback**\nRevert handler; read-only.\n\n**Observability**\n`logger.info(\"project list: %d shared, %d private for %s\", ...)`\n\n**Dependencies**\n#7\n\n---\n\n## Issue #14: /todo project set-private command with assignee validation\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/014-cmd-project-set-private`  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-private <name>` with the assignee validation described in PRD 3.4. Resolution flow: if sender already has private with that name -> noop; if shared exists -> attempt conversion; if neither -> create new private. Conversion scans all tasks in the project and rejects if any task has a non-owner assignee.\n\n**Acceptance Criteria**\n- [ ] Already-private for sender: returns \"already private\" message\n- [ ] Shared -> private: scans tasks; all assignees are owner -> success (visibility='private', owner_user_id=sender)\n- [ ] Shared -> private: at least one non-owner assignee -> error with task IDs and violating assignee list (max 10)\n- [ ] Neither exists: creates new private project with owner=sender\n- [ ] Error message format matches PRD example\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_private_already_private`\n- `tests/test_cmd_project.py::test_set_private_shared_success`\n- `tests/test_cmd_project.py::test_set_private_shared_rejected_non_owner_assignee`\n- `tests/test_cmd_project.py::test_set_private_creates_new`\n- `tests/test_cmd_project.py::test_set_private_error_message_format`\n\n**Rollback**\nRevert handler; no schema change.\n\n**Observability**\n`logger.info(\"project set-private: %s result=%s by %s\", name, result, sender)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #15: /todo project set-shared command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/015-cmd-project-set-shared`   |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-shared <name>`. Creates a shared project if none exists. If a shared project with that name already exists, noop. Global uniqueness enforced by DB index.\n\n**Acceptance Criteria**\n- [ ] New shared project created when name is free\n- [ ] Existing shared project: returns \"already shared\" / noop\n- [ ] Name conflict with existing shared: returns exists message (index enforces)\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_shared_creates_new`\n- `tests/test_cmd_project.py::test_set_shared_already_exists_noop`\n- `tests/test_cmd_project.py::test_set_shared_name_conflict`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"project set-shared: %s result=%s\", name, result)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #16: Command dispatcher and routing\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/016-dispatcher`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the dispatcher in `plugin.py` that maps the parsed command name to handler functions: `add`, `list`, `board`, `move`, `done`, `drop`, `edit`, `project`. The `project` command further dispatches to `list`, `set-private`, `set-shared`. Unknown commands return a help/error message.\n\n**Acceptance Criteria**\n- [ ] All valid command names routed to correct handler\n- [ ] `project` subcommands routed correctly\n- [ ] Unknown command returns usage hint\n- [ ] DB connection initialised (migration check) before first command execution\n\n**Tests**\n- `tests/test_dispatcher.py::test_routes_known_commands`\n- `tests/test_dispatcher.py::test_project_sub_routing`\n- `tests/test_dispatcher.py::test_unknown_command_help`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.info(\"Dispatching command=%s sub=%s\", command, sub)`\n\n**Dependencies**\n#5\n\n---\n\n## Issue #17: Permission helper module\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/017-permissions`              |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExtract shared permission-checking logic into `src/openclaw_todo/permissions.py`. Provides `can_write_task(conn, task_id, sender_id) -> bool` and `validate_private_assignees(project, assignees, owner_id) -> Optional[str]` (returns warning message or None).\n\n**Acceptance Criteria**\n- [ ] Private project: only owner can write\n- [ ] Shared project: only assignee or created_by can write\n- [ ] `validate_private_assignees` returns warning string when non-owner assignees present for private project\n- [ ] Returns None for shared projects or when all assignees are owner\n\n**Tests**\n- `tests/test_permissions.py::test_private_owner_can_write`\n- `tests/test_permissions.py::test_private_non_owner_rejected`\n- `tests/test_permissions.py::test_shared_assignee_can_write`\n- `tests/test_permissions.py::test_shared_creator_can_write`\n- `tests/test_permissions.py::test_validate_private_assignees_warning`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Permission check: task=%d sender=%s result=%s\", ...)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #18: Parser unit tests (comprehensive)\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/018-parser-tests`             |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExpand parser test coverage to include edge cases: multiple options in varied order, due at year boundary, empty title, mentions mixed with options, unicode in titles, extra whitespace handling.\n\n**Acceptance Criteria**\n- [ ] >=95% line coverage on `parser.py`\n- [ ] Edge cases documented in test docstrings\n- [ ] All tests pass with `uv run pytest tests/test_parser.py -v`\n\n**Tests**\n- `tests/test_parser.py::test_options_in_any_order`\n- `tests/test_parser.py::test_due_year_boundary`\n- `tests/test_parser.py::test_empty_title_no_crash`\n- `tests/test_parser.py::test_unicode_title`\n- `tests/test_parser.py::test_extra_whitespace`\n- `tests/test_parser.py::test_mixed_mentions_and_options`\n\n**Rollback**\nRevert test file; no production code change.\n\n**Observability**\nCI coverage report.\n\n**Dependencies**\n#5\n\n---\n\n## Issue #19: SQLite end-to-end integration tests\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/019-e2e-tests`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nWrite integration tests that exercise the full flow through `handle_message` with a real (tmp_path) SQLite database. Cover the main user stories: add a task, list it, move it, mark done, edit it, manage projects, and validate private project constraints.\n\n**Acceptance Criteria**\n- [ ] Each test uses a fresh DB via `tmp_path` fixture\n- [ ] Scenarios: add->list, add->move->board, add->done, add->edit, project set-private rejection\n- [ ] Private project visibility enforced end-to-end\n- [ ] Due normalisation verified in DB\n- [ ] All tests pass with `uv run pytest tests/test_e2e.py -v`\n\n**Tests**\n- `tests/test_e2e.py::test_add_and_list_roundtrip`\n- `tests/test_e2e.py::test_add_move_board`\n- `tests/test_e2e.py::test_done_and_drop`\n- `tests/test_e2e.py::test_edit_title_and_assignees`\n- `tests/test_e2e.py::test_private_project_isolation`\n- `tests/test_e2e.py::test_set_private_rejects_foreign_assignees`\n- `tests/test_e2e.py::test_due_normalisation_stored_correctly`\n\n**Rollback**\nRevert test file.\n\n**Observability**\nCI test results and coverage delta.\n\n**Dependencies**\n#6, #8, #9, #10, #11, #12, #14, #15\n\n---\n\n## Issue #20: Packaging and distribution setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | DevOps                                 |\n| Milestone   | M6                                     |\n| Status      | TODO                                   |\n| Priority    | P2                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/020-packaging`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nFinalise `pyproject.toml` metadata (name, version, description, license, entry-points), add a `Makefile` with targets for lint/test/build, and document installation instructions in README. Ensure the plugin can be installed as a package and discovered by the OpenClaw gateway.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` has complete metadata and entry-point for OpenClaw plugin discovery\n- [ ] `make lint` runs ruff + black --check\n- [ ] `make test` runs pytest with coverage\n- [ ] `make build` produces a wheel via `uv build`\n- [ ] `pip install <wheel>` in a clean venv makes the plugin importable\n- [ ] README documents installation and configuration (DB path env var)\n\n**Tests**\n- Manual: install wheel in fresh venv, import module, call `handle_message`\n- `make test` passes in CI\n\n**Rollback**\nRevert packaging changes.\n\n**Observability**\nBuild artifact size logged; CI publishes wheel as artifact.\n\n**Dependencies**\n#19\n\n---\n\n## Dependency Graph (summary)\n\n```\n#1  Plugin skeleton\n |\n +--#2  DB connection\n |   |\n |   +--#3  Migration framework\n |       |\n |       +--#4  V1 schema\n |           |\n |           +--#7  Project resolver\n |           |   |\n |           |   +--#13 project list\n |           |   +--#14 project set-private\n |           |   +--#15 project set-shared\n |           |\n |           +--#17 Permissions helper\n |\n +--#5  Parser\n |   |\n |   +--#18 Parser tests (M5)\n |\n +--#16 Dispatcher\n     |\n     +--#6  cmd add       (#4,#5,#7,#17)\n     +--#8  cmd list      (#6,#7)\n     +--#9  cmd board     (#8)\n     +--#10 cmd move      (#6,#7,#17)\n     +--#11 cmd done/drop (#10)\n     +--#12 cmd edit      (#6,#7,#10,#17)\n\n#19 E2E tests    (all commands)\n#20 Packaging    (#19)\n```\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01GX5wGMA8Kjz7rK3knMWd4V", "_ts": "2026-02-20T11:34:16+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a5b42a7", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a5b42a7.jsonl", "agent_type": "planner", "_ts": "2026-02-20T11:34:30+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/README.md", "content": "# OpenClaw TODO Plugin\n\nSlack DM-based team/personal TODO system — an OpenClaw plugin.\n\n## Prerequisites\n\n- Python 3.11+\n- [uv](https://docs.astral.sh/uv/) package manager\n\n## Setup\n\n```bash\n# Clone and initialize\ngit clone <repo-url>\ncd openclaw_todo_plugin\n\n# Install dependencies\nuv sync\n```\n\n## Run\n\nThe plugin runs within the OpenClaw Gateway. It registers a `/todo` command handler that processes messages in Slack DMs.\n\n```bash\n# Start via OpenClaw Gateway (details TBD based on Gateway docs)\nuv run openclaw-gateway\n```\n\n### DB Location\n\nThe SQLite database is automatically created at:\n```\n~/.openclaw/workspace/.todo/todo.sqlite3\n```\n\n## Test\n\n```bash\n# Run all tests\nuv run pytest -q\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=term-missing\n\n# Run smoke tests only\nuv run pytest -m smoke -q\n```\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| `/todo add <title> [@user] [/p project] [/s section] [due:date]` | Create a task |\n| `/todo list [mine\\|all\\|@user] [/p project] [/s section]` | List tasks |\n| `/todo board [mine\\|all\\|@user] [/p project]` | Kanban board view |\n| `/todo move <id> <section>` | Move task to section |\n| `/todo done <id>` | Mark task done |\n| `/todo drop <id>` | Drop a task |\n| `/todo edit <id> [new title] [@user] [/p project] [/s section] [due:date]` | Edit a task |\n| `/todo project list` | List projects |\n| `/todo project set-private <name>` | Make project private |\n| `/todo project set-shared <name>` | Make project shared |\n\n## Project Structure\n\n```\nopenclaw_todo_plugin/\n├── src/\n│   └── openclaw_todo_plugin/\n│       ├── __init__.py          # Plugin entry point\n│       ├── commands/            # Command handlers\n│       ├── db/                  # Connection + migrations\n│       ├── repositories/        # SQL data access\n│       ├── services/            # Business logic + permissions\n│       ├── parser.py            # Input tokenizer/parser\n│       ├── formatter.py         # Response formatting\n│       └── errors.py            # Custom exceptions\n├── tests/\n├── docs/\n├── issues.md\n├── pyproject.toml\n└── STATUS.md\n```\n\n## Documentation\n\n- [Requirements](requirements.md)\n- [UX Specification](ux_spec.md)\n- [Architecture](architecture.md)\n- [Test Plan](test_plan.md)\n- [Issues / Task Breakdown](../issues.md)\n"}, "tool_use_id": "toolu_01LPyjLbF81jSKrQHCrxP5xJ", "_ts": "2026-02-20T11:34:47+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/README.md", "content": "# OpenClaw TODO Plugin\n\nSlack DM-based team/personal TODO system — an OpenClaw plugin.\n\n## Prerequisites\n\n- Python 3.11+\n- [uv](https://docs.astral.sh/uv/) package manager\n\n## Setup\n\n```bash\n# Clone and initialize\ngit clone <repo-url>\ncd openclaw_todo_plugin\n\n# Install dependencies\nuv sync\n```\n\n## Run\n\nThe plugin runs within the OpenClaw Gateway. It registers a `/todo` command handler that processes messages in Slack DMs.\n\n```bash\n# Start via OpenClaw Gateway (details TBD based on Gateway docs)\nuv run openclaw-gateway\n```\n\n### DB Location\n\nThe SQLite database is automatically created at:\n```\n~/.openclaw/workspace/.todo/todo.sqlite3\n```\n\n## Test\n\n```bash\n# Run all tests\nuv run pytest -q\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=term-missing\n\n# Run smoke tests only\nuv run pytest -m smoke -q\n```\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| `/todo add <title> [@user] [/p project] [/s section] [due:date]` | Create a task |\n| `/todo list [mine\\|all\\|@user] [/p project] [/s section]` | List tasks |\n| `/todo board [mine\\|all\\|@user] [/p project]` | Kanban board view |\n| `/todo move <id> <section>` | Move task to section |\n| `/todo done <id>` | Mark task done |\n| `/todo drop <id>` | Drop a task |\n| `/todo edit <id> [new title] [@user] [/p project] [/s section] [due:date]` | Edit a task |\n| `/todo project list` | List projects |\n| `/todo project set-private <name>` | Make project private |\n| `/todo project set-shared <name>` | Make project shared |\n\n## Project Structure\n\n```\nopenclaw_todo_plugin/\n├── src/\n│   └── openclaw_todo_plugin/\n│       ├── __init__.py          # Plugin entry point\n│       ├── commands/            # Command handlers\n│       ├── db/                  # Connection + migrations\n│       ├── repositories/        # SQL data access\n│       ├── services/            # Business logic + permissions\n│       ├── parser.py            # Input tokenizer/parser\n│       ├── formatter.py         # Response formatting\n│       └── errors.py            # Custom exceptions\n├── tests/\n├── docs/\n├── issues.md\n├── pyproject.toml\n└── STATUS.md\n```\n\n## Documentation\n\n- [Requirements](requirements.md)\n- [UX Specification](ux_spec.md)\n- [Architecture](architecture.md)\n- [Test Plan](test_plan.md)\n- [Issues / Task Breakdown](../issues.md)\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/docs/README.md", "content": "# OpenClaw TODO Plugin\n\nSlack DM-based team/personal TODO system — an OpenClaw plugin.\n\n## Prerequisites\n\n- Python 3.11+\n- [uv](https://docs.astral.sh/uv/) package manager\n\n## Setup\n\n```bash\n# Clone and initialize\ngit clone <repo-url>\ncd openclaw_todo_plugin\n\n# Install dependencies\nuv sync\n```\n\n## Run\n\nThe plugin runs within the OpenClaw Gateway. It registers a `/todo` command handler that processes messages in Slack DMs.\n\n```bash\n# Start via OpenClaw Gateway (details TBD based on Gateway docs)\nuv run openclaw-gateway\n```\n\n### DB Location\n\nThe SQLite database is automatically created at:\n```\n~/.openclaw/workspace/.todo/todo.sqlite3\n```\n\n## Test\n\n```bash\n# Run all tests\nuv run pytest -q\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=term-missing\n\n# Run smoke tests only\nuv run pytest -m smoke -q\n```\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| `/todo add <title> [@user] [/p project] [/s section] [due:date]` | Create a task |\n| `/todo list [mine\\|all\\|@user] [/p project] [/s section]` | List tasks |\n| `/todo board [mine\\|all\\|@user] [/p project]` | Kanban board view |\n| `/todo move <id> <section>` | Move task to section |\n| `/todo done <id>` | Mark task done |\n| `/todo drop <id>` | Drop a task |\n| `/todo edit <id> [new title] [@user] [/p project] [/s section] [due:date]` | Edit a task |\n| `/todo project list` | List projects |\n| `/todo project set-private <name>` | Make project private |\n| `/todo project set-shared <name>` | Make project shared |\n\n## Project Structure\n\n```\nopenclaw_todo_plugin/\n├── src/\n│   └── openclaw_todo_plugin/\n│       ├── __init__.py          # Plugin entry point\n│       ├── commands/            # Command handlers\n│       ├── db/                  # Connection + migrations\n│       ├── repositories/        # SQL data access\n│       ├── services/            # Business logic + permissions\n│       ├── parser.py            # Input tokenizer/parser\n│       ├── formatter.py         # Response formatting\n│       └── errors.py            # Custom exceptions\n├── tests/\n├── docs/\n├── issues.md\n├── pyproject.toml\n└── STATUS.md\n```\n\n## Documentation\n\n- [Requirements](requirements.md)\n- [UX Specification](ux_spec.md)\n- [Architecture](architecture.md)\n- [Test Plan](test_plan.md)\n- [Issues / Task Breakdown](../issues.md)\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01LPyjLbF81jSKrQHCrxP5xJ", "_ts": "2026-02-20T11:34:47+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md", "content": "# Project Status — OpenClaw TODO Plugin\n\n**Last updated:** 2026-02-20\n\n## Current Phase\n\n**Kickoff complete** — All planning documents generated. Ready to begin implementation.\n\n## Milestones\n\n| Milestone | Description | Status | Issues |\n|-----------|-------------|--------|--------|\n| M0 | Plugin skeleton + `/todo` command registration | Not started | #1 |\n| M1 | DB init + migrations + schema_version | Not started | #2, #3, #4 |\n| M2 | Parser (Slack mention, /p, /s, due correction) | Not started | #5 |\n| M3 | Commands (add/list/board/move/done/drop/edit) | Not started | #6–#12, #16, #17 |\n| M4 | Project commands (list/set-private/set-shared) | Not started | #13, #14, #15 |\n| M5 | Tests (parser/unit + sqlite E2E) | Not started | #18, #19 |\n| M6 | Packaging / deployment | Not started | #20 |\n\n## Critical Path\n\n```\n#1 (skeleton) → #2 (DB conn) → #3 (migration framework) → #4 (V1 schema) → #7 (project resolver) → commands\n#5 (parser) can be developed in parallel with DB track\n```\n\n## Next Issues to Work On\n\n1. **#1** — Plugin skeleton and project scaffold (M0)\n2. **#2** — DB connection manager with WAL + busy_timeout (M1)\n3. **#5** — Command parser / tokenizer (M2, parallelizable)\n\n## Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|-----------|--------|------------|\n| SQLite write contention under concurrent access | Low | Medium | WAL mode + busy_timeout=3000 |\n| Private/shared name collision user confusion | Medium | Low | Option A (private-first) + guidance |\n| Schema migration failures on upgrade | Low | High | schema_version table + sequential migrations |\n| Slack rate limits on heavy usage | Low | Low | Responses are single messages per command |\n\n## Generated Documents\n\n- [x] `docs/requirements.md` — Functional & non-functional requirements\n- [x] `docs/ux_spec.md` — UX specification with all command flows\n- [x] `docs/architecture.md` — Software architecture design\n- [x] `docs/test_plan.md` — Test strategy with 80+ test cases\n- [x] `issues.md` — 20 issues across 7 milestones\n"}, "tool_use_id": "toolu_01An3HYvNqqDh27rGGbfUGuc", "_ts": "2026-02-20T11:34:58+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md", "content": "# Project Status — OpenClaw TODO Plugin\n\n**Last updated:** 2026-02-20\n\n## Current Phase\n\n**Kickoff complete** — All planning documents generated. Ready to begin implementation.\n\n## Milestones\n\n| Milestone | Description | Status | Issues |\n|-----------|-------------|--------|--------|\n| M0 | Plugin skeleton + `/todo` command registration | Not started | #1 |\n| M1 | DB init + migrations + schema_version | Not started | #2, #3, #4 |\n| M2 | Parser (Slack mention, /p, /s, due correction) | Not started | #5 |\n| M3 | Commands (add/list/board/move/done/drop/edit) | Not started | #6–#12, #16, #17 |\n| M4 | Project commands (list/set-private/set-shared) | Not started | #13, #14, #15 |\n| M5 | Tests (parser/unit + sqlite E2E) | Not started | #18, #19 |\n| M6 | Packaging / deployment | Not started | #20 |\n\n## Critical Path\n\n```\n#1 (skeleton) → #2 (DB conn) → #3 (migration framework) → #4 (V1 schema) → #7 (project resolver) → commands\n#5 (parser) can be developed in parallel with DB track\n```\n\n## Next Issues to Work On\n\n1. **#1** — Plugin skeleton and project scaffold (M0)\n2. **#2** — DB connection manager with WAL + busy_timeout (M1)\n3. **#5** — Command parser / tokenizer (M2, parallelizable)\n\n## Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|-----------|--------|------------|\n| SQLite write contention under concurrent access | Low | Medium | WAL mode + busy_timeout=3000 |\n| Private/shared name collision user confusion | Medium | Low | Option A (private-first) + guidance |\n| Schema migration failures on upgrade | Low | High | schema_version table + sequential migrations |\n| Slack rate limits on heavy usage | Low | Low | Responses are single messages per command |\n\n## Generated Documents\n\n- [x] `docs/requirements.md` — Functional & non-functional requirements\n- [x] `docs/ux_spec.md` — UX specification with all command flows\n- [x] `docs/architecture.md` — Software architecture design\n- [x] `docs/test_plan.md` — Test strategy with 80+ test cases\n- [x] `issues.md` — 20 issues across 7 milestones\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md", "content": "# Project Status — OpenClaw TODO Plugin\n\n**Last updated:** 2026-02-20\n\n## Current Phase\n\n**Kickoff complete** — All planning documents generated. Ready to begin implementation.\n\n## Milestones\n\n| Milestone | Description | Status | Issues |\n|-----------|-------------|--------|--------|\n| M0 | Plugin skeleton + `/todo` command registration | Not started | #1 |\n| M1 | DB init + migrations + schema_version | Not started | #2, #3, #4 |\n| M2 | Parser (Slack mention, /p, /s, due correction) | Not started | #5 |\n| M3 | Commands (add/list/board/move/done/drop/edit) | Not started | #6–#12, #16, #17 |\n| M4 | Project commands (list/set-private/set-shared) | Not started | #13, #14, #15 |\n| M5 | Tests (parser/unit + sqlite E2E) | Not started | #18, #19 |\n| M6 | Packaging / deployment | Not started | #20 |\n\n## Critical Path\n\n```\n#1 (skeleton) → #2 (DB conn) → #3 (migration framework) → #4 (V1 schema) → #7 (project resolver) → commands\n#5 (parser) can be developed in parallel with DB track\n```\n\n## Next Issues to Work On\n\n1. **#1** — Plugin skeleton and project scaffold (M0)\n2. **#2** — DB connection manager with WAL + busy_timeout (M1)\n3. **#5** — Command parser / tokenizer (M2, parallelizable)\n\n## Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|-----------|--------|------------|\n| SQLite write contention under concurrent access | Low | Medium | WAL mode + busy_timeout=3000 |\n| Private/shared name collision user confusion | Medium | Low | Option A (private-first) + guidance |\n| Schema migration failures on upgrade | Low | High | schema_version table + sequential migrations |\n| Slack rate limits on heavy usage | Low | Low | Responses are single messages per command |\n\n## Generated Documents\n\n- [x] `docs/requirements.md` — Functional & non-functional requirements\n- [x] `docs/ux_spec.md` — UX specification with all command flows\n- [x] `docs/architecture.md` — Software architecture design\n- [x] `docs/test_plan.md` — Test strategy with 80+ test cases\n- [x] `issues.md` — 20 issues across 7 milestones\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01An3HYvNqqDh27rGGbfUGuc", "_ts": "2026-02-20T11:34:58+0900"}
{"session_id": "2bafd63c-35dc-4008-a792-8a4e0d4b08b4", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "acceptEdits", "hook_event_name": "SubagentStop", "stop_hook_active": false, "agent_id": "a7a5fbf", "agent_transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/2bafd63c-35dc-4008-a792-8a4e0d4b08b4/subagents/agent-a7a5fbf.jsonl", "agent_type": "", "_ts": "2026-02-20T11:35:07+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md"}, "tool_use_id": "toolu_015HznGKsc2w7N3dtaDxuu9C", "_ts": "2026-02-20T11:57:58+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "content": "# OpenClaw TODO Plugin -- Issues\n\n> Auto-generated from `openclaw_todo_plugin_prd.md` (PRD v1.1)\n> Date: 2026-02-20\n\n---\n\n## Issue #1: Plugin skeleton and entry point\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M0                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/001-plugin-skeleton`          |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load. The plugin must expose a callable that receives raw Slack DM text and a sender context dict.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n**Tests**\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n**Rollback**\nDelete branch; no runtime dependency.\n\n**Observability**\n`logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched.\n\n**Dependencies**\nNone.\n\n---\n\n## Issue #2: DB module -- connection helper and pragma setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/002-db-connection`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/db.py` with a `get_connection(db_path)` helper that creates the `~/.openclaw/workspace/.todo/` directory tree if missing, opens (or creates) `todo.sqlite3`, and applies `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000`.\n\n**Acceptance Criteria**\n- [ ] Directory is created recursively when absent\n- [ ] SQLite connection returned with WAL mode enabled\n- [ ] `busy_timeout` is 3000\n- [ ] Calling `get_connection` twice returns usable connections (no lock conflict)\n\n**Tests**\n- `tests/test_db.py::test_creates_directory_and_file` (tmp_path)\n- `tests/test_db.py::test_wal_mode_enabled`\n- `tests/test_db.py::test_busy_timeout`\n\n**Rollback**\nRevert module; no schema changes yet.\n\n**Observability**\n`logger.info` on first DB creation; `logger.debug` on each connection open.\n\n**Dependencies**\n#1\n\n---\n\n## Issue #3: Schema migration framework and schema_version table\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/003-schema-migration`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement a simple sequential migration runner. On startup, read `schema_version` (create if missing), compare to available migrations list, and apply outstanding migrations in order inside a transaction.\n\n**Acceptance Criteria**\n- [ ] `schema_version` table created with single row `version=0` if absent\n- [ ] Migrations are Python callables registered in an ordered list\n- [ ] Each migration runs inside a transaction; version incremented on success\n- [ ] Re-running on an up-to-date DB is a no-op\n- [ ] Failing migration rolls back and raises with clear message\n\n**Tests**\n- `tests/test_migrations.py::test_fresh_db_gets_version_table`\n- `tests/test_migrations.py::test_applies_migrations_sequentially`\n- `tests/test_migrations.py::test_idempotent_on_rerun`\n- `tests/test_migrations.py::test_rollback_on_failure`\n\n**Rollback**\nDrop `schema_version` table; revert module.\n\n**Observability**\n`logger.info(\"Migrating from version %d to %d\", current, target)` per step.\n\n**Dependencies**\n#2\n\n---\n\n## Issue #4: V1 schema migration -- projects, tasks, task_assignees, events\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/004-v1-schema`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nRegister migration v1 that creates the four tables (`projects`, `tasks`, `task_assignees`, `events`) with all columns, CHECK constraints, and partial unique indexes as specified in PRD section 6.3. Also seed shared project `Inbox`.\n\n**Acceptance Criteria**\n- [ ] `projects` table with `ux_projects_shared_name` and `ux_projects_private_owner_name` partial unique indexes\n- [ ] `tasks` table with section and status CHECK constraints\n- [ ] `task_assignees` table with composite PK and secondary index\n- [ ] `events` audit table created\n- [ ] Shared `Inbox` project auto-created (INSERT OR IGNORE)\n- [ ] `schema_version` = 1 after migration\n\n**Tests**\n- `tests/test_migrations.py::test_v1_tables_exist`\n- `tests/test_migrations.py::test_v1_inbox_created`\n- `tests/test_migrations.py::test_v1_shared_unique_index_enforced`\n- `tests/test_migrations.py::test_v1_private_unique_index_enforced`\n\n**Rollback**\nDrop all four tables + reset schema_version to 0.\n\n**Observability**\nLog table creation counts.\n\n**Dependencies**\n#3\n\n---\n\n## Issue #5: Command parser -- tokenizer and option extraction\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M2                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/005-parser-tokenizer`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/parser.py` that takes raw message text (after `/todo` prefix) and returns a `ParsedCommand` dataclass containing: `command` (str), `args` (list), `project` (str|None), `section` (str|None), `due` (str|None, normalised to YYYY-MM-DD), `mentions` (list of Slack user IDs), and remaining `title_tokens`.\n\nParsing rules:\n- `/p <name>` extracts project\n- `/s <section>` extracts section (validate against enum)\n- `due:YYYY-MM-DD` or `due:MM-DD` extracts and normalises due date\n- `due:-` clears due (sentinel)\n- `<@U...>` patterns extracted as mentions\n- Everything else before first option token is title\n\n**Acceptance Criteria**\n- [ ] `/p MyProject` correctly extracted; token consumed\n- [ ] `/s doing` validated; invalid section raises `ParseError`\n- [ ] `due:03-15` normalised to `2026-03-15`\n- [ ] `due:2026-02-30` raises `ParseError` (invalid date)\n- [ ] `<@U12345>` extracted into mentions list\n- [ ] Multiple mentions supported\n- [ ] Title tokens are non-option, non-mention tokens before first option\n\n**Tests**\n- `tests/test_parser.py::test_extract_project`\n- `tests/test_parser.py::test_extract_section_valid`\n- `tests/test_parser.py::test_extract_section_invalid`\n- `tests/test_parser.py::test_due_mm_dd_normalisation`\n- `tests/test_parser.py::test_due_full_date`\n- `tests/test_parser.py::test_due_invalid_date`\n- `tests/test_parser.py::test_due_clear`\n- `tests/test_parser.py::test_mentions_extraction`\n- `tests/test_parser.py::test_title_extraction`\n\n**Rollback**\nRevert module; no side effects.\n\n**Observability**\n`logger.debug(\"Parsed: %s\", parsed_command)`\n\n**Dependencies**\n#1\n\n---\n\n## Issue #6: /todo add command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/006-cmd-add`                  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `add` subcommand handler. Resolves project (default `Inbox`), applies defaults (section=`backlog`, assignees=sender if none mentioned), validates private-project assignee constraint (PRD 3.3), inserts task + task_assignees rows, logs event, and returns formatted confirmation.\n\n**Acceptance Criteria**\n- [ ] Task inserted with correct project_id, section, due, status='open', created_by\n- [ ] Assignees default to sender when no mentions\n- [ ] Multiple mentions create multiple task_assignee rows\n- [ ] Private project + non-owner assignee returns warning and does NOT insert\n- [ ] Non-existent project: `Inbox` auto-created as shared; others return error\n- [ ] Response format: `Added #<id> (<project>/<section>) due:<due|-> assignees:<mentions> -- <title>`\n- [ ] Event row written to `events` table\n\n**Tests**\n- `tests/test_cmd_add.py::test_add_default_inbox`\n- `tests/test_cmd_add.py::test_add_with_project_section_due`\n- `tests/test_cmd_add.py::test_add_private_rejects_other_assignee`\n- `tests/test_cmd_add.py::test_add_assignee_defaults_to_sender`\n- `tests/test_cmd_add.py::test_add_multiple_assignees`\n\n**Rollback**\nRevert handler; tasks table unchanged structurally.\n\n**Observability**\n`logger.info(\"Task #%d created in %s/%s by %s\", id, project, section, sender)`\n\n**Dependencies**\n#4, #5\n\n---\n\n## Issue #7: Project resolver helper\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/007-project-resolver`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `resolve_project(conn, name, sender_id) -> Project` following PRD 3.2 (Option A): sender's private project with that name takes priority, then shared, then error/auto-create for Inbox.\n\n**Acceptance Criteria**\n- [ ] Private project of sender matched first\n- [ ] Falls back to shared if no private match\n- [ ] Returns error when neither exists (except Inbox which is auto-created)\n- [ ] Returns project row with id, name, visibility, owner_user_id\n\n**Tests**\n- `tests/test_project_resolver.py::test_private_takes_priority`\n- `tests/test_project_resolver.py::test_falls_back_to_shared`\n- `tests/test_project_resolver.py::test_inbox_auto_created`\n- `tests/test_project_resolver.py::test_unknown_project_error`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Resolved project '%s' -> id=%d vis=%s\", name, id, visibility)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #8: /todo list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/008-cmd-list`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `list` subcommand. Supports scope (mine/all/<@USER>), project filter, section filter, status filter (open/done/drop), and limit. Sorting: due ASC (NULLs last), then id DESC. Excludes other users' private projects.\n\n**Acceptance Criteria**\n- [ ] Default scope=mine, status=open, limit=30\n- [ ] `mine` filters to tasks where sender is an assignee\n- [ ] `all` includes shared + sender's private (excludes others' private)\n- [ ] `/p` and `/s` filters applied correctly\n- [ ] Sorting: due NOT NULL first, due ASC, id DESC\n- [ ] limit:N respected\n- [ ] Output lists tasks in formatted lines\n\n**Tests**\n- `tests/test_cmd_list.py::test_list_mine_default`\n- `tests/test_cmd_list.py::test_list_all_excludes_others_private`\n- `tests/test_cmd_list.py::test_list_with_project_filter`\n- `tests/test_cmd_list.py::test_list_sorting_order`\n- `tests/test_cmd_list.py::test_list_limit`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"list: scope=%s project=%s returned %d rows\", scope, project, count)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #9: /todo board command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/009-cmd-board`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `board` subcommand. Groups tasks by section in fixed order (BACKLOG, DOING, WAITING, DONE, DROP), applies scope/project/status filters, and limits per section. Format: section headers with task lines underneath.\n\n**Acceptance Criteria**\n- [ ] Sections displayed in order: BACKLOG -> DOING -> WAITING -> DONE -> DROP\n- [ ] Empty sections shown with \"(empty)\" or omitted (decide and document)\n- [ ] `limitPerSection:N` caps items per section (default 10)\n- [ ] Scope/project filters identical to `list`\n- [ ] Each task line: `#id due:<date|-> assignees:<@U..> title`\n\n**Tests**\n- `tests/test_cmd_board.py::test_board_section_order`\n- `tests/test_cmd_board.py::test_board_limit_per_section`\n- `tests/test_cmd_board.py::test_board_scope_filter`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"board: scope=%s project=%s sections=%s\", ...)`\n\n**Dependencies**\n#8\n\n---\n\n## Issue #10: /todo move command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/010-cmd-move`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `move` subcommand. Validates section enum, checks permissions (private: owner only; shared: assignee or created_by), updates task section and updated_at, logs event.\n\n**Acceptance Criteria**\n- [ ] Section validated against enum; invalid returns error\n- [ ] Private project: only owner can move\n- [ ] Shared project: only assignee or created_by can move\n- [ ] `updated_at` set on change\n- [ ] Event logged\n- [ ] Response confirms new section\n\n**Tests**\n- `tests/test_cmd_move.py::test_move_valid_section`\n- `tests/test_cmd_move.py::test_move_invalid_section`\n- `tests/test_cmd_move.py::test_move_private_owner_only`\n- `tests/test_cmd_move.py::test_move_shared_permission`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d moved to %s by %s\", id, section, sender)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #11: /todo done and /todo drop commands\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/011-cmd-done-drop`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `done` and `drop` subcommands. Both set section and status accordingly, record `closed_at`, validate permissions same as `move`, and log event.\n\n**Acceptance Criteria**\n- [ ] `done`: section='done', status='done', closed_at=now\n- [ ] `drop`: section='drop', status='dropped', closed_at=now\n- [ ] Permissions enforced (same as move)\n- [ ] Already-closed task returns informational message (idempotent or error -- decide)\n- [ ] Event logged for each\n\n**Tests**\n- `tests/test_cmd_done_drop.py::test_done_sets_fields`\n- `tests/test_cmd_done_drop.py::test_drop_sets_fields`\n- `tests/test_cmd_done_drop.py::test_permission_check`\n- `tests/test_cmd_done_drop.py::test_already_done`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d %s by %s\", id, action, sender)`\n\n**Dependencies**\n#10\n\n---\n\n## Issue #12: /todo edit command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/012-cmd-edit`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `edit` subcommand (v1 replace semantics). Supports changing title, assignees (full replace), project, section, and due. Validates private-project assignee constraint on both source and target project. Logs event with old/new diff in payload.\n\n**Acceptance Criteria**\n- [ ] Title updated only if non-option tokens present\n- [ ] Mentions present -> assignees fully replaced (DELETE + INSERT)\n- [ ] `due:-` clears due to NULL\n- [ ] `/p <newProject>` moves task to new project (project_id updated)\n- [ ] Private project assignee validation applied to target project\n- [ ] If moving to private project with non-owner assignees -> warning, no change\n- [ ] Event payload contains changed fields\n- [ ] Permissions: private owner only; shared assignee/created_by\n\n**Tests**\n- `tests/test_cmd_edit.py::test_edit_title`\n- `tests/test_cmd_edit.py::test_edit_assignees_replace`\n- `tests/test_cmd_edit.py::test_edit_due_clear`\n- `tests/test_cmd_edit.py::test_edit_move_project`\n- `tests/test_cmd_edit.py::test_edit_private_assignee_rejected`\n- `tests/test_cmd_edit.py::test_edit_no_change_fields`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d edited by %s: fields=%s\", id, sender, changed_fields)`\n\n**Dependencies**\n#6, #7, #10\n\n---\n\n## Issue #13: /todo project list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/013-cmd-project-list`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project list`. Returns all shared projects and the sender's private projects. Format: grouped by visibility with name and task count.\n\n**Acceptance Criteria**\n- [ ] Shared projects listed regardless of sender\n- [ ] Sender's private projects listed\n- [ ] Other users' private projects NOT shown\n- [ ] Each project shows name, visibility, task count\n\n**Tests**\n- `tests/test_cmd_project.py::test_project_list_shows_shared`\n- `tests/test_cmd_project.py::test_project_list_shows_own_private`\n- `tests/test_cmd_project.py::test_project_list_hides_others_private`\n\n**Rollback**\nRevert handler; read-only.\n\n**Observability**\n`logger.info(\"project list: %d shared, %d private for %s\", ...)`\n\n**Dependencies**\n#7\n\n---\n\n## Issue #14: /todo project set-private command with assignee validation\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/014-cmd-project-set-private`  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-private <name>` with the assignee validation described in PRD 3.4. Resolution flow: if sender already has private with that name -> noop; if shared exists -> attempt conversion; if neither -> create new private. Conversion scans all tasks in the project and rejects if any task has a non-owner assignee.\n\n**Acceptance Criteria**\n- [ ] Already-private for sender: returns \"already private\" message\n- [ ] Shared -> private: scans tasks; all assignees are owner -> success (visibility='private', owner_user_id=sender)\n- [ ] Shared -> private: at least one non-owner assignee -> error with task IDs and violating assignee list (max 10)\n- [ ] Neither exists: creates new private project with owner=sender\n- [ ] Error message format matches PRD example\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_private_already_private`\n- `tests/test_cmd_project.py::test_set_private_shared_success`\n- `tests/test_cmd_project.py::test_set_private_shared_rejected_non_owner_assignee`\n- `tests/test_cmd_project.py::test_set_private_creates_new`\n- `tests/test_cmd_project.py::test_set_private_error_message_format`\n\n**Rollback**\nRevert handler; no schema change.\n\n**Observability**\n`logger.info(\"project set-private: %s result=%s by %s\", name, result, sender)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #15: /todo project set-shared command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/015-cmd-project-set-shared`   |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-shared <name>`. Creates a shared project if none exists. If a shared project with that name already exists, noop. Global uniqueness enforced by DB index.\n\n**Acceptance Criteria**\n- [ ] New shared project created when name is free\n- [ ] Existing shared project: returns \"already shared\" / noop\n- [ ] Name conflict with existing shared: returns exists message (index enforces)\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_shared_creates_new`\n- `tests/test_cmd_project.py::test_set_shared_already_exists_noop`\n- `tests/test_cmd_project.py::test_set_shared_name_conflict`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"project set-shared: %s result=%s\", name, result)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #16: Command dispatcher and routing\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/016-dispatcher`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the dispatcher in `plugin.py` that maps the parsed command name to handler functions: `add`, `list`, `board`, `move`, `done`, `drop`, `edit`, `project`. The `project` command further dispatches to `list`, `set-private`, `set-shared`. Unknown commands return a help/error message.\n\n**Acceptance Criteria**\n- [ ] All valid command names routed to correct handler\n- [ ] `project` subcommands routed correctly\n- [ ] Unknown command returns usage hint\n- [ ] DB connection initialised (migration check) before first command execution\n\n**Tests**\n- `tests/test_dispatcher.py::test_routes_known_commands`\n- `tests/test_dispatcher.py::test_project_sub_routing`\n- `tests/test_dispatcher.py::test_unknown_command_help`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.info(\"Dispatching command=%s sub=%s\", command, sub)`\n\n**Dependencies**\n#5\n\n---\n\n## Issue #17: Permission helper module\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/017-permissions`              |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExtract shared permission-checking logic into `src/openclaw_todo/permissions.py`. Provides `can_write_task(conn, task_id, sender_id) -> bool` and `validate_private_assignees(project, assignees, owner_id) -> Optional[str]` (returns warning message or None).\n\n**Acceptance Criteria**\n- [ ] Private project: only owner can write\n- [ ] Shared project: only assignee or created_by can write\n- [ ] `validate_private_assignees` returns warning string when non-owner assignees present for private project\n- [ ] Returns None for shared projects or when all assignees are owner\n\n**Tests**\n- `tests/test_permissions.py::test_private_owner_can_write`\n- `tests/test_permissions.py::test_private_non_owner_rejected`\n- `tests/test_permissions.py::test_shared_assignee_can_write`\n- `tests/test_permissions.py::test_shared_creator_can_write`\n- `tests/test_permissions.py::test_validate_private_assignees_warning`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Permission check: task=%d sender=%s result=%s\", ...)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #18: Parser unit tests (comprehensive)\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/018-parser-tests`             |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExpand parser test coverage to include edge cases: multiple options in varied order, due at year boundary, empty title, mentions mixed with options, unicode in titles, extra whitespace handling.\n\n**Acceptance Criteria**\n- [ ] >=95% line coverage on `parser.py`\n- [ ] Edge cases documented in test docstrings\n- [ ] All tests pass with `uv run pytest tests/test_parser.py -v`\n\n**Tests**\n- `tests/test_parser.py::test_options_in_any_order`\n- `tests/test_parser.py::test_due_year_boundary`\n- `tests/test_parser.py::test_empty_title_no_crash`\n- `tests/test_parser.py::test_unicode_title`\n- `tests/test_parser.py::test_extra_whitespace`\n- `tests/test_parser.py::test_mixed_mentions_and_options`\n\n**Rollback**\nRevert test file; no production code change.\n\n**Observability**\nCI coverage report.\n\n**Dependencies**\n#5\n\n---\n\n## Issue #19: SQLite end-to-end integration tests\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/019-e2e-tests`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nWrite integration tests that exercise the full flow through `handle_message` with a real (tmp_path) SQLite database. Cover the main user stories: add a task, list it, move it, mark done, edit it, manage projects, and validate private project constraints.\n\n**Acceptance Criteria**\n- [ ] Each test uses a fresh DB via `tmp_path` fixture\n- [ ] Scenarios: add->list, add->move->board, add->done, add->edit, project set-private rejection\n- [ ] Private project visibility enforced end-to-end\n- [ ] Due normalisation verified in DB\n- [ ] All tests pass with `uv run pytest tests/test_e2e.py -v`\n\n**Tests**\n- `tests/test_e2e.py::test_add_and_list_roundtrip`\n- `tests/test_e2e.py::test_add_move_board`\n- `tests/test_e2e.py::test_done_and_drop`\n- `tests/test_e2e.py::test_edit_title_and_assignees`\n- `tests/test_e2e.py::test_private_project_isolation`\n- `tests/test_e2e.py::test_set_private_rejects_foreign_assignees`\n- `tests/test_e2e.py::test_due_normalisation_stored_correctly`\n\n**Rollback**\nRevert test file.\n\n**Observability**\nCI test results and coverage delta.\n\n**Dependencies**\n#6, #8, #9, #10, #11, #12, #14, #15\n\n---\n\n## Issue #20: Packaging and distribution setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | DevOps                                 |\n| Milestone   | M6                                     |\n| Status      | TODO                                   |\n| Priority    | P2                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/020-packaging`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nFinalise `pyproject.toml` metadata (name, version, description, license, entry-points), add a `Makefile` with targets for lint/test/build, and document installation instructions in README. Ensure the plugin can be installed as a package and discovered by the OpenClaw gateway.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` has complete metadata and entry-point for OpenClaw plugin discovery\n- [ ] `make lint` runs ruff + black --check\n- [ ] `make test` runs pytest with coverage\n- [ ] `make build` produces a wheel via `uv build`\n- [ ] `pip install <wheel>` in a clean venv makes the plugin importable\n- [ ] README documents installation and configuration (DB path env var)\n\n**Tests**\n- Manual: install wheel in fresh venv, import module, call `handle_message`\n- `make test` passes in CI\n\n**Rollback**\nRevert packaging changes.\n\n**Observability**\nBuild artifact size logged; CI publishes wheel as artifact.\n\n**Dependencies**\n#19\n\n---\n\n## Dependency Graph (summary)\n\n```\n#1  Plugin skeleton\n |\n +--#2  DB connection\n |   |\n |   +--#3  Migration framework\n |       |\n |       +--#4  V1 schema\n |           |\n |           +--#7  Project resolver\n |           |   |\n |           |   +--#13 project list\n |           |   +--#14 project set-private\n |           |   +--#15 project set-shared\n |           |\n |           +--#17 Permissions helper\n |\n +--#5  Parser\n |   |\n |   +--#18 Parser tests (M5)\n |\n +--#16 Dispatcher\n     |\n     +--#6  cmd add       (#4,#5,#7,#17)\n     +--#8  cmd list      (#6,#7)\n     +--#9  cmd board     (#8)\n     +--#10 cmd move      (#6,#7,#17)\n     +--#11 cmd done/drop (#10)\n     +--#12 cmd edit      (#6,#7,#10,#17)\n\n#19 E2E tests    (all commands)\n#20 Packaging    (#19)\n```\n", "numLines": 863, "startLine": 1, "totalLines": 863}}, "tool_use_id": "toolu_015HznGKsc2w7N3dtaDxuu9C", "_ts": "2026-02-20T11:57:59+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "gh auth status 2>&1", "description": "Check gh authentication status"}, "tool_use_id": "toolu_01V4MqNtac1X9asLf3qHdT7v", "_ts": "2026-02-20T11:57:59+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "gh auth status 2>&1", "description": "Check gh authentication status"}, "tool_response": {"stdout": "github.com\n  ✓ Logged in to github.com account pillip (keyring)\n  - Active account: true\n  - Git operations protocol: https\n  - Token: gho_************************************\n  - Token scopes: 'gist', 'read:org', 'repo', 'workflow'", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_01V4MqNtac1X9asLf3qHdT7v", "_ts": "2026-02-20T11:58:02+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_use_id": "toolu_01U1p81ZQdHWRrEuqG7jKGdz", "_ts": "2026-02-20T11:58:08+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/openclaw_todo_plugin_prd.md", "content": "# OpenClaw TODO Plugin for Slack — PRD v1.1 (DM 기반)\n\n> 변경사항 반영:\n> 1) Slack **슬래시 커맨드 미사용** → **DM(또는 앱 멘션/일반 메시지)에서 `/todo …`**로 사용  \n> 2) private 프로젝트: **same owner 내 name 유니크**  \n> 3) `/todo project set-private` 실행 시: 해당 프로젝트 내 task 중 **owner가 아닌 assignee가 하나라도 있으면 에러**  \n> 4) 프로젝트 이름 충돌 해소: **옵션 A(private 우선)** 유지  \n> 5) DB **초기 생성/마이그레이션** 절차 추가\n\n---\n\n## 1) 개요\n\n### 1.1 목표\nOpenClaw 플러그인으로 Slack에서 다음을 **LLM 호출 없이(=비용 0)** 처리하는 팀/개인용 TODO 시스템을 제공한다.\n\n- `/todo add|list|board|move|done|drop|edit`\n- `/todo project list|set-private|set-shared`\n- 저장소: **공유 SQLite3** (동일 Gateway/동일 DB 파일)\n- 담당자(assignee): **Slack 멘션만 허용** (`<@U…>` 기반)\n- due: `YYYY-MM-DD` 또는 `MM-DD` 허용, 연도 생략 시 **현재 연도**로 보정\n- Private 프로젝트: **오직 owner만** 조회/수정 가능\n\n---\n\n## 2) Slack 사용 방식 (슬래시 커맨드 미사용)\n\n### 2.1 사용 채널\n슬래시 커맨드를 쓰지 않는다면, 일반적으로 다음 중 하나로 사용한다.\n\n- **DM 채널**: OpenClaw Slack 앱(봇)과 1:1 대화에서 `/todo …` 입력  \n- **채널/스레드**(옵션): 앱 멘션(`@openclaw /todo …`) 또는 특정 메시지 패턴을 OpenClaw가 수신하도록 설정된 경우\n\n> v1은 **DM 사용을 기본 경로**로 가정한다.  \n> 이유: 권한/노이즈/오작동 리스크가 낮고 운영이 단순함.\n\n### 2.2 커맨드 인식 규칙\n- 메시지의 첫 토큰이 `/todo`이면 플러그인이 처리한다.\n- 그 외 메시지는 v1에서 무시(자연어 자동 등록은 Phase 2).\n\n---\n\n## 3) 핵심 정책\n\n### 3.1 프로젝트 이름 유니크 정책\n- **Shared 프로젝트**: 전역 유니크 (겹치면 생성/변경 거부)\n- **Private 프로젝트**: **same owner 내에서만 유니크** (owner가 다르면 동일 name 허용)\n\n### 3.2 프로젝트 이름 충돌 해소(옵션 A)\n`/p <name>` 해석:\n1) sender(owner)의 private 프로젝트 `<name>`가 존재하면 **private 우선**\n2) 없으면 shared `<name>` 사용\n3) 둘 다 없으면 (v1 정책에 따라) shared 자동 생성 또는 에러\n\n> 운영 가이드: private와 shared에 같은 이름을 쓰지 않는 것을 권장(혼란 방지).\n\n### 3.3 Private 프로젝트 assignee 제한(“경고 후 거부”)\n- private 프로젝트는 **owner만 볼 수 있는 범위**이므로:\n  - add/edit 시 owner 이외의 assignee가 포함되면 **경고 메시지 출력 후 작업 거부(변경/생성 미적용)**\n\n경고/거부 응답 예시:\n- `⚠️ Private 프로젝트(Personal)는 owner만 볼 수 있어요. 다른 담당자(<@U…>)를 지정할 수 없습니다. (요청이 적용되지 않았습니다.)`\n\n### 3.4 `/todo project set-private` 추가 제약(요구사항)\n- 프로젝트를 private로 전환할 때,\n  - 해당 프로젝트 내 모든 task를 스캔하여\n  - **owner가 아닌 assignee가 하나라도 존재하면 에러**로 실패해야 한다.\n- 에러 메시지에는 최소한 아래 정보를 포함한다:\n  - 실패 사유\n  - 위반 task id 목록 일부(예: 최대 10개)\n  - 위반 assignee 목록 일부\n\n에러 예시:\n- `❌ Cannot set project \"Biz\" to private: found tasks assigned to non-owner users. e.g. #12 assignees:<@U2>, #18 assignees:<@U3>`\n\n---\n\n## 4) due 파서 정책\n\n허용 입력:\n- `due:YYYY-MM-DD`\n- `due:MM-DD` 또는 `due:M-D`\n\n보정:\n- 연도 생략 시: `YYYY = now().year` (서버 timezone은 Asia/Seoul 권장)\n\n검증:\n- 유효하지 않은 날짜(예: 02-30)는 에러\n- DB에는 항상 `YYYY-MM-DD`로 저장\n\n---\n\n## 5) 커맨드 스펙\n\n### 5.0 공통 토큰\n- 프로젝트: `/p <projectName>`\n- 섹션: `/s <section>`\n- 섹션 enum: `backlog | doing | waiting | done | drop`\n- due: `due:YYYY-MM-DD|MM-DD` 또는 `due:-`(클리어)\n\n---\n\n### 5.1 `/todo add`\n문법:\n```\n/todo add <title...> [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD]\n```\n\n기본값:\n- project: `Inbox`\n- section: `backlog`\n- assignees:\n  - 멘션 없으면 sender\n  - 멘션 있으면 해당 유저들(다중)\n- due: 없으면 NULL\n\n검증:\n- private 프로젝트에 sender 외 assignee 포함 시: **경고 후 거부**\n- 프로젝트가 없으면:\n  - `Inbox`는 shared로 자동 생성 가능(권장)\n\n응답:\n- `✅ Added #123 (Inbox/backlog) due:- assignees:<@U1> — 장보기`\n\n---\n\n### 5.2 `/todo list`\n문법:\n```\n/todo list [mine|all|<@USER>] [/p <project>] [/s <section>] [open|done|drop] [limit:N]\n```\n\n기본값:\n- scope: `mine`\n- status: `open`\n- limit: 30\n\nscope 의미:\n- `mine`: assignees에 sender 포함\n- `<@USER>`: 해당 유저가 assignee인 task\n- `all`: shared 전체 + sender의 private 프로젝트(타인의 private는 제외)\n\n정렬:\n1) due 있는 것 우선\n2) due 오름차순\n3) id 내림차순\n\n---\n\n### 5.3 `/todo board`\n문법:\n```\n/todo board [mine|all|<@USER>] [/p <project>] [open|done|drop] [limitPerSection:N]\n```\n\n기본값:\n- scope: mine\n- status: open\n- limitPerSection: 10\n\n출력:\n- BACKLOG → DOING → WAITING → DONE → DROP 순\n- 항목 포맷: `#id due:YYYY-MM-DD| - assignees:<@U..> <@U..> title`\n\n---\n\n### 5.4 `/todo move`\n문법:\n```\n/todo move <id> <section>\n```\n\n검증:\n- 섹션 enum validate\n- 권한:\n  - private: owner만\n  - shared: v1 권장 `assignee` 또는 `created_by`만 수정 가능\n\n---\n\n### 5.5 `/todo done`\n```\n/todo done <id>\n```\n- section=`done`, status=`done`, closed_at 기록\n\n### 5.6 `/todo drop`\n```\n/todo drop <id>\n```\n- section=`drop`, status=`dropped`, closed_at 기록\n\n---\n\n### 5.7 `/todo edit`\n문법(v1 replace 방식):\n```\n/todo edit <id> [<new title...>] [<@USER> ...] [/p <project>] [/s <section>] [due:YYYY-MM-DD|MM-DD|due:-]\n```\n\n규칙:\n- 멘션이 있으면 assignees **완전 교체**\n- `due:-` 는 due NULL\n- title은 옵션 토큰 이전 텍스트를 새 title로 간주(비어있으면 변경 없음)\n\n검증:\n- private 프로젝트로 변경되거나 private 프로젝트에서 assignee 변경 시:\n  - sender 외 assignee 포함이면 **경고 후 거부(변경 미적용)**\n\n---\n\n### 5.8 `/todo project list`\n- 반환:\n  - shared 프로젝트 목록\n  - sender(owner)의 private 프로젝트 목록\n\n---\n\n### 5.9 `/todo project set-private <name>`\n동작:\n1) 대상 프로젝트를 resolve:\n   - sender의 private `<name>` 존재 → already private (ok)\n   - 없고 shared `<name>` 존재 → shared를 private로 “전환 시도”\n   - 둘 다 없으면 → sender private `<name>` 생성 (owner=sender)\n\n2) shared→private 전환 시도 시 검증:\n   - 해당 프로젝트 내 tasks를 조회\n   - 각 task에 대해 `task_assignees`를 확인\n   - **owner(sender) 외 assignee가 하나라도 존재하면 실패(에러)**\n\n3) 성공 시:\n   - projects.visibility='private', owner_user_id=sender\n   - (선택) 기존 task의 assignees가 모두 owner인지 확인되므로 유지 가능\n\n---\n\n### 5.10 `/todo project set-shared <name>`\n동작:\n- shared `<name>`이 없으면 생성\n- 이미 있으면 noop\n- 단, shared는 전역 유니크이므로 충돌 시 에러/exists\n\n---\n\n## 6) 데이터 모델 (SQLite3)\n\n### 6.1 DB 파일 위치\n- 기본: `~/.openclaw/workspace/.todo/todo.sqlite3`\n\n### 6.2 동시성 설정\n- `PRAGMA journal_mode=WAL;`\n- `PRAGMA busy_timeout=3000;`\n\n### 6.3 스키마(v1)\n\n#### `projects`\n- `id` INTEGER PK AUTOINCREMENT\n- `name` TEXT NOT NULL\n- `visibility` TEXT NOT NULL CHECK (visibility IN ('shared','private'))\n- `owner_user_id` TEXT NULL\n- `created_at` TEXT NOT NULL DEFAULT (datetime('now'))\n- `updated_at` TEXT NOT NULL DEFAULT (datetime('now'))\n\nIndexes:\n- shared 전역 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_shared_name ON projects(name) WHERE visibility='shared';`\n- private owner 내 유니크:\n  - `CREATE UNIQUE INDEX ux_projects_private_owner_name ON projects(owner_user_id, name) WHERE visibility='private';`\n\n#### `tasks`\n- `id` INTEGER PK AUTOINCREMENT\n- `title` TEXT NOT NULL\n- `project_id` INTEGER NOT NULL REFERENCES projects(id)\n- `section` TEXT NOT NULL CHECK (section IN ('backlog','doing','waiting','done','drop'))\n- `due` TEXT NULL  -- YYYY-MM-DD\n- `status` TEXT NOT NULL CHECK (status IN ('open','done','dropped'))\n- `created_by` TEXT NOT NULL  -- Slack user id\n- `created_at`, `updated_at`, `closed_at`\n\n#### `task_assignees`\n- `task_id` INTEGER NOT NULL REFERENCES tasks(id)\n- `assignee_user_id` TEXT NOT NULL\n- PRIMARY KEY(task_id, assignee_user_id)\n- INDEX: `(assignee_user_id, task_id)`\n\n#### `events` (audit, 권장)\n- `id` INTEGER PK\n- `ts` TEXT\n- `actor_user_id` TEXT\n- `action` TEXT\n- `task_id` INTEGER NULL\n- `payload` TEXT (JSON)\n\n---\n\n## 7) DB 초기 생성 / 마이그레이션(필수)\n\n### 7.1 생성 타이밍\n플러그인 로딩 후 첫 `/todo …` 실행 시 또는 gateway startup 시점에 아래를 수행:\n\n1) workspace path 결정\n2) `~/.openclaw/workspace/.todo/` 디렉토리 생성\n3) `todo.sqlite3` 파일 존재 여부 확인\n4) 없으면:\n   - 파일 생성\n   - schema migration 실행\n   - `schema_version` 테이블 생성 및 version=1 기록\n\n### 7.2 schema_version 테이블\n- `schema_version(version INTEGER NOT NULL)`\n- 초기: 1\n- 향후:\n  - 현재 버전 읽고, 필요한 migration 순차 실행\n\n### 7.3 기본 프로젝트 생성(권장)\n- DB 초기화 시 shared 프로젝트 `Inbox` 자동 생성 (중복이면 noop)\n\n---\n\n## 8) 권한/가시성\n\n### 8.1 읽기\n- private: owner만\n- shared: scope에 따라 mine/all/<@USER>\n\n### 8.2 쓰기\n- private: owner만\n- shared: v1 권장 `assignee` 또는 `created_by`만\n\n---\n\n## 9) 수용 기준(Acceptance Criteria)\n\n- [ ] shared 프로젝트 이름 충돌 시 생성/변경 거부\n- [ ] private 프로젝트는 owner 단위로 유니크 (owner A/B는 같은 name 허용)\n- [ ] `/todo project set-private <name>` 실행 시:\n  - 프로젝트 내 task 중 owner 외 assignee 존재하면 에러로 실패\n- [ ] private 프로젝트에 타 assignee 지정 시: 경고 + 작업 미생성/미수정\n- [ ] due `MM-DD` 입력 시 올해로 보정되어 저장\n- [ ] DB 최초 실행 시 파일 생성 + schema 적용 + Inbox 생성\n\n---\n\n## 10) 구현 작업 분해(WBS)\n\n- M0: plugin skeleton + `/todo` command 등록\n- M1: DB init + migrations + schema_version\n- M2: parser (Slack mention, /p, /s, due 보정)\n- M3: commands (add/list/board/move/done/drop/edit)\n- M4: project commands (list/set-private/set-shared + set-private 검증 로직)\n- M5: tests (parser/unit + sqlite E2E)\n- M6: packaging/배포(npm 권장)\n", "numLines": 353, "startLine": 1, "totalLines": 353}}, "tool_use_id": "toolu_01U1p81ZQdHWRrEuqG7jKGdz", "_ts": "2026-02-20T11:58:08+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md"}, "tool_use_id": "toolu_01PUj7KFTo4YTeeovJCgwF2k", "_ts": "2026-02-20T11:58:08+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/STATUS.md", "content": "# Project Status — OpenClaw TODO Plugin\n\n**Last updated:** 2026-02-20\n\n## Current Phase\n\n**Kickoff complete** — All planning documents generated. Ready to begin implementation.\n\n## Milestones\n\n| Milestone | Description | Status | Issues |\n|-----------|-------------|--------|--------|\n| M0 | Plugin skeleton + `/todo` command registration | Not started | #1 |\n| M1 | DB init + migrations + schema_version | Not started | #2, #3, #4 |\n| M2 | Parser (Slack mention, /p, /s, due correction) | Not started | #5 |\n| M3 | Commands (add/list/board/move/done/drop/edit) | Not started | #6–#12, #16, #17 |\n| M4 | Project commands (list/set-private/set-shared) | Not started | #13, #14, #15 |\n| M5 | Tests (parser/unit + sqlite E2E) | Not started | #18, #19 |\n| M6 | Packaging / deployment | Not started | #20 |\n\n## Critical Path\n\n```\n#1 (skeleton) → #2 (DB conn) → #3 (migration framework) → #4 (V1 schema) → #7 (project resolver) → commands\n#5 (parser) can be developed in parallel with DB track\n```\n\n## Next Issues to Work On\n\n1. **#1** — Plugin skeleton and project scaffold (M0)\n2. **#2** — DB connection manager with WAL + busy_timeout (M1)\n3. **#5** — Command parser / tokenizer (M2, parallelizable)\n\n## Risks\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|-----------|--------|------------|\n| SQLite write contention under concurrent access | Low | Medium | WAL mode + busy_timeout=3000 |\n| Private/shared name collision user confusion | Medium | Low | Option A (private-first) + guidance |\n| Schema migration failures on upgrade | Low | High | schema_version table + sequential migrations |\n| Slack rate limits on heavy usage | Low | Low | Responses are single messages per command |\n\n## Generated Documents\n\n- [x] `docs/requirements.md` — Functional & non-functional requirements\n- [x] `docs/ux_spec.md` — UX specification with all command flows\n- [x] `docs/architecture.md` — Software architecture design\n- [x] `docs/test_plan.md` — Test strategy with 80+ test cases\n- [x] `issues.md` — 20 issues across 7 milestones\n", "numLines": 50, "startLine": 1, "totalLines": 50}}, "tool_use_id": "toolu_01PUj7KFTo4YTeeovJCgwF2k", "_ts": "2026-02-20T11:58:08+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "ls -la /Users/pillip/project/practice/openclaw_todo_plugin/", "description": "List repo contents"}, "tool_use_id": "toolu_01LaJofbSsaAZjmxyiMmGiW2", "_ts": "2026-02-20T11:58:09+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "ls -la /Users/pillip/project/practice/openclaw_todo_plugin/", "description": "List repo contents"}, "tool_response": {"stdout": "total 120\ndrwxr-xr-x  11 pillip  staff    352  2월 20 11:34 .\ndrwxr-xr-x@ 27 pillip  staff    864  2월 20 11:28 ..\ndrwxr-xr-x   7 pillip  staff    224  2월 20 11:31 .claude\ndrwxr-xr-x  13 pillip  staff    416  2월 20 11:29 .claude-kit\ndrwxr-xr-x  13 pillip  staff    416  2월 20 11:57 .git\n-rw-r--r--   1 pillip  staff     94  2월 20 11:29 .gitmodules\ndrwxr-xr-x   7 pillip  staff    224  2월 20 11:34 docs\n-rw-r--r--   1 pillip  staff  33697  2월 20 11:34 issues.md\n-rw-r--r--@  1 pillip  staff  10661  2월 20 11:26 openclaw_todo_plugin_prd.md\n-rw-r--r--   1 pillip  staff     22  2월 20 11:28 README.md\n-rw-r--r--   1 pillip  staff   2056  2월 20 11:34 STATUS.md", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_01LaJofbSsaAZjmxyiMmGiW2", "_ts": "2026-02-20T11:58:09+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Create GH Issue for Issue #1", "description": "Create GitHub issue with title, body from issues.md acceptance criteria", "activeForm": "Creating GitHub issue"}, "tool_use_id": "toolu_01Q4biJgLnkj2wVmKcPN9E2S", "_ts": "2026-02-20T11:58:18+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Create GH Issue for Issue #1", "description": "Create GitHub issue with title, body from issues.md acceptance criteria", "activeForm": "Creating GitHub issue"}, "tool_response": {"task": {"id": "1", "subject": "Create GH Issue for Issue #1"}}, "tool_use_id": "toolu_01Q4biJgLnkj2wVmKcPN9E2S", "_ts": "2026-02-20T11:58:18+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Implement plugin skeleton code", "description": "Create pyproject.toml, src/openclaw_todo/__init__.py, src/openclaw_todo/plugin.py, and tests/test_plugin.py", "activeForm": "Implementing plugin skeleton"}, "tool_use_id": "toolu_01VV41sUN5tpJ6fiNZhkxUx7", "_ts": "2026-02-20T11:58:21+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Implement plugin skeleton code", "description": "Create pyproject.toml, src/openclaw_todo/__init__.py, src/openclaw_todo/plugin.py, and tests/test_plugin.py", "activeForm": "Implementing plugin skeleton"}, "tool_response": {"task": {"id": "2", "subject": "Implement plugin skeleton code"}}, "tool_use_id": "toolu_01VV41sUN5tpJ6fiNZhkxUx7", "_ts": "2026-02-20T11:58:21+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Run tests and create PR", "description": "Run uv sync, pytest, commit, push, create PR with Closes #N", "activeForm": "Running tests and creating PR"}, "tool_use_id": "toolu_01L6RvxYFNjZdBUcxb8BKEaV", "_ts": "2026-02-20T11:58:25+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskCreate", "tool_input": {"subject": "Run tests and create PR", "description": "Run uv sync, pytest, commit, push, create PR with Closes #N", "activeForm": "Running tests and creating PR"}, "tool_response": {"task": {"id": "3", "subject": "Run tests and create PR"}}, "tool_use_id": "toolu_01L6RvxYFNjZdBUcxb8BKEaV", "_ts": "2026-02-20T11:58:25+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "1", "status": "in_progress"}, "tool_use_id": "toolu_01LzRWocp8wBvLdYxtuBMHYX", "_ts": "2026-02-20T11:58:28+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "1", "status": "in_progress"}, "tool_response": {"success": true, "taskId": "1", "updatedFields": ["status"], "statusChange": {"from": "pending", "to": "in_progress"}}, "tool_use_id": "toolu_01LzRWocp8wBvLdYxtuBMHYX", "_ts": "2026-02-20T11:58:28+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "gh issue create --title \"[Issue#1] Plugin skeleton and entry point\" --body \"$(cat <<'EOF'\n## Goal\nCreate the Python project scaffold for the OpenClaw TODO Plugin.\n\n## Scope\n\n### In Scope\n- `pyproject.toml` (uv) with Python >=3.11, pytest, pytest-cov dev deps\n- `src/openclaw_todo/` package layout\n- Plugin entry-point `handle_message(text: str, context: dict) -> str`\n- Messages not starting with `/todo` are silently ignored (returns `None`)\n\n### Out of Scope\n- Actual command parsing/dispatch (Issue #5, #16)\n- DB setup (Issue #2)\n\n## Acceptance Criteria\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n## Tests\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n## Implementation Notes\n- Observability: `logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched\n- No runtime dependencies; M0 milestone\nEOF\n)\"", "description": "Create GH issue for Issue #1"}, "tool_use_id": "toolu_017iTS1BApfDKtBdRnot9JsZ", "_ts": "2026-02-20T11:58:37+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "gh issue create --title \"[Issue#1] Plugin skeleton and entry point\" --body \"$(cat <<'EOF'\n## Goal\nCreate the Python project scaffold for the OpenClaw TODO Plugin.\n\n## Scope\n\n### In Scope\n- `pyproject.toml` (uv) with Python >=3.11, pytest, pytest-cov dev deps\n- `src/openclaw_todo/` package layout\n- Plugin entry-point `handle_message(text: str, context: dict) -> str`\n- Messages not starting with `/todo` are silently ignored (returns `None`)\n\n### Out of Scope\n- Actual command parsing/dispatch (Issue #5, #16)\n- DB setup (Issue #2)\n\n## Acceptance Criteria\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n## Tests\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n## Implementation Notes\n- Observability: `logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched\n- No runtime dependencies; M0 milestone\nEOF\n)\"", "description": "Create GH issue for Issue #1"}, "tool_response": {"stdout": "https://github.com/pillip/openclaw_todo_plugin/issues/1", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_017iTS1BApfDKtBdRnot9JsZ", "_ts": "2026-02-20T11:58:40+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "1", "status": "completed"}, "tool_use_id": "toolu_01QjBr7hPi59MKeFBPfwY6Kv", "_ts": "2026-02-20T11:58:43+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "1", "status": "completed"}, "tool_response": {"success": true, "taskId": "1", "updatedFields": ["status"], "statusChange": {"from": "in_progress", "to": "completed"}}, "tool_use_id": "toolu_01QjBr7hPi59MKeFBPfwY6Kv", "_ts": "2026-02-20T11:58:43+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "old_string": "| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "new_string": "| GH-Issue    | https://github.com/pillip/openclaw_todo_plugin/issues/1 |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "replace_all": false}, "tool_use_id": "toolu_017d3m5CJ3pa8HzdntYWiTcd", "_ts": "2026-02-20T11:58:49+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "old_string": "| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "new_string": "| GH-Issue    | https://github.com/pillip/openclaw_todo_plugin/issues/1 |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "replace_all": false}, "tool_response": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/issues.md", "oldString": "| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "newString": "| GH-Issue    | https://github.com/pillip/openclaw_todo_plugin/issues/1 |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load.", "originalFile": "# OpenClaw TODO Plugin -- Issues\n\n> Auto-generated from `openclaw_todo_plugin_prd.md` (PRD v1.1)\n> Date: 2026-02-20\n\n---\n\n## Issue #1: Plugin skeleton and entry point\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M0                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/001-plugin-skeleton`          |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nCreate the Python project scaffold: `pyproject.toml` (uv), `src/openclaw_todo/` package layout, and the plugin entry-point that the OpenClaw gateway will load. The plugin must expose a callable that receives raw Slack DM text and a sender context dict.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` exists with Python >=3.11, pytest, pytest-cov dev deps\n- [ ] `src/openclaw_todo/__init__.py` exposes `__version__`\n- [ ] `src/openclaw_todo/plugin.py` contains `handle_message(text: str, context: dict) -> str` entry point\n- [ ] Messages not starting with `/todo` are silently ignored (returns `None`)\n- [ ] `uv sync && uv run pytest -q` passes (trivial smoke test)\n\n**Tests**\n- `tests/test_plugin.py::test_ignores_non_todo_message`\n- `tests/test_plugin.py::test_dispatches_todo_prefix`\n\n**Rollback**\nDelete branch; no runtime dependency.\n\n**Observability**\n`logger.debug` on every inbound message; `logger.info` when `/todo` prefix matched.\n\n**Dependencies**\nNone.\n\n---\n\n## Issue #2: DB module -- connection helper and pragma setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/002-db-connection`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/db.py` with a `get_connection(db_path)` helper that creates the `~/.openclaw/workspace/.todo/` directory tree if missing, opens (or creates) `todo.sqlite3`, and applies `PRAGMA journal_mode=WAL` and `PRAGMA busy_timeout=3000`.\n\n**Acceptance Criteria**\n- [ ] Directory is created recursively when absent\n- [ ] SQLite connection returned with WAL mode enabled\n- [ ] `busy_timeout` is 3000\n- [ ] Calling `get_connection` twice returns usable connections (no lock conflict)\n\n**Tests**\n- `tests/test_db.py::test_creates_directory_and_file` (tmp_path)\n- `tests/test_db.py::test_wal_mode_enabled`\n- `tests/test_db.py::test_busy_timeout`\n\n**Rollback**\nRevert module; no schema changes yet.\n\n**Observability**\n`logger.info` on first DB creation; `logger.debug` on each connection open.\n\n**Dependencies**\n#1\n\n---\n\n## Issue #3: Schema migration framework and schema_version table\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/003-schema-migration`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement a simple sequential migration runner. On startup, read `schema_version` (create if missing), compare to available migrations list, and apply outstanding migrations in order inside a transaction.\n\n**Acceptance Criteria**\n- [ ] `schema_version` table created with single row `version=0` if absent\n- [ ] Migrations are Python callables registered in an ordered list\n- [ ] Each migration runs inside a transaction; version incremented on success\n- [ ] Re-running on an up-to-date DB is a no-op\n- [ ] Failing migration rolls back and raises with clear message\n\n**Tests**\n- `tests/test_migrations.py::test_fresh_db_gets_version_table`\n- `tests/test_migrations.py::test_applies_migrations_sequentially`\n- `tests/test_migrations.py::test_idempotent_on_rerun`\n- `tests/test_migrations.py::test_rollback_on_failure`\n\n**Rollback**\nDrop `schema_version` table; revert module.\n\n**Observability**\n`logger.info(\"Migrating from version %d to %d\", current, target)` per step.\n\n**Dependencies**\n#2\n\n---\n\n## Issue #4: V1 schema migration -- projects, tasks, task_assignees, events\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend / Data                         |\n| Milestone   | M1                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/004-v1-schema`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nRegister migration v1 that creates the four tables (`projects`, `tasks`, `task_assignees`, `events`) with all columns, CHECK constraints, and partial unique indexes as specified in PRD section 6.3. Also seed shared project `Inbox`.\n\n**Acceptance Criteria**\n- [ ] `projects` table with `ux_projects_shared_name` and `ux_projects_private_owner_name` partial unique indexes\n- [ ] `tasks` table with section and status CHECK constraints\n- [ ] `task_assignees` table with composite PK and secondary index\n- [ ] `events` audit table created\n- [ ] Shared `Inbox` project auto-created (INSERT OR IGNORE)\n- [ ] `schema_version` = 1 after migration\n\n**Tests**\n- `tests/test_migrations.py::test_v1_tables_exist`\n- `tests/test_migrations.py::test_v1_inbox_created`\n- `tests/test_migrations.py::test_v1_shared_unique_index_enforced`\n- `tests/test_migrations.py::test_v1_private_unique_index_enforced`\n\n**Rollback**\nDrop all four tables + reset schema_version to 0.\n\n**Observability**\nLog table creation counts.\n\n**Dependencies**\n#3\n\n---\n\n## Issue #5: Command parser -- tokenizer and option extraction\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M2                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/005-parser-tokenizer`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `src/openclaw_todo/parser.py` that takes raw message text (after `/todo` prefix) and returns a `ParsedCommand` dataclass containing: `command` (str), `args` (list), `project` (str|None), `section` (str|None), `due` (str|None, normalised to YYYY-MM-DD), `mentions` (list of Slack user IDs), and remaining `title_tokens`.\n\nParsing rules:\n- `/p <name>` extracts project\n- `/s <section>` extracts section (validate against enum)\n- `due:YYYY-MM-DD` or `due:MM-DD` extracts and normalises due date\n- `due:-` clears due (sentinel)\n- `<@U...>` patterns extracted as mentions\n- Everything else before first option token is title\n\n**Acceptance Criteria**\n- [ ] `/p MyProject` correctly extracted; token consumed\n- [ ] `/s doing` validated; invalid section raises `ParseError`\n- [ ] `due:03-15` normalised to `2026-03-15`\n- [ ] `due:2026-02-30` raises `ParseError` (invalid date)\n- [ ] `<@U12345>` extracted into mentions list\n- [ ] Multiple mentions supported\n- [ ] Title tokens are non-option, non-mention tokens before first option\n\n**Tests**\n- `tests/test_parser.py::test_extract_project`\n- `tests/test_parser.py::test_extract_section_valid`\n- `tests/test_parser.py::test_extract_section_invalid`\n- `tests/test_parser.py::test_due_mm_dd_normalisation`\n- `tests/test_parser.py::test_due_full_date`\n- `tests/test_parser.py::test_due_invalid_date`\n- `tests/test_parser.py::test_due_clear`\n- `tests/test_parser.py::test_mentions_extraction`\n- `tests/test_parser.py::test_title_extraction`\n\n**Rollback**\nRevert module; no side effects.\n\n**Observability**\n`logger.debug(\"Parsed: %s\", parsed_command)`\n\n**Dependencies**\n#1\n\n---\n\n## Issue #6: /todo add command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/006-cmd-add`                  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `add` subcommand handler. Resolves project (default `Inbox`), applies defaults (section=`backlog`, assignees=sender if none mentioned), validates private-project assignee constraint (PRD 3.3), inserts task + task_assignees rows, logs event, and returns formatted confirmation.\n\n**Acceptance Criteria**\n- [ ] Task inserted with correct project_id, section, due, status='open', created_by\n- [ ] Assignees default to sender when no mentions\n- [ ] Multiple mentions create multiple task_assignee rows\n- [ ] Private project + non-owner assignee returns warning and does NOT insert\n- [ ] Non-existent project: `Inbox` auto-created as shared; others return error\n- [ ] Response format: `Added #<id> (<project>/<section>) due:<due|-> assignees:<mentions> -- <title>`\n- [ ] Event row written to `events` table\n\n**Tests**\n- `tests/test_cmd_add.py::test_add_default_inbox`\n- `tests/test_cmd_add.py::test_add_with_project_section_due`\n- `tests/test_cmd_add.py::test_add_private_rejects_other_assignee`\n- `tests/test_cmd_add.py::test_add_assignee_defaults_to_sender`\n- `tests/test_cmd_add.py::test_add_multiple_assignees`\n\n**Rollback**\nRevert handler; tasks table unchanged structurally.\n\n**Observability**\n`logger.info(\"Task #%d created in %s/%s by %s\", id, project, section, sender)`\n\n**Dependencies**\n#4, #5\n\n---\n\n## Issue #7: Project resolver helper\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/007-project-resolver`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `resolve_project(conn, name, sender_id) -> Project` following PRD 3.2 (Option A): sender's private project with that name takes priority, then shared, then error/auto-create for Inbox.\n\n**Acceptance Criteria**\n- [ ] Private project of sender matched first\n- [ ] Falls back to shared if no private match\n- [ ] Returns error when neither exists (except Inbox which is auto-created)\n- [ ] Returns project row with id, name, visibility, owner_user_id\n\n**Tests**\n- `tests/test_project_resolver.py::test_private_takes_priority`\n- `tests/test_project_resolver.py::test_falls_back_to_shared`\n- `tests/test_project_resolver.py::test_inbox_auto_created`\n- `tests/test_project_resolver.py::test_unknown_project_error`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Resolved project '%s' -> id=%d vis=%s\", name, id, visibility)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #8: /todo list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/008-cmd-list`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `list` subcommand. Supports scope (mine/all/<@USER>), project filter, section filter, status filter (open/done/drop), and limit. Sorting: due ASC (NULLs last), then id DESC. Excludes other users' private projects.\n\n**Acceptance Criteria**\n- [ ] Default scope=mine, status=open, limit=30\n- [ ] `mine` filters to tasks where sender is an assignee\n- [ ] `all` includes shared + sender's private (excludes others' private)\n- [ ] `/p` and `/s` filters applied correctly\n- [ ] Sorting: due NOT NULL first, due ASC, id DESC\n- [ ] limit:N respected\n- [ ] Output lists tasks in formatted lines\n\n**Tests**\n- `tests/test_cmd_list.py::test_list_mine_default`\n- `tests/test_cmd_list.py::test_list_all_excludes_others_private`\n- `tests/test_cmd_list.py::test_list_with_project_filter`\n- `tests/test_cmd_list.py::test_list_sorting_order`\n- `tests/test_cmd_list.py::test_list_limit`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"list: scope=%s project=%s returned %d rows\", scope, project, count)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #9: /todo board command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/009-cmd-board`                |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `board` subcommand. Groups tasks by section in fixed order (BACKLOG, DOING, WAITING, DONE, DROP), applies scope/project/status filters, and limits per section. Format: section headers with task lines underneath.\n\n**Acceptance Criteria**\n- [ ] Sections displayed in order: BACKLOG -> DOING -> WAITING -> DONE -> DROP\n- [ ] Empty sections shown with \"(empty)\" or omitted (decide and document)\n- [ ] `limitPerSection:N` caps items per section (default 10)\n- [ ] Scope/project filters identical to `list`\n- [ ] Each task line: `#id due:<date|-> assignees:<@U..> title`\n\n**Tests**\n- `tests/test_cmd_board.py::test_board_section_order`\n- `tests/test_cmd_board.py::test_board_limit_per_section`\n- `tests/test_cmd_board.py::test_board_scope_filter`\n\n**Rollback**\nRevert handler; read-only operation.\n\n**Observability**\n`logger.info(\"board: scope=%s project=%s sections=%s\", ...)`\n\n**Dependencies**\n#8\n\n---\n\n## Issue #10: /todo move command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/010-cmd-move`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `move` subcommand. Validates section enum, checks permissions (private: owner only; shared: assignee or created_by), updates task section and updated_at, logs event.\n\n**Acceptance Criteria**\n- [ ] Section validated against enum; invalid returns error\n- [ ] Private project: only owner can move\n- [ ] Shared project: only assignee or created_by can move\n- [ ] `updated_at` set on change\n- [ ] Event logged\n- [ ] Response confirms new section\n\n**Tests**\n- `tests/test_cmd_move.py::test_move_valid_section`\n- `tests/test_cmd_move.py::test_move_invalid_section`\n- `tests/test_cmd_move.py::test_move_private_owner_only`\n- `tests/test_cmd_move.py::test_move_shared_permission`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d moved to %s by %s\", id, section, sender)`\n\n**Dependencies**\n#6, #7\n\n---\n\n## Issue #11: /todo done and /todo drop commands\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/011-cmd-done-drop`            |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `done` and `drop` subcommands. Both set section and status accordingly, record `closed_at`, validate permissions same as `move`, and log event.\n\n**Acceptance Criteria**\n- [ ] `done`: section='done', status='done', closed_at=now\n- [ ] `drop`: section='drop', status='dropped', closed_at=now\n- [ ] Permissions enforced (same as move)\n- [ ] Already-closed task returns informational message (idempotent or error -- decide)\n- [ ] Event logged for each\n\n**Tests**\n- `tests/test_cmd_done_drop.py::test_done_sets_fields`\n- `tests/test_cmd_done_drop.py::test_drop_sets_fields`\n- `tests/test_cmd_done_drop.py::test_permission_check`\n- `tests/test_cmd_done_drop.py::test_already_done`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d %s by %s\", id, action, sender)`\n\n**Dependencies**\n#10\n\n---\n\n## Issue #12: /todo edit command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/012-cmd-edit`                 |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the `edit` subcommand (v1 replace semantics). Supports changing title, assignees (full replace), project, section, and due. Validates private-project assignee constraint on both source and target project. Logs event with old/new diff in payload.\n\n**Acceptance Criteria**\n- [ ] Title updated only if non-option tokens present\n- [ ] Mentions present -> assignees fully replaced (DELETE + INSERT)\n- [ ] `due:-` clears due to NULL\n- [ ] `/p <newProject>` moves task to new project (project_id updated)\n- [ ] Private project assignee validation applied to target project\n- [ ] If moving to private project with non-owner assignees -> warning, no change\n- [ ] Event payload contains changed fields\n- [ ] Permissions: private owner only; shared assignee/created_by\n\n**Tests**\n- `tests/test_cmd_edit.py::test_edit_title`\n- `tests/test_cmd_edit.py::test_edit_assignees_replace`\n- `tests/test_cmd_edit.py::test_edit_due_clear`\n- `tests/test_cmd_edit.py::test_edit_move_project`\n- `tests/test_cmd_edit.py::test_edit_private_assignee_rejected`\n- `tests/test_cmd_edit.py::test_edit_no_change_fields`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"Task #%d edited by %s: fields=%s\", id, sender, changed_fields)`\n\n**Dependencies**\n#6, #7, #10\n\n---\n\n## Issue #13: /todo project list command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/013-cmd-project-list`         |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project list`. Returns all shared projects and the sender's private projects. Format: grouped by visibility with name and task count.\n\n**Acceptance Criteria**\n- [ ] Shared projects listed regardless of sender\n- [ ] Sender's private projects listed\n- [ ] Other users' private projects NOT shown\n- [ ] Each project shows name, visibility, task count\n\n**Tests**\n- `tests/test_cmd_project.py::test_project_list_shows_shared`\n- `tests/test_cmd_project.py::test_project_list_shows_own_private`\n- `tests/test_cmd_project.py::test_project_list_hides_others_private`\n\n**Rollback**\nRevert handler; read-only.\n\n**Observability**\n`logger.info(\"project list: %d shared, %d private for %s\", ...)`\n\n**Dependencies**\n#7\n\n---\n\n## Issue #14: /todo project set-private command with assignee validation\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/014-cmd-project-set-private`  |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-private <name>` with the assignee validation described in PRD 3.4. Resolution flow: if sender already has private with that name -> noop; if shared exists -> attempt conversion; if neither -> create new private. Conversion scans all tasks in the project and rejects if any task has a non-owner assignee.\n\n**Acceptance Criteria**\n- [ ] Already-private for sender: returns \"already private\" message\n- [ ] Shared -> private: scans tasks; all assignees are owner -> success (visibility='private', owner_user_id=sender)\n- [ ] Shared -> private: at least one non-owner assignee -> error with task IDs and violating assignee list (max 10)\n- [ ] Neither exists: creates new private project with owner=sender\n- [ ] Error message format matches PRD example\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_private_already_private`\n- `tests/test_cmd_project.py::test_set_private_shared_success`\n- `tests/test_cmd_project.py::test_set_private_shared_rejected_non_owner_assignee`\n- `tests/test_cmd_project.py::test_set_private_creates_new`\n- `tests/test_cmd_project.py::test_set_private_error_message_format`\n\n**Rollback**\nRevert handler; no schema change.\n\n**Observability**\n`logger.info(\"project set-private: %s result=%s by %s\", name, result, sender)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #15: /todo project set-shared command\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M4                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/015-cmd-project-set-shared`   |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement `/todo project set-shared <name>`. Creates a shared project if none exists. If a shared project with that name already exists, noop. Global uniqueness enforced by DB index.\n\n**Acceptance Criteria**\n- [ ] New shared project created when name is free\n- [ ] Existing shared project: returns \"already shared\" / noop\n- [ ] Name conflict with existing shared: returns exists message (index enforces)\n- [ ] Event logged\n\n**Tests**\n- `tests/test_cmd_project.py::test_set_shared_creates_new`\n- `tests/test_cmd_project.py::test_set_shared_already_exists_noop`\n- `tests/test_cmd_project.py::test_set_shared_name_conflict`\n\n**Rollback**\nRevert handler.\n\n**Observability**\n`logger.info(\"project set-shared: %s result=%s\", name, result)`\n\n**Dependencies**\n#7, #13\n\n---\n\n## Issue #16: Command dispatcher and routing\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/016-dispatcher`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nImplement the dispatcher in `plugin.py` that maps the parsed command name to handler functions: `add`, `list`, `board`, `move`, `done`, `drop`, `edit`, `project`. The `project` command further dispatches to `list`, `set-private`, `set-shared`. Unknown commands return a help/error message.\n\n**Acceptance Criteria**\n- [ ] All valid command names routed to correct handler\n- [ ] `project` subcommands routed correctly\n- [ ] Unknown command returns usage hint\n- [ ] DB connection initialised (migration check) before first command execution\n\n**Tests**\n- `tests/test_dispatcher.py::test_routes_known_commands`\n- `tests/test_dispatcher.py::test_project_sub_routing`\n- `tests/test_dispatcher.py::test_unknown_command_help`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.info(\"Dispatching command=%s sub=%s\", command, sub)`\n\n**Dependencies**\n#5\n\n---\n\n## Issue #17: Permission helper module\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | Backend                                |\n| Milestone   | M3                                     |\n| Status      | TODO                                   |\n| Priority    | P0                                     |\n| Estimate    | 0.5d                                   |\n| Branch      | `feature/017-permissions`              |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExtract shared permission-checking logic into `src/openclaw_todo/permissions.py`. Provides `can_write_task(conn, task_id, sender_id) -> bool` and `validate_private_assignees(project, assignees, owner_id) -> Optional[str]` (returns warning message or None).\n\n**Acceptance Criteria**\n- [ ] Private project: only owner can write\n- [ ] Shared project: only assignee or created_by can write\n- [ ] `validate_private_assignees` returns warning string when non-owner assignees present for private project\n- [ ] Returns None for shared projects or when all assignees are owner\n\n**Tests**\n- `tests/test_permissions.py::test_private_owner_can_write`\n- `tests/test_permissions.py::test_private_non_owner_rejected`\n- `tests/test_permissions.py::test_shared_assignee_can_write`\n- `tests/test_permissions.py::test_shared_creator_can_write`\n- `tests/test_permissions.py::test_validate_private_assignees_warning`\n\n**Rollback**\nRevert module.\n\n**Observability**\n`logger.debug(\"Permission check: task=%d sender=%s result=%s\", ...)`\n\n**Dependencies**\n#4\n\n---\n\n## Issue #18: Parser unit tests (comprehensive)\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/018-parser-tests`             |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nExpand parser test coverage to include edge cases: multiple options in varied order, due at year boundary, empty title, mentions mixed with options, unicode in titles, extra whitespace handling.\n\n**Acceptance Criteria**\n- [ ] >=95% line coverage on `parser.py`\n- [ ] Edge cases documented in test docstrings\n- [ ] All tests pass with `uv run pytest tests/test_parser.py -v`\n\n**Tests**\n- `tests/test_parser.py::test_options_in_any_order`\n- `tests/test_parser.py::test_due_year_boundary`\n- `tests/test_parser.py::test_empty_title_no_crash`\n- `tests/test_parser.py::test_unicode_title`\n- `tests/test_parser.py::test_extra_whitespace`\n- `tests/test_parser.py::test_mixed_mentions_and_options`\n\n**Rollback**\nRevert test file; no production code change.\n\n**Observability**\nCI coverage report.\n\n**Dependencies**\n#5\n\n---\n\n## Issue #19: SQLite end-to-end integration tests\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | QA                                     |\n| Milestone   | M5                                     |\n| Status      | TODO                                   |\n| Priority    | P1                                     |\n| Estimate    | 1.5d                                   |\n| Branch      | `feature/019-e2e-tests`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nWrite integration tests that exercise the full flow through `handle_message` with a real (tmp_path) SQLite database. Cover the main user stories: add a task, list it, move it, mark done, edit it, manage projects, and validate private project constraints.\n\n**Acceptance Criteria**\n- [ ] Each test uses a fresh DB via `tmp_path` fixture\n- [ ] Scenarios: add->list, add->move->board, add->done, add->edit, project set-private rejection\n- [ ] Private project visibility enforced end-to-end\n- [ ] Due normalisation verified in DB\n- [ ] All tests pass with `uv run pytest tests/test_e2e.py -v`\n\n**Tests**\n- `tests/test_e2e.py::test_add_and_list_roundtrip`\n- `tests/test_e2e.py::test_add_move_board`\n- `tests/test_e2e.py::test_done_and_drop`\n- `tests/test_e2e.py::test_edit_title_and_assignees`\n- `tests/test_e2e.py::test_private_project_isolation`\n- `tests/test_e2e.py::test_set_private_rejects_foreign_assignees`\n- `tests/test_e2e.py::test_due_normalisation_stored_correctly`\n\n**Rollback**\nRevert test file.\n\n**Observability**\nCI test results and coverage delta.\n\n**Dependencies**\n#6, #8, #9, #10, #11, #12, #14, #15\n\n---\n\n## Issue #20: Packaging and distribution setup\n\n| Field       | Value                                  |\n|-------------|----------------------------------------|\n| Track       | DevOps                                 |\n| Milestone   | M6                                     |\n| Status      | TODO                                   |\n| Priority    | P2                                     |\n| Estimate    | 1d                                     |\n| Branch      | `feature/020-packaging`               |\n| GH-Issue    | --                                     |\n| PR          | --                                     |\n\n**Description**\nFinalise `pyproject.toml` metadata (name, version, description, license, entry-points), add a `Makefile` with targets for lint/test/build, and document installation instructions in README. Ensure the plugin can be installed as a package and discovered by the OpenClaw gateway.\n\n**Acceptance Criteria**\n- [ ] `pyproject.toml` has complete metadata and entry-point for OpenClaw plugin discovery\n- [ ] `make lint` runs ruff + black --check\n- [ ] `make test` runs pytest with coverage\n- [ ] `make build` produces a wheel via `uv build`\n- [ ] `pip install <wheel>` in a clean venv makes the plugin importable\n- [ ] README documents installation and configuration (DB path env var)\n\n**Tests**\n- Manual: install wheel in fresh venv, import module, call `handle_message`\n- `make test` passes in CI\n\n**Rollback**\nRevert packaging changes.\n\n**Observability**\nBuild artifact size logged; CI publishes wheel as artifact.\n\n**Dependencies**\n#19\n\n---\n\n## Dependency Graph (summary)\n\n```\n#1  Plugin skeleton\n |\n +--#2  DB connection\n |   |\n |   +--#3  Migration framework\n |       |\n |       +--#4  V1 schema\n |           |\n |           +--#7  Project resolver\n |           |   |\n |           |   +--#13 project list\n |           |   +--#14 project set-private\n |           |   +--#15 project set-shared\n |           |\n |           +--#17 Permissions helper\n |\n +--#5  Parser\n |   |\n |   +--#18 Parser tests (M5)\n |\n +--#16 Dispatcher\n     |\n     +--#6  cmd add       (#4,#5,#7,#17)\n     +--#8  cmd list      (#6,#7)\n     +--#9  cmd board     (#8)\n     +--#10 cmd move      (#6,#7,#17)\n     +--#11 cmd done/drop (#10)\n     +--#12 cmd edit      (#6,#7,#10,#17)\n\n#19 E2E tests    (all commands)\n#20 Packaging    (#19)\n```\n", "structuredPatch": [{"oldStart": 15, "oldLines": 7, "newStart": 15, "newLines": 7, "lines": [" | Priority    | P0                                     |", " | Estimate    | 1d                                     |", " | Branch      | `feature/001-plugin-skeleton`          |", "-| GH-Issue    | --                                     |", "+| GH-Issue    | https://github.com/pillip/openclaw_todo_plugin/issues/1 |", " | PR          | --                                     |", " ", " **Description**"]}], "userModified": false, "replaceAll": false}, "tool_use_id": "toolu_017d3m5CJ3pa8HzdntYWiTcd", "_ts": "2026-02-20T11:58:49+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "2", "status": "in_progress"}, "tool_use_id": "toolu_01YXGrSbeWE5jfe7bqAv5s7S", "_ts": "2026-02-20T11:58:52+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "2", "status": "in_progress"}, "tool_response": {"success": true, "taskId": "2", "updatedFields": ["status"], "statusChange": {"from": "pending", "to": "in_progress"}}, "tool_use_id": "toolu_01YXGrSbeWE5jfe7bqAv5s7S", "_ts": "2026-02-20T11:58:52+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "git checkout -b feature/001-plugin-skeleton", "description": "Create feature branch"}, "tool_use_id": "toolu_015BVii5f9T2AGR93PYSmXXX", "_ts": "2026-02-20T11:58:55+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "git checkout -b feature/001-plugin-skeleton", "description": "Create feature branch"}, "tool_response": {"stdout": "새로 만든 'feature/001-plugin-skeleton' 브랜치로 전환합니다", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_015BVii5f9T2AGR93PYSmXXX", "_ts": "2026-02-20T11:58:57+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo && mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/tests", "description": "Create source and test directories"}, "tool_use_id": "toolu_01NNUxD89zStfsLspcN2hUdW", "_ts": "2026-02-20T11:59:01+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo && mkdir -p /Users/pillip/project/practice/openclaw_todo_plugin/tests", "description": "Create source and test directories"}, "tool_response": {"stdout": "", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": true}, "tool_use_id": "toolu_01NNUxD89zStfsLspcN2hUdW", "_ts": "2026-02-20T11:59:01+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "content": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"\n"}, "tool_use_id": "toolu_01PhkKFpCFCrE81b6Kr4DeB3", "_ts": "2026-02-20T11:59:06+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "content": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "content": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01PhkKFpCFCrE81b6Kr4DeB3", "_ts": "2026-02-20T11:59:07+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/__init__.py", "content": "\"\"\"OpenClaw TODO Plugin — team/personal task management for Slack.\"\"\"\n\n__version__ = \"0.1.0\"\n"}, "tool_use_id": "toolu_01AD34uGmyCtVcFDtEwZkAeZ", "_ts": "2026-02-20T11:59:07+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/__init__.py", "content": "\"\"\"OpenClaw TODO Plugin — team/personal task management for Slack.\"\"\"\n\n__version__ = \"0.1.0\"\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/__init__.py", "content": "\"\"\"OpenClaw TODO Plugin — team/personal task management for Slack.\"\"\"\n\n__version__ = \"0.1.0\"\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01AD34uGmyCtVcFDtEwZkAeZ", "_ts": "2026-02-20T11:59:07+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "content": "\"\"\"Plugin entry-point for the OpenClaw gateway.\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n_TODO_PREFIX = \"/todo\"\n\n\ndef handle_message(text: str, context: dict) -> str | None:\n    \"\"\"Process an incoming Slack DM message.\n\n    Returns a response string for ``/todo`` commands, or ``None`` if the\n    message is not a TODO command.\n    \"\"\"\n    logger.debug(\"Inbound message: %s\", text)\n\n    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()\n\n    if not remainder:\n        return \"Usage: /todo <command> [options]\\nCommands: add, list, board, move, done, drop, edit, project\"\n\n    # Placeholder: will be replaced by dispatcher in Issue #16\n    return f\"TODO command received: {remainder}\"\n"}, "tool_use_id": "toolu_01K1wZ7nopPuLXWjvx8wtcJZ", "_ts": "2026-02-20T11:59:12+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "content": "\"\"\"Plugin entry-point for the OpenClaw gateway.\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n_TODO_PREFIX = \"/todo\"\n\n\ndef handle_message(text: str, context: dict) -> str | None:\n    \"\"\"Process an incoming Slack DM message.\n\n    Returns a response string for ``/todo`` commands, or ``None`` if the\n    message is not a TODO command.\n    \"\"\"\n    logger.debug(\"Inbound message: %s\", text)\n\n    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()\n\n    if not remainder:\n        return \"Usage: /todo <command> [options]\\nCommands: add, list, board, move, done, drop, edit, project\"\n\n    # Placeholder: will be replaced by dispatcher in Issue #16\n    return f\"TODO command received: {remainder}\"\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "content": "\"\"\"Plugin entry-point for the OpenClaw gateway.\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n_TODO_PREFIX = \"/todo\"\n\n\ndef handle_message(text: str, context: dict) -> str | None:\n    \"\"\"Process an incoming Slack DM message.\n\n    Returns a response string for ``/todo`` commands, or ``None`` if the\n    message is not a TODO command.\n    \"\"\"\n    logger.debug(\"Inbound message: %s\", text)\n\n    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()\n\n    if not remainder:\n        return \"Usage: /todo <command> [options]\\nCommands: add, list, board, move, done, drop, edit, project\"\n\n    # Placeholder: will be replaced by dispatcher in Issue #16\n    return f\"TODO command received: {remainder}\"\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01K1wZ7nopPuLXWjvx8wtcJZ", "_ts": "2026-02-20T11:59:12+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/__init__.py", "content": ""}, "tool_use_id": "toolu_01YUBLvJC1VQtsrYLPGsuCfC", "_ts": "2026-02-20T11:59:12+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/__init__.py", "content": ""}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/__init__.py", "content": "", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01YUBLvJC1VQtsrYLPGsuCfC", "_ts": "2026-02-20T11:59:12+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/test_plugin.py", "content": "\"\"\"Tests for the plugin entry-point.\"\"\"\n\nfrom openclaw_todo.plugin import handle_message\n\n\ndef test_ignores_non_todo_message():\n    \"\"\"Messages not starting with /todo should be silently ignored.\"\"\"\n    assert handle_message(\"hello world\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"some random text\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"/todox something\", {\"sender_id\": \"U1\"}) is None\n\n\ndef test_dispatches_todo_prefix():\n    \"\"\"Messages starting with /todo should return a response.\"\"\"\n    result = handle_message(\"/todo add buy milk\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"add buy milk\" in result\n\n\ndef test_todo_prefix_with_whitespace():\n    \"\"\"Leading/trailing whitespace should not prevent matching.\"\"\"\n    result = handle_message(\"  /todo add task  \", {\"sender_id\": \"U1\"})\n    assert result is not None\n\n\ndef test_todo_without_subcommand():\n    \"\"\"/todo alone should return usage information.\"\"\"\n    result = handle_message(\"/todo\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"Usage\" in result\n"}, "tool_use_id": "toolu_01LaNvip6jEMHWueCB9iht5q", "_ts": "2026-02-20T11:59:16+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/test_plugin.py", "content": "\"\"\"Tests for the plugin entry-point.\"\"\"\n\nfrom openclaw_todo.plugin import handle_message\n\n\ndef test_ignores_non_todo_message():\n    \"\"\"Messages not starting with /todo should be silently ignored.\"\"\"\n    assert handle_message(\"hello world\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"some random text\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"/todox something\", {\"sender_id\": \"U1\"}) is None\n\n\ndef test_dispatches_todo_prefix():\n    \"\"\"Messages starting with /todo should return a response.\"\"\"\n    result = handle_message(\"/todo add buy milk\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"add buy milk\" in result\n\n\ndef test_todo_prefix_with_whitespace():\n    \"\"\"Leading/trailing whitespace should not prevent matching.\"\"\"\n    result = handle_message(\"  /todo add task  \", {\"sender_id\": \"U1\"})\n    assert result is not None\n\n\ndef test_todo_without_subcommand():\n    \"\"\"/todo alone should return usage information.\"\"\"\n    result = handle_message(\"/todo\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"Usage\" in result\n"}, "tool_response": {"type": "create", "filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/tests/test_plugin.py", "content": "\"\"\"Tests for the plugin entry-point.\"\"\"\n\nfrom openclaw_todo.plugin import handle_message\n\n\ndef test_ignores_non_todo_message():\n    \"\"\"Messages not starting with /todo should be silently ignored.\"\"\"\n    assert handle_message(\"hello world\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"some random text\", {\"sender_id\": \"U1\"}) is None\n    assert handle_message(\"/todox something\", {\"sender_id\": \"U1\"}) is None\n\n\ndef test_dispatches_todo_prefix():\n    \"\"\"Messages starting with /todo should return a response.\"\"\"\n    result = handle_message(\"/todo add buy milk\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"add buy milk\" in result\n\n\ndef test_todo_prefix_with_whitespace():\n    \"\"\"Leading/trailing whitespace should not prevent matching.\"\"\"\n    result = handle_message(\"  /todo add task  \", {\"sender_id\": \"U1\"})\n    assert result is not None\n\n\ndef test_todo_without_subcommand():\n    \"\"\"/todo alone should return usage information.\"\"\"\n    result = handle_message(\"/todo\", {\"sender_id\": \"U1\"})\n    assert result is not None\n    assert \"Usage\" in result\n", "structuredPatch": [], "originalFile": null}, "tool_use_id": "toolu_01LaNvip6jEMHWueCB9iht5q", "_ts": "2026-02-20T11:59:16+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "2", "status": "completed"}, "tool_use_id": "toolu_01F8ffjTo4fR8BoghxukJs87", "_ts": "2026-02-20T11:59:19+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "2", "status": "completed"}, "tool_response": {"success": true, "taskId": "2", "updatedFields": ["status"], "statusChange": {"from": "in_progress", "to": "completed"}}, "tool_use_id": "toolu_01F8ffjTo4fR8BoghxukJs87", "_ts": "2026-02-20T11:59:19+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "3", "status": "in_progress"}, "tool_use_id": "toolu_013A32c8Us77TJMLVPXWMqL1", "_ts": "2026-02-20T11:59:20+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "TaskUpdate", "tool_input": {"taskId": "3", "status": "in_progress"}, "tool_response": {"success": true, "taskId": "3", "updatedFields": ["status"], "statusChange": {"from": "pending", "to": "in_progress"}}, "tool_use_id": "toolu_013A32c8Us77TJMLVPXWMqL1", "_ts": "2026-02-20T11:59:20+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_use_id": "toolu_012fUw2pHg8nXpVYupzLoV1q", "_ts": "2026-02-20T11:59:23+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUseFailure", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_use_id": "toolu_012fUw2pHg8nXpVYupzLoV1q", "error": "Exit code 1\nUsing CPython 3.11.13\nCreating virtual environment at: .venv\nResolved 10 packages in 1.13s\n   Building openclaw-todo-plugin @ file:///Users/pillip/project/practice/openclaw_todo_plugin\nDownloading pygments (1.2MiB)\n Downloading pygments\n  × Failed to build `openclaw-todo-plugin @\n  │ file:///Users/pillip/project/practice/openclaw_todo_plugin`\n  ├─▶ The build backend returned an error\n  ╰─▶ Call to `hatchling.backends.build_editable` failed (exit status: 1)\n\n      [stderr]\n      Traceback (most recent call last):\n        File \"<string>\", line 8, in <module>\n      ModuleNotFoundError: No module named 'hatchling.backends'\n\n      hint: This error likely indicates that `openclaw-todo-plugin@0.1.0`\n      depends on `hatchling.backends`, but doesn't declare it as a build\n      dependency. If `openclaw-todo-plugin` is a first-party package, consider\n      adding `hatchling.backends` to its `build-system.requires`. Otherwise,\n      either add it to your `pyproject.toml` under:\n\n      [tool.uv.extra-build-dependencies]\n      openclaw-todo-plugin = [\"hatchling.backends\"]\n\n      or `uv pip install hatchling.backends` into the environment and re-run\n      with `--no-build-isolation`.", "is_interrupt": false, "_ts": "2026-02-20T11:59:26+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "old_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"", "new_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "replace_all": false}, "tool_use_id": "toolu_01FCzZ5KVEFAPxrZpkUP5TvX", "_ts": "2026-02-20T11:59:29+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "old_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"", "new_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "replace_all": false}, "tool_response": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "oldString": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"", "newString": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "originalFile": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.backends\"\n", "structuredPatch": [{"oldStart": 19, "oldLines": 4, "newStart": 19, "newLines": 4, "lines": [" ", " [build-system]", " requires = [\"hatchling\"]", "-build-backend = \"hatchling.backends\"", "+build-backend = \"hatchling.build\""]}], "userModified": false, "replaceAll": false}, "tool_use_id": "toolu_01FCzZ5KVEFAPxrZpkUP5TvX", "_ts": "2026-02-20T11:59:29+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_use_id": "toolu_01HBPJ8vKQz1Re5rgLDhitJZ", "_ts": "2026-02-20T11:59:33+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUseFailure", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_use_id": "toolu_01HBPJ8vKQz1Re5rgLDhitJZ", "error": "Exit code 1\nResolved 10 packages in 2ms\n   Building openclaw-todo-plugin @ file:///Users/pillip/project/practice/openclaw_todo_plugin\n  × Failed to build `openclaw-todo-plugin @\n  │ file:///Users/pillip/project/practice/openclaw_todo_plugin`\n  ├─▶ The build backend returned an error\n  ╰─▶ Call to `hatchling.build.build_editable` failed (exit status: 1)\n\n      [stderr]\n      Traceback (most recent call last):\n        File \"<string>\", line 11, in <module>\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/build.py\",\n      line 83, in build_editable\n          return os.path.basename(next(builder.build(directory=wheel_directory,\n      versions=[\"editable\"])))\n      \n      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/plugin/interface.py\",\n      line 157, in build\n          artifact = version_api[version](directory, **build_data)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/wheel.py\",\n      line 522, in build_editable\n          return self.build_editable_detection(directory, **build_data)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/wheel.py\",\n      line 534, in build_editable_detection\n          for included_file in self.recurse_selected_project_files():\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/plugin/interface.py\",\n      line 182, in recurse_selected_project_files\n          if self.config.only_include:\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.local/share/uv/python/cpython-3.11.13-macos-aarch64-none/lib/python3.11/functools.py\",\n      line 1001, in __get__\n          val = self.func(instance)\n                ^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/config.py\",\n      line 715, in only_include\n          only_include = only_include_config.get(\"only-include\",\n      self.default_only_include()) or self.packages\n      \n      ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/wheel.py\",\n      line 268, in default_only_include\n          return self.default_file_selection_options.only_include\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.local/share/uv/python/cpython-3.11.13-macos-aarch64-none/lib/python3.11/functools.py\",\n      line 1001, in __get__\n          val = self.func(instance)\n                ^^^^^^^^^^^^^^^^^^^\n        File\n      \"/Users/pillip/.cache/uv/builds-v0/.tmp5L8rd3/lib/python3.11/site-packages/hatchling/builders/wheel.py\",\n      line 256, in default_file_selection_options\n          raise ValueError(message)\n      ValueError: Unable to determine which files to ship\n      inside the wheel using the following heuristics:\n      https://hatch.pypa.io/latest/plugins/builder/wheel/#default-file-selection\n\n      The most likely cause of this is that there is no directory that matches\n      the name of your project (openclaw_todo_plugin).\n\n      At least one file selection option must be defined\n      in the `tool.hatch.build.targets.wheel` table, see:\n      https://hatch.pypa.io/latest/config/build/\n\n      As an example, if you intend to ship a directory named `foo` that\n      resides within a `src` directory located at the root of your project,\n      you can define the following:\n\n      [tool.hatch.build.targets.wheel]\n      packages = [\"src/foo\"]\n\n      hint: This usually indicates a problem with the package or the build\n      environment.", "is_interrupt": false, "_ts": "2026-02-20T11:59:34+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml"}, "tool_use_id": "toolu_01S35Cvs2E2CAywPgctFLYuv", "_ts": "2026-02-20T11:59:37+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Read", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml"}, "tool_response": {"type": "text", "file": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "content": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"\n", "numLines": 23, "startLine": 1, "totalLines": 23}}, "tool_use_id": "toolu_01S35Cvs2E2CAywPgctFLYuv", "_ts": "2026-02-20T11:59:37+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "old_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "new_string": "[tool.hatch.build.targets.wheel]\npackages = [\"src/openclaw_todo\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "replace_all": false}, "tool_use_id": "toolu_01HkYFTfNUUEBZaP5HTf1wds", "_ts": "2026-02-20T11:59:40+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "old_string": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "new_string": "[tool.hatch.build.targets.wheel]\npackages = [\"src/openclaw_todo\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "replace_all": false}, "tool_response": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/pyproject.toml", "oldString": "[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "newString": "[tool.hatch.build.targets.wheel]\npackages = [\"src/openclaw_todo\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"", "originalFile": "[project]\nname = \"openclaw-todo-plugin\"\nversion = \"0.1.0\"\ndescription = \"OpenClaw TODO plugin for Slack — team/personal task management via DM\"\nreadme = \"README.md\"\nrequires-python = \">=3.11\"\ndependencies = []\n\n[dependency-groups]\ndev = [\n    \"pytest>=7.0\",\n    \"pytest-cov>=4.0\",\n]\n\n[tool.pytest.ini_options]\nminversion = \"7.0\"\naddopts = \"-ra\"\ntestpaths = [\"tests\"]\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"\n", "structuredPatch": [{"oldStart": 17, "oldLines": 6, "newStart": 17, "newLines": 9, "lines": [" addopts = \"-ra\"", " testpaths = [\"tests\"]", " ", "+[tool.hatch.build.targets.wheel]", "+packages = [\"src/openclaw_todo\"]", "+", " [build-system]", " requires = [\"hatchling\"]", " build-backend = \"hatchling.build\""]}], "userModified": false, "replaceAll": false}, "tool_use_id": "toolu_01HkYFTfNUUEBZaP5HTf1wds", "_ts": "2026-02-20T11:59:40+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_use_id": "toolu_01ScygNV534jMe7n8nGpbiA9", "_ts": "2026-02-20T11:59:43+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "uv sync 2>&1", "description": "Install dependencies with uv"}, "tool_response": {"stdout": "Resolved 10 packages in 2ms\n   Building openclaw-todo-plugin @ file:///Users/pillip/project/practice/openclaw_todo_plugin\n      Built openclaw-todo-plugin @ file:///Users/pillip/project/practice/openclaw_todo_plugin\nPrepared 1 package in 168ms\nInstalled 8 packages in 7ms\n + coverage==7.13.4\n + iniconfig==2.3.0\n + openclaw-todo-plugin==0.1.0 (from file:///Users/pillip/project/practice/openclaw_todo_plugin)\n + packaging==26.0\n + pluggy==1.6.0\n + pygments==2.19.2\n + pytest==9.0.2\n + pytest-cov==7.0.0", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_01ScygNV534jMe7n8nGpbiA9", "_ts": "2026-02-20T11:59:44+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "uv run pytest -q 2>&1", "description": "Run tests"}, "tool_use_id": "toolu_01KzdWPMRPsKyzJZSn7wkPWr", "_ts": "2026-02-20T11:59:47+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUseFailure", "tool_name": "Bash", "tool_input": {"command": "uv run pytest -q 2>&1", "description": "Run tests"}, "tool_use_id": "toolu_01KzdWPMRPsKyzJZSn7wkPWr", "error": "Exit code 1\nF...                                                                     [100%]\n=================================== FAILURES ===================================\n________________________ test_ignores_non_todo_message _________________________\n\n    def test_ignores_non_todo_message():\n        \"\"\"Messages not starting with /todo should be silently ignored.\"\"\"\n        assert handle_message(\"hello world\", {\"sender_id\": \"U1\"}) is None\n        assert handle_message(\"\", {\"sender_id\": \"U1\"}) is None\n        assert handle_message(\"some random text\", {\"sender_id\": \"U1\"}) is None\n>       assert handle_message(\"/todox something\", {\"sender_id\": \"U1\"}) is None\nE       AssertionError: assert 'TODO command received: x something' is None\nE        +  where 'TODO command received: x something' = handle_message('/todox something', {'sender_id': 'U1'})\n\ntests/test_plugin.py:11: AssertionError\n=========================== short test summary info ============================\nFAILED tests/test_plugin.py::test_ignores_non_todo_message - AssertionError: ...\n1 failed, 3 passed in 0.01s", "is_interrupt": false, "_ts": "2026-02-20T11:59:49+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "old_string": "    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "new_string": "    stripped = text.strip()\n    if not (stripped == _TODO_PREFIX or stripped.startswith(_TODO_PREFIX + \" \")):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "replace_all": false}, "tool_use_id": "toolu_017HaDYaHZZUiCWea2oLyC6V", "_ts": "2026-02-20T11:59:55+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Edit", "tool_input": {"file_path": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "old_string": "    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "new_string": "    stripped = text.strip()\n    if not (stripped == _TODO_PREFIX or stripped.startswith(_TODO_PREFIX + \" \")):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "replace_all": false}, "tool_response": {"filePath": "/Users/pillip/project/practice/openclaw_todo_plugin/src/openclaw_todo/plugin.py", "oldString": "    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "newString": "    stripped = text.strip()\n    if not (stripped == _TODO_PREFIX or stripped.startswith(_TODO_PREFIX + \" \")):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    remainder = stripped[len(_TODO_PREFIX) :].strip()", "originalFile": "\"\"\"Plugin entry-point for the OpenClaw gateway.\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n_TODO_PREFIX = \"/todo\"\n\n\ndef handle_message(text: str, context: dict) -> str | None:\n    \"\"\"Process an incoming Slack DM message.\n\n    Returns a response string for ``/todo`` commands, or ``None`` if the\n    message is not a TODO command.\n    \"\"\"\n    logger.debug(\"Inbound message: %s\", text)\n\n    stripped = text.strip()\n    if not stripped.startswith(_TODO_PREFIX):\n        return None\n\n    logger.info(\"/todo prefix matched\")\n\n    # Extract the part after \"/todo\"\n    remainder = stripped[len(_TODO_PREFIX) :].strip()\n\n    if not remainder:\n        return \"Usage: /todo <command> [options]\\nCommands: add, list, board, move, done, drop, edit, project\"\n\n    # Placeholder: will be replaced by dispatcher in Issue #16\n    return f\"TODO command received: {remainder}\"\n", "structuredPatch": [{"oldStart": 18, "oldLines": 12, "newStart": 18, "newLines": 11, "lines": ["     logger.debug(\"Inbound message: %s\", text)", " ", "     stripped = text.strip()", "-    if not stripped.startswith(_TODO_PREFIX):", "+    if not (stripped == _TODO_PREFIX or stripped.startswith(_TODO_PREFIX + \" \")):", "         return None", " ", "     logger.info(\"/todo prefix matched\")", " ", "-    # Extract the part after \"/todo\"", "     remainder = stripped[len(_TODO_PREFIX) :].strip()", " ", "     if not remainder:"]}], "userModified": false, "replaceAll": false}, "tool_use_id": "toolu_017HaDYaHZZUiCWea2oLyC6V", "_ts": "2026-02-20T11:59:55+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "uv run pytest -q 2>&1", "description": "Run tests"}, "tool_use_id": "toolu_01FsWXr8S21xTZpMoUy2j3DZ", "_ts": "2026-02-20T11:59:58+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "uv run pytest -q 2>&1", "description": "Run tests"}, "tool_response": {"stdout": "....                                                                     [100%]\n4 passed in 0.00s", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_01FsWXr8S21xTZpMoUy2j3DZ", "_ts": "2026-02-20T11:59:58+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "git status", "description": "Show working tree status"}, "tool_use_id": "toolu_01PfD4RffoeCygbyUJ3iG5Gj", "_ts": "2026-02-20T12:00:01+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "git status", "description": "Show working tree status"}, "tool_response": {"stdout": "현재 브랜치 feature/001-plugin-skeleton\n커밋할 변경 사항:\n  (use \"git restore --staged <file>...\" to unstage)\n\t새 파일:       .claude-kit\n\t새 파일:       .gitmodules\n\n추적하지 않는 파일:\n  (커밋할 사항에 포함하려면 \"git add <파일>...\"을 사용하십시오)\n\t.claude/\n\tSTATUS.md\n\tdocs/\n\tissues.md\n\topenclaw_todo_plugin_prd.md\n\tpyproject.toml\n\tsrc/\n\ttests/\n\tuv.lock", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_01PfD4RffoeCygbyUJ3iG5Gj", "_ts": "2026-02-20T12:00:01+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "git log --oneline -5 2>&1", "description": "Check recent commits"}, "tool_use_id": "toolu_017S69dUxgZDHYs3GE4jQnpv", "_ts": "2026-02-20T12:00:05+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PostToolUse", "tool_name": "Bash", "tool_input": {"command": "git log --oneline -5 2>&1", "description": "Check recent commits"}, "tool_response": {"stdout": "fb1a126 Initial commit", "stderr": "", "interrupted": false, "isImage": false, "noOutputExpected": false}, "tool_use_id": "toolu_017S69dUxgZDHYs3GE4jQnpv", "_ts": "2026-02-20T12:00:05+0900"}
{"session_id": "fed9c7ac-2183-4d64-a248-ba295d4fda46", "transcript_path": "/Users/pillip/.claude/projects/-Users-pillip-project-practice-openclaw-todo-plugin/fed9c7ac-2183-4d64-a248-ba295d4fda46.jsonl", "cwd": "/Users/pillip/project/practice/openclaw_todo_plugin", "permission_mode": "default", "hook_event_name": "PreToolUse", "tool_name": "Bash", "tool_input": {"command": "git add pyproject.toml uv.lock src/openclaw_todo/__init__.py src/openclaw_todo/plugin.py tests/__init__.py tests/test_plugin.py issues.md STATUS.md .claude/ docs/ openclaw_todo_plugin_prd.md", "description": "Stage files for commit"}, "tool_use_id": "toolu_01Sjhz52vG5kPwE5FjmPDScT", "_ts": "2026-02-20T12:00:08+0900"}
